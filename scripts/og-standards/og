#!/bin/bash
# ABOUTME: Quick reference command for O&G Standards lookup
# ABOUTME: Wrapper script for common search operations

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
SEARCH_SCRIPT="$SCRIPT_DIR/search.py"

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

usage() {
    echo -e "${BLUE}O&G Standards Quick Reference${NC}"
    echo ""
    echo "Usage: og <command> [args]"
    echo ""
    echo "Commands:"
    echo "  search <query>     Search standards (e.g., og search \"API RP 2RD\")"
    echo "  api <query>        Search API standards only"
    echo "  dnv <query>        Search DNV standards only"
    echo "  astm <query>       Search ASTM standards only"
    echo "  iso <query>        Search ISO standards only"
    echo "  orgs               List all organizations"
    echo "  types [org]        List document types (optional: filter by org)"
    echo "  stats              Show database statistics"
    echo "  recent             Show recently modified documents"
    echo "  open <query>       Search and open first result"
    echo "  path <query>       Search and show file path"
    echo "  catalog            Open HTML catalog in browser"
    echo ""
    echo "Examples:"
    echo "  og search \"riser design\""
    echo "  og api \"RP 2RD\""
    echo "  og dnv \"fatigue\""
    echo "  og open \"API 5L\""
    echo ""
}

# Check if search script exists
if [ ! -f "$SEARCH_SCRIPT" ]; then
    echo -e "${RED}Error: search.py not found at $SEARCH_SCRIPT${NC}"
    exit 1
fi

case "$1" in
    search|s)
        shift
        python "$SEARCH_SCRIPT" "$@"
        ;;
    api)
        shift
        python "$SEARCH_SCRIPT" --org API "$@"
        ;;
    dnv)
        shift
        python "$SEARCH_SCRIPT" --org DNV "$@"
        ;;
    astm)
        shift
        python "$SEARCH_SCRIPT" --org ASTM "$@"
        ;;
    iso)
        shift
        python "$SEARCH_SCRIPT" --org ISO "$@"
        ;;
    norsok)
        shift
        python "$SEARCH_SCRIPT" --org Norsok "$@"
        ;;
    orgs|organizations)
        python "$SEARCH_SCRIPT" --list-orgs
        ;;
    types)
        shift
        if [ -n "$1" ]; then
            python "$SEARCH_SCRIPT" --list-types --org "$1"
        else
            python "$SEARCH_SCRIPT" --list-types
        fi
        ;;
    stats)
        python "$SEARCH_SCRIPT" --stats
        ;;
    recent)
        python "$SEARCH_SCRIPT" --recent
        ;;
    open)
        shift
        # Get first result path and open it
        result=$(python "$SEARCH_SCRIPT" "$@" -v --limit 1 2>/dev/null | grep "Path:" | head -1 | sed 's/.*Path: //')
        if [ -n "$result" ] && [ -f "$result" ]; then
            echo -e "${GREEN}Opening: $result${NC}"
            xdg-open "$result" 2>/dev/null || open "$result" 2>/dev/null || echo "File: $result"
        else
            echo -e "${YELLOW}No results found or file not accessible${NC}"
            python "$SEARCH_SCRIPT" "$@" --limit 5
        fi
        ;;
    path|p)
        shift
        python "$SEARCH_SCRIPT" "$@" -v --limit 5
        ;;
    catalog|browse)
        catalog_path="/mnt/ace/O&G-Standards/_catalog.html"
        if [ -f "$catalog_path" ]; then
            echo -e "${GREEN}Opening catalog: $catalog_path${NC}"
            xdg-open "$catalog_path" 2>/dev/null || open "$catalog_path" 2>/dev/null || echo "Catalog: $catalog_path"
        else
            echo -e "${RED}Catalog not found at: $catalog_path${NC}"
        fi
        ;;
    help|-h|--help)
        usage
        ;;
    "")
        usage
        ;;
    *)
        # Default: treat as search query
        python "$SEARCH_SCRIPT" "$@"
        ;;
esac
