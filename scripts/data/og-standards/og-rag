#!/bin/bash
# ABOUTME: Quick RAG query command for O&G Standards
# ABOUTME: Wrapper for semantic search with AI-powered answers

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
RAG_SCRIPT="$SCRIPT_DIR/rag.py"

# Force CPU mode for embeddings (GPU compatibility issues)
export CUDA_VISIBLE_DEVICES=""

# Colors
BLUE='\033[0;34m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

usage() {
    echo -e "${BLUE}O&G Standards AI Assistant${NC}"
    echo ""
    echo "Usage: og-rag [options] <question>"
    echo ""
    echo "Options:"
    echo "  -i, --interactive    Interactive Q&A mode"
    echo "  --ai claude          Use Claude for answers (requires ANTHROPIC_API_KEY)"
    echo "  --ai openai          Use OpenAI for answers (requires OPENAI_API_KEY)"
    echo "  -k, --top-k N        Number of source documents (default: 5)"
    echo "  --no-sources         Hide source citations"
    echo "  -h, --help           Show this help"
    echo ""
    echo "Examples:"
    echo "  og-rag \"What are API requirements for riser design?\""
    echo "  og-rag -i                    # Interactive mode"
    echo "  og-rag --ai claude \"DNV fatigue assessment methods\""
    echo ""
    echo "Environment Variables:"
    echo "  ANTHROPIC_API_KEY    For Claude AI responses"
    echo "  OPENAI_API_KEY       For OpenAI responses"
    echo ""
}

if [ ! -f "$RAG_SCRIPT" ]; then
    echo -e "${YELLOW}Error: rag.py not found at $RAG_SCRIPT${NC}"
    exit 1
fi

case "$1" in
    -h|--help|help)
        usage
        ;;
    -i|--interactive)
        echo -e "${GREEN}Starting interactive mode...${NC}"
        python "$RAG_SCRIPT" --interactive "${@:2}"
        ;;
    "")
        usage
        ;;
    *)
        python "$RAG_SCRIPT" "$@"
        ;;
esac
