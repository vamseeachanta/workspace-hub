---
id: WRK-130
title: Standardize analysis reporting for each OrcaWave structure type
status: blocked
priority: high
complexity: complex
compound: false
created_at: 2026-02-11 19:00:00+00:00
target_repos:
- digitalmodel
commit: null
spec_ref: null
related:
- WRK-125
- WRK-129
- WRK-031
- WRK-115
blocked_by: []
synced_to: []
plan: inline
plan_reviewed: true
plan_approved: false
percent_complete: 0
brochure_status: null
provider: codex
provider_alt: null
tags:
- reporting
- orcawave
- diffraction
- html-reports
- standardization
- analysis-outputs
- plotly
---

# Standardize Analysis Reporting for Each OrcaWave Structure Type

## What
Create a standardized reporting framework for OrcaWave (diffraction) analysis outputs, with per-hull-type report templates. Each hull category (barge, ship, spar, semi-sub, FPSO, LNGC) gets a dedicated HTML report with consistent format: RAO plots per DOF, added mass/damping matrices, wave excitation forces, mesh quality summary, solver comparison tables, hydrostatics summary, and roll critical damping analysis with peak-period annotation.

## Why
- Diffraction benchmark reports (barge r4, ship r1, spar r1) were built ad-hoc with custom scripts
- The r4 barge report format is the canonical template but not yet abstracted into reusable code
- Standard reports enable automated post-processing after every OrcaWave/AQWA run
- Consistent format across hull types makes cross-comparison straightforward
- Links to hull library (WRK-115) — reports should auto-reference cataloged hull metadata

## Scope
1. **Define standard diffraction output schema** — RAOs (6 DOF × N headings × N frequencies), added mass (6×6), radiation damping (6×6), wave excitation forces, mesh metadata, hydrostatics, roll damping
2. **Report template** — single-page HTML following r4 barge report convention (per-DOF 2-col grid, significance filter, vertical legends)
3. **Standard plots** — RAO amplitude/phase per DOF, added mass/damping vs frequency, wave force per heading
4. **Solver comparison** — side-by-side OrcaWave vs AQWA (vs BEMRosetta) when multiple solver results available
5. **Mesh quality section** — panel count, aspect ratio, watertight check, symmetry
6. **Hydrostatics section** — displacement, waterplane area, center of buoyancy, metacentric heights (GM_T, GM_L), moments of inertia, hydrostatic stiffness matrix
7. **Roll critical damping section** — compute critical damping from roll added mass + hydrostatic restoring, plot radiation damping as % of critical, annotate peak roll RAO period with critical damping ratio
8. **Report generator API** — `generate_diffraction_report(hull_id, solver_results) → HTML`
9. **Integration with hull catalog** — auto-populate hull metadata from `hull_panel_catalog.yaml`

## Acceptance Criteria
- [ ] Standard diffraction output schema defined (RAOs, matrices, forces, mesh, hydrostatics, roll damping)
- [ ] HTML report template following r4 barge canonical format
- [ ] Plotly interactive plots: RAO amplitude/phase, added mass/damping matrices, wave forces
- [ ] Hydrostatics summary table (displacement, waterplane area, CoB, GM_T, GM_L, hydrostatic stiffness)
- [ ] Roll critical damping plot: radiation damping as % of critical vs frequency, with annotation at peak roll RAO period
- [ ] Solver comparison layout when multiple results available
- [ ] Mesh quality summary section with panel statistics
- [ ] Report generator callable from benchmark scripts
- [ ] At least 2 example reports generated from existing benchmark data (barge, ship or spar)
- [ ] Reports self-contained (single HTML file; Plotly loaded via CDN with `include_plotlyjs='cdn'` for online use, or `include_plotlyjs=True` for fully offline mode — configurable via parameter)

## Plan

**Target**: `src/digitalmodel/hydrodynamics/diffraction/report_generator.py` (new) + extend `benchmark_plotter.py`

### Existing Assets (reuse)

| Component | Path | Purpose |
|-----------|------|---------|
| BenchmarkPlotter | `hydrodynamics/diffraction/benchmark_plotter.py` | r4 barge report rendering (HTML + Plotly) |
| BenchmarkRunner | `hydrodynamics/diffraction/benchmark_runner.py` | `_generate_html_report()` + `_generate_json_report()` |
| BenchmarkReport | `hydrodynamics/diffraction/multi_solver_comparator.py` | Report dataclass (consensus, per-DOF results) |
| GeometryQualityReport | `hydrodynamics/diffraction/geometry_quality.py` | Mesh quality metrics + recommendations |
| ComparisonReport | `hydrodynamics/diffraction/comparison_framework.py` | Solver-vs-solver comparison |
| RAO Plotter | `hydrodynamics/diffraction/rao_plotter.py` | Per-DOF RAO plots (amplitude + phase) |
| r4 barge report | `benchmark_output/barge_benchmark/r4_per_dof_report/` | Canonical HTML template |
| Hull catalog | `data/hull_library/catalog/hull_panel_catalog.yaml` | Hull metadata (23 entries) |
| PanelCatalogEntry | `hydrodynamics/hull_library/panel_catalog.py` | Pydantic model for hull metadata |
| Benchmark scripts | `scripts/benchmark/regenerate_barge_benchmark.py`, `regenerate_ship_benchmark.py`, `run_spar_benchmark.py` | Per-hull benchmark orchestration |

### Phase 1 — Define Standard Diffraction Output Schema

- Create `DiffractionReportData` Pydantic model in `report_generator.py` with `schema_version: str = "1.0"` for forward compatibility:
  - `hull_metadata`: from `PanelCatalogEntry` (name, dimensions, panel count, symmetry)
  - `solver_results`: Dict[solver_name, SolverOutput] — RAOs (6 DOF × N headings × N freqs), added mass (6×6 × N freqs), radiation damping (6×6 × N freqs), wave excitation forces
  - `mesh_quality`: from `GeometryQualityReport` (panel count, aspect ratio, watertight, symmetry)
  - `hydrostatics`: displacement, waterplane area, center of buoyancy (x, y, z), metacentric heights (GM_T, GM_L), waterplane moments of inertia, hydrostatic stiffness matrix C (6×6)
  - `roll_damping`: roll radiation damping B_44(ω), roll added mass A_44(ω), hydrostatic restoring C_44, critical damping ratio ζ(ω) = B_44 / (2√((A_44 + I_44) × C_44)), peak roll RAO period T_peak
  - `comparison`: from `BenchmarkReport` (consensus level, per-DOF agreement)
  - `metadata`: solver versions, run dates, frequency/heading grids, unit systems
- Ensure schema can be serialized to JSON for archival

### Phase 2 — Extract & Refactor r4 Report Template

- Extract the inline HTML/CSS from `benchmark_plotter._render_html_with_table()` into a Jinja2-style template or string template
- Canonical layout (from r4 barge):
  - Header: hull name, dimensions, draft, displacement, solver names
  - Per-DOF sections: 2-col grid (45% text + table left, 55% Plotly plot right)
  - Significance filter: auto-omit headings < 1% of peak response
  - Vertical legends: right side, grouped by heading
  - Solver-column tables: headings as rows, solver names as columns
  - CSS: alternating rows, hover highlight, monospace numerics (Cascadia Code)
- Plotly conventions: `include_plotlyjs=False` + CDN, right margin 140+px, `tracegroupgap=2`

### Phase 3 — Report Generator API

- `generate_diffraction_report(report_data: DiffractionReportData, output_path: Path) -> Path`
- Sections generated:
  1. **Hull Summary** — auto-populated from `hull_panel_catalog.yaml` via hull_id lookup
  2. **Hydrostatics** — table of displacement, waterplane area, center of buoyancy, GM_T, GM_L, waterplane moments of inertia; hydrostatic stiffness matrix C displayed as 6×6 heatmap or formatted table
  3. **Mesh Quality** — panel stats, aspect ratio histogram, watertight check
  4. **RAO Plots** — amplitude + phase per DOF, all headings overlaid
  5. **Added Mass & Damping** — diagonal elements vs frequency, off-diagonal matrix heatmap
  6. **Roll Critical Damping** — plot of radiation damping B_44 as % of critical damping vs frequency/period; vertical annotation line at peak roll RAO period T_peak showing ζ value; critical damping computed as ζ(ω) = B_44(ω) / (2√((A_44(ω) + I_44) × C_44)); table of key values (T_peak, ζ at T_peak, B_44 at T_peak, A_44 at T_peak, C_44)
  7. **Wave Excitation** — force/moment per DOF per heading
  8. **Solver Comparison** — side-by-side tables + overlay plots (when 2+ solvers)
  9. **Summary Table** — peak values per DOF, natural periods, consensus level, roll critical damping ratio at peak
- Single self-contained HTML file with embedded Plotly CDN script tag

### Phase 4 — Per-Hull-Type Customization

Define hull-type-specific report tweaks (all share the base template):

| Hull Type | Customization |
|-----------|--------------|
| Barge | All 6 DOFs relevant, rectangular symmetry note |
| Ship | Note on roll damping (viscous), forward speed effects |
| Spar | Heave/pitch dominant, surge coupling note, deep draft context |
| Semi-sub | Column/pontoon interference, low-frequency resonance highlight |
| FPSO | Weathervaning note, turret position, spread mooring comparison |
| LNGC | Membrane tank sloshing note, side-by-side operation context |

- Implement as `HullTypeConfig` dict mapping hull category to display hints
- Auto-detect category from `hull_panel_catalog.yaml` entry

### Phase 5 — Integration & Validation

- Wire `generate_diffraction_report()` into existing benchmark scripts:
  - `regenerate_barge_benchmark.py` → call after benchmark completes
  - `regenerate_ship_benchmark.py` → same
  - `run_spar_benchmark.py` → same
- Generate 2 example reports from existing benchmark data (barge r4, ship r1)
- Verify: reports load in browser, Plotly interactive, all sections populated
- Unit tests: report generation with mock data (no solver dependency)
- Test tiers: (1) unit tests with mock DiffractionReportData (always run), (2) integration tests generating from existing benchmark JSON (run on licensed machine), (3) visual regression check (manual spot-check)

---
*Source: reporting for each structure in the orcawave module. standardize analysis outputs*
*Updated 2026-02-14: added hydrostatics section, roll critical damping section with peak-period annotation*
