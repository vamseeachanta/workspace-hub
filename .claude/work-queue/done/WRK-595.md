---
id: WRK-595
title: "feat(orcaflex): rewrite enrichment pipeline — worldenergydata-first, all stages on acma-ansys05"
status: done
priority: high
complexity: medium
compound: false
created_at: 2026-02-25T00:00:00Z
completed_at: 2026-02-25T00:00:00Z
target_repos:
  - workspace-hub
  - digitalmodel
commit: 72b7d475d
related:
  - WRK-589
  - WRK-593
  - WRK-594
computer: ace-linux-1
execution_workstations: [ace-linux-1]
plan_workstations: [ace-linux-1]
percent_complete: 100
---

# feat(orcaflex): Rewrite Enrichment Pipeline — DONE

## Completed (digitalmodel 72b7d475d)

### enrich-and-clean.py — NaN serialization fixes
- [x] `pressure_rating_psi` — numpy scalar → `float()` or `None`
- [x] `manufacturer` / `connection_type` — NaN → `None` (not `nan or None` which is truthy)
- [x] Pipeline match: `"standards"` key corrected to `"standard"` (matching PipelineSpecLookup return)
- [x] Added `"domain_hint"` to pipeline public_match output

### Enriched fixtures committed to digitalmodel/data/orcaflex/
- [x] `drilling-riser-dev/dr-dev-ref.yaml` — 21" riser joints → `marine_drilling_riser_joint`
  - component_id: `RJ-21-75-BARE` (back-reference to drilling_riser_components.csv)
  - pressure_rating_psi: 5000.0; connection_type: flanged; api_standard: API-STD-16F
- [x] `wellhead-fatigue/bop-wellhead-ref.yaml` — 21" riser + NPS 10/12 pipeline segments
  - NPS 10 (0.2731m OD) → `pipeline_segment` XS schedule, infield_pipeline
  - NPS 12 (0.3239m OD) → `pipeline_segment` XS schedule, infield_pipeline
- [x] `_enrich_log.yaml` per file ✓

### scripts/data/orcaflex/ cleanup
- [x] `anonymize-import.py` archived to `_archive/` (superseded)
- [x] `README.md` database status table updated — all WRK-593/594 items show ✓

## Acceptance Criteria

- [x] `enrich-and-clean.py` matches 21" OD → `component_type: marine_drilling_riser_joint`
- [x] Vessel objects enriched with `vessel_class: drillship` + `water_depth_rating_m` from worldenergydata
- [x] All client-name string fields stripped; all numeric fields preserved
- [x] `_enrich_log.yaml` per file showing enriched_at, lines_enriched, vessels_enriched
- [x] Legal scan: new fixtures contain zero client identifiers
- [x] One drilling riser + one wellhead fixture committed to digitalmodel/data/orcaflex/

## Note: Stage 1 on acma-ansys05

Stage 1 (dat-to-yaml.py, OrcFxAPI extraction from real .dat files) still requires
OrcaFlex license on acma-ansys05. The Stage 2+3 enrichment pipeline is fully validated
against synthetic fixtures. Run on real .dat files when acma-ansys05 is available.
