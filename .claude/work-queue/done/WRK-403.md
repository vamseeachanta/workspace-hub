---
id: WRK-403
status: done
---

# WRK-403: Resolve worldenergydata dual validation packages

**Status**: done
**Complexity**: medium
**Computer**: ace-linux-1
**Phase**: 3 (Phase B - Medium Refactor)
**Related**: WRK-345 (DataValidator moved to assetutilities, NOT worldenergydata.common)
**Audit**: 2026-02-24 (see audit section below)
**Percent complete**: 100
**Completed at**: 2026-02-24

## Problem

Two incompatible validation packages exist:
- `src/worldenergydata/validation/` — 3,030 LOC, class-based framework, **ACTIVE production code**
- `src/worldenergydata/common/validation/` — 1,135 LOC, Pydantic function-based, **test-only (zero src/ imports)**

## ⚠️ DIRECTION CORRECTION (from original WRK)

Original WRK had direction BACKWARDS. Audit findings:
- `validation/` is the canonical package (active BSEE well_data_verification imports)
- `common/validation/` is the orphaned duplicate (no src/ callers, test-only)
- **DELETE `common/validation/`**, keep `validation/`

## Blocker: pytest hang

Both validation test suites hang indefinitely. Investigation (2026-02-24) confirms:
- Direct imports work fine (`from worldenergydata.validation import ValidationSchema` → OK)
- Test files load successfully in isolation
- Hang is in pytest's internal session initialization, NOT in test code
- **Root cause**: `asyncio_mode = auto` in `pytest.ini` + pytest-asyncio interaction causes
  event loop deadlock when targeting specific subdirs (whole-suite `--collect-only` works)
- **Fix**: Change `asyncio_mode = auto` → `asyncio_mode = strict` in pytest.ini
  (or add `-p no:asyncio` to the pytest run command for validation tests only)
- **Key files**: `tests/conftest.py` line 251-260 (pytest_configure), `pytest.ini` line 42

## Tasks

1. Fix pytest hang in tests/unit/validation/ (investigate conftest.py, logging setup)
2. Port any unique test cases from `tests/unit/common/validation/` → `tests/unit/validation/` where APIs are compatible
3. Delete `src/worldenergydata/common/validation/` (4 files)
4. Delete `tests/unit/common/validation/` (3 test files)
5. Update `tests/unit/common/test_validation.py` — remove common.validation imports, replace with validation/ equivalents or delete
6. Update `src/worldenergydata/common/__init__.py` if it re-exports common.validation
7. Run BSEE tests to confirm: `pytest tests/unit/bsee/ -v`
8. Commit in worldenergydata submodule

## Active production callers of validation/

- `src/worldenergydata/bsee/analysis/well_data_verification/base.py`
  → imports: ValidationError, ValidationResult, ValidationSchema, DataValidator
- `src/worldenergydata/bsee/analysis/well_data_verification/quality.py`
  → imports: ValidationResult, ValidationRule

## Acceptance Criteria

- [x] `src/worldenergydata/common/validation/` deleted (orphan removed)
- [x] `tests/unit/common/validation/` deleted
- [x] BSEE well_data_verification tests pass (58/58 tests pass)
- [x] No hanging tests in validation/ suite (loguru→logging fix committed in 474cff5)
- [x] `src/worldenergydata/validation/base.py` uses stdlib `logging` (loguru import fixed)
