---
id: WRK-644
title: "feat(review): define Claude-specific compact review bundle for plan reviews"
status: done
priority: high
complexity: medium
route: B
compound: false
created_at: 2026-02-28T00:00:00Z
target_repos:
  - workspace-hub
commit:
spec_ref:
related:
  - WRK-624
  - WRK-640
  - WRK-642
blocked_by: []
parent:
synced_to: []
plan_reviewed: true
plan_approved: true
percent_complete: 100
brochure_status: n/a
computer: ace-linux-1
execution_workstations: [ace-linux-1]
plan_workstations: [ace-linux-1]
provider: codex
provider_alt: claude
cross_review: strong
html_output_ref: assets/WRK-644/review.html
claim_routing_ref: .claude/work-queue/assets/WRK-644/claim-evidence.yaml
plan_html_review_draft_ref: .claude/work-queue/assets/WRK-644/plan-html-review-draft.md
plan_html_review_final_ref: .claude/work-queue/assets/WRK-644/plan-html-review-final.md
html_verification_ref: .claude/work-queue/assets/WRK-644/html-verification.md
---

# feat(review): Define Claude-Specific Compact Review Bundle for Plan Reviews

## Problem

`WRK-642` established that Claude non-interactive review transport is functional
on a minimal schema control case, but not reliable on `WRK-624`-sized review
inputs. The current compact review bundle for plan reviews is still too large or
poorly shaped for reliable Claude execution in non-interactive mode.

The review workflow now needs a narrower, provider-specific compact bundle for
Claude so that Claude can contribute substantive plan-review output instead of
falling back to repeated `NO_OUTPUT` classification.

## What

Define, implement, and validate a Claude-specific compact review bundle for plan
reviews.

Scope:
1. define the minimum review payload Claude needs for substantive plan review
2. create a provider-specific compact bundle format for Claude plan-review runs
3. update review scripts or prompts to support that bundle cleanly
4. validate the new bundle against at least one real plan-review target
5. document limits, fallback rules, and artifact generation requirements
6. produce HTML review output for user inspection

## Why

- multi-agent plan review is a core workflow gate under `WRK-624`
- Claude should contribute substantive review output where possible, not only
  transport-heartbeat smoke tests
- `WRK-642` already narrowed the problem to payload boundary and wrapper cleanup
- a smaller review bundle is the most direct next experiment with practical value

## Deliverables

1. Claude-specific compact review bundle definition
2. supporting prompt/wrapper adjustments if needed
3. validation results against a real plan-review target
4. documented operational boundary for Claude plan reviews
5. HTML review artifact summarizing the bundle and validation results

## Plan

### Phase 1 - Define bundle contract

- identify required sections from a full plan for Claude review
- remove non-essential sections that increase payload without improving review
- define canonical bundle fields and formatting

### Phase 2 - Implement bundle generation

- add script support or artifact generation for the Claude-specific bundle
- ensure output is deterministic and reusable across WRKs
- keep the bundle interpretable by other agents and humans

### Phase 3 - Validate on real plan review

- run Claude against the new bundle on a real target, starting with `WRK-624`
- record whether Claude returns schema-valid substantive review output
- compare result against prior `WRK-642` failure cases
- generate HTML review artifact for the user

### Test Strategy

- include at least one smoke-test control and one real plan-review target
- validate returned output with `scripts/review/validate-review-output.sh`
- record exact bundle size/shape and command path used
- verify wrapper exits cleanly under success and failure cases

### Review Strategy

- Codex review of bundle contract and implementation
- Claude result treated as target evidence, not sole review authority
- Gemini may be used for secondary review if needed

## Acceptance Criteria

- [x] Claude-specific compact review bundle is defined
- [x] Bundle generation path is documented or scripted
- [x] At least one real plan-review target is tested with the new bundle
- [x] Claude returns either a schema-valid substantive review or a clearly smaller failure boundary
- [x] Wrapper/prompt path used for validation is recorded
- [x] HTML review artifact exists for user inspection

## Evidence

- Bundle artifact: `/mnt/local-analysis/workspace-hub/.claude/work-queue/assets/WRK-644/wrk-624-claude-compact-bundle.md`
- Validation results: `/mnt/local-analysis/workspace-hub/.claude/work-queue/assets/WRK-644/results.md`
- HTML review artifact: `/mnt/local-analysis/workspace-hub/.claude/work-queue/assets/WRK-644/review.html`

## Outcome

The Claude-specific compact plan bundle is now implemented, scripted, and wired
into `submit-to-claude.sh --compact-plan`. The bundle reduces the `WRK-624` plan
payload by about 72 percent and provides a deterministic provider-specific input
surface for future plan-review experiments.

Validation on the real `WRK-624` target shows that Claude still does not return
substantive non-interactive review output on this plan-review workload. The new
bundle therefore improves tooling and narrows the operational boundary, but does
not yet unlock successful Claude plan review on this target.
