---
id: WRK-614
title: Research FreeCAD Ship Workbench for offset-table-driven parametric hull generation
status: done
priority: medium
complexity: medium
compound: false
created_at: 2026-02-25T00:00:00Z
completed_at: 2026-02-26T00:00:00Z
target_repos:
  - CAD-DEVELOPMENTS
commit: b8c50f6
spec_ref:
related:
  - WRK-611
  - WRK-394
blocked_by:
synced_to: []
plan_ensemble: false
ensemble_consensus_score: null
plan_reviewed: false
plan_approved: false
percent_complete: 100
brochure_status:
computer: ace-linux-2
---

# Research FreeCAD Ship Workbench for offset-table-driven parametric hull generation

## What

Research the FreeCAD Ship Workbench (built-in module) and determine whether it can generate 3D hull geometry from a standard naval architecture offset table (waterplane half-breadths by station and waterline). If viable, build a proof-of-concept `agents/geometry_agent.py` that accepts an offset table YAML and outputs a FreeCAD `.FCStd` + STEP export using the Ship Workbench Python API.

## Why

The existing FreeCAD files were built by hand (Curves Workbench — sketches + interpolation curves + lofts). This works but is not automatable by AI agents. The FreeCAD Ship Workbench provides a parametric hull representation (hydrostatics, tank definitions, stability) from a standardised offset table — which IS AI-automatable: an agent can generate the offset table from a brief and then drive FreeCAD headlessly.

Offset tables are the universal input format in naval architecture (used by Maxsurf, Rhino/Orca3D, ShipConstructor) — making this the highest-leverage upstream input format.

## Acceptance Criteria

- [ ] Research note at `docs/research/freecad-ship-workbench.md`: Ship Workbench capabilities, offset table format, Python API, headless execution feasibility
- [ ] Example offset table YAML at `specs/hulls/small_boat_offsets.yaml` representing a simple 5m planing hull
- [ ] Proof-of-concept: FreeCAD headless script that reads the offset table and generates a hull shape (run on ace-linux-2: `FreeCAD -c agents/geometry_agent.py`)
- [ ] Assessment: Ship Workbench vs. Curves Workbench loft approach — which is more AI-agent-friendly?
- [ ] If headless FreeCAD works: `agents/geometry_agent.py` stub reads offset YAML, generates `.FCStd` + STEP export
- [ ] Pushed to `bakkiprasad5669/CAD-DEVELOPMENTS`

## Research Questions

1. Does FreeCAD Ship Workbench support headless execution (no GUI) via `FreeCAD -c script.py`?
2. What is the Python API for creating a Ship hull from an offset table in the Ship Workbench?
3. Can we export directly to STEP/IGES from the Ship Workbench hull object?
4. How does the Ship Workbench hull compare to a Curves Workbench loft for FEA mesh quality?
5. Is `build123d` (modern OCC Python library) a better alternative to FreeCAD for headless hull generation?

## Agentic AI Horizon

- Offset table → hull geometry is the key AI-generatable upstream step: LLM can produce offset tables from a natural language description ("5m planing hull, beam 2m, deadrise 12°")
- Connects directly to WRK-394 (planing hull strip theory): hull geometry from offset table → hydrodynamic mesh → seakeeping analysis
- build123d (pure Python OCC) may be the long-term winner over FreeCAD for headless AI-agent use

## Implementation Notes (2026-02-26, ace-linux-2)

**Files created/modified:**
- `agents/geometry_agent.py` (215 lines) — FreeCAD backend working, build123d deferred
- `tests/test_geometry_agent.py` (112 lines) — 8 tests, all passing
- `specs/hulls/small_planing_hull.yaml` — 9-station, 5-waterline offset table (5m LOA)
- `docs/research/freecad-ship-workbench.md` — research findings

**Key finding:** Ship Workbench is an analysis layer (hydrostatics, tank definitions), NOT a geometry generator. It wraps existing solids. The Part module with B-spline interpolation + loft is the correct approach for AI-agent hull generation.

**Approach:** offset table YAML → B-spline section curves at each station → `Part.makeLoft()` → mirror about XZ plane → fuse → STEP + FCStd export.

**FreeCAD headless gotcha:** `freecadcmd -c script.py --backend freecad` fails because FreeCAD parses all CLI args. Fixed by using environment variables (`HULL_SPEC`, `HULL_BACKEND`, `HULL_OUTPUT`) and `freecadcmd -c "exec(open('script.py').read())"`.

**FreeCAD stdout noise:** STEP transfer stats mix into stdout. Fixed by writing `_result.json` to disk; tests read that file instead of parsing stdout.

**Commit:** `b8c50f6` (auto-sync picked up)

---
*Source: WRK-610 analysis — geometry_agent.py is Stage 0 of the AI-agent FEA pipeline; offset tables are the standard naval architecture parametric input.*
