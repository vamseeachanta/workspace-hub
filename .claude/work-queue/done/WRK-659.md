---
id: WRK-659
title: "test(workflow): sandbox multi-agent gate enforcement"
status: done
route: C
priority: high
complexity: medium
compound: false
created_at: 2026-03-01T12:35:00Z
target_repos:
  - workspace-hub
commit:
spec_ref:
related:
  - WRK-658
blocked_by: []
synced_to: []
plan_reviewed: true
plan_approved: true
percent_complete: 100
brochure_status: n/a
computer: ace-linux-1
execution_workstations: [ace-linux-1]
plan_workstations: [ace-linux-1]
provider: claude
orchestrator: claude
cross_review: done
plan_html_review_draft_ref: .claude/work-queue/assets/WRK-659/plan-html-review-final.md
plan_html_review_final_ref: .claude/work-queue/assets/WRK-659/plan-html-review-final.md
html_output_ref: assets/WRK-659/wrk-659-plan-review-final.html
html_verification_ref: assets/WRK-659/wrk-659-plan-review-final.html
resource_pack_ref: .claude/work-queue/assets/WRK-659/resource-pack.md
claim_routing_ref: .claude/work-queue/assets/WRK-659/claim-evidence.yaml
locked_by: "session-20260301083906"
locked_at: "2026-03-01T20:44:26Z"
completed_at: 2026-03-01T23:07:35Z
---
# test(workflow): Sandbox multi-agent gate enforcement

## Purpose

Establish the logging + validator guard end-to-end across Claude, Codex, and Gemini in a controlled sandbox WRK. Every agent run must:

1. Go through the `/work run` wrappers with logging entries for start/finish.
2. Present the final HTML with human-review confirmation.
3. Record full gate evidence (plan, cross-review, TDD, legal) under the WRK assets.
4. Let `verify-gate-evidence.py` validate the gates before claiming/closing.

## Plan
- **Spec**: `assets/WRK-659/wrk-659-plan-review-draft.html` (plan HTML — user confirmed)
- **Steps**: Reset WRK → session init → plan HTML → cross-review (Codex+Gemini) → TDD → legal → verify gates → close
- **Test**: smoke tests for session.sh, log-gate-event.sh, verify-gate-evidence.py, plan.sh
- **Verify**: `verify-gate-evidence.py WRK-659` exits 0 before close

*Approved by user: 2026-03-01*

## Acceptance Criteria
- [x] Logs under `.claude/work-queue/logs/WRK-659-*.log` show start/close per agent.
- [x] `verify-gate-evidence.py WRK-659` passes after cross-review/TDD/legal artifacts are in place.
- [x] HTML button records human-review confirmation for the sandbox test.
- [x] Claim evidence references the validator template and notes the NO_OUTPUT policy.
