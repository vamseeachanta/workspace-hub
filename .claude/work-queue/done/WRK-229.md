---
id: WRK-229
title: AI agent QA closure — HTML output + SME verification loop per work item
status: done
priority: high
created: 2026-02-21
area: workspace-infra
related: WRK-228
computer: ace-linux-1
execution_workstations: [ace-linux-1]
plan_workstations: [ace-linux-1]
percent_complete: 100
completed_at: 2026-02-24
qa_verdict: PASS
---

# WRK-229: AI agent QA closure loop

## Problem

AI agents currently leave too much verification work to the user. After an agent
completes a task, the user must manually inspect outputs, run checks, and confirm
correctness. This creates friction and misses errors that automated QA could catch.

Root causes identified:
- No standard HTML output per work item (no input/output/QA artefact)
- Agents rely on text-only confirmation rather than data-driven verification
- Subject matter expert (SME) skills exist (OrcaWave, AQWA, mesh, etc.) but are not
  automatically invoked after task completion
- No correlation / regression check closing the loop end-to-end

## Goal

Every work item that produces a computational or analytical output should automatically:

1. Generate a **paired HTML report** (input → process → output → QA verdict)
2. Invoke **relevant SME verification skills** (e.g. `orcaflex-specialist`, `hydrodynamic-analysis`)
3. Run **data quality checks** (correlations, unit validation, range checks)
4. Produce a **QA verdict** (PASS / WARN / FAIL) before marking the item complete

## Proposed Standard

### HTML Output Template (per work item)

```
WRK-NNN-report.html
├── Section 1: Inputs (spec.yml / config digest)
├── Section 2: Process log (steps taken, tools invoked)
├── Section 3: Outputs (tables, plots, key numbers)
├── Section 4: QA checks (automated assertions)
│   ├── SME skill verdict
│   ├── Correlation matrix (if numerical output)
│   └── Unit / range validation
└── Section 5: Verdict (PASS / WARN / FAIL + rationale)
```

### Agent Behaviour Change

Agents must NOT mark a WRK item complete until:
- [ ] Output artefacts exist and are readable
- [ ] At least one automated QA check has run and passed
- [ ] HTML report generated and linked in WRK item

## SME Skills to Auto-Invoke

| Output type | SME skill |
|-------------|
-----------|
| RAO / diffraction results | `orcaflex-specialist`, `hydrodynamic-analysis` |
| Mooring analysis | `mooring-analysis` |
| Mesh output | `gmsh-meshing` or `cad-mesh-generation` |
| Data pipeline | `polars` / `pandas` |
| Any numerical comparison | correlation + unit check |

## Implementation Plan

1. **Define HTML template** — `specs/modules/qa-loop/wrk-html-template.md`
2. **Add QA hook** — `scripts/work-queue/qa-check.sh <WRK-ID>` runs SME skill + generates HTML
3. **Wire into work item lifecycle** — pre-complete gate in `scripts/agents/work.sh`
4. **Pilot on 2 existing WRK items** — WRK-149 (test coverage) and WRK-209 (water_density)
5. **Update CLAUDE.md** — document QA closure as mandatory before WRK completion

## Acceptance Criteria

- [x] HTML template defined and approved
- [x] `qa-check.sh` script implemented
- [x] 2 pilot WRK items completed with HTML QA reports
- [x] Agent completion gate updated (no close without QA PASS)
- [x] `ensure-readiness.sh` flags WRK items marked complete without QA report

## Notes

- WRK-228 (terminal UX) uses the same HTML output standard — coordinate templates
- Chrome Claude extension (WRK-228) will be the primary viewer for HTML reports
- This item is architectural — affects all future work items once implemented
