---
id: WRK-378
title: "Generalise CT hydraulics to full wellbore hydraulics module in digitalmodel"
status: done
priority: high
complexity: simple
compound: false
created_at: 2026-02-24T13:00:00Z
target_repos:
  - digitalmodel
commit: b90c4167d8f8555edec8adabe36c4c1b6142a1ba
spec_ref:
related: [WRK-375, WRK-377]
blocked_by: []
synced_to: []
plan_ensemble: false
ensemble_consensus_score: null
plan_reviewed: false
plan_approved: false
percent_complete: 100
brochure_status: pending
computer: ace-linux-1
---

# Generalise CT Hydraulics to Full Wellbore Hydraulics Module

## What

The existing `digitalmodel/src/digitalmodel/marine_ops/ct_hydraulics/ct_hydraulics.py`
already implements: ECD calculation, pressure drop (Darcy-Weisbach), Reynolds number,
friction factor (laminar/turbulent), pump pressure, and travel/bottoms-up time — but
is hard-coded for coiled tubing pipe dimensions.

This work generalises it to a `WellboreHydraulics` class at
`src/digitalmodel/well/drilling/hydraulics.py` that accepts arbitrary pipe/annulus
geometry and adds:
- **Annular velocity** for any pipe OD + hole diameter pair
- **Cuttings transport ratio** (AV vs minimum slip velocity)
- **Multi-section** pressure drop (surface line + drillstring + BHA + annulus)
- **Mud weight window** input validation (pore pressure to fracture gradient)

## Why

ECD is the primary pressure management variable in drilling — it determines whether
the wellbore is over or underbalanced at any depth. Without a generalised hydraulics
model, no drilling controller can enforce the safe operating window. This is an H1
gap from the Drillbotics capability path (WRK-375) and from
`docs/vision/VISION.md`.

Estimated effort is low (~250 lines) since the CT foundation is already tested.

## Acceptance Criteria

- [x] `digitalmodel/src/digitalmodel/well/drilling/hydraulics.py` created
- [x] `WellboreHydraulics` class: accepts `pipe_od`, `pipe_id`, `hole_diameter`,
  `mud_weight`, `flow_rate`, `tvd`, `plastic_viscosity`, `yield_point`
- [x] `.ecd(annular_pressure_loss) -> float` — equivalent circulating density (ppg)
- [x] `.annular_velocity() -> float` — ft/min
- [x] `.pressure_drop_annulus() -> float` — psi
- [x] `.cuttings_transport_ratio() -> float` — 0–1 (>0.5 = adequate hole cleaning)
- [x] Existing `ct_hydraulics.py` tests continue to pass (no regression)
- [x] New unit tests covering at least one field-realistic scenario with known ECD
- [x] Exported from `digitalmodel.well.drilling` package `__init__.py`

## Agentic AI Horizon

- ECD management is the pressure control loop in autonomous drilling — agents can
  monitor ECD in real time and adjust flow rate to stay inside the mud-weight window
- Combines with ROP model (WRK-377) to give the controller the full parameter space:
  WOB/RPM for ROP, flow rate for ECD

---
*Source: WRK-375 Drillbotics gap analysis — CT hydraulics exists; generalisation ~250L*
