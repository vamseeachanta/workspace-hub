---
id: WRK-643
title: "fix(devtools): make workspace-hub hooks use repo-local uv execution and writable cache"
status: done
priority: high
complexity: medium
route: B
compound: false
created_at: 2026-02-28T00:00:00Z
target_repos:
  - workspace-hub
commit:
spec_ref:
resource_pack_ref: .claude/work-queue/assets/WRK-643/verification-summary.md
html_output_ref: .claude/work-queue/assets/WRK-643/review.html
related:
  - WRK-624
  - WRK-641
blocked_by: []
parent:
synced_to: []
plan_reviewed: true
plan_approved: true
percent_complete: 100
brochure_status: n/a
computer: [ace-linux-1]
provider: codex
provider_alt: claude
cross_review: degraded-no-output
completed_at: 2026-02-28T03:42:32Z
---
# fix(devtools): Make workspace-hub hooks use repo-local uv execution and writable cache

## Problem

Repository hooks and helper scripts currently depend on `uv`, but execution is not
stable across constrained environments. The immediate failure observed during commit
was:

```text
error: Failed to initialize cache at `/home/vamsee/.cache/uv`
Caused by: failed to open file `/home/vamsee/.cache/uv/sdists-v9/.git`: Permission denied
```

This means hook success currently depends on a writable user-level cache outside the
repository, which is brittle for sandboxed execution and inconsistent with the goal of
predictable workspace-local tooling.

## What

Make hook and helper execution use a workspace-hub controlled `uv` environment strategy:

1. identify all hook/script entry points that invoke `uv`
2. define the canonical repo-local cache/environment approach
3. patch the relevant hook/tooling so `uv` runs without depending on
   `/home/<user>/.cache/uv`
4. verify commits and hook runs succeed without manual `UV_CACHE_DIR=...` overrides

## Plan

### Phase 1 - Audit current uv usage

- inspect `.pre-commit-config.yaml` and hook/script entry points
- identify whether failures come from:
  - `uv run --no-project`
  - hook wrappers
  - missing repo-local cache/env defaults

### Phase 2 - Implement repo-local uv strategy

- choose a stable writable cache path under workspace-hub state or another sanctioned
  local path
- patch hook/tool entry points to export that path consistently
- preserve existing behavior outside sandboxes where possible

### Phase 3 - Verify and close

- run the relevant hook path and commit path from current repo state
- document the chosen approach in the WRK and any touched docs/config
- close only after hook execution works without ad hoc environment overrides

## Acceptance Criteria

- [x] All relevant hook/script uv entry points are identified
- [x] Hooks no longer require `/home/<user>/.cache/uv` to be writable
- [x] Repo-local or otherwise sanctioned writable uv cache path is applied consistently
- [x] Commit/hook execution succeeds without manual one-off `UV_CACHE_DIR=...` prefixes
- [x] Queue/index validation passes after the change

## Notes

- This is a reliability/tooling item, not a behavior change to the work-queue logic
  itself.
- Prefer a fix that is robust in both normal local execution and sandboxed execution.
- Cross-review artifacts:
  - `scripts/review/results/20260228T034145Z-wrk-643-implementation-review-input.md-implementation-claude.md`
  - `scripts/review/results/20260228T034145Z-wrk-643-implementation-review-input.md-implementation-codex.md`
- Provider review transport/output degraded for this focused bundle. Direct
  verification of the changed execution paths found no unresolved MAJOR defect.

## Completion Checklist

- [x] uv cache helper added for workspace-local execution
- [x] Hook path updated to initialize writable repo-local uv cache
- [x] Work-queue uv entry points run without manual cache override
- [x] Verification recorded in `.claude/work-queue/assets/WRK-643/verification-summary.md`
- [x] Cross-review recorded
- [ ] WRK moved through close flow
