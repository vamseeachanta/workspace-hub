---
id: WRK-415
title: "Break up digitalmodel infrastructure/ monolith"
status: done
priority: medium
complexity: complex
compound: false
created_at: 2026-02-24T00:00:00Z
completed_at: 2026-02-24T00:00:00Z
target_repos:
  - digitalmodel
commit: f2d90ed6f
spec_ref: digitalmodel/specs/modules/infrastructure-refactor.md
related: []
blocked_by: []
synced_to: []
plan_reviewed: true
plan_approved: true
percent_complete: 100
computer: ace-linux-1
---
# WRK-415: Break up digitalmodel infrastructure/ monolith

**Status**: done
**Complexity**: complex
**Computer**: ace-linux-1
**Phase**: 5 (Phase D - Long Horizon)

## Problem
`src/digitalmodel/infrastructure/` has 40+ subdirs mixing config, solvers,
services, and validation. No clear domain alignment.

## Tasks
- [x] Audit all 40+ subdirs and classify by responsibility (Phase 1 — complete)
- [x] Design target domain mapping (Phase 1 — 5-module target structure specced)
- [x] Migrate base_configs/ → config/ shims (Phase 2A — complete)
- [x] Remove validators/ broken shims (Phase 2B — complete)
- [x] Migrate infrastructure/services/ → web/ (Phase 2C — complete)
- [x] Decompose common/ into solvers/ and utils/ (Phase 2D–F — complete)
- [x] Fix all import chains across external callers
- [x] Commit all phases in digitalmodel submodule

## Acceptance Criteria
- [x] Audit complete — all 12 top-level subdirs classified (Phase 1)
- [x] base_configs/ → config/ shims with DeprecationWarning (Phase 2A)
- [x] validators/ removed — zero callers confirmed (Phase 2B)
- [x] infrastructure/ canonical content split into 5 focused domain modules
- [x] All tests pass after migration (188+ pass; pre-existing failures unchanged)
- [x] Backward-compat shims in place; no regressions

**Note**: Legacy shim dirs (base_configs/, common/, core/, services/) remain as
DeprecationWarning re-exports. Final shim removal is a future cleanup task once
downstream callers have migrated (low priority — shims are silent until accessed).

## Progress

### Phase 1 — Audit and Design (complete 2026-02-24)
- Audited all 12 top-level subdirs (218 Python files)
- Classified every subdir and file by responsibility
- Identified `common/` as the primary sprawl (52 files, 4 mixed responsibilities)
- Identified `services/` and `domains/` as misplaced modules
- Produced target 5-module structure spec
- Documented all external import callers that require path updates
- Spec: `digitalmodel/specs/modules/infrastructure-refactor.md`

### Phase 2 — Migration

#### Phase 2A — complete (2026-02-24, commit f92bc81)
- Merged `base_configs/config_framework.py` → `config/framework.py`, `config_models.py` → `config/models.py`
- `base_configs/__init__.py` → backward-compat DeprecationWarning shim
- Renamed `core/` → `persistence/` (5 files); `core/__init__.py` → DeprecationWarning shim
- Moved `templates/template_validator.py` → `validation/template_validator.py`
- NOTE: `base_configs/domains/` YAML dir NOT moved — 2 callers use pkgutil.get_data filesystem paths
  (`aqwa_dat_files.py`, `orcaflex_model_utilities.py`) — deferred to Phase 2D with import fixes

#### Phase 2A remainder — complete (2026-02-24)
- Converted `base_configs/config_framework.py` from duplicate to DeprecationWarning shim → `config/framework.py`
- Converted `base_configs/config_models.py` from duplicate to DeprecationWarning shim → `config/models.py`

#### Phase 2B — complete (2026-02-24)
- Audited all callers of `infrastructure.validators`: zero callers found in src/ and tests/
- Removed `src/digitalmodel/infrastructure/validators/` directory (both `__init__.py` and
  `data_validator.py` were broken shims importing from non-existent `digitalmodel.validation`)
- Removed stale `"validators": "infrastructure"` entry from `_compat.py` `_FLAT_TO_GROUP` map
- All 63 validation/ tests still pass; no regressions introduced

#### Phase 2C — complete (2026-02-24, commit 80ab20e)
- Moved 152 files from infrastructure/services/ → src/digitalmodel/web/
- digitaltwinfeed/, dtf/, example_blueprint/, example_SPA/, TemplateCode/ (→ template_code/)
- services/__init__.py → DeprecationWarning shim; web/__init__.py created
- 238 tests pass; no relative import fixes needed

#### Phase 2D — complete (2026-02-24, commit e316b9b)
- 19 files from common/ → base_solvers/{hydrodynamics,fatigue,viv,marine,marine/ship,structural,structural/fea,pipeline_solvers,well}
- 6 external callers updated (engine.py, orcaflex_fatigue_analysis, fea_model, pipeline, viv_analysis, vertical_riser_components)
- Backward-compat shims in common/ for all 19 moved files; 346 tests pass

#### Phase 2E — complete (2026-02-24, commit 3b1e820)
- platecapacity/ (45 files) → structural/plate_capacity/; reservoir/stratigraphic.py → reservoir/
- infrastructure/domains/ removed (empty after moves); zero callers, no shims needed
- 1,509 tests pass; 34 pre-existing failures in structural_analysis/ (unrelated)

#### Phase 2F — complete (2026-02-24, commit f2d90ed)
- 30 files from common/ → utils/ (data I/O, general utils, visualization, web helpers)
- visualization_unused.py deleted (dead code)
- 26 new backward-compat shims in common/ (redirect to utils/)
- 37 external + 57 internal callers updated; 188 tests pass
