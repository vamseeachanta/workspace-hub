---
id: WRK-640
title: "chore(review): harden Claude and Gemini non-interactive review transport"
status: done
priority: high
complexity: medium
route: B
compound: false
created_at: 2026-02-27T00:00:00Z
target_repos:
  - workspace-hub
commit:
spec_ref: docs/guides/review-transport.md
resource_pack_ref: .claude/work-queue/assets/WRK-640/resource-pack.md
claim_routing_ref: .claude/work-queue/assets/WRK-640/claim-evidence.yaml
example_pack_ref: .claude/work-queue/assets/WRK-640/example-pack.md
variation_test_ref: .claude/work-queue/assets/WRK-640/variation-test-results.md
html_output_ref: .claude/work-queue/assets/WRK-640/review.html
related:
  - WRK-624
blocked_by: []
synced_to: []
plan_reviewed: true
plan_approved: true
percent_complete: 100
brochure_status: n/a
computer: ace-linux-1
provider: codex
provider_alt: claude
cross_review: strong
orchestrator: codex
---

# chore(review): Harden Claude and Gemini Non-Interactive Review Transport

## Problem Statement

`WRK-624` hardened the review wrappers so failed or malformed reviewer output is
classified deterministically as `NO_OUTPUT` or `INVALID_OUTPUT`. That exposed a
deeper infrastructure problem: both `claude` and `gemini` CLIs are present on
the command line, but they do not reliably return schema-compliant non-interactive
plan reviews through the current wrapper flow.

Observed behavior on 2026-02-27:

- `claude` frequently hangs until timeout and returns no usable review body
- `gemini` often returns planning chatter or execution-like thoughts instead of
  the required review schema
- the wrappers now classify these failures correctly, but the transport itself
  is still unreliable

This leaves the 3-agent review model operationally incomplete even though the
review policy and validation rules are now explicit.

## What

1. Diagnose why `claude -p` and `gemini -p` are not returning stable review-format
   output through `scripts/review/submit-to-*.sh`
2. Harden the prompt/wrapper path so both providers:
   - run non-interactively
   - return within bounded time
   - emit the shared review schema:
     - `Verdict`
     - `Summary`
     - `Issues Found`
     - `Suggestions`
     - `Questions for Author`
3. Add transport-level validation and retry strategy where useful
4. Document provider-specific constraints and fallback behavior
5. Produce passing end-to-end proof with real review artifacts from:
   - Claude
   - Gemini

## Why

- `WRK-624` depends on multi-agent review being practically runnable, not just specified
- clean `NO_OUTPUT` classification is necessary but not sufficient
- reliable cross-provider review transport is now a first-class workflow dependency

## Acceptance Criteria

- [x] Root cause is documented for current Claude/Gemini review failures
- [x] `submit-to-claude.sh` returns schema-compliant plan review output in non-interactive mode
- [x] `submit-to-gemini.sh` returns schema-compliant plan review output in non-interactive mode
- [x] Wrappers enforce bounded execution and classify transport failures deterministically
- [x] At least one real plan review artifact from Claude is valid under `validate-review-output.sh`
- [x] At least one real plan review artifact from Gemini is valid under `validate-review-output.sh`
- [x] Provider-specific guidance is documented for future review automation

## Notes

This is a follow-on item from `WRK-624`, not a replacement. `WRK-624` hardened
review validation and classification; `WRK-640` addresses the remaining transport
reliability gap for Claude and Gemini.
