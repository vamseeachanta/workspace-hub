---
id: WRK-566
title: "feat(scripts): extend query-docs.sh + build calc-examples mapper"
status: done
priority: high
complexity: medium
compound: false
created_at: 2026-02-25T00:00:00Z
target_repos:
  - workspace-hub
commit:
spec_ref:
related:
  - WRK-309
  - WRK-560
  - WRK-561
  - WRK-562
  - WRK-563
  - WRK-564
  - WRK-565
blocked_by: []
synced_to: []
plan_reviewed: false
plan_approved: false
percent_complete: 0
brochure_status: n/a
computer: ace-linux-1
execution_workstations: [ace-linux-1]
plan_workstations: [ace-linux-1]
---

# feat(scripts): Extend query-docs.sh + Build Calc-Examples Mapper

## What

1. **Extend `scripts/readiness/query-docs.sh`** with two new filter flags:
   - `--calc-only` — returns only calc files (xlsx/xls/pdf with doc-number patterns: `/CAL/`, `-CAL-`, `-RPT-`)
   - `--standard <id>` — filters by keyword match against standard ID / keywords

2. **New script `scripts/data/document-index/calc-examples-mapper.py`**:
   - Takes a standard ID (e.g., `DNV-OS-F101`) and domain as input
   - Searches index for matching calc files using keyword scoring
   - Outputs a YAML block ready to paste into a data-source YAML `calc_examples:` section

## Why

The manual WRK-560..565 process of finding calc files per standard is slow and
error-prone. An automated mapper reduces the effort to a single CLI call per gap.
This also makes the quarterly document refresh (Phase E cron) able to detect new
calc files and suggest additions to `calc_examples` sections automatically.

## Usage Examples

```bash
# Find all calc files for DNV-OS-F101 in pipeline domain
scripts/readiness/query-docs.sh --domain pipeline --calc-only --standard DNV-OS-F101

# Generate calc_examples YAML block for a specific gap
python3 scripts/data/document-index/calc-examples-mapper.py \
    --standard "DNV-OS-F101" --domain pipeline --top 5

# Output:
# calc_examples:
# - standard: DNV-OS-F101
#   files:
#   - path: /mnt/ace/docs/.../0116-CAL-0001-01 List of Pipelines Installed.xlsx
#     description: Pipeline wall thickness and installation list
#     type: xlsx
```

## Implementation Notes

- Keyword scoring: path + filename + org fields; doc-number pattern = `/CAL/` or `-CAL-` in path
- Score boost for: standard ID in filename, project number in path
- Output format: valid YAML compatible with `specs/data-sources/*.yaml` schema
- `--top N` flag: return top N results by score (default 5)

## Acceptance Criteria

- [ ] `query-docs.sh --calc-only` flag works, returns only calc files
- [ ] `query-docs.sh --standard <id>` flag filters by keyword match
- [ ] `calc-examples-mapper.py --standard <id> --domain <domain>` outputs valid YAML block
- [ ] Tests cover at least 3 standard ID lookups (DNV-OS-F101, API-RP-2A-WSD, DNV-RP-B401)
- [ ] Cross-review via `scripts/review/cross-review.sh`
