---
id: WRK-238
title: Adopt Codex 0.102.0 TOML role definitions — implement native multi-agent roles in .codex/
status: done
priority: medium
complexity: medium
compound: false
created_at: 2026-02-20T00:00:00Z
target_repos:
  - workspace-hub
commit:
spec_ref:
related: [WRK-213, WRK-199, WRK-226]
blocked_by: []
synced_to: []
plan_reviewed: false
plan_approved: false
standing: false
auto_execute: false
percent_complete: 100
brochure_status: n/a
computer: ace-linux-1
execution_workstations: [ace-linux-1]
plan_workstations: [ace-linux-1]
tags:
  - codex
  - multi-agent
  - config
  - toml
---

# Adopt Codex 0.102.0 TOML Role Definitions

## What

Codex 0.102.0 shipped native multi-agent role configuration via TOML. Where WRK-213 (archived) was an assessment, this is the implementation: wire up `.codex/config.toml` with `default`, `explorer`, and `worker` roles, plus custom roles matching the workspace-hub agent library, replacing the current markdown-only agent configuration.

Key capabilities to adopt:
- Role definitions in `.codex/config.toml` + `agents/<role>/config.toml` (per-role model, reasoning level, system prompt, permissions, MCP servers)
- `max_threads = 12` (default is 6) — enables higher parallel agent throughput for batch tasks
- Skills ↔ subagents callable from each other — cross-invocation between Claude skills and Codex roles

## Why

WRK-213 concluded: "The mental model transfers completely — define specializations, route tasks to the right one." Codex now has this natively. The workspace-hub agent library (`.claude/agent-library/`) already encodes the role specializations; the work is to express the Codex-facing subset as TOML so Codex uses explicit role-aware routing (model + permissions per task type) instead of the flat default config.

**Key architectural difference to preserve:**
- Claude skills = semantic routing (LLM picks based on intent description, single agent + context)
- Codex TOML roles = explicit routing (orchestrator spawns named roles, each with own model + sandbox + tool access, parallel-capable)

These are complementary, not competing — both should coexist. MCP servers are the common substrate.

## Scope

### Phase 1 — Config structure
- Add `.codex/config.toml` with `max_threads = 12` and role references
- Wire three built-in roles: `default`, `explorer`, `worker` (with workspace-hub-appropriate configs)
- Ensure current `settings.json` model_ref still respected (or migrate to TOML cleanly)

### Phase 2 — Custom role definitions
- Map workspace-hub agent library roles to Codex TOML: `coder`, `tester`, `reviewer`, `planner`
- Each role: specify model, reasoning level, system prompt (trimmed from corresponding `.claude/agent-library/` file), permissions (Read/Write/Edit/Bash scope)
- Reference the 25 pre-built roles pack (`github.com/am-will/codex-skills/tree/main/agents`) as inspiration; do not copy blindly — adapt to workspace patterns

### Phase 3 — Cross-invocation wiring
- Verify that `.codex/skills` symlink to `.claude/skills/` still works post-TOML migration
- Test that a Codex role can invoke a Claude skill (and vice versa) via MCP if available
- Document the routing decision matrix: when to use Claude skill vs Codex role

## Acceptance Criteria

- [ ] `.codex/config.toml` exists with `max_threads = 12` and role registry
- [ ] `default`, `explorer`, `worker` roles configured with appropriate model + permissions
- [ ] At least `coder` and `tester` custom roles defined with trimmed system prompts
- [ ] `settings.json` model_ref preserved or cleanly migrated (no regression)
- [ ] `.codex/skills` symlink still resolves correctly after changes
- [ ] Routing decision matrix documented in `.claude/docs/agent-routing.md` (or equivalent)
- [ ] Smoke-test: `codex exec` with a simple task picks up new role config without errors

## Agentic AI Horizon

- This is a direct capability unlock: parallel Codex agents with explicit role boundaries reduce context bleed and enable higher-throughput batch execution.
- `max_threads = 12` is immediately usable for WRK-226 (multi-file agent audit) and any future batch analysis tasks.
- The skills ↔ subagents cross-invocation path is foundational — once proven, it unlocks hybrid Claude+Codex workflows where each provider does what it's best at within the same task graph.
- **Disposition: invest now** — Codex 0.102.0 is shipping this natively; adopting it positions the ecosystem to leverage it in production rather than working around it.

---
*Source: "Codex 0.102.0 shipped custom multi-agent roles. Three built-in roles: default, explorer, worker. Custom roles in .codex/config.toml + agents/role_config.toml. Hidden gem: max_threads = 12. Skills ↔ subagents callable from each other. Claude skills = semantic routing (single agent, context-loaded). Codex TOML roles = explicit routing (parallel agents, model+permissions per role). MCP servers are the common substrate."*
