---
id: WRK-607
title: "feat(digitalmodel): implement DNV RP F105 free-spanning pipeline VIV module"
status: done
commits:
  - 6244e7b (initial implementation — 33 tests)
  - 2f2cde1 (Codex P2/P3 review fixes — 41 tests)
priority: high
complexity: medium
compound: false
created_at: 2026-02-25T00:00:00Z
target_repos:
  - digitalmodel
commit: 6244e7b
related:
  - WRK-045
  - WRK-528
  - WRK-309
computer: ace-linux-1
execution_workstations: [ace-linux-1]
plan_workstations: [ace-linux-1]
percent_complete: 100
---

# feat(digitalmodel): DNV RP F105 — Free-Spanning Pipeline VIV Module

## What

Implement `digitalmodel.pipeline.free_span` — DNV RP F105 (2006/2017) free-spanning
pipeline VIV assessment: natural frequencies, reduced velocity, stability parameter (Ks),
onset criteria, in-line and cross-flow VIV response, and fatigue damage accumulation.

## Why

DNV RP F105 is the primary code for free-spanning pipeline design. Required as:
- Prerequisite for WRK-045 Phase 4 (rigid jumper VIV screening uses F105 reduced velocity)
- WRK-528 (DNV RP F105 wrk_captured) needs a module to land in
- 476 MATLAB riser analysis scripts on disk use F105 onset criteria

## Auxiliary Codes Covered

| Code | Role |
|------|------|
| **DNV RP F105** (primary) | VIV response models, onset criteria, fatigue |
| **DNV-ST-F101** (OS-F101) | Combined loading allowable stresses for pipe wall |
| **DNV-RP-C203** | Fatigue of offshore steel — S-N curves for fatigue damage |
| **DNV-RP-F109** | On-bottom stability — pipe settling affects span boundary conditions |
| **ISO 13624-1** | Marine drilling riser systems — cross-reference for IL/CF models |
| **API-RP-1111** | Pipeline design pressure — design pressure for pipe wall check |
| **BS 7608** | Alternative S-N curves (alternative to DNV-RP-C203) |

## Module Structure

```
digitalmodel/src/digitalmodel/pipeline/free_span/
├── __init__.py
├── natural_frequency.py   # Effective mass, Ke, fn_IL, fn_CF (Section 6.8)
├── onset_criteria.py      # Reduced velocity Ur, onset Ur_onset, Ks, fs/fn
├── viv_response.py        # IL and CF amplitude/stress response (Section 6)
├── fatigue.py             # Cumulative fatigue damage (Section 7, DNV-RP-C203 S-N)
└── span_length.py         # Allowable span length (Section 4, Level 1 / Level 2)
```

## Key Calculations

### Natural Frequency (Section 6.8)
```
f_n = C_1 / (L² * √(m_e / EI)) * √(1 + C_e(δ/D)²)
```
where C_1 = boundary condition factor (pinned-pinned=9.87, fixed-fixed=22.4),
L = span length, m_e = effective mass per unit length, EI = bending stiffness.

### VIV Onset (Section 6.2 / 6.3)
```
Ur = Uc / (fn × D)           # reduced velocity
Ks = 4πme ζ_T / (ρw D²)     # stability parameter
Ur_onset_IL = 1.0 + 0.4/Ks  # onset of IL VIV (screening criterion)
```

### Cross-Flow Response (Section 6.4)
```
Ay/D = Ay_IL(VR, Ks, γ_on)   # response amplitude ratio from F105 Figure 6-1
σ_CF = Ks_stress × (Ay/D) × (D/L²) × EI  # peak stress
```

### Fatigue Damage (Section 7.3)
```
D_fat = Σ(ni / Ni)            # Palmgren-Miner rule
Ni = S-N curve (DNV-RP-C203 F-class for girth welds)
```

## Acceptance Criteria

- [ ] `natural_frequency.py` — fn_IL and fn_CF for pinned-pinned and fixed-fixed BCs; unit tests vs Table 6-2 values
- [ ] `onset_criteria.py` — Ur, Ks, onset velocity; tests confirm screening pass/fail logic
- [ ] `viv_response.py` — IL and CF amplitude; tests vs F105 example problem (Section 6 worked example)
- [ ] `fatigue.py` — Miner sum with DNV-RP-C203 F-class S-N; test with known D_fat
- [ ] `span_length.py` — Level 1 allowable span (Section 4.2 simplified); validates against F105 Table 4-1
- [ ] All tests pass: `PYTHONPATH=src python3 -m pytest tests/pipeline/free_span/ -v`
- [ ] Legal scan passes; no client identifiers

## Input/Output

Input (YAML/dataclass):
```yaml
pipe_od_m: 0.2731
pipe_wt_m: 0.0127
span_length_m: 45.0
current_velocity_ms: 0.8
boundary_condition: pinned-pinned  # or fixed-fixed, fixed-pinned
water_depth_m: 120.0
submerged_weight_N_m: 850.0
content_density_kg_m3: 900.0
sn_curve: F           # DNV-RP-C203 S-N class
```

Output:
```yaml
fn_IL_Hz: 0.42
fn_CF_Hz: 0.38
Ur_IL: 1.91
Ur_onset_IL: 1.65
il_viv_onset: true
Ks: 0.22
Ay_over_D: 0.45
sigma_CF_MPa: 78.4
fatigue_life_years: 42.1
allowable_span_m: 38.0
```

## Reference Code on Drives

| File | Path | What it does | Relevance |
|------|------|-------------|-----------|
| `FindModes.m` / `ModesFind.m` | `.../3824 - BP Macondo.../VIV/Program for Summarizing.../` | Post-processes SHEAR7 `.out` files — extracts excited mode numbers and power-in region nodes | **Not F105 equations** — SHEAR7 wrapper only |
| `testmodes.m` | `.../31245 - Shell West Boreas BOP.../VIV/Model Setup/Pluck Test/` | FFT modal identification from pluck-test OrcaFlex `.tt` time traces; identifies peaks via `fftshift(fft(...))` | Useful for **test fixtures** — validates fn against measured pluck-test response |
| `PostProcVIVLoc.m` | `.../0151 Merton Riser IM/Data/Shear7 VIV/` | SHEAR7 VIV post-processor (location-based) | Reference for VIV location results parsing |
| `Create_VIVO.m` | `.../Training/VIVA Delta House/Example Files for VIVA/` | Creates VIVA (Vortex Induced Vibration Analysis) input files | Shows VIVA I/O format |
| `natural_frequency_FEA_functions.py` | `.../0168_Python_Support/.../vibration_algorithm_manager/` | **Full 12-DOF Euler-Bernoulli FEA solver** in Python: elastic K_e, axial K_a/K_aSD, torsional K_phi, axial-stiffening K_as; translational + rotary + gyroscopic mass matrices; `scipy.linalg.eigh` eigenvalue solve; BC types (Clamped-Free, Pinned-Pinned, etc.) | **Best reference for Level 2 FEA path** — axial/lateral/torsional freq separation already done |
| `estimate_natural_frequencies_FEA.py` | same dir | Orchestrates FEA over bit-depth intervals; iterates `compute_global_FEA_matrices → eigen_value_soln → compute_primary_freq` | Shows Level 2 pipeline structure |

### Implementation strategy

- **Level 1 (primary)**: F105 Section 6.8 analytical formula —
  `f_n = C_1 / (L² × √(m_e / EI)) × √(1 + C_e × (δ/D)²)` — no FEA needed.
  C_1 = 9.87 (pinned-pinned), 22.4 (fixed-fixed).
- **Level 2 (optional)**: FEA-based using `scipy.linalg.eigh` — port approach from
  `natural_frequency_FEA_functions.py` (strip drillstring-specific terms; pipeline has
  no gyroscopic coupling).
- Strip all client identifiers from 0168 project before using any ported logic.

## Notes

- PDF at `/mnt/ace/docs/_standards/DNV/DNV-RP-F105.pdf` (or via query-ledger.py)
- WRK-528 is the ledger entry for this standard (wrk_captured)
- WRK-045 Phase 4 can use `onset_criteria.py` directly (reduced velocity screening)
- After implementation: mark WRK-528 done, update ledger status to `done`
- Project 0168 Python code (natural_frequency_FEA_functions.py) has author attribution
  (Qian Li, 2017) — treat as reference only, do not copy verbatim; rewrite from F105
