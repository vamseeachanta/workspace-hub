---
id: WRK-198
title: "Provider-neutral AI architecture — make skills/adapters/routing work equally for Claude, Codex, Gemini"
status: done
priority: high
complexity: complex
route: C
created: 2026-02-18
repos:
  - workspace-hub
tags: [ai-orchestration, provider-neutral, architecture]
plan_workstations: [ace-linux-1]
execution_workstations: [ace-linux-1]
---

## Context

Current architecture is ~48% provider-neutral. Strategic layer (AGENTS.md, model-registry, behavior-contract) is
already neutral. Execution layer is Claude-centric: only `.claude/skills/`, only `CLAUDE.md` adapter, and
`task_agents:` assignments exist in WRK frontmatter but are not wired to the executor.

Work-queue workflow (capture → triage → plan → gate1 → execute → cross-review → archive) MUST apply equally
to all providers. See `.claude/work-queue/assets/workflow-visual.html`.

## Gaps (from 2026-02-18 audit)

### Tier 1 — Execution Blockers
1. No `.codex/` or `.gemini/` directories — other providers have no native config entry point
2. `CODEX.md` and `GEMINI.md` adapters do not exist (only CLAUDE.md generated, and generator missing)
3. `multi-ai-workflow.yaml` hardcodes `primary: claude` — cannot swap primary provider
4. `task_agents:` in WRK frontmatter defined but execution dispatcher does not read or follow them

### Tier 2 — Practical Limitations
5. No provider-specific skill variants (`.claude/skills/_provider-variants/{codex,gemini}/`)
6. Provider assessment data missing — `.claude/state/provider-assessments/` is empty
7. No capability profiles (token limits, latency SLA, cost_per_token per provider)
8. CLI dispatch assumes commands in PATH, no fallback or health check

## Plan

### Phase 1 — Adapter generation (Route B)
- Write `scripts/operations/generate-provider-adapters.sh`
- Reads `AGENTS.md` → emits `CLAUDE.md`, `CODEX.md`, `GEMINI.md` into each repo
- Template variables: provider name, model IDs from model-registry.yaml
- Add to ecosystem propagation script

### Phase 2 — Provider config directories (Route B)
- Create `.claude/settings.json` (already exists), `.codex/settings.json`, `.gemini/settings.json`
  at workspace-hub level
- Propagate to submodule repos via existing `centralize_skills.sh` pattern
- Content: model selection, task routing hints, CLI invocation defaults

### Phase 3 — Wire task_agents to executor (Route C)
- Modify `scripts/agents/execute.sh` to read `task_agents:` from WRK frontmatter per phase
- Route each phase to the declared provider via `agent_dispatcher.sh`
- Fallback: use WRK `provider:` if no per-phase override

### Phase 4 — Fix multi-ai-workflow.yaml (Route A)
- Remove hardcoded `primary: claude`
- Replace with `primary: ${WRK_PROVIDER}` resolved at runtime from WRK frontmatter

## Provider-Neutral Invariants (non-negotiable)
- Work-queue workflow applies to ALL providers (no provider-specific shortcuts)
- All providers go through the same gates (plan approval, cross-review)
- Skills remain in workspace-hub canonical source; providers consume via their adapter dirs
- model-registry.yaml remains single source of truth for model IDs

## Skills & Plugins Note
- Install/update Claude Code skills relevant to active work as needed (no approval required)
- Codex and Gemini do not have equivalent skill marketplaces — compensate via prompt templates
  stored in `.codex/prompts/` and `.gemini/prompts/` once Phase 2 complete
- `/plugin` commands are not yet implemented in Claude Code CLI — track as future capability

## task_agents (provisional)
task_agents:
  phase_1: gemini      # research existing patterns, audit current state
  phase_2: claude      # generate adapters, write config files
  phase_3: codex       # implement executor wiring (code-focused)
  phase_4: claude      # integration + cross-review coordination
