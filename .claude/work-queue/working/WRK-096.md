---
id: WRK-096
title: "Review and improve worldenergydata module structure for discoverability"
status: done
priority: high
complexity: medium
route: B
created_at: 2026-02-04T12:00:00Z
completed_at: 2026-02-08T16:00:00Z
target_repos:
  - worldenergydata
commit: e6fc27a6
spec_ref: worldenergydata/specs/modules/sharded-orbiting-turtle.md
related: [WRK-066, WRK-097]
blocked_by: []
synced_to: []
tags: [architecture, refactoring, discoverability, module-structure]
progress:
  phase: "implemented"
  last_session: 2026-02-08
  notes: |
    - 17 modules moved from worldenergydata.modules.X → worldenergydata.X
    - MetaPathFinder compat layer (_compat.py) redirects old imports with DeprecationWarning
    - modules/__init__.py retained as __getattr__ shim
    - 1032 files changed across src/, tests/, docs/, scripts/, specs/, .claude/
    - 762 tests pass; 8 failures all pre-existing (missing deps), zero restructuring regressions
    - Symlinks to digitalmodel .claude/commands/ preserved (sed had dereferenced them — restored)
    - Data residence blocker resolved by WRK-097
review:
  cross_review: completed
  iterations: 3
  rationale: "Precedent-based downgrade from Route C → B. WRK-066 provides the proven methodology; no architectural ambiguity remains."
  review_1:
    reviewer: claude-opus-4.5
    date: 2026-02-04
    verdict: APPROVE
    notes: "P2: add rollback strategy + CLI entry point validation. P2: verify external consumers. P3: cross-review fallback when external reviewers unavailable."
  review_2:
    reviewer: codex (gpt-5.2-codex)
    date: 2026-02-04
    verdict: REQUEST_CHANGES
    notes: "P1: missing migration/rollback strategy. P2: external consumers not identified. P2: cross-review criterion under-defined. P3: module index structure ambiguous."
  review_3:
    reviewer: gemini (gemini-cli v0.27.0)
    date: 2026-02-04
    verdict: APPROVE
    notes: "P2: external dependency risk not in AC. P2: no rollback procedure. P3: CLI entry points not checked. Suggests libcst/rope for automated refactoring."
  consensus: "2 APPROVE, 1 REQUEST_CHANGES. All 3 reviewers flagged rollback strategy and external consumer verification as gaps. Addressed in updated acceptance criteria below."
---

# Review and Improve worldenergydata Module Structure for Discoverability

## What
Apply the same module structure improvement approach used in WRK-066 (digitalmodel) to the worldenergydata repository. Audit the current layout, simplify the module hierarchy, standardize naming, and improve discoverability so that all subpackages are clearly organized and findable.

## Why
WRK-066 successfully restructured digitalmodel for discoverability — the same treatment is needed for worldenergydata. Poor organization makes it difficult for users and AI agents to locate functionality, increases onboarding friction, and leads to duplicated or misplaced code. worldenergydata has grown to include 15+ data sources across energy, marine safety, and production analytics domains, making clear module organization critical.

## Route B Pipeline
```
Explore (audit as-is) → Implement (restructure) → Test (regression) → Archive
```

**Why Route B, not C**: WRK-066 already established the plan. This item applies a proven methodology to a different repo — no Plan phase needed. Classified per WRK-094 precedent-based downgrade principle.

## Acceptance Criteria

### Audit Phase (DONE — 2026-02-08)
- [x] Current module structure audited (17 modules, 538 files under modules/, 615 total)
- [x] External consumers identified: zero Python imports; assetutilities/aceengineer-website refs are string-only
- [x] CLI entry points inventoried: 1 entry point (worldenergydata.cli.main:app), 11 command modules

### Design Phase (DONE — 2026-02-08)
- [x] Flatten-only approach designed (no domain grouping): worldenergydata.modules.X → worldenergydata.X
- [x] Naming conventions confirmed: all modules already snake_case, no violations
- [x] Migration strategy: MetaPathFinder compat layer with DeprecationWarning (from digitalmodel/_compat.py pattern)
- [x] Full implementation plan: `worldenergydata/specs/modules/sharded-orbiting-turtle.md` (8 phases)
- [ ] Public API surface defined per package (deferred to implementation Phase 5)

### Implementation Phase (DONE — 2026-02-08)
- [x] Module organization follows clear, discoverable patterns
- [x] Top-level `__init__.py` or module index provides discoverability with defined public API
- [x] Old import paths preserved as deprecation shims (import redirects with warnings)
- [x] Documentation updated to reflect new structure

### Validation Phase (DONE — 2026-02-08)
- [x] All existing imports and tests updated for new paths
- [x] No regressions — 762 tests pass (8 failures pre-existing missing deps)
- [x] External consumer imports validated (zero Python consumers confirmed)
- [x] CLI entry points verified functional after restructure
- [ ] Rollback plan tested: git-based revert to pre-restructure state confirmed viable

### Review Phase
- [ ] Cross-review of implementation (Claude + Codex + Gemini) — pending

## Rollback Strategy
1. All restructuring done on a feature branch (`refactor/worldenergydata-module-structure`)
2. Pre-restructure commit tagged as `pre-wrk-096` for clean revert point
3. Deprecation shims in old paths ensure backward compatibility during transition
4. If regression tests fail: `git revert` to tagged commit, no downstream breakage
5. Full removal of old paths only after confirming zero `DeprecationWarning` hits in CI

## Blocker: Data Residence Policy

vessel_hull_models may move to digitalmodel per data residence policy (separate planning session).
If it moves, scope drops to 16 modules. Await policy decision before executing flatten.

## Reference
- WRK-066 (digitalmodel) completed this successfully. Review its approach, as-is/to-be maps, and apply the same methodology adapted to worldenergydata's domain structure.
- Cross-review results: `scripts/review/results/codex-WRK-096-plan-review.md`, `scripts/review/results/gemini-WRK-096-plan-review.md`
- Implementation plan: `worldenergydata/specs/modules/sharded-orbiting-turtle.md`
- Key compat reference: `digitalmodel/src/digitalmodel/_compat.py`
