---
id: WRK-287
title: Set up Linux-to-Linux network file sharing for workspace-hub access from ace-linux-2
status: working
priority: medium
complexity: medium
compound: false
created_at: 2026-02-21T00:00:00Z
target_repos:
  - workspace-hub
commit:
spec_ref:
related: []
blocked_by: []
synced_to: []
plan_reviewed: false
plan_approved: true
percent_complete: 0
brochure_status: n/a
---

# Set up Linux-to-Linux network file sharing for workspace-hub access from ace-linux-2

## What

Configure network file sharing so that `ace-linux-2` (another machine on the same LAN) can
access `/mnt/local-analysis/workspace-hub` from `ace-linux-1` (192.168.1.100) seamlessly —
as if it were a local directory. Windows sharing is out of scope for now.

## Why

Two machines in the same office network need to share a single workspace-hub so that work
can be done from either seat without manual file transfers or duplicate state.

## Constraints

- **Linux-to-Linux only** — no Windows SMB/Samba needed now; note it as future work
- **Workspace-hub only** (not full drive exports) — `/mnt/local-analysis/workspace-hub`
- Must be auto-mounted on boot (persistent, not manual-per-session)
- ace-linux-2 hostname not yet in `/etc/hosts` — IP discovery step required first
- **Both machines are on DHCP** — IPs must be stabilised before configuring mounts

## IP Stability (Prerequisite)

ace-linux-1 (`192.168.1.100`, MAC `f0:79:59:39:49:7b`) is DHCP-assigned (`dynamic` flag
confirmed via `ip addr`). The IP is likely stable day-to-day (same MAC → same router lease),
but is NOT guaranteed — especially after router reboots or long power-offs.

**If fstab uses a raw IP and the IP changes, the auto-mount fails silently at boot.**

Fix strategy (choose one, in preference order):

1. **Router DHCP reservation** *(recommended)* — In router admin UI, bind each machine's
   MAC address to a fixed IP. Zero Linux config changes. Survives OS reinstalls.
   - ace-linux-1: MAC `f0:79:59:39:49:7b` → `192.168.1.100`
   - ace-linux-2: MAC TBD → TBD
2. **Static IP via netplan** — Edit `/etc/netplan/*.yaml` on each machine; removes DHCP
   dependency entirely but must be maintained if network topology changes.
3. **Avahi mDNS** — Install `avahi-daemon`; machines advertise `ace-linux-1.local` /
   `ace-linux-2.local` via multicast DNS. IP-independent but adds a dependency.

**Regardless of strategy chosen**: fstab entry must use the **hostname** (`ace-linux-1`),
not a raw IP — so only `/etc/hosts` needs updating if IP ever shifts, not fstab itself.

## Recommended Approach

**SSHFS over NFS** for this use case:

| Factor | SSHFS | NFS |
|--------|-------|-----|
| Server install | None (SSH already running) | `nfs-kernel-server` required |
| Security | SSH encrypted by default | Needs firewall rules |
| Performance | Adequate for code/text work | Faster for large binary I/O |
| Setup effort | Low | Medium |
| Auto-mount | `/etc/fstab` with `_netdev` | `/etc/fstab` + `exportfs` |

For workspace-hub (code + text files), SSHFS is the right tradeoff. NFS is documented as
the upgrade path if performance becomes an issue or if more mounts are needed.

**Future Windows path** (not now): add Samba (`smb.conf`) exposing the same share — SSHFS
and Samba can coexist on the same export path.

## Investigation Notes (2026-02-21)

### ace-linux-1 network state
- **IP**: `192.168.1.100/24` — DHCP-assigned (`dynamic` flag in `ip addr`)
- **MAC**: `f0:79:59:39:49:7b` (interface `enp4s0f0`)
- **Gateway/router**: `192.168.1.1`
- **DHCP lease**: ~14h remaining at time of check (`valid_lft 51160sec`)
- **Network manager**: NetworkManager via netplan (`ipv4.method: auto`)

### Risk
DHCP IPs are not guaranteed stable across router reboots or long power-offs. If fstab
references a raw IP that shifts, the auto-mount fails silently at boot.

### Action required before implementation
Configure **router DHCP reservation** at `192.168.1.1` admin UI:
- ace-linux-1: MAC `f0:79:59:39:49:7b` → `192.168.1.100` (bind permanently)
- ace-linux-2: MAC TBD → IP TBD (bind after discovery)

fstab must use **hostname** (`ace-linux-1`), not raw IP — `/etc/hosts` is then the single
point to update if IPs ever change.

### ace-linux-2 network state
- **IP**: `192.168.1.103/24` — DHCP-assigned (`dynamic`, lease ~19.6h remaining)
- **MAC**: `08:62:66:a2:a0:ce` (interface `enp4s0f0`)
- Same subnet as ace-linux-1 (`192.168.1.0/24`) — direct LAN reachability confirmed

### Router DHCP reservations needed
| Machine | Interface | MAC | Reserve IP |
|---------|-----------|-----|------------|
| ace-linux-1 | enp4s0f0 | `f0:79:59:39:49:7b` | `192.168.1.100` |
| ace-linux-2 | enp4s0f0 | `08:62:66:a2:a0:ce` | `192.168.1.103` |

## Consistent Drive Mapping (Both Directions)

Both machines must expose their drives to each other at consistent, mirrored mount points
so that work and data access is seamless regardless of which seat you're at.

### Confirmed Local Mounts (verified 2026-02-22 via SSH)

| Drive | ace-linux-1 (local) | ace-linux-2 (local) |
|-------|---------------------|---------------------|
| Boot SSD | / (250 GB CT250BX100SSD1) | / (466 GB Samsung 870 EVO, ext4) |
| Local Analysis | /mnt/local-analysis (932 GB WDC, NTFS, 84GB used) | /mnt/local-analysis (932 GB WDC, NTFS, 441GB used) |
| Bulk Storage | /mnt/ace (7.3 TB Seagate, ext4, 4.5TB used) | /mnt/dde (2.8 TB Seagate, NTFS, 2.0TB used) |
| workspace-hub | /mnt/local-analysis/workspace-hub (local) | /mnt/workspace-hub ✅ MOUNTED |

### Target Remote Mounts (with safeguards)

| Remote Drive | Mount on ace-linux-1 | Mount on ace-linux-2 |
|--------------|----------------------|----------------------|
| ace-linux-2 local-analysis | /mnt/remote/ace-linux-2/local-analysis | (local) |
| ace-linux-2 dde | /mnt/remote/ace-linux-2/dde | (local) |
| ace-linux-1 local-analysis | (local) | /mnt/remote/ace-linux-1/local-analysis |
| ace-linux-1 ace (bulk) | (local) | /mnt/remote/ace-linux-1/ace |

### fstab Safeguard Options (all SSHFS entries)

```
noauto,_netdev,x-systemd.automount,x-systemd.idle-timeout=60,
x-systemd.mount-timeout=30,reconnect,
ServerAliveInterval=15,ServerAliveCountMax=3,
IdentityFile=/home/vamsee/.ssh/id_ed25519
```

| Option | Purpose |
|--------|---------|
| `noauto` + `x-systemd.automount` | Mount on-demand only, not at boot — prevents boot hang if network down |
| `_netdev` | systemd waits for network before attempting mount |
| `x-systemd.idle-timeout=60` | Auto-unmount after 60s idle — frees resources |
| `x-systemd.mount-timeout=30` | Fail gracefully in 30s if unreachable |
| `reconnect` | SSHFS auto-reconnects on connection drop |
| `ServerAliveInterval=15,ServerAliveCountMax=3` | Detects dead connections in 45s |

### Principles

- **Bidirectional**: both machines can reach each other's drives, not just one-way
- **Consistent prefix**: all remote mounts under `/mnt/remote/<hostname>/`
- **Mirrored naming**: same logical names regardless of direction
- **Auto-mount on boot**: fstab entries with `_netdev,x-systemd.automount`
- **SSH key auth both ways**: ace-linux-1 ↔ ace-linux-2 passwordless in both directions

## Acceptance Criteria

- [x] ace-linux-2 IP discovered and added to `/etc/hosts` on both machines — 192.168.1.103, ping confirmed both directions
- [x] SSH key-based auth bidirectional — ace-linux-2→ace-linux-1 (ssh-copy-id done); ace-linux-1→ace-linux-2 (verified via SSH 2026-02-22)
- [x] workspace-hub accessible from ace-linux-2 at `/mnt/workspace-hub` — mounted and readable
- [x] Remote drives mounted under `/mnt/remote/<hostname>/` on both machines — fstab entries written; manual mounts verified pre-reboot
- [ ] All mounts persist across reboot (fstab entries with safeguard options) — **BLOCKED: root known_hosts missing; fix documented above**
- [ ] Basic smoke test: `git status` from `/mnt/workspace-hub` on ace-linux-2
- [ ] Reboot test: mounts survive reboot on both machines
- [ ] Windows/Samba path documented as a future WRK item (not implemented)

## Plan

- **Phase 0 (done)**: Router DHCP reservations bound (Linksys WRT1900AC)
- **Phase 1 (done)**: `/etc/hosts` bidirectional; ping by hostname confirmed
- **Phase 2 (done)**: SSH server on ace-linux-1; ed25519 keys bidirectional; `sshfs` on ace-linux-2
- **Phase 3 (done)**: `/mnt/workspace-hub` mounted on ace-linux-2; readable; `drwxrwxrwx vamsee`
- **Phase 4 — ACE-LINUX-1 SIDE (pending)**:
  - `sudo mkdir -p /mnt/remote/ace-linux-2/{local-analysis,dde}`
  - `sudo chown vamsee:vamsee /mnt/remote/ace-linux-2/{local-analysis,dde}`
  - Test: `sshfs vamsee@ace-linux-2:/mnt/local-analysis /mnt/remote/ace-linux-2/local-analysis`
  - Test: `sshfs vamsee@ace-linux-2:/mnt/dde /mnt/remote/ace-linux-2/dde`
  - Add fstab entries with safeguards (see fstab block below)
  - `sudo systemctl daemon-reload`
- **Phase 4 — ACE-LINUX-2 SIDE (pending)**:
  - `sudo mkdir -p /mnt/remote/ace-linux-1/{local-analysis,ace}`
  - `sudo chown vamsee:vamsee /mnt/remote/ace-linux-1/{local-analysis,ace}`
  - Test: `sshfs vamsee@ace-linux-1:/mnt/local-analysis /mnt/remote/ace-linux-1/local-analysis`
  - Test: `sshfs vamsee@ace-linux-1:/mnt/ace /mnt/remote/ace-linux-1/ace`
  - Add fstab entries with safeguards (see fstab block below)
  - Add workspace-hub fstab entry for persistence
  - `sudo systemctl daemon-reload`
- **Phase 5 (both sides)**: Reboot each machine; confirm all mounts auto-reconnect
- **NOTE — plan_reviewed still false**: Codex + Gemini plan review pending

### fstab Entries

**On ace-linux-1** (`/etc/fstab` — append):
```
vamsee@ace-linux-2:/mnt/local-analysis /mnt/remote/ace-linux-2/local-analysis fuse.sshfs noauto,_netdev,x-systemd.automount,x-systemd.idle-timeout=60,x-systemd.mount-timeout=30,reconnect,ServerAliveInterval=15,ServerAliveCountMax=3,IdentityFile=/home/vamsee/.ssh/id_ed25519 0 0
vamsee@ace-linux-2:/mnt/dde /mnt/remote/ace-linux-2/dde fuse.sshfs noauto,_netdev,x-systemd.automount,x-systemd.idle-timeout=60,x-systemd.mount-timeout=30,reconnect,ServerAliveInterval=15,ServerAliveCountMax=3,IdentityFile=/home/vamsee/.ssh/id_ed25519 0 0
```

**On ace-linux-2** (`/etc/fstab` — append):
```
vamsee@ace-linux-1:/mnt/local-analysis/workspace-hub /mnt/workspace-hub fuse.sshfs noauto,_netdev,x-systemd.automount,x-systemd.idle-timeout=60,x-systemd.mount-timeout=30,reconnect,ServerAliveInterval=15,ServerAliveCountMax=3,IdentityFile=/home/vamsee/.ssh/id_ed25519 0 0
vamsee@ace-linux-1:/mnt/local-analysis /mnt/remote/ace-linux-1/local-analysis fuse.sshfs noauto,_netdev,x-systemd.automount,x-systemd.idle-timeout=60,x-systemd.mount-timeout=30,reconnect,ServerAliveInterval=15,ServerAliveCountMax=3,IdentityFile=/home/vamsee/.ssh/id_ed25519 0 0
vamsee@ace-linux-1:/mnt/ace /mnt/remote/ace-linux-1/ace fuse.sshfs noauto,_netdev,x-systemd.automount,x-systemd.idle-timeout=60,x-systemd.mount-timeout=30,reconnect,ServerAliveInterval=15,ServerAliveCountMax=3,IdentityFile=/home/vamsee/.ssh/id_ed25519 0 0
```

*Approved by user: 2026-02-21*

## Session Log (coordination between ace-linux-1 and ace-linux-2 sessions)

> Both sessions read/write this file. Prefix each entry with machine and timestamp.

### ace-linux-1 session — 2026-02-22
- `/mnt/remote/ace-linux-2/{local-analysis,dde}` created + owned vamsee ✓
- `sshfs` installed ✓
- `/mnt/remote/ace-linux-2/local-analysis` mounted + readable ✓
- `/mnt/remote/ace-linux-2/dde` mounted + readable ✓
- fstab entries written + `daemon-reload` done ✓
- **Remaining**: reboot test

### ace-linux-2 session — 2026-02-22
- workspace-hub fstab entry added ✓ (with safeguards: `noauto,x-systemd.automount,_netdev,reconnect,ServerAliveInterval=15,ServerAliveCountMax=3,IdentityFile,allow_other,uid/gid=1000`)
- `/mnt/remote/ace-linux-1/{local-analysis,ace}` created ✓
- fstab entries for ace-linux-1 local-analysis + ace added ✓
- Hard reboot performed (KVM display unrecoverable) ✓
- **Remaining**: reboot test + KVM display issue (see below)

### Reboot Test — ace-linux-2 (2026-02-22) — BLOCKED: mounts failing

**Symptom**: After reboot, all 3 SSHFS automount units show `waiting` state correctly but
fail immediately when triggered:
```
mount[2600]: read: Connection reset by peer
mnt-workspace\x2dhub.mount: Mount process exited, code=exited, status=1/FAILURE
Failed to mount mnt-workspace\x2dhub.mount - /mnt/workspace-hub.
```
Affects all 3 mounts: `/mnt/workspace-hub`, `/mnt/remote/ace-linux-1/local-analysis`,
`/mnt/remote/ace-linux-1/ace`.

**Root cause identified**: systemd triggers the SSHFS mount as **root**. Root has never
SSH'd to ace-linux-1, so `/root/.ssh/known_hosts` does not exist / lacks the host key.
OpenSSH rejects unknown hosts → `Connection reset by peer`.

**Fix (ready to run — script at `/tmp/fix-sshfs-mounts.sh` on ace-linux-2)**:
```bash
sudo bash /tmp/fix-sshfs-mounts.sh
```
Script does:
1. `mkdir -p /root/.ssh && chmod 700 /root/.ssh`
2. `ssh-keyscan -H ace-linux-1 >> /root/.ssh/known_hosts`
3. `ssh-keyscan -H 192.168.1.100 >> /root/.ssh/known_hosts`
4. `chmod 600 /root/.ssh/known_hosts`
5. `systemctl daemon-reload`
6. Triggers workspace-hub mount and reports status

**Note**: Script is in `/tmp/` — it will not survive a reboot of ace-linux-2. If
ace-linux-2 is rebooted again before running the script, re-create it or run the
commands manually from this note.

**Manual commands** (if script is gone):
```bash
sudo mkdir -p /root/.ssh
sudo chmod 700 /root/.ssh
sudo ssh-keyscan -H ace-linux-1 | sudo tee -a /root/.ssh/known_hosts
sudo ssh-keyscan -H 192.168.1.100 | sudo tee -a /root/.ssh/known_hosts
sudo chmod 600 /root/.ssh/known_hosts
sudo systemctl daemon-reload
sudo systemctl start 'mnt-workspace\x2dhub.mount'
mount | grep sshfs
```

**After fix**: verify all 3 mounts, then update acceptance criteria above.

### KVM Display Issue — ace-linux-2 (2026-02-22)

**Symptom**: No display output on ace-linux-2 after switching KVM to another machine and back.

**Diagnosis (via SSH from ace-linux-1)**:
- GDM running ✓, session active on `seat0 tty2` (session ID 5)
- Display port `card2-DP-3` (NVIDIA T400, DisplayPort) shows `connected` — OS sees monitor
- `card1-VGA-1` (ASPEED BMC) also shows `connected` — always on
- Ubuntu 24.04 uses **Wayland** by default (no X lock file at `/tmp/.X*`)
- Root cause: **KVM drops EDID signal on switch** — NVIDIA GPU stops outputting when it loses EDID, does not auto-recover when KVM switches back

**Attempted fix**: `loginctl unlock-session 5` — sent but result unknown (no display to verify)

**Recommended fixes (in preference order)**:

| Option | Command / Action | Notes |
|--------|-----------------|-------|
| 1. EDID emulator dongle | Buy ~$10 DisplayPort EDID emulator, plug into KVM port | Best fix — hardware, zero config, permanent |
| 2. Wake session via SSH | `loginctl unlock-session 5` from ace-linux-1 | Try first each time KVM switches back |
| 3. Restart GDM | `sudo systemctl restart gdm` from ace-linux-1 | Kills graphical session but restores display |
| 4. Force DP always-on | Create `/etc/X11/xorg.conf.d/10-monitor.conf` with `Option "IgnoreDisplayDevices" "none"` | Needs Xorg (currently Wayland) |

**Immediate workaround**: SSH from ace-linux-1 and run `loginctl unlock-session 5` each time display goes blank after KVM switch. If that fails: `sudo systemctl restart gdm`.

## Agentic AI Horizon

- File sharing is infrastructure, not AI-automated soon
- Getting this right now unblocks multi-seat work immediately
- No deferral warranted — setup is low complexity once IPs are known

---
*Source: "let us progress this as a work item. linux to linux sharing, only need workspace-hub across network from other machine, windows sharing future/not needed now"*
