---
id: WRK-062
title: "Test suite for spec converter using existing example data"
status: archived
priority: high
complexity: medium
created_at: 2026-01-31T00:00:00Z
target_repos:
  - digitalmodel
commit:
spec_ref:
related: [WRK-026, WRK-057, WRK-058, WRK-059, WRK-060, WRK-061]
blocked_by: [WRK-057]
synced_to: []
parent: WRK-026
plan_workstations: [ace-linux-1]
execution_workstations: [ace-linux-1]
---
# Test Suite for Spec Converter Using Existing Example Data

## What
Create a comprehensive test suite that validates the spec converter pipeline using real example data already present in the digitalmodel repository. Tests should cover schema validation, each backend, mesh conversion, and round-trip integrity.

## Why
The digitalmodel repo contains rich example data for both AQWA and OrcaWave that serves as ground truth for validation. TDD requires tests first — this work item defines the test infrastructure and golden-file tests that the backends must satisfy.

## Existing Test Data Sources

### AQWA Examples
| Path | Description |
|------|-------------|
| `docs/modules/aqwa/examples/03_dat/001_ship_raos/001_ship_raos.dat` | Ship RAO analysis (single file) |
| `docs/modules/aqwa/examples/03_dat/002_ship_with_pier/` | Multi-deck ship-pier (modular) |
| `docs/modules/aqwa/examples/03_dat/003_FPSO_Turret/` | FPSO turret analysis |
| `tests/modules/aqwa/conftest.py` | AQWA test fixtures |

### OrcaWave Examples
| Path | Description |
|------|-------------|
| `docs/modules/orcawave/examples/L01_default_vessel/L01 Default vessel.yml` | Default vessel (single file) |
| `docs/modules/orcawave/examples/L02 OC4 Semi-sub/L02 OC4 Semi-sub.yml` | Semi-sub analysis |
| `docs/modules/orcawave/L01_aqwa_benchmark/orcawave_001_ship_raos_rev2.yml` | AQWA benchmark match |
| `specs/modules/orcawave/diffraction-analysis/inputs/orcawave/go-by/` | Go-by configs |

### Mesh Examples
| Path | Format | Description |
|------|--------|-------------|
| `tests/modules/bemrosetta/fixtures/sample_box.gdf` | GDF | Simple box mesh |
| `tests/modules/bemrosetta/fixtures/sample_box.dat` | DAT | Same box in NEMOH format |
| `docs/modules/orcawave/examples/L01_default_vessel/L01 Vessel mesh.gdf` | GDF | Tutorial vessel mesh |
| `specs/modules/orcawave/diffraction-analysis/inputs/geometry/*.stl` | STL | Sea Cypress meshes |

## Test Categories

### 1. Schema Tests (`test_input_schemas.py`)
- Valid spec.yml loads without errors
- Missing required fields → clear validation error
- Invalid types → clear validation error
- Default values applied correctly
- Frequency range vs explicit list handling
- Heading symmetry flag behavior

### 2. AQWA Backend Tests (`test_aqwa_backend.py`)
- Golden file: generate from spec → compare to `001_ship_raos.dat`
- Deck structure: correct header/body/footer per deck
- Node formatting: correct spacing and structure numbering
- Modular mode: files match when combined into single file
- Parametric: change water depth → only affected decks change

### 3. OrcaWave Backend Tests (`test_orcawave_backend.py`)
- Golden file: generate from spec → compare to `L01 Default vessel.yml`
- Section completeness: all required OrcaWave sections present
- Body properties: mass, inertia, mesh reference correct
- Modular mode: master + includes produce same result as single file
- Frequency conversion: period input → correct frequency output

### 4. Mesh Pipeline Tests (`test_mesh_pipeline.py`)
- Round-trip: GDF → PanelMesh → GDF (lossless)
- Round-trip: DAT → PanelMesh → DAT (lossless)
- Cross-format: GDF → DAT → GDF (panel/vertex count preserved)
- AQWA deck format: PanelMesh → deck 1+2 cards → PanelMesh
- Quality report: known-good mesh scores > 80

### 5. Integration Tests (`test_spec_converter_integration.py`)
- Full pipeline: spec.yml → AQWA single → output exists and valid
- Full pipeline: spec.yml → OrcaWave single → output exists and valid
- Benchmark mode: spec.yml → both solvers → outputs structurally consistent
- CLI: `convert-spec` exit code 0 for valid input, non-zero for invalid

## Implementation Steps
1. Create test fixtures: 3 spec.yml files derived from existing examples
2. Create golden files: expected outputs for each backend/format combination
3. Write schema validation tests (TDD: these run first)
4. Write backend tests with golden file comparison
5. Write mesh pipeline tests with round-trip validation
6. Write integration tests covering CLI end-to-end

## Acceptance Criteria
- [ ] 3+ spec.yml test fixtures covering different vessel types
- [ ] Golden file comparison for AQWA single-file output
- [ ] Golden file comparison for OrcaWave single-file output
- [ ] Round-trip mesh tests for all format pairs
- [ ] Schema validation tests (positive and negative cases)
- [ ] Integration tests covering CLI commands
- [ ] All tests pass in digitalmodel's uv test environment

---
*Source: WRK-026 child — test suite with existing example data*
