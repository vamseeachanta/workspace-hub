---
id: WRK-061
title: "CLI and integration layer for spec converter"
status: archived
priority: medium
complexity: medium
created_at: 2026-01-31T00:00:00Z
target_repos:
  - digitalmodel
commit:
spec_ref:
related: [WRK-026, WRK-057, WRK-058, WRK-059, WRK-060]
blocked_by: [WRK-058, WRK-059, WRK-060]
synced_to: []
parent: WRK-026
plan_workstations: [ace-linux-1]
execution_workstations: [ace-linux-1]
---
# CLI and Integration Layer for Spec Converter

## What
Build the CLI commands and integration layer that ties together the canonical spec schema, solver backends (AQWA, OrcaWave), and mesh converter pipeline into a unified user-facing tool.

## Why
The individual backends (WRK-058, WRK-059) and mesh pipeline (WRK-060) need a cohesive interface. The CLI provides the primary user entry point and the integration layer handles backend selection, validation, and output organization.

## CLI Commands

```bash
# Convert spec to solver-specific input
digitalmodel convert-spec analysis.yml --solver aqwa --format single --output ./aqwa_run/
digitalmodel convert-spec analysis.yml --solver aqwa --format modular --output ./aqwa_run/
digitalmodel convert-spec analysis.yml --solver orcawave --format single --output ./orcawave_run/
digitalmodel convert-spec analysis.yml --solver orcawave --format modular --output ./orcawave_run/

# Generate for all solvers (benchmarking)
digitalmodel convert-spec analysis.yml --solver all --output ./benchmark/

# Validate spec without generating
digitalmodel validate-spec analysis.yml

# Show spec info
digitalmodel spec-info analysis.yml

# Mesh conversion (from WRK-060)
digitalmodel mesh-convert input.stl output.gdf
digitalmodel mesh-validate hull.gdf --report
```

## Integration Layer

```python
class SpecConverter:
    """Main entry point for spec → solver input conversion."""

    def __init__(self, spec_path: Path):
        self.spec = DiffractionSpec.from_yaml(spec_path)
        self.backends = {
            'aqwa': AQWABackend(),
            'orcawave': OrcaWaveBackend(),
        }

    def convert(self, solver: str, format: str, output_dir: Path) -> Path:
        """Convert spec to solver-specific input files."""
        backend = self.backends[solver]
        self.spec.validate()
        mesh = self._prepare_mesh(solver)
        if format == 'single':
            return backend.generate_single(self.spec, mesh, output_dir)
        elif format == 'modular':
            return backend.generate_modular(self.spec, mesh, output_dir)

    def convert_all(self, output_dir: Path) -> dict[str, Path]:
        """Generate inputs for all solvers (benchmarking)."""
```

## Implementation Steps
1. Create `src/digitalmodel/modules/diffraction/spec_converter.py` — main integration class
2. Create `src/digitalmodel/modules/diffraction/cli.py` — Click-based CLI commands
3. Register CLI commands in digitalmodel's main CLI entry point
4. Output directory structure: `output_dir/{solver}/{format}/` with manifest
5. Logging and progress reporting for conversion steps
6. Error handling: clear messages for schema validation failures, missing mesh files, unsupported options

## Acceptance Criteria
- [ ] `convert-spec` CLI command works end-to-end for AQWA single + modular
- [ ] `convert-spec` CLI command works end-to-end for OrcaWave single + modular
- [ ] `validate-spec` reports all schema errors without generating files
- [ ] `--solver all` generates both AQWA and OrcaWave outputs in one run
- [ ] Output directory has consistent structure with README/manifest
- [ ] Integration tests covering full pipeline: spec → CLI → output files → validate

---
*Source: WRK-026 child — CLI and integration*
