---
id: WRK-059
title: "OrcaWave input backend — spec.yml to single .yml and modular includes"
status: archived
priority: high
complexity: complex
created_at: 2026-01-31T00:00:00Z
target_repos:
  - digitalmodel
commit:
spec_ref:
related: [WRK-026, WRK-057, WRK-029, WRK-030]
blocked_by: [WRK-057]
synced_to: []
parent: WRK-026
plan_workstations: [ace-linux-1]
execution_workstations: [ace-linux-1]
---
# OrcaWave Input Backend — spec.yml to Single .yml and Modular Includes

## What
Implement a converter backend that takes a canonical `spec.yml` and generates OrcaWave-compatible input files in two modes:
1. **Single file**: Complete `.yml` project file with all sections (UnitsSystem, Bodies, Environment, etc.)
2. **Modular files**: Master `.yml` with include references to separate section files (01_general through 09_shapes)

## Why
The existing OrcaWave orchestrator generates configs from a vessel template + base config. This backend adapts the canonical spec to OrcaWave's YAML project format, enabling the same analysis definition to target either AQWA or OrcaWave.

## Existing Code to Leverage
- `src/digitalmodel/modules/orcawave/diffraction/orchestrator.py` — config generation with template substitution
- `src/digitalmodel/modules/orcawave/diffraction/configs/base_diffraction_config.yml` — base template
- `docs/modules/orcawave/examples/` — L01-L05 tutorial cases with `.yml` and `.gdf` files
- `docs/modules/orcawave/L01_aqwa_benchmark/` — AQWA-OrcaWave comparison configs

## Section Mapping from Spec

| Spec Section | OrcaWave Section | Notes |
|-------------|-----------------|-------|
| analysis.type | SolveType | diffraction → "Diffraction only", full_qtf → "Full QTF calculation" |
| vessel.name | Bodies[0].BodyName | |
| vessel.mass | Bodies[0].BodyMass | |
| vessel.centre_of_gravity | Bodies[0].BodyCentreOfMass | |
| vessel.inertia_tensor | Bodies[0].BodyInertiaTensor* | Split into 6 separate fields |
| geometry.mesh_file | Bodies[0].BodyMeshFileName | Convert to OrcaWave-compatible format |
| geometry.mesh_format | Bodies[0].BodyMeshFormat | "Aqwa dat", "Wamit gdf", etc. |
| environment.water_depth | Environment.WaterDepth | |
| environment.water_density | Environment.WaterDensity | |
| frequencies | PeriodOrFrequency | Convert between period/frequency as needed |
| wave_headings | WaveHeading | |
| solver_options.qtf | QTFMinPeriod, QTFMaxPeriod | Only if qtf_calculation: true |
| solver_options.load_rao_method | LoadRAOCalculationMethod | haskind/direct/both |

## Modular Include Structure
```
model_name/
├── master.yml              # Top-level with include references
├── includes/
│   ├── 01_general.yml      # UnitsSystem, SolveType, LoadRAOMethod
│   ├── 02_environment.yml  # WaterDepth, WaterDensity
│   ├── 03_bodies.yml       # Body definitions, mesh refs, mass/inertia
│   ├── 04_frequencies.yml  # PeriodOrFrequency ranges
│   ├── 05_headings.yml     # WaveHeading list
│   ├── 06_qtf.yml          # QTF settings (if applicable)
│   └── 07_outputs.yml      # Output configuration
└── geometry/
    └── <mesh_file>         # Converted mesh in OrcaWave-compatible format
```

## Implementation Steps
1. Create `OrcaWaveBackend` class in `src/digitalmodel/modules/diffraction/backends/orcawave_backend.py`
2. Map canonical spec fields to OrcaWave YAML sections
3. Single-file mode: write complete `.yml` with all sections
4. Modular mode: write master + include files
5. Mesh conversion: spec mesh → GDF or DAT format for OrcaWave
6. Validate against existing tutorial examples

## Acceptance Criteria
- [ ] `OrcaWaveBackend.generate_single(spec) → Path` produces valid OrcaWave `.yml`
- [ ] `OrcaWaveBackend.generate_modular(spec) → Path` produces master + includes structure
- [ ] Generated `.yml` compatible with OrcaWave project format (matches L01 tutorial structure)
- [ ] Mesh correctly referenced and converted to OrcaWave-compatible format
- [ ] Frequency/heading conversion handles period ↔ frequency correctly
- [ ] Tests using L01_default_vessel and L01_aqwa_benchmark as ground truth

---
*Source: WRK-026 child — OrcaWave input backend*
