---
id: WRK-057
title: "Define canonical spec.yml schema for diffraction analysis"
status: archived
priority: high
complexity: medium
created_at: 2026-01-31T00:00:00Z
target_repos:
  - digitalmodel
commit:
spec_ref:
related: [WRK-026, WRK-058, WRK-059, WRK-060]
blocked_by: []
synced_to: []
parent: WRK-026
plan_workstations: [ace-linux-1]
execution_workstations: [ace-linux-1]
---
# Define Canonical spec.yml Schema for Diffraction Analysis

## What
Design and implement a solver-agnostic YAML schema (`spec.yml`) that captures all information needed to define a diffraction analysis. This becomes the single source of truth from which solver-specific inputs (AQWA, OrcaWave) are generated.

## Why
Each solver currently has its own config format. A canonical schema enables "define once, generate for any solver" and provides a stable interface for parametric studies, benchmarking, and automation.

## Schema Sections (Draft)
```yaml
version: "1.0"
analysis:
  name: str
  type: diffraction | radiation | full_qtf
  description: str

vessel:
  name: str
  type: str  # FPSO, semi-sub, ship, spar, etc.
  mass: float  # tonnes
  centre_of_gravity: [x, y, z]
  radii_of_gyration: [kxx, kyy, kzz]
  inertia_tensor:  # optional full 6x6
    Ixx: float
    Iyy: float
    Izz: float
    Ixy: float  # cross terms optional
    Ixz: float
    Iyz: float

geometry:
  mesh_file: str  # path to common format mesh
  mesh_format: gdf | dat | stl  # auto-detect from extension
  symmetry: none | xz | yz | xz+yz
  reference_point: [x, y, z]
  waterline_z: float

environment:
  water_depth: float | infinite
  water_density: float  # default 1025 kg/m³
  gravity: float  # default 9.80665 m/s²

frequencies:
  type: period | frequency  # input units
  values: list[float]  # explicit list
  # OR range definition:
  start: float
  end: float
  count: int
  distribution: linear | logarithmic

wave_headings:
  values: list[float]  # degrees
  # OR range:
  start: float
  end: float
  increment: float
  symmetry: bool  # exploit heading symmetry

solver_options:
  remove_irregular_frequencies: bool
  qtf_calculation: bool
  load_rao_method: haskind | direct | both
  precision: single | double

outputs:
  formats: [csv, xlsx, hdf5, orcaflex_yml]
  components: [raos, added_mass, damping, excitation, mean_drift, qtf]

metadata:
  project: str
  author: str
  date: str
  tags: list[str]
```

## Implementation Steps
1. Review existing schemas: `output_schemas.py`, `base_diffraction_config.yml`, `aqwa.yml`
2. Identify superset of fields across AQWA and OrcaWave configs
3. Define schema as Pydantic models in `src/digitalmodel/modules/diffraction/input_schemas.py`
4. Create JSON Schema export for external validation
5. Write example `spec.yml` files from existing test cases
6. Validate that schema captures all info needed by AQWA and OrcaWave backends

## Acceptance Criteria
- [ ] Pydantic models for all schema sections
- [ ] JSON Schema export (`diffraction_spec_schema.json`)
- [ ] At least 3 example spec.yml files (ship RAOs, FPSO, semi-sub)
- [ ] Validation: load spec → check all required fields → report errors
- [ ] Documentation of each field with units and defaults
- [ ] Tests for schema validation (valid and invalid inputs)

---
*Source: WRK-026 child — canonical schema definition*
