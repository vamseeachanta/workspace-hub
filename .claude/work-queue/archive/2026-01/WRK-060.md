---
id: WRK-060
title: "Common mesh format and converter pipeline (BEMRosetta + GMSH)"
status: archived
priority: high
complexity: medium
created_at: 2026-01-31T00:00:00Z
target_repos:
  - digitalmodel
commit:
spec_ref:
related: [WRK-026, WRK-057, WRK-058, WRK-059]
blocked_by: []
synced_to: []
parent: WRK-026
---
# Common Mesh Format and Converter Pipeline

## What
Establish a common mesh interchange format and build a conversion pipeline that ensures meshes are interchangeable between AQWA, OrcaWave, BEMRosetta, and GMSH. Extend existing BEMRosetta mesh handlers and integrate GMSH for parametric mesh generation.

## Why
Each solver accepts different mesh formats:
- **AQWA**: Node/element cards in `.dat` deck 1+2 format
- **OrcaWave**: GDF (WAMIT), DAT (NEMOH), STL
- **BEMRosetta**: GDF, DAT, STL (already supported)
- **GMSH**: `.msh` native, can export to multiple formats

A common pipeline ensures a mesh defined once can target any solver without manual conversion.

## Existing Assets
- `bemrosetta/mesh/mesh_handler.py` — `BaseMeshHandler`, `convert_mesh()`, `PanelMesh` data model
- `bemrosetta/mesh/gdf_handler.py` — WAMIT GDF read/write
- `bemrosetta/mesh/dat_handler.py` — AQWA/NEMOH DAT read/write
- `bemrosetta/mesh/stl_handler.py` — STL ASCII/binary read/write
- `gmsh_meshing/mesh_generator.py` — `GMSHMeshGenerator` with basic geometry
- `bemrosetta/models/mesh_models.py` — `PanelMesh`, `MeshQualityReport`

## Implementation Steps

### 1. Common Mesh Format (extend PanelMesh)
- Use `PanelMesh` as the canonical in-memory representation
- Add serialization: `PanelMesh.to_yaml()` / `PanelMesh.from_yaml()` for persistence
- Add metadata: solver origin, quality metrics, symmetry info

### 2. AQWA Deck 1+2 Handler
- New handler: `AQWADeckHandler` in `bemrosetta/mesh/aqwa_deck_handler.py`
- Read: parse AQWA `.dat` deck 1 (COOR) + deck 2 (ELM*) → `PanelMesh`
- Write: `PanelMesh` → formatted AQWA deck 1+2 card strings
- This bridges BEMRosetta's mesh system with AQWA's native input format

### 3. GMSH Integration Pipeline
- Extend `GMSHMeshGenerator` to output `PanelMesh` directly
- Add import from `.msh` → `PanelMesh`
- Add parametric hull generation (box barge, cylinder, hemisphere) for testing
- Surface mesh extraction (GMSH generates volume meshes; need surface panel extraction)

### 4. OBJ Handler (optional)
- OrcaWave supports `.obj` — add `OBJHandler` to BEMRosetta mesh handlers
- Read Wavefront OBJ (vertices + faces) → `PanelMesh`

### 5. Conversion Pipeline CLI
```bash
# Direct conversion
digitalmodel mesh-convert hull.stl hull.gdf

# GMSH parametric generation
digitalmodel mesh-generate --shape box --length 100 --beam 30 --draft 10 --panel-size 0.5 -o hull.gdf

# Mesh quality report
digitalmodel mesh-validate hull.gdf --report
```

## Acceptance Criteria
- [ ] `PanelMesh` serialization to/from YAML
- [ ] AQWA deck 1+2 handler (read/write COOR + ELM cards)
- [ ] All 6 conversion paths tested: GDF↔DAT, GDF↔STL, DAT↔STL
- [ ] GMSH → PanelMesh pipeline for basic geometries
- [ ] Mesh quality report: panel count, aspect ratios, normals, degenerate panels
- [ ] Round-trip test: read → write → read → compare (lossless for GDF and DAT)
- [ ] Test with real meshes from `docs/modules/orcawave/examples/` and `tests/modules/bemrosetta/fixtures/`

---
*Source: WRK-026 child — common mesh format and conversion pipeline*
