---
id: WRK-216
title: 'Subagent learning capture — emit signals to pending-reviews before task completion'
status: archived
priority: medium
complexity: simple
compound: false
created_at: 2026-02-19T00:00:00Z
target_repos:
  - workspace-hub
module: automation
tags:
  - subagents
  - improve
  - learning-capture
  - agent-teams
  - workflow
related:
  - WRK-212
  - WRK-215
  - WRK-214
blocked_by: []
synced_to: []
provider: claude
spec_ref: ''
plan_reviewed: false
plan_approved: true
percent_complete: 100
brochure_status: n/a
---
# WRK-216: Subagent Learning Capture

## What

Subagents executing WRK tasks complete their work and exit without emitting any
learning signals. Stop hooks (`post-task-review.sh`, `ecosystem-health-check.sh`)
and `/improve` only fire for the main orchestrator session. Subagent learnings
survive only if the main session reconstructs them from task output text — fragile
and incomplete.

Fix: add a lightweight signal-emission step to the subagent completion protocol,
and document this in `agent-teams/SKILL.md` and `process.md`.

## Why

Surfaced in session 2026-02-19 while dispatching P2 cross-review agents for
WRK-205 and WRK-209. Example learnings that would have been lost without the
main session manually capturing them:
- Gemini CLI misinterprets cross-review prompts as execution commands
- Codex CLI not installed in this environment
- `--quiet` flag needed on `uv run` to suppress verbose output
- P2 reviews found 6 files missed in WRK-209 scope (audit-first is essential)

These were captured by the main session only because the conversation was still
active. In automated or longer sessions, they would be lost.

## Scope

Two file edits only (Route A):

**1. `.claude/skills/workspace-hub/agent-teams/SKILL.md`**

Add a "Learning capture" subsection to the team lifecycle section:

```
### Learning capture (subagent responsibility)

Before returning results, subagents executing non-trivial tasks SHOULD emit
signals to the main session's pending-reviews:

- New skill gap found → append to `.claude/state/pending-reviews/skill-candidates.jsonl`
- Tool/API quirk discovered → append to `.claude/state/pending-reviews/memory-updates.jsonl`
- Process deviation observed → append to `.claude/state/pending-reviews/insights.jsonl`

Emit format (JSONL, one line):
{"timestamp":"<ISO>","type":"<skill|memory|insight>","content":"<finding>","source":"<WRK-ID>","severity":"info"}

This ensures /improve ingests subagent learnings at session end rather than
relying on the main session to reconstruct them from task output text.
```

**2. `.claude/work-queue/process.md`**

Add one clause to the Execution section:

```
- **Subagent learning capture**: Executor agents emit signals to
  `.claude/state/pending-reviews/` before completing. Tool quirks, scope
  deviations, and missed-file discoveries go to memory-updates.jsonl or
  skill-candidates.jsonl. Do not rely on the orchestrator to reconstruct
  these from task output.
```

## Acceptance Criteria

- [ ] `agent-teams/SKILL.md` has learning capture subsection with emit format
- [ ] `process.md` has subagent learning capture clause in Execution section
- [ ] Both files pass 400-line limit check

## Plan

Route A — two file edits. No cross-review. No new infrastructure.

## Execution Brief

### Provider
- **Executor**: Claude Sonnet — two markdown edits

### Task for Executor
Edit two files as specified in Scope above. Read each file first, insert
at the correct location, verify line counts under 400.

### Done When
- [ ] `agent-teams/SKILL.md` contains emit format and JSONL schema
- [ ] `process.md` contains subagent learning capture clause
- [ ] `wc -l` both files < 400
