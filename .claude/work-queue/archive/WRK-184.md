---
id: WRK-184
title: "Improve /improve \u2014 Bug fixes, recommendations output, startup readiness"
status: archived
priority: high
provider: claude
created: 2026-02-17
completed: 2026-02-17
followup:
- WRK-186
- WRK-187
session_id: magical-snuggling-melody
tags:
- improve
- readiness
- hooks
- bug-fix
task_agents:
  implement: claude
  review: claude
complexity: medium
created_at: '2026-02-17T00:00:00Z'
target_repos:
- workspace-hub
spec_ref: ''
plan_reviewed: false
plan_approved: false
plan_workstations: [ace-linux-1]
execution_workstations: [ace-linux-1]
---
# WRK-184: Improve /improve — Bug fixes, recommendations output, startup readiness

## Scope

Fix bugs in `/improve` lib modules, add recommendation output (Phase 5.5), and create startup readiness dispatcher.

## Deliverables

### Bug Fixes (completed)
- [x] **apply.sh**: Fixed subshell variable loss (pipe → process substitution), deduplicated enhance/append, corrected misleading "60% API" comment
- [x] **log.sh**: Fixed YAML injection — all string values now properly quoted, `reason` field escapes internal double quotes
- [x] **ecosystem.sh**: Corrected misleading "30% API" comment to "100% shell"

### New Features (completed)
- [x] **recommend.sh** (`scripts/improve/lib/recommend.sh`): Phase 5.5 — surfaces actionable recommendations to terminal after apply phase:
  - Changes applied summary
  - Ecosystem health warnings (memory limit, skill sprawl)
  - Skill gap detection from session signals
  - Correction chain analysis (suggests rules)
  - Mature pattern promotion
  - Tool/plugin recommendations (jq, yq, curl, codex, gemini, MCP servers)
  - API credential check
- [x] **ensure-readiness.sh** (`.claude/hooks/readiness/ensure-readiness.sh`): **Stop hook #9** — ensures next session starts clean:
  - R1: Memory curation (MEMORY.md line count, stale entries)
  - R5: Context budget enforcement (CLAUDE.md + rules/ + MEMORY.md vs 16KB)
  - R6: Submodule sync (detached HEAD, >5 commits behind)
  - Writes `state/readiness-report.md` for next session's startup
  - Clears startup lock file so next session re-verifies
- [x] **readiness.sh** (`.claude/hooks/readiness/readiness.sh`): **Startup hook** — lightweight verification:
  - Surfaces previous session's readiness report warnings
  - R4: Agent CLI availability check (claude, codex, gemini)
  - R4: Model registry freshness (<30 days)
  - R8: Required tools (jq, curl)
  - Run-once-per-session via lock file

### Wiring (completed)
- [x] `improve.sh` sources `recommend.sh` and runs `phase_recommend` after apply phase
- [x] `settings.json` PreToolUse hook #3 added for readiness dispatcher

## Files Changed

| Action | File |
|--------|------|
| FIXED | `scripts/improve/lib/apply.sh` |
| FIXED | `scripts/improve/lib/log.sh` |
| FIXED | `scripts/improve/lib/ecosystem.sh` |
| MODIFIED | `scripts/improve/improve.sh` |
| CREATED | `scripts/improve/lib/recommend.sh` |
| CREATED | `.claude/hooks/readiness/readiness.sh` |
| CREATED | `.claude/hooks/readiness/ensure-readiness.sh` |
| MODIFIED | `.claude/settings.json` (PreToolUse #3, Stop #9) |
| CREATED | `.claude/work-queue/pending/WRK-184.md` |

## Testing

- `readiness.sh` tested: correctly detects context budget at 138% (22,650/16,384 bytes), 3/3 CLIs, missing yq
- `improve.sh --quick --dry-run` tested: recommendation output shows memory warning, tool recommendations, stats
