---
id: WRK-053
title: "assethold test coverage improvement"
status: done
priority: medium
complexity: medium
created_at: 2026-01-30T00:00:00Z
target_repos:
  - assethold
commit:
spec_ref:
related: [WRK-051, WRK-052, WRK-054, WRK-055, WRK-056]
blocked_by: []
synced_to: []
tags: [testing, coverage, tdd, infrastructure]
---

# assethold Test Coverage Improvement

## What
Set up test infrastructure and achieve 80%+ test coverage for the assethold repository. Currently there is no coverage data available, meaning the testing infrastructure may not be configured.

## Why
Without any coverage data, there is no visibility into code quality or regression risk. Setting up the testing infrastructure is a prerequisite for safe development and maintenance.

## Current State
- **Coverage**: No data available
- **Test infrastructure**: Not configured
- **Tests**: Unknown

## Strategy
1. Set up pytest + coverage infrastructure (pyproject.toml / setup.cfg)
2. Configure coverage reporting (coveragerc or pyproject.toml coverage section)
3. Run initial coverage baseline measurement
4. Write tests for core modules starting with highest-risk code
5. Integrate coverage into CI pipeline

## Acceptance Criteria
- [ ] pytest and coverage tooling configured and working
- [ ] Baseline coverage measured and documented
- [ ] Core module tests written
- [ ] Overall repository coverage reaches 80%+
- [ ] CI pipeline reports coverage on every PR

## Notes
- This is a greenfield testing effort -- start with infrastructure before writing tests
- Identify the most critical code paths first to prioritize test writing

## Plan

**Target**: `assethold/tests/`

### Phase 1 — Set Up Test Infrastructure
- Create `pyproject.toml` or add `[tool.pytest.ini_options]` section
- Configure `pytest-cov` with `--cov=assethold`
- Verify package is importable from tests
- Run initial test discovery to establish baseline

### Phase 1.5 — Module Inventory
- Inventory all modules under `src/assethold/modules/` and `src/assethold/common/` to understand current functionality
- Note: `stocks/` (WRK-021), `property/` (WRK-022) do not exist yet — test only existing modules

### Phase 2 — Baseline Assessment
- Identify all source modules in assethold (from inventory above)
- Run coverage measurement against all source
- Document which modules have 0% vs partial coverage
- Prioritize by business criticality of existing modules (engine.py, common utilities, modules/)
- Set per-package minimum coverage threshold, not only overall

### Phase 3 — Test Writing
- Focus on existing modules only; future modules (stocks, property) will have tests written as part of their respective WRK items
- Create test fixtures for sample data; document how fixtures are shared across tests
- Follow TDD naming: `test_<module>_<function>_<scenario>_<expected>`
- Target: 80%+ coverage per module

### Phase 4 — CI Integration
- Add coverage reporting to CI pipeline
- Set minimum threshold enforcement

### Review Notes
- **Verdict**: Claude: MINOR | Codex: MINOR | Gemini: APPROVE
- **Actions taken**:
  - Added Phase 1.5 module inventory step to discover what actually exists before writing tests
  - Clarified that `stocks/`, `property/`, `tax/` modules don't exist yet — scope limited to existing modules
  - Added per-package coverage threshold (not just overall)
  - Added test fixture sharing documentation requirement
  - Identified top modules to target: `engine.py`, `common/`, `modules/` per Codex feedback
- *Cross-reviewed: 2026-02-09*

*Approved by user: 2026-02-09*

---
*Source: test coverage audit across workspace-hub repositories*
