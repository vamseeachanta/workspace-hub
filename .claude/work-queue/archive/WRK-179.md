---
id: WRK-179
title: 'Start Hook: Agent Capacity Pre-flight'
status: archived
priority: medium
complexity: low
compound: false
created_at: 2026-02-17 00:00:00+00:00
completed: 2026-02-19
percent_complete: 100
source: plan-magical-snuggling-melody
target_repos:
- workspace-hub
module: automation
tags:
- session-lifecycle
- multi-agent
- quota
- ai-operations
spec_ref: null
related:
- WRK-172
- WRK-173
blocked_by: []
synced_to: []
provider: codex
provider_alt: null
plan_reviewed: false
plan_approved: true
---
# WRK-179: Start Hook — Agent Capacity Pre-flight

## What
Before starting work, check all three providers (Claude/Codex/Gemini) quota status from cached data. If primary provider is >90% weekly utilization, suggest task routing to alternative provider. Prevents mid-session quota exhaustion.

## Phases
- [x] Phase 1: Implement agent capacity check — read `agent-quota-latest.json`
- [x] Phase 2: Display provider capacity summary at session start
- [x] Phase 3: Suggest routing when primary is >90% — reference `assign-providers.sh` for alternatives

## Delivered

Implemented as `check_agent_capacity()` function in `.claude/hooks/readiness/readiness.sh` (lines 53–91).
All three phases complete — reads quota cache, warns at ≥90%, suggests alternatives, notes stale cache.
