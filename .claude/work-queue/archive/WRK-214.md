---
id: WRK-214
title: 'Session lifecycle compliance — interview-driven review of all workflow scaffolding'
status: archived
priority: high
complexity: medium
compound: false
created_at: 2026-02-19T00:00:00Z
target_repos:
  - workspace-hub
module: automation
tags:
  - session-lifecycle
  - orchestration
  - workflow
  - compliance
  - interview
  - tool-readiness
  - statusline
  - cross-os
related:
  - WRK-213
  - WRK-211
  - WRK-179
blocked_by: []
synced_to: []
provider: claude
spec_ref: ''
plan_reviewed: true
plan_approved: true
percent_complete: 100
brochure_status: n/a
---
# WRK-214: Session Lifecycle Compliance — Interview-Driven Workflow Review

## What

Review all session lifecycle workflow scaffolding — readiness checks, skill loading,
orchestration rules, learning capture, and agent behaviour contracts — through a
structured manual interview. Identify gaps, ambiguities, and failure modes. Improve
the scaffolding so these processes are reliably followed by any AI agent without
missing steps.

## Working Context

**Single terminal model**: Claude Code IS the primary work surface. Ad-hoc terminal work
happens in spare terminals, but all work items are captured and tracked here. Agentic code
has made the multi-terminal workflow obsolete — the orchestrator manages execution, not the
human switching between tabs. This is a stable shift, not a temporary habit.

**Work sources — all three must flow into the queue**:
1. Existing work items spawn child items during execution
2. User inputs (ad-hoc, in-session, real-time)
3. The ecosystem extending itself — tools built here enable more tools; every module
   added increases the surface area for the next module

**Self-extending ecosystem principle**: This workspace is not just a place to do work —
it is itself a product of the work. The queue is the flywheel:
engineering work → tools → more engineering work → better tools.
The session lifecycle must support this loop, not interrupt it.

## Why

The session lifecycle is the invisible foundation of every work session: it sets
who the orchestrator is, what skills are loaded, what rules apply, and how learnings
are captured. When any part is unclear or poorly enforced, agents either skip steps
or silently deviate. The recent `/clear` + blank-output failure (WRK-213 research
finding) is a direct symptom of this gap.

The goal is zero ambiguity: every agent, every session, follows the same process
to the letter — not because it was told to in the moment, but because the scaffolding
makes deviation impossible or immediately visible.

## Scope

Session lifecycle components to review:

1. **Readiness** — pre-session checks (repo state, quota, provider availability)
2. **Skill loading** — which skills are loaded at session start, how, and by whom
3. **Orchestration rules** — who is orchestrator, what subagents can and cannot do,
   the prompt-layer / control-plane separation principle
4. **Agent behaviour contracts** — `AGENTS.md` / `CLAUDE.md` / `CODEX.md` / `GEMINI.md`
   consistency and enforcement
5. **Learning capture** — session end workflow: insights → memory, learnings → skills,
   findings → work items
6. **Work queue gates** — plan gate, cross-review gate, archive gate — are these
   reliably enforced or easy to skip?
7. **Hook coverage** — start hooks, stop hooks, pre-commit hooks — what fires, what
   is missing, what can be bypassed

## Method

Manual interview approach:
- Walk through each lifecycle phase with Vamsee, step by step
- For each step: does it exist? Is it enforced? Can an agent miss it? Has it been
  missed in practice?
- Output: gap list + improvement proposals for each phase
- Implement fixes only after interview is complete and gaps are agreed

## Target Operating Principles

These are the principles the scaffolding must encode. Output of this work item is
these principles reliably enforced — in hooks, behaviour contracts, and skill files —
not just documented.

### Architecture
- **Prompt layer is for user input only.** System commands (`/clear`, resets, control
  ops) go through a separate control plane — never the same input that reaches the
  orchestrator.
- **Orchestrator context is sacred. Never wipe it.** Subagents can be reset freely.
- **Skills/roles route tasks, not the orchestrator directly** — delegate down, don't
  execute yourself.

### Work Style
- **Don't let architecture become the work.** File structure, org systems, and work
  items are scaffolding — they exist to ship things, not as deliverables themselves.
- **When stuck in planning mode**: identify the one task that *closes* today, do that
  first.
- **700+ domain modules are the moat.** The routing layer (TOML, markdown, MCP) is
  commodity — migrate freely, protect the domain logic.

### Execution
- **Weekly usage reset = accountability cycle.** Results are measured per week, not
  per conversation.
- **If a task can be done by a subagent, spawn it.** Don't burn orchestrator context
  on execution work.
- **Act, don't search-then-confirm.** A note that needs adding → just add it.

*Source: Narada/Vamsee conversation, 2026-02-19*

## Acceptance Criteria

- [ ] Interview complete — all 7 lifecycle phases walked through with Vamsee
- [ ] Gap list documented: every step that is unclear, unenforced, or skippable
- [ ] Improvement proposals written for each gap
- [ ] At least the top 3 gaps addressed (hook, doc, or skill change)
- [ ] Session start / stop sequence documented in a single canonical reference
      (e.g., `docs/session-lifecycle.md` or a SKILL.md update)

### Tool Readiness Review (absorbed from WRK-222, 2026-02-19)

*Context*: Statusline bug fixed — `stats-cache.json` was stale (last entry 2026-02-16),
causing computed `pct_remaining: 100%` for all providers. Fixes applied:
- `statusline-command.sh`: reads `agent-quota-latest.json` (OAuth, week_pct) as primary
- `query-quota.sh`: portable OS helpers added (stat, date, touch, ISO date)
- `readiness.sh`: now triggers `query-quota.sh --refresh` in background when cache >4h

- [ ] Create `.claude/skills/workspace-hub/tool-readiness/SKILL.md` — repeatable
      session-start check covering: CLI availability, data source freshness,
      statusline integrity, cross-OS script compatibility, work queue accessibility
- [ ] Register skill in `SKILLS_GRAPH.yaml`
- [ ] Verify `readiness.sh` background refresh works at session start (cache auto-refreshed)
- [ ] Document: `agent-quota-latest.json` ownership — which script writes it, at what cadence
- [ ] Add `--fix` mode to skill (runs `query-quota.sh --refresh` and reports result)

## Execution Brief (Tool Readiness Skill — ready to delegate)

**What was done (2026-02-19 session)**:
- `statusline-command.sh` — reads `agent-quota-latest.json` (OAuth `week_pct`) as primary;
  falls back to `~/.cache/agent-quota.json`
- `scripts/ai/assessment/query-quota.sh` — portable OS helpers added (`file_mtime`,
  `iso_now`, `today_midnight_ts`, `last_monday_date`, `touch_midnight`) replacing all
  GNU-only `stat -c %Y`, `date -d`, `touch -d`, `date -Iseconds` calls
- `.claude/hooks/readiness/readiness.sh` — triggers `query-quota.sh --refresh` in
  background when cache >4h old (statusline fresh at session open)

**Remaining task — create the skill**:

Create `.claude/skills/workspace-hub/tool-readiness/SKILL.md` with 5 check groups:

| Group | Checks |
|-------|--------|
| 1 — CLI Availability | `claude`, `codex`, `gemini` in PATH |
| 2 — Data Source Health | `agent-quota-latest.json` age <24h; `stats-cache.json` has today's entry (warn if not); `~/.cache/agent-quota.json` age <TTL |
| 3 — Statusline Integrity | Script exists+executable; reads `agent-quota-latest.json` as primary (grep check); not all-100% when quota-latest has real data |
| 4 — Cross-OS Compatibility | `query-quota.sh` uses portable helpers (no bare `stat -c`, `date -d`); helper functions present |
| 5 — Work Queue | `pending/`, `working/`, `blocked/` exist; WRK count >0 |

Format: match `.claude/skills/workspace-hub/ecosystem-health/SKILL.md` (frontmatter +
grouped check tables + bash implementation steps + `[PASS]/[FAIL]/[WARN]` output).

Frontmatter: `name: tool-readiness`, `wrk_ref: WRK-214`, `trigger: session-start`,
`related_skills: [ecosystem-health, repo-sync]`.

After creating, register in `.claude/skills/SKILLS_GRAPH.yaml` under `workspace-hub`.
No other files need editing. Do not commit.

**Done When**: Skill file exists, passes ecosystem-health frontmatter check, produces
clean output on this machine.

## Plan

Route B — medium complexity. Explore existing scaffolding first, then conduct interview.

*Awaiting plan approval.*

---
*Source: user request 2026-02-19 — "review workflow scaffolding and ensure no AI agents miss it: session lifecycle (readiness, skills, learnings, orchestration rules). Manually interview until satisfied, things followed to the dot."*
