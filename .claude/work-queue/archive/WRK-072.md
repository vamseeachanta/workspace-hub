---
id: WRK-072
title: Technical safety analysis module for worldenergydata using ENIGMA theory
status: archived
priority: high
complexity: complex
compound: false
created_at: 2026-02-01T00:00:00Z
target_repos:
  - worldenergydata
commit:
spec_ref:
related: []
blocked_by: []
synced_to: []
plan_workstations: [ace-linux-1]
execution_workstations: [ace-linux-1]
---
# Technical Safety Analysis Module for WorldEnergyData

## What
Port and integrate the technical safety analysis theory, code, and methodologies from the ENIGMA project (`client_projects/energy_firm_sd_support/xom/000 ENIGMA/`) into the `worldenergydata` repository as a structured safety analysis module.

## Why
The ENIGMA project contains mature safety analysis code (NLP classification, incident analysis, hypothesis testing, ML models for safety observations) that should be generalized and integrated into worldenergydata as a reusable technical safety analysis capability.

## Source Material (ENIGMA)
- **NLP pipeline**: TF-IDF, BERT, Doc2Vec, LSTM, Word2Vec models for safety observation card classification
- **Incident analysis**: `incident_analysis.py`, `incident_analysis_2022.py` — incident trend analysis
- **Maintenance analysis**: `maintenance_analysis.py` — maintenance-related safety patterns
- **NPT analysis**: Non-productive time correlation with safety incidents
- **Hypothesis testing**: `sshe_NLP/hypothesis_testing/` — statistical safety hypothesis tests
- **Preprocessing**: 16+ preprocessing scripts for safety text data
- **Safety rubrics**: PlantUML diagrams for safety metric frameworks (`Enigma_safety_rubric_event.puml`, grouped metrics, incident metrics)
- **PTW analysis**: Permit-to-work safety analysis

## Acceptance Criteria
- [ ] Audit ENIGMA codebase and document reusable components vs client-specific code
- [ ] Design module structure within worldenergydata (`src/worldenergydata/safety/` or `modules/safety/`)
- [ ] Port generalizable NLP safety classification pipeline (TF-IDF + BERT at minimum)
- [ ] Port incident analysis and trend detection logic
- [ ] Port hypothesis testing framework for safety metrics
- [ ] Create safety data schemas (incident records, observation cards, PTW records)
- [ ] Add tests following TDD (80%+ coverage on new module)
- [ ] Add documentation in `docs/hse/` for the safety analysis module
- [ ] Ensure no client-specific data or credentials are transferred

## Plan

**Spec**: `specs/modules/wrk-072-technical-safety-module.md`
**Target**: `src/worldenergydata/technical_safety/`

### Existing Assets in worldenergydata (already implemented)
- `safety_analysis/` — 45 files: Pydantic models (SafetyObservation, SafetyIncident), TF-IDF + BERT classifiers, statistical tests, risk index, taxonomy
- `hse/` — 20 files: BSEE/EPA/OSHA acquirers and importers
- `marine_safety/` — 74 files: 9 importers, correlation engine, LLM classifier
- `pipeline_safety/` — 3 files: PHMSA importer

### ENIGMA Source Analysis (95 Python files)
**Reusable (port with refactoring)**:
- `FeatureEngineer` class (23 statistical features: FFT, skewness, kurtosis, peak detection)
- Lag-N cross-correlation tools (`sshe_lib_correlation_tools.py`)
- Incident aggregation by activity/superintendent/time (`incident_analysis.py`, 257 lines)
- Maintenance metrics (open/closed/overdue) (`maintenance_analysis.py`, 64 lines)
- PTW safety analysis (`ptw_analysis.py`)
- NPT correlation with incidents (`npt_analysis.py`)
- Hypothesis testing framework (13 files: activity-level, clustering, distribution)

**Unique to ENIGMA (not in worldenergydata)**:
- Maintenance open/closed/overdue metrics system
- Permit-to-Work (PTW) analysis
- Non-Productive Time (NPT) ↔ safety incident correlation
- Rig-specific safety observation card analysis

**Exclude (client-specific)**:
- Databricks/PySpark SQL queries, MLflow wrappers
- Hardcoded rig names, client config paths, table references
- SME review process scripts

### Phase 0 — Locate Source & Legal Pre-Scan
- Locate ENIGMA source files at `client_projects/energy_firm_sd_support/xom/000 ENIGMA/`
- Run legal scan against source before any porting: `scripts/legal/legal-sanity-scan.sh --repo=worldenergydata`
- Verify all 95 Python files are accessible and catalog by category (reusable / client-specific / exclude)

### Phase 1 — Audit & Design (no code)
- **Deliverable**: Produce a concrete overlap mapping table — each ENIGMA module mapped to its worldenergydata equivalent (duplicate / extend / unique)
- Document ENIGMA components vs worldenergydata overlap (TF-IDF: duplicate, BERT: duplicate, maintenance: unique)
- **Architecture decision**: Decide upfront whether to extend `safety_analysis/` or create `technical_safety/` and deprecate the old one. Do not create a new module only to merge it back in Phase 5.
- Design module structure:
  - `core/models.py` — Enhanced schemas (add PTW, maintenance, NPT records)
  - `incident_analysis/` — Aggregate by activity, trend analysis
  - `maintenance/` — Open/closed/overdue metrics
  - `permit_to_work/` — PTW analysis
  - `npt/` — NPT correlation with incidents
  - `hypothesis_testing/` — Statistical test framework
  - `feature_engineering/` — FeatureEngineer class (time-series features)

### Phase 2 — Port Utility Libraries
- Port `FeatureEngineer` (23 features) → `feature_engineering/time_series_features.py`
- Port correlation tools → `feature_engineering/correlation.py`
- Port config pattern → `config.py` (generalize from rig-specific to asset-level)
- Strip all client references (rig names, Databricks, table names)
- Legal scan: `scripts/legal/legal-sanity-scan.sh --repo=worldenergydata`

### Phase 3 — Port Domain Analysis
- `incident_analysis/aggregator.py` — Generalize from rig-specific to configurable asset categories
- `maintenance/metrics.py` — Open/closed/overdue calculations (replace client column names with schema)
- `permit_to_work/ptw_analyzer.py` — Abstract permit structure from client-specific
- `npt/analyzer.py` — Asset-level time correlation (remove hardcoded config)

### Phase 4 — Port Hypothesis Testing
- Activity-level statistical tests
- Observation clustering and distribution analysis
- Lag-N correlation framework for safety metrics

### Phase 5 — Consolidate with Existing safety_analysis
**NOTE**: This phase is high-risk (45 files with Pydantic models, NLP classifiers, risk index). Split into a separate WRK item (e.g., WRK-108: "Merge technical_safety into safety_analysis") if architecture decision in Phase 1 results in a new module. Porting phases (2-4) can land independently.
- Unify NLP models (existing TF-IDF + BERT with ENIGMA patterns)
- Merge schemas (SafetyObservation + maintenance + PTW + NPT)
- Enhanced reporting (safety index + maintenance index + incident trends)

### Phase 6 — Tests (80%+ coverage)
- Unit tests per new module with real BSEE incident data from `hse/` importers where available
- Synthetic data only for PTW/maintenance/NPT which have no existing data source
- Integration tests with BSEE incident data
- Legal compliance tests (no client references in output)

### Dependencies
- Must pass legal scan before any commit (see Phase 0)
- NEVER reference client project names or identifiers in code/comments
- Existing `safety_analysis/` module may need refactoring to merge cleanly
- Requires numpy/scipy for FFT/feature engineering (verify versions installed)

### Review Notes
- **Verdict**: Claude: MAJOR | Codex: MINOR | Gemini: APPROVE
- **Actions taken**:
  - Added Phase 0: Locate ENIGMA source files and run legal pre-scan before any porting
  - Phase 1: Made overlap analysis a concrete deliverable (mapping table, not just narrative)
  - Phase 1: Added architecture decision gate — decide extend vs. new module upfront to avoid churn
  - Phase 5: Flagged as high-risk, recommended splitting into separate WRK item (WRK-108)
  - Phase 6: Replaced "synthetic safety data" with real BSEE incident data from `hse/` importers where available
  - Added numpy/scipy dependency requirement
  - Codex additionally requested exact target file paths and schema mapping details — address during Phase 1 design deliverable
- *Cross-reviewed: 2026-02-09*

*Approved by user: 2026-02-09*

---
*Source: /work add to worldenergydata to do technical safety analysis using the theory and analysis located in /mnt/github/workspace-hub/client_projects/energy_firm_sd_support/xom/000 ENIGMA*
