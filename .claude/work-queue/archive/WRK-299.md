---
id: WRK-299
title: "comprehensive-learning skill — single batch command for all session learning + ecosystem improvement"
status: archived
priority: high
created: 2026-02-21
completed_at: 2026-02-22T00:00:00Z
tags: [skills, learning, meta, session-efficiency, multi-machine]
---

## Goal

Create `/comprehensive-learning` — a single fire-and-forget skill that consolidates all
learning, reflection, and improvement commands. Safe for cron scheduling.

Strip all inline post-task learning overhead from sessions so work stays focused.

## Motivation

- 4+ fragmented learning skills (/insights, /reflect, /knowledge, /improve) create decision
  fatigue and are never all run together
- Post-task review hooks interrupt session flow
- Candidate files (skill/script/hook/mcp/agent ideas) accumulate but are never actioned
- Sessions should be lean — all learning deferred to this batch command

## Pipeline (sequential, each feeds next)

### Phase 1 — Insights
Run `/insights`: analyze current session signals, cc-insights, session-analysis files.
Sources: `state/session-signals/`, `state/cc-insights/`, `state/sessions/`, `state/daily-summaries/`

### Phase 2 — Reflect
Run `/reflect`: git history cross-repo patterns, trends.
Sources: `state/reflect-history/`, `state/trends/`, git log across all repos

### Phase 3 — Knowledge
Run `/knowledge`: extract and persist domain facts across sessions.
Sources: session context + phase 1/2 output

### Phase 4 — Improve
Run `/improve`: apply learnings to memory, rules, skills, docs, config.
Sources: `state/corrections/`, `state/accumulator.json`, `state/patterns/`,
         `state/pending-reviews/`, `state/learned-patterns.json`,
         `state/skill-scores.yaml`, `state/cc-user-insights.yaml`

### Phase 5 — Action Candidates (GAP FILL)
Read all candidate files that currently accumulate unread:
- `state/candidates/skill-candidates.md`
- `state/candidates/script-candidates.md`
- `state/candidates/hook-candidates.md`
- `state/candidates/mcp-candidates.md`
- `state/candidates/agent-candidates.md`

For each non-trivial candidate: auto-create a WRK item in pending/ with appropriate
priority. Clear the candidate file after processing.

### Phase 6 — Report
Write summary to `.claude/state/learning-reports/YYYY-MM-DD-HHMM.md`
Print one-line summary per phase. Exit 0 on success, 1 on any phase failure.

## Multi-machine Behavior

`comprehensive-learning` must be machine-aware:

| Machine | Behavior |
|---------|----------|
| ace-linux-1 | Primary run — full pipeline, all phases, writes to shared workspace-hub |
| ace-linux-2 | Also runs against ace-linux-1 workspace-hub (shared mount) — skip Phase 5 to avoid duplicate WRK items; or add dedup check |
| acma-ansys05 | Isolated Windows machine — needs its OWN cron job running a lightweight variant (Phase 1 only: session signals from OrcaFlex/ANSYS sessions) |

Machine identity: read from `hostname` or `$WORKSPACE_MACHINE` env var.
Config block in SKILL.md maps hostname → behavior.

## Strip Post-Task Learning Overhead

Audit and disable/convert to no-op:
- `.claude/hooks/post-task-review.sh` — disable blocking behavior; keep signal capture only
- Any stop-hook phases that pause waiting for review
- `/improve` auto-trigger at session exit — convert to reminder only, not auto-run

Keep signal CAPTURE intact (hooks still write to `state/session-signals/`) — just don't
analyze mid-session.

## Cron Setup

```bash
# ace-linux-1: nightly at 22:00
0 22 * * * cd /mnt/local-analysis/workspace-hub && claude --skill comprehensive-learning

# acma-ansys05: nightly at 23:00 (lightweight)
0 23 * * * cd /path/to/workspace && claude --skill comprehensive-learning --phase insights
```

Document cron setup in SKILL.md under ## Scheduling.

## Acceptance Criteria

- [ ] Skill file: `.claude/skills/workspace-hub/comprehensive-learning/SKILL.md`
- [ ] All 6 phases implemented and run in sequence
- [ ] All 10 state data sources consumed (no dead accumulation)
- [ ] Candidate files auto-converted to WRK items
- [ ] Machine-aware behavior (hostname routing)
- [ ] Post-task hooks stripped of blocking behavior
- [ ] Summary report written to `state/learning-reports/`
- [ ] Cron example documented
- [ ] Sessions measurably faster (no mid-task pauses)

## Route

Route B — plan approval needed before implementation (touches hooks + session flow)

## Session Notes (2026-02-22)

**Root cause of 4 Codex review rounds:**
Original plan used a 6-phase model; implementation evolved to 10 phases mid-session
(code-quality scan, session archive, report review, coverage audit added). Each round
caught incremental issues as the scope expanded: machine placeholder, flock safety,
trap semantics, then cron/SSH/PyYAML as the infrastructure sections were added last.

**Key architectural decisions:**
- Single-machine analysis (ace-linux-1 only) — other machines contribute derived state
  via git; raw sessions archived locally via rsync. Keeps analysis deterministic.
- `set -euo pipefail` + wrapper script for cron — ensures git pull is hard gate.
- Phase 5 diagnosis requirement added after WRK-301/302 noise: bare-count escalations
  with no diagnosis are useless. Require tool breakdown + example JSONL per escalation.
- Session lean principle documented as first-class section — key design intent.

**What to watch:**
- Phase 7 code-quality candidates: first real run may produce many WRK items; tune
  thresholds based on Phase 6 feedback loop.
- Stop hook cleanup (WRK-304): highest-impact follow-on — 885 lines of analysis
  currently block every session exit.
