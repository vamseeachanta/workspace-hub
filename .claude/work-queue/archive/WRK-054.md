---
id: WRK-054
title: "worldenergydata test coverage improvement"
status: archived
priority: medium
complexity: medium
created_at: 2026-01-30T00:00:00Z
target_repos:
  - worldenergydata
commit:
spec_ref:
related: [WRK-051, WRK-052, WRK-053, WRK-055, WRK-056]
blocked_by: []
synced_to: []
tags: [testing, coverage, tdd, configuration]
plan_workstations: [ace-linux-1]
execution_workstations: [ace-linux-1]
---
# worldenergydata Test Coverage Improvement

## What
Improve test coverage for the worldenergydata repository from the current 22.6% to 80%+. Investigate why 3329 test files only yield 22.6% coverage -- likely a source path misconfiguration.

## Why
With 3329 test files but only 22.6% coverage, there is a strong indication that tests are not measuring coverage against the correct source paths. Fixing this configuration issue may reveal significantly higher actual coverage, and any remaining gaps can then be addressed efficiently.

## Current State
- **Coverage**: 22.6%
- **Statements**: 1945
- **Test files**: 3329
- **Suspected issue**: Source path misconfiguration in coverage settings

## Strategy
1. Investigate coverage configuration (source paths, omit patterns, include patterns)
2. Verify that coverage measures against the installed/editable package source
3. Fix any path misconfiguration to get accurate baseline
4. Identify actual coverage gaps after configuration fix
5. Write tests for uncovered code paths

## Acceptance Criteria
- [ ] Coverage configuration investigated and documented
- [ ] Source path misconfiguration identified and fixed
- [ ] Accurate baseline coverage measured after fix
- [ ] Tests written for remaining uncovered code paths
- [ ] Overall repository coverage reaches 80%+
- [ ] CI pipeline reports coverage on every PR

## Notes
- The ratio of 3329 tests to 22.6% coverage is anomalous -- configuration fix may dramatically improve the number
- Check pyproject.toml, setup.cfg, and .coveragerc for source path settings

## Plan

**Target**: `worldenergydata/tests/`

### Phase 1 — Fix Coverage Configuration
- Check `pyproject.toml` / `.coveragerc` for source path settings
- Verify `--cov=worldenergydata` points to `src/worldenergydata/` (post-flatten paths)
- Fix any `omit` or `include` patterns that exclude valid source
- Re-run coverage to get accurate baseline (expect significant jump from 22.6%)

### Phase 2 — Assess Actual Gaps
- After config fix, identify true uncovered modules
- Expected well-covered: bsee (WRK-011 added 54 tests), marine_safety
- Expected gaps: newer modules (metocean API clients, LNG, paleowells)
- Prioritize by business criticality

### Phase 3 — Fill Coverage Gaps
- Write tests for uncovered modules, focusing on:
  - Data loaders (handle LFS stubs gracefully — add explicit skip logic for LFS stubs in test fixtures)
  - API clients (mock external HTTP calls at boundary; document which clients are mocked and how)
  - Analysis modules (use materialized test data)
- Define per-subpackage coverage targets (bsee, metocean, marine_safety, etc.)
- Test runner: `PYTHONPATH="src:../assetutilities/src" python3 -m pytest --noconftest --cov=worldenergydata`
- **Note**: If import errors occur due to `_compat.py` path shim, add `--import-mode=importlib` to pytest invocation

### Phase 4 — CI Integration
- Add coverage reporting configuration
- Set per-module minimum thresholds

### Data Constraints
- 129/133 .bin files are LFS stubs — tests must handle gracefully
- Use materialized data (production_raw, rig_fleet) for integration tests

### Review Notes
- **Verdict**: Claude: APPROVE | Codex: MINOR | Gemini: APPROVE
- **Actions taken**:
  - Added `--import-mode=importlib` note for post-flatten path shim compatibility
  - Added explicit LFS stub skip logic requirement in test fixtures
  - Added per-subpackage coverage targets per Codex feedback
  - Added documentation of which API clients are mocked and how
- *Cross-reviewed: 2026-02-09*

*Approved by user: 2026-02-09*

---
*Source: test coverage audit across workspace-hub repositories*
