---
id: WRK-083
title: Validate multi-format export (Excel, PDF, Parquet) with real BSEE data
status: archived
priority: medium
complexity: medium
compound: false
created_at: 2026-02-02T14:00:00Z
target_repos:
  - worldenergydata
commit:
spec_ref:
related: [WRK-073]
blocked_by: []
synced_to: []
---
# Validate multi-format export (Excel, PDF, Parquet) with real BSEE data

## What
Test and fix Excel, PDF, and Parquet export paths using real BSEE production data. HTML export works. The other formats have infrastructure but unclear if they produce valid output with real data.

## Why
Website markets "Multi-format export (Excel, JSON, HTML, PDF, Parquet)" as a core feature. HTML is confirmed working; others need validation to ensure the claim holds.

## Acceptance Criteria
- [ ] Excel export produces valid .xlsx with real BSEE production data
- [ ] PDF export produces valid .pdf with formatted tables and charts
- [ ] Parquet export produces valid .parquet readable by pandas/polars
- [ ] JSON export produces valid structured JSON
- [ ] Each format tested with at least one BSEE field dataset
- [ ] Export manager has integration tests for all formats

## Plan

**Target**: `src/worldenergydata/bsee/reports/`

### Existing Assets (reuse)
- `reports/comprehensive/exporters/` — export manager with format handlers
- `mv_productionsum.bin` — materialized production data (real, not LFS stub)
- `AllFieldsRunner` — field-level data generation

### Phase 1 — Audit Export Infrastructure
- Read `reports/comprehensive/exporters/` — identify which exporters exist (Excel, PDF confirmed at `excel_exporter.py`, `pdf_exporter.py`) and which need to be created (likely: Parquet, JSON)
- Choose PDF library and verify it is compatible with CI OS packages
- Test each existing exporter with a simple DataFrame to verify basic functionality
- Add output validation checks (not just file existence — verify content integrity)
- Document which formats work, which error, which need creation from scratch
- Adjust Phase 2 scope accordingly

### Phase 2 — Fix & Validate Each Format
- **Excel**: Verify openpyxl dependency, test with BSEE production DataFrame, check formatting
- **PDF**: Verify PDF generation library (weasyprint/reportlab), test with production report
- **Parquet**: Verify pyarrow/fastparquet dependency, test round-trip (write → read → compare)
- **JSON**: Verify structured output with nested field data

### Phase 3 — Integration Tests
- End-to-end test: AllFieldsRunner → export to each format → validate output
- Use materialized `mv_productionsum.bin` data
- Verify file sizes are reasonable and content is correct

### Phase 4 — Fix Dependencies
- Add missing export libraries to `pyproject.toml` if needed
- Document optional dependencies for each format

### Review Notes
- **Verdict**: Claude: APPROVE | Codex: MINOR | Gemini: APPROVE
- **Actions taken**:
  - Noted Parquet/JSON exporters may not exist yet — Phase 1 now identifies what needs creation vs fixing
  - Added PDF library CI compatibility check per Codex feedback
  - Added output validation checks beyond file existence
  - Documented confirmed exporters (excel_exporter.py, pdf_exporter.py) per codebase verification
- *Cross-reviewed: 2026-02-09*

*Approved by user: 2026-02-09*

---
*Source: Gap analysis — HTML export works, other formats untested with real data*
