---
id: WRK-158
title: Staleness enforcement â€” auto-flag aging working items
status: archived
priority: medium
complexity: simple
compound: false
created_at: 2026-02-16T19:30:00Z
target_repos:
  - workspace-hub
commit: 547ee30
spec_ref:
related: [WRK-094, WRK-157]
blocked_by: []
synced_to: []
provider: claude
---

## What

Add automated staleness detection for items in `working/` that exceed age thresholds, preventing items from stalling indefinitely.

## Why

WRK-094 has been in `working/` for 13 days with no enforcement. Without staleness alerts, items accumulate in working state and the queue loses visibility into actual progress.

## Acceptance Criteria

- [ ] New function `check_stale_items()` in `scripts/agents/lib/workflow-guards.sh`
- [ ] Items in `working/` > 7 days: `stale: warning` tag added to frontmatter, warning printed to stderr
- [ ] Items in `working/` > 14 days: `stale: critical` tag added, moved back to `pending/` with status reset
- [ ] `work.sh list` displays stale badge next to aged items
- [ ] `session.sh init` calls `check_stale_items()` on session startup (passive enforcement)
- [ ] Staleness check is idempotent (re-running doesn't duplicate tags or move already-moved items)
- [ ] Existing `created_at` frontmatter field is used for age calculation (no new fields needed)
- [ ] Tests: 7-day warning threshold, 14-day critical + move, idempotency on re-run

## Plan

### Phase 1: Detection
1. Add `check_stale_items()` to `workflow-guards.sh`
2. Parse `created_at` from frontmatter, compare to current date
3. 7-day threshold: add `stale: warning` if not already present
4. 14-day threshold: add `stale: critical`, `mv working/WRK-NNN.md pending/`, set `status: pending`

### Phase 2: Integration
5. Call `check_stale_items` from `session.sh init`
6. Update `work.sh list` output to show `[STALE]` marker

### Phase 3: Testing
7. Create test WRK files with backdated `created_at` timestamps
8. Verify warning at 7d, critical+move at 14d, idempotency

*Promoted from workflow-visual.html section 7 refinement candidates (2026-02-16)*
