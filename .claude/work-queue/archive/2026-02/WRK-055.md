---
id: WRK-055
title: "aceengineer-website test coverage improvement"
status: archived
priority: low
complexity: simple
archived_at: 2026-02-13T00:00:00Z
created_at: 2026-01-30T00:00:00Z
target_repos:
  - aceengineer-website
commit:
spec_ref:
related: [WRK-051, WRK-052, WRK-053, WRK-054, WRK-056]
blocked_by: []
synced_to: []
tags: [testing, coverage, tdd]
---

# aceengineer-website Test Coverage Improvement

## What
Add test coverage to the aceengineer-website repository, which currently has 0% coverage. The codebase is small (4 source files, 0 tests) making this a quick win.

## Why
Even a small codebase benefits from tests to catch regressions, especially for a public-facing website. With only 4 source files, achieving 80%+ coverage is a low-effort, high-value task.

## Current State
- **Coverage**: 0%
- **Source files**: 4
- **Test files**: 0
- **Languages**: Python and JavaScript components

## Strategy
1. Set up test infrastructure (pytest for Python, appropriate framework for JS)
2. Write basic tests for each of the 4 source files
3. Cover Python components with unit tests
4. Cover JavaScript components with appropriate tests
5. Integrate into CI

## Acceptance Criteria
- [ ] Test infrastructure configured for both Python and JS
- [ ] Tests written for all 4 source files
- [ ] Python component coverage reaches 80%+
- [ ] JavaScript component coverage reaches 80%+
- [ ] Overall repository coverage reaches 80%+
- [ ] CI pipeline reports coverage on every PR

## Notes
- Small codebase makes this a quick win -- could be completed in a single session
- Consider both Python and JS testing frameworks as the repo contains both

## Plan

### Current State Assessment

The WRK-055 description says "0% coverage, 4 source files, 0 tests" but this is outdated. Research reveals the repo **already has substantial test coverage**:

- **Python source files**: `scripts/content_sync.py` (438 lines), `scripts/competitor_analysis.py` (585 lines)
- **Python test files**: `tests/python/test_content_sync.py` (936 lines), `tests/python/test_competitor_analysis.py` (980 lines)
- **Test infrastructure**: `tests/python/conftest.py` with 148 lines of shared fixtures
- **Coverage data**: `coverage.xml` reports **97.04% line coverage** (360/371 lines covered)
- **JS source**: `build.js` (183 lines), `assets/js/navbar-toggle.js` -- no JS tests exist
- **Build tool**: Node.js (posthtml, purgecss, clean-css) via `package.json`
- **Python deps**: `pyproject.toml` lists `pytest`, `pytest-cov`, `pyyaml` as dev deps

### Phase 1: Assess Remaining Python Gaps (0.5 hours)

1. Review coverage.xml to identify the 11 uncovered lines (3% gap)
   - File: `/mnt/local-analysis/workspace-hub/aceengineer-website/coverage.xml`
   - Likely gap: the `yaml` ImportError fallback branches in both scripts (lines 22-25 of competitor_analysis.py)
2. Determine if the uncovered lines are import guards (`except ImportError: sys.exit(1)`) which are hard to test without subprocess invocation
3. Add targeted tests for any testable uncovered lines

### Phase 2: Add `build.js` Test Coverage (2 hours)

1. **Install test framework**: Add `jest` to `package.json` devDependencies
   - Target path: `/mnt/local-analysis/workspace-hub/aceengineer-website/package.json`
2. **Refactor `build.js` for testability**: Extract pure functions that can be unit-tested
   - `parseFrontMatter(content)` -- already a pure function, testable directly
   - `getHtmlFiles(dir)` -- filesystem function, testable with temp dirs
   - `ensureDir(dir)` -- simple wrapper, testable
   - File: `/mnt/local-analysis/workspace-hub/aceengineer-website/build.js`
3. **Create test file**: `tests/js/build.test.js`
   - Test `parseFrontMatter` with valid YAML front matter, no front matter, empty front matter
   - Test `getHtmlFiles` with mock directory structure (using `fs.mkdtempSync`)
   - Test `ensureDir` creates nested directories
4. **Add jest config** to `package.json`:
   ```json
   "scripts": {
     "test": "jest",
     "test:coverage": "jest --coverage"
   }
   ```

### Phase 3: Add `navbar-toggle.js` Test Coverage (1 hour)

1. **Assess file**: `/mnt/local-analysis/workspace-hub/aceengineer-website/assets/js/navbar-toggle.js`
   - Likely DOM manipulation code for Bootstrap navbar collapse
2. **Create test file**: `tests/js/navbar-toggle.test.js`
   - Use `jsdom` environment for DOM testing
   - Test toggle behavior, aria-expanded attribute changes
3. **Add jsdom dependency** if needed

### Phase 4: CI Integration (1 hour)

1. **GitHub Actions workflow**: Create `.github/workflows/test.yml`
   - Run `pytest` for Python tests
   - Run `jest` for JS tests
   - Report combined coverage
2. **Coverage thresholds**: Configure 80% minimum in both pytest and jest configs

### Test Strategy

- **Python**: Already at 97% -- close remaining gaps with subprocess-level import error tests or mark as `pragma: no cover`
- **JavaScript**: Focus on `parseFrontMatter` (most logic), `getHtmlFiles` (file discovery), skip async `processFile` (integration-level, requires posthtml)
- **Pattern**: Follow existing test structure in `tests/python/` -- add parallel `tests/js/` directory

### Dependencies and Prerequisites

- Node.js (already available -- `node_modules/` exists)
- `npm install --save-dev jest` for JS testing
- Python venv with pytest (already configured in `pyproject.toml`)

### Review Notes

**Cross-review date**: 2026-02-10

| Reviewer | Verdict |
|----------|---------|
| Claude Opus 4.6 | APPROVE |
| Gemini CLI | APPROVE |
| Codex CLI | NO_OUTPUT |

**Feedback incorporated**:
- Self-correcting plan: original description says "0% coverage, 4 source files" but plan correctly discovers existing 97% Python coverage and refocuses on JS gap
- All 4 line count discrepancies off by exactly 1 line

*Approved by user: 2026-02-10*

### Acceptance Criteria Update

The original criteria should be revised:
- [x] Test infrastructure configured for Python (already done)
- [ ] Test infrastructure configured for JS (jest)
- [x] Python component coverage at 97% (exceeds 80% target)
- [ ] JavaScript component coverage reaches 80%+
- [ ] CI pipeline reports coverage on every PR

---
*Source: test coverage audit across workspace-hub repositories*
