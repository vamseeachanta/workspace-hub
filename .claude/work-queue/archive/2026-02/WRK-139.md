---
id: WRK-139
title: "Unified multi-agent orchestration architecture (Claude/Codex/Gemini)"
status: archived
archived_at: 2026-02-13T23:30:00Z
priority: high
complexity: complex
compound: false
created_at: 2026-02-13T00:00:00Z
target_repos:
  - workspace-hub
target_module: agents
commit:
spec_ref:
related: [WRK-118]
blocked_by: []
synced_to: []
plan_reviewed: true
plan_approved: true
percent_complete: 100
brochure_status: n/a
tags: [orchestration, claude, codex, gemini, workflow]
---

# Unified Multi-Agent Orchestration Architecture (Claude/Codex/Gemini)

## What
Implement a workflow-equivalent architecture across Claude Code, Codex CLI, and Gemini CLI where the session-started agent is the orchestrator and all others operate as subagents under orchestrator control.

## Why
Current behavior parity is partial and inconsistent across CLIs. A common orchestration contract is needed so `/work` lifecycle gates, planning approval, implementation, testing, and cross-review behavior are equivalent regardless of provider.

## Acceptance Criteria
- [x] Behavior contract documented in machine-readable format
- [x] Session orchestrator lock implemented and persisted
- [x] Provider-neutral wrappers for work/plan/execute/review implemented
- [x] Provider adapters for Claude/Codex/Gemini implemented
- [x] Shared workflow guards enforce plan-approval gates
- [x] Standardized review verdict normalization script added
- [x] Equivalence reporting script added
- [x] Architecture documentation added
- [x] Bash syntax validation passes for all new scripts

## Plan
1. Define behavior contract and session state artifacts (`config/agents/behavior-contract.yaml`, `.claude/work-queue/session-state.yaml`).
2. Build shared libraries (`session-store.sh`, `workflow-guards.sh`) for orchestrator lock, WRK metadata reads, and lifecycle guard checks.
3. Implement provider-neutral orchestration entry points (`session.sh`, `work.sh`, `plan.sh`, `execute.sh`, `review.sh`).
4. Implement provider adapters (`providers/claude.sh`, `providers/codex.sh`, `providers/gemini.sh`) with normalized status handling.
5. Add review normalization and equivalence reporting scripts.
6. Add architecture doc and run shell/structure validation.

## Notes
- Session orchestrator rule: first provider to initialize session is orchestrator.
- Existing Claude workflows are reference behavior and are not modified.
- Cross-review policy remains mandatory with NO_OUTPUT fallback logging when a provider is unavailable.
- **Renumbered from WRK-138 to WRK-139** due to ID collision with FFS module enhancement item.

## Review Log

| Phase | Date | Reviewer | Verdict | Findings | Fixed |
|-------|------|----------|---------|----------|-------|
| Impl  | 2026-02-13 | Codex | Orchestrator | Built all 15 files | N/A |
| Impl  | 2026-02-13 | Claude | MINOR | 6: dry-run no-op, WRK-138 ref, stub adapters, review.sh no --provider, handoff unenforced, AWK scope | 2/6 (4 deferred V2) |

## Implementation Snapshot
- Added contract: `config/agents/behavior-contract.yaml`
- Added session state artifact: `.claude/work-queue/session-state.yaml`
- Added wrappers: `scripts/agents/session.sh`, `scripts/agents/work.sh`, `scripts/agents/plan.sh`, `scripts/agents/execute.sh`, `scripts/agents/review.sh`
- Added shared libs: `scripts/agents/lib/session-store.sh`, `scripts/agents/lib/workflow-guards.sh`
- Added provider adapters: `scripts/agents/providers/{claude,codex,gemini}.sh`
- Added review normalizer: `scripts/review/normalize-verdicts.sh`
- Added reporting: `scripts/agents/report-equivalence.sh`
- Added architecture doc: `docs/modules/ai/AGENT_EQUIVALENCE_ARCHITECTURE.md`

---
*Source: user request â€” "understand how the repos are set up for claude and follow same thing for codex/gemini" + "where the session starts, that will be the orchestration agent" + "add this work item and add the plan to it and then implement"*
