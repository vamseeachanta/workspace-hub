---
id: WRK-077
title: Validate and wire decline curve modeling into BSEE production workflow
status: archived
priority: high
complexity: medium
compound: false
created_at: 2026-02-02T14:00:00Z
target_repos:
  - worldenergydata
commit: 116c01b
spec_ref:
related: [WRK-073]
blocked_by: []
synced_to: []
percent_complete: 100
---

# Validate and wire decline curve modeling into BSEE production workflow

## What
Connect the existing forecasting/decline curve code (exponential, hyperbolic, harmonic models in sodir/forecasting.py) to actual BSEE production data with an end-to-end example. Currently the code exists but is not integrated into any production workflow.

## Why
Website markets "production forecasting and decline curve modeling" as a core FDAS capability. The code exists but has never been run against real production data in a documented workflow.

## Acceptance Criteria
- [x] Decline curve models fit to real BSEE field production data
- [x] At least one documented example with a Gulf of Mexico field
- [x] Comparison of exponential vs hyperbolic vs harmonic fits
- [x] Forecast output with confidence intervals
- [x] Plotly visualization of historical data + forecast
- [x] Integration test with real data
- [x] CLI command to run forecast on any BSEE field

## Plan

**Target**: `src/worldenergydata/bsee/analysis/forecasting/`

### Existing Assets (reuse)
- `sodir/forecasting.py` — Contains `ExponentialDecline`, `HyperbolicDecline`, `HarmonicDecline` model classes with `fit()` and `forecast()` methods
- `ProductionAPI12Analysis` — production data aggregation per lease/field
- `mv_productionsum.bin` — materialized 39-year production totals (real data, not LFS stub)
- `AllFieldsRunner` + `FieldNameResolver` — field selection and lease resolution
- `analysis/intervention/dashboard.py` — Plotly chart patterns for reuse

### Phase 1 — Decline Curve Adapter
- `bsee_decline_adapter.py` — Bridge between BSEE production data format and sodir decline models:
  - Extract monthly/annual production time series from `ProductionRouter`
  - Convert to the `(time, rate)` format expected by `sodir/forecasting.py`
  - Handle data gaps, shut-in periods, and rate changes
  - Support oil, gas, and water rate series independently

### Phase 2 — Model Fitting & Comparison
- `decline_analysis.py` — Fit all three decline models to a given field's production data:
  - Exponential: `q(t) = qi * exp(-Di * t)`
  - Hyperbolic: `q(t) = qi / (1 + b*Di*t)^(1/b)`
  - Harmonic: `q(t) = qi / (1 + Di*t)` (special case b=1)
  - Compute R², RMSE, AIC for model comparison (note: AIC is new code; `sodir/forecasting.py` provides R² and RMSE but not AIC)
  - Select best-fit model automatically
  - Generate forecast with confidence intervals (bootstrap or parametric)

### Phase 3 — Visualization
- `decline_plots.py` — Plotly visualizations:
  - Historical production + all three model fits overlaid
  - Best-fit forecast with confidence envelope
  - Residual plot for fit quality assessment
  - EUR (Estimated Ultimate Recovery) comparison across models

### Phase 4 — CLI Integration
- `decline_cli.py` — Command-line entry point:
  - Accept field name, lease number, or area code as input
  - Resolve to production data via `FieldNameResolver` + `ProductionRouter`
  - Run all three fits, output summary table + Plotly HTML
  - Create `__main__.py` in `forecasting/` package for CLI entry point
  - Example: `python -m worldenergydata.bsee.analysis.forecasting --field "Buckskin"`

### Phase 5 — Tests
- Unit tests: model fitting accuracy against synthetic known-decline data
- Integration test: fit models to real `mv_productionsum.bin` data for a known GoM field
- Validation: compare EUR estimates against published field reserves where available
- Test confidence interval coverage

### Data Constraints
- Only `mv_productionsum.bin` (annual totals) is materialized — monthly resolution needs LFS pull
- Decline analysis works best with monthly data; annual totals give coarse but usable fits
- Shut-in periods (hurricanes, COVID) need detection and exclusion from fitting window

### Review Notes
- **Verdict**: Claude: APPROVE | Codex: MINOR | Gemini: APPROVE
- **Actions taken**:
  - Noted AIC computation is new code (not reuse from sodir/forecasting.py)
  - Added `__main__.py` creation requirement for CLI entry point in Phase 4
- *Cross-reviewed: 2026-02-09*

*Approved by user: 2026-02-09*

---
*Source: Gap analysis — decline curve code exists in sodir/forecasting.py but not wired to BSEE data*
