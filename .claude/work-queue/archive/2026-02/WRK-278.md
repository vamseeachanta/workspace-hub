---
id: WRK-278
title: "Wire legal-sanity-scan into pre-commit for CP-stream repos — activate deny list CI gate"
status: archived
priority: high
complexity: simple
compound: false
created_at: 2026-02-20T00:00:00Z
target_repos:
  - digitalmodel
  - saipem
  - acma-projects
commit: 7d410753b
spec_ref:
related: [WRK-276]
blocked_by: [WRK-276]
synced_to: []
plan_reviewed: false
plan_approved: false
percent_complete: 100
brochure_status: n/a
provider: claude
provider_alt: codex
tags: [legal-compliance, pre-commit, ci-gate, deny-list, cathodic-protection]
group: CP-stream
---
# Wire Legal-Sanity-Scan into Pre-Commit for CP-Stream Repos

## Problem

`scripts/legal/legal-sanity-scan.sh` exists and works manually but is NOT wired into
either pre-commit config. Neither `.pre-commit-config.yaml` (hub) nor
`digitalmodel/.pre-commit-config.yaml` contains a legal scan hook.

Current state:
- `digitalmodel/.legal-deny-list.yaml`: **empty** (patterns exist in spec but not yet committed)
- `saipem/.legal-deny-list.yaml`: **does not exist**
- `acma-projects/.legal-deny-list.yaml`: **does not exist**
- Pre-commit: **no legal scan hook** in either config

Any PR from the CP stream can commit client identifiers without automated detection.
WRK-276 creates all three deny list files; this WRK wires them into enforcement.

## What

### 1. Add legal scan to `digitalmodel/.pre-commit-config.yaml`

Add a local hook that runs the legal-sanity-scan on staged files:

```yaml
- repo: local
  hooks:
    - id: legal-sanity-scan
      name: Legal sanity scan (deny list)
      language: script
      entry: scripts/legal/legal-sanity-scan.sh
      args: [--repo=digitalmodel]
      pass_filenames: false
      stages: [pre-commit]
```

### 2. Verify scan integration for saipem and acma-projects

Check whether saipem and acma-projects have pre-commit configs. If not, document
the recommended way to run the scan manually before any content is committed from
these repos (they may not need full pre-commit, just a run-before-PR gate).

### 3. Smoke test

Confirm the hook actually catches known patterns:

```bash
# Temporarily add a test file with a known blocked pattern
echo "Yellowtail project analysis" > /tmp/test-legal.py
# Run scan against it
bash scripts/legal/legal-sanity-scan.sh --repo=saipem
# Expect: exit 1, "Yellowtail" flagged
# Remove test file
```

### 4. Document scan usage in SKILL.md or ops runbook

Add a note to `docs/legal-scanning.md` (or create if it doesn't exist) confirming
the three deny lists and their patterns.

## Blocked By

**WRK-276** — must run after the three deny list files are created, otherwise the
hook configuration has nothing to enforce.

## Acceptance Criteria

- [ ] `digitalmodel/.pre-commit-config.yaml` includes legal-sanity-scan hook
- [ ] `digitalmodel/.legal-deny-list.yaml` populated with Woodfibre/350106/WLNG patterns (from WRK-276)
- [ ] `saipem/.legal-deny-list.yaml` created with Yellowtail/ExxonMobil/MMA patterns (from WRK-276)
- [ ] `acma-projects/.legal-deny-list.yaml` created with PSVM/BP Angola/MC252 etc. (from WRK-276)
- [ ] Smoke test: scan catches "Yellowtail" in a test file and exits 1
- [ ] Smoke test: scan passes cleanly on `digitalmodel/src/` (no false positives)
- [ ] saipem and acma-projects: pre-commit hook or documented manual gate in place
- [ ] `scripts/legal/legal-sanity-scan.sh --repo=digitalmodel` exits 0 on clean tree

## Agentic AI Horizon

- One-time setup; permanent protection for all CP stream output going forward
- Catches legal violations before they reach review, not after
- **Disposition: Route A — implement directly after WRK-276 creates the deny lists**

---
*Source: CP stream review 2026-02-20 — pre-commit configs confirmed to have no legal scan hook*
