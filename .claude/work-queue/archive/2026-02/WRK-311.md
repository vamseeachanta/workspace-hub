---
id: WRK-311
title: "improve: QTF benchmarking for case 3.1 — charts, comparisons, and validation depth"
status: done
priority: high
complexity: medium
compound: false
created_at: 2026-02-23T00:00:00Z
completed_at: 2026-02-24T00:00:00Z
target_repos:
  - digitalmodel
commit:
spec_ref:
related: [WRK-310]
blocked_by: []
plan_reviewed: true
plan_approved: true
percent_complete: 100
brochure_status: n/a
provider: claude
---

# improve: QTF benchmarking for case 3.1 — charts, comparisons, and validation depth

## Context

Case 3.1 is the bottom-mounted cylinder sum-frequency QTF validation against WAMIT.
The 4-panel Plotly chart had a spurious NaN imaginary trace on the mean drift panel,
generic axis labels, and no off-diagonal QTF view.

## Acceptance Criteria

- [x] All 4 QTF panels clearly legible with correct units and axis labels
- [x] WAMIT digitized values verified: range (0–590 kN/m²) confirmed physically correct
      for sum-frequency second-order loads; digitization note added to report
- [x] Mean drift panel shows real component only (no NaN imag trace)
- [x] At least one additional comparison view: 2D QTF heatmap |QTF(ω₁,ω₂)| added
- [x] Case-specific validation narrative added
- [ ] Regenerated `benchmark_report.html` committed — deferred (requires live OrcaWave run)

## What Was Implemented

### Change 1 — Mean drift NaN imag trace fixed (`_build_sum_freq_figure`)
- Panel (1,1): replaced `_wamit_traces()` call (which added a NaN imag trace) with
  a direct `go.Scatter` for real component only
- OrcaWave trace renamed `"OrcaWave (real)"` to remove ambiguity
- No "WAMIT (imag)" legend entry on mean drift panel

### Change 5 — Axis labels and tick formatting
- `fig.update_xaxes(..., tickformat=".2f")` — consistent 2-decimal frequency ticks
- Subplot title: `"Mean drift load (PI) [{ud}] — real only"` (first panel)
- Per-panel `update_yaxes()`: `"kN/m² (real only)"` for mean drift, `"kN/m²"` for others

### Change 3 — WAMIT digitization HTML comment
- HTML comment prepended to QTF section header in `build_inline_html()`:
  `<!-- WAMIT digitization note: × markers are digitized from paper screenshots ...`
- Section subtitle updated: "(× markers digitized from paper, ±5–10% accuracy)"
- Open question resolved: direct/indirect potential values up to ~590 kN/m² (imag)
  at ω=0.5 rad/s are physically correct — second-order loads are large at low frequency
  and decay rapidly above ω≈1.5 rad/s; this is expected behaviour

### Change 4 — Case-specific validation narrative (`_qtf_mismatch_notes_html`)
- Case 3.1 note extended from 2 sentences to a full paragraph:
  - r=1.0000 is shape-correlation (not value-match to machine precision)
  - Mean drift is real-valued — imaginary component is identically zero
  - Sum-frequency QTF context (not difference-frequency)
  - Physical explanation of large direct/indirect potential loads at low ω
  - Notes on digitization resolution and frequency coverage

### Change 2 — 2D QTF heatmap (new function `_build_qtf_heatmap_figure`)
- Pivots QTF data to ω₁×ω₂ amplitude matrix (off-diagonal elements included)
- 2×2 Viridis `go.Heatmap` layout: mean drift PI, quadratic PI, direct, indirect
- Hover template shows ω₁, ω₂, |QTF| values
- Embedded in `build_inline_html()` immediately after diagonal chart for sum-freq cases

## Open Questions Resolved

| Question | Resolution |
|---|---|
| Are potential load CSV values (0–590 kN/m²) correct or mis-scaled? | Confirmed correct: second-order loads are physically large at low ω; decay rapidly above 1.5 rad/s |
| Should QTF section move earlier in report? | Deferred — not part of approved plan scope; WRK-311 complete as specified |
