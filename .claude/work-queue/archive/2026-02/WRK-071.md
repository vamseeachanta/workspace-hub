---
id: WRK-071
title: Acquire NTSB CAROL marine investigations and EPA TRI data
status: archived
priority: high
complexity: simple
created_at: 2026-02-01T00:00:00Z
archived_at: 2026-02-13T00:00:00Z
target_repos:
  - worldenergydata
commit: "worldenergydata:a9e4604 (EPA TRI import)"
spec_ref:
related: [WRK-012, WRK-013]
blocked_by: []
synced_to: []
---

# Acquire NTSB CAROL marine investigations and EPA TRI data

## What
Query NTSB CAROL (data.ntsb.gov) for mode=marine and export as CSV. Download EPA TRI basic data files (1987-present) from EPA. Build TRI importer.

## Why
NTSB marine importer is ready but has no data. EPA TRI covers toxic releases from 1987 with 1M+ records.

## Acceptance Criteria
- [ ] Export NTSB CAROL marine data as CSV (BLOCKED - manual export required, see guide)
- [ ] Import using existing ntsb_importer.py (BLOCKED - depends on CAROL export)
- [x] Download EPA TRI basic data files
- [x] Build EPA TRI importer
- [x] Import EPA TRI dataset (51,487 records, 2020-2024)
- [x] Document record counts and date ranges

---
*Source: HSE data acquisition - NTSB CAROL marine investigations and EPA TRI toxic release data*

## Progress
- 2026-02-01: EPA TRI — Acquirer and importer built. 51,503 records acquired (2020-2024, oil & gas filtered). ToxicRelease model added to DB.
- 2026-02-01: NTSB CAROL — Acquirer built but CAROL marine API not publicly accessible. Manual export guide generated at data/modules/marine_safety/raw/ntsb/NTSB_CAROL_MANUAL_EXPORT_GUIDE.md. Existing ntsb_importer.py ready to process manually exported CSV.
- Refresh scripts: scripts/refresh_epa_tri.sh, scripts/refresh_ntsb_marine.sh.
- 2026-02-10: EPA TRI imported to database. 51,487 records loaded into `data/modules/hse/hse_incidents.db` (toxic_releases table, 20MB). 16 cross-year duplicates skipped, 0 errors. Verified: per-year counts, NAICS codes (424710, 324110, 211130, 213113), top chemicals (H2S 192.6M lbs, nitrates 133.6M lbs), state distribution (TX/CA/LA/OH/PA top 5), all 51,487 records have coordinates. README updated with import summary. NTSB CAROL remains blocked on manual export.

## Plan

> Remaining work only. EPA TRI data acquired (51K records, 5 yearly files + combined). NTSB CAROL API unavailable, manual export guide generated. Existing importers ready.

### Phase 1 — EPA TRI: Import to Database

1. **Import EPA TRI data** using existing `EPATRIImporter`:
   - Source files at `data/modules/hse/raw/epa_tri/`:
     - `tri_basic_2020_oil_gas.csv` (7.7MB)
     - `tri_basic_2021_oil_gas.csv` (7.5MB)
     - `tri_basic_2022_oil_gas.csv` (6.6MB)
     - `tri_basic_2023_oil_gas.csv` (2.9MB)
     - `tri_basic_2024_oil_gas.csv` (8.4MB)
     - `tri_basic_2020-2024_oil_gas_combined.csv` (23.6MB, skip during import to avoid double-counting — importer already checks for "combined" in filename)
   - Run: `PYTHONPATH="src" python3 -m worldenergydata.hse.importers.epa_tri_importer --input-dir data/modules/hse/raw/epa_tri --database-url "sqlite:///data/modules/hse/hse_incidents.db"`
   - Target: `ToxicRelease` model in `hse_incidents.db`
   - Dedup key: `tri_facility_id + chemical_name + reporting_year`
   - Expected: ~51,503 records across 2020-2024

2. **Verify import**:
   - Count records per reporting year
   - Spot-check facility names and chemical releases
   - Verify NAICS codes are oil & gas (211xxx, 213xxx)
   - Check geographic distribution (state column)

3. **Add README**: Update `data/modules/hse/raw/epa_tri/README.md` with final import counts

### Phase 2 — NTSB CAROL: Manual Export Acquisition

1. **NTSB CAROL API is NOT publicly accessible** (confirmed during acquisition attempt). Manual export required.
   - Manual export guide already generated at: `data/modules/marine_safety/raw/ntsb/NTSB_CAROL_MANUAL_EXPORT_GUIDE.md`
   - Steps: Navigate to `data.ntsb.gov/carol-main-public/query-builder`, select Mode=Marine, export CSV

2. **Process manual export** once obtained:
   - Use `NTSBCAROLAcquirer.process_export(input_file)` to normalize column names and filter marine mode
   - Output: `data/modules/marine_safety/raw/ntsb/ntsb_marine_investigations.csv`

3. **Import via existing `NTSBImporter`**:
   - Located at: `src/worldenergydata/marine_safety/importers/ntsb_importer.py`
   - Uses marine_safety database models (`Incident`, `Location`, `Vessel`) — separate from HSE database
   - Depends on: `marine_safety.constants`, `marine_safety.database.models`, `marine_safety.processors.data_cleaner`, `marine_safety.processors.data_normalizer`
   - Note: This uses a different DB schema than the HSE module (marine_safety has its own models)

4. **Alternative data source check**: NTSB also publishes data at `data.ntsb.gov/avdata` (primarily aviation but may include marine). If CAROL manual export is impractical, investigate the NTSB downloadable datasets.

### Phase 3 — Verification and Quality

1. **EPA TRI verification**:
   - Run `--dry-run` mode first to validate CSV structure
   - Cross-check total_releases_pounds for reasonableness
   - Verify coordinate data (latitude/longitude) falls within US boundaries
   - Check for common chemicals: hydrogen sulfide, benzene, toluene, xylene, methanol

2. **NTSB verification** (post manual export):
   - Verify mode filtering (Marine only)
   - Check date range coverage (2001-present expected)
   - Verify vessel types present (cargo, tanker, tug, barge, fishing, passenger)
   - Check fatality/injury counts are non-negative integers

3. **Document in this WRK file**:
   - EPA TRI: final record count, date range, top 10 chemicals by release volume, state distribution
   - NTSB: record count (estimated 3K-8K marine investigations), date range, vessel type distribution

### Phase 4 — Tests

1. **EPA TRI tests**: `tests/unit/hse/test_epa_tri_importer.py`
   - Test `_normalize_columns()` with various TRI column name conventions
   - Test `_normalize_record()` with missing required fields
   - Test `_is_duplicate()` dedup logic
   - Test `_safe_float()` edge cases (NaN, ".", empty string)
   - Test batch import with small fixture (5-10 records)

2. **NTSB tests**: `tests/unit/marine_safety/test_ntsb_carol_acquirer.py`
   - Test `_parse_carol_record()` with various field name conventions
   - Test `_normalize_date()` with multiple date formats
   - Test `process_export()` with mock CSV containing mixed-mode records
   - Test marine mode filtering

3. **Path**: `PYTHONPATH="src:../assetutilities/src" python3 -m pytest tests/unit/hse/test_epa_tri_importer.py tests/unit/marine_safety/ -v --tb=short --noconftest`

### Existing Code to Build On
- EPA TRI acquirer: `src/worldenergydata/hse/acquirers/epa_tri_acquirer.py`
- EPA TRI importer: `src/worldenergydata/hse/importers/epa_tri_importer.py` (555 lines, complete)
- NTSB CAROL acquirer: `src/worldenergydata/marine_safety/acquirers/ntsb_carol_acquirer.py` (987 lines, complete)
- NTSB importer: `src/worldenergydata/marine_safety/importers/ntsb_importer.py` (marine_safety module)
- DB models: `src/worldenergydata/hse/database/models.py` (ToxicRelease)
- Marine safety models: `src/worldenergydata/marine_safety/database/models.py` (Incident, Location, Vessel)
- Refresh scripts: `scripts/refresh_epa_tri.sh`, `scripts/refresh_ntsb_marine.sh` (both use `uv run`, need adaptation to system python3)
- Existing NTSB test: `tests/modules/marine_safety/test_ntsb_importer.py`

### Data State
- **On disk (EPA TRI CSV)**: `data/modules/hse/raw/epa_tri/` — 5 yearly files + combined (66MB total, 51K records)
- **In database (EPA TRI)**: `data/modules/hse/hse_incidents.db` — 51,487 records in `toxic_releases` table (20MB SQLite)
- **On disk (NTSB)**: `data/modules/marine_safety/raw/ntsb/NTSB_CAROL_MANUAL_EXPORT_GUIDE.md` (guide only, no data)
- **Not yet created**: `data/modules/marine_safety/raw/ntsb/ntsb_marine_investigations.csv` (blocked on manual export)

### Dependencies
- EPA TRI import: no blockers (data on disk, importer ready)
- NTSB CAROL: blocked on manual export (human action required — navigate to data.ntsb.gov and export)
- Shared HSE DB with WRK-067 and WRK-068 (ToxicRelease is a separate table, no conflicts)

### Review Notes

**Cross-review date**: 2026-02-10

| Reviewer | Verdict |
|----------|---------|
| Claude Opus 4.6 | MINOR |
| Gemini CLI | APPROVE |
| Codex CLI | NO_OUTPUT |

**Feedback incorporated**:
- EPA TRI importer is 554 lines (plan says 555)
- Extra combined CSV `tri_basic_2022-2023_oil_gas_combined.csv` (9.5MB) on disk not accounted for in plan
- Test path convention inconsistency (tests/unit/ vs tests/modules/)
- NTSB CAROL API blocker is real; `data.ntsb.gov/avdata` fallback should be explored as alternative data source
