---
id: WRK-310
title: "explore: OrcFxAPI schematic capture for OrcaWave models (program screenshots)"
status: done
priority: medium
complexity: medium
compound: false
created_at: 2026-02-23T00:00:00Z
completed_at: 2026-02-24T00:00:00Z
target_repos:
  - digitalmodel
  - workspace-hub
commit:
spec_ref:
related: [WRK-311]
blocked_by: []
plan_reviewed: true
plan_approved: true
percent_complete: 100
brochure_status: n/a
provider: claude
---

# explore: OrcFxAPI schematic capture for OrcaWave models (program screenshots)

## Context

The 3.1 benchmark report now has an interactive Plotly Mesh3d visualization
(body panels + free-surface zone). For human comfort and consistency across
viewers (printed PDFs, slide decks, stakeholders without a browser), static
program-generated screenshots are highly valuable — keeping the view consistent
regardless of how the report is consumed.

OrcaFlex uses `Model.SaveModelView(path, viewParameters)` for programmatic
screenshot capture. OrcaWave uses `OrcFxAPI.Diffraction` which has NO equivalent
`SaveModelView`. This item explores what is actually feasible.

## Acceptance Criteria

- [x] Approaches 1–5 investigated; findings documented in skill (v1.2.0)
- [x] At least one working approach demonstrated (Plotly + Kaleido primary path)
- [x] Screenshot helper committed to digitalmodel (`mesh_capture.py`, `save_mesh_views()`)
- [x] `build_mesh_schematic_html()` updated to embed static images when available
- [x] Static images cover 3-view layout: perspective, plan, elevation

## What Was Implemented

### `BenchmarkPlotter._build_panel_mesh3d_fig()` (refactor)
- Extracted figure-building logic from `_build_panel_mesh3d_html()` into a new
  `@staticmethod` that returns `go.Figure` instead of HTML
- `_build_panel_mesh3d_html()` is now a thin wrapper: `_build_panel_mesh3d_fig(...).to_html(...)`
- Enables downstream code to work with the figure directly

### `BenchmarkPlotter.save_mesh_views(fig, out_dir)` (new)
- Exports 3 camera-preset views as PNG via Plotly Kaleido (`fig.write_image(..., scale=2)`)
- Views: `mesh_perspective.png`, `mesh_plan.png`, `mesh_elevation.png`
- Returns `{"perspective": Path, "plan": Path, "elevation": Path}`

### `build_mesh_schematic_html()` (updated)
- Calls `_build_panel_mesh3d_fig()` → `save_mesh_views()` → embeds 3 PNGs as base64
- PNGs in `<div class="mesh-statics">` flexbox above the interactive Plotly widget
- Kaleido failure is caught and logged; report degrades gracefully (widget still shown)

### `src/digitalmodel/hydrodynamics/diffraction/mesh_capture.py` (new)
- `save_orcawave_views(owd_path, out_dir) -> dict[str, Path]`
- Loads `.owd`/`.owr` → `panelGeometry` → figure → 3 PNGs
- Public deliverable referenced in WRK-310; headless, no GUI required

### `SKILL.md` v1.1.0 → v1.2.0
- Added "OrcaWave Schematic Capture (Static PNG)" section with 3-tier table
- Tier 1 (primary): Plotly + Kaleido — `save_orcawave_views()` / `save_mesh_views()`
- Tier 2 (secondary): `OrcaWaveScreenCapture` (win32gui/pyautogui) — fragile, Windows-only
- Tier 3 (tertiary): GDF → `OrcFxAPI.Model.SaveModelView()` — loses free-surface zone
- Code example for primary path included

## Remaining

- Report regeneration (`run_benchmark.py --case 3.1`) deferred to next session
  (requires OrcaWave license + data files on the execution machine)
- Kaleido dependency in `pyproject.toml` already present — no `uv add` required
