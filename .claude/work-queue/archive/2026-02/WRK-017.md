---
id: WRK-017
title: Streamline BSEE field data analysis pipeline — wellbore, casing, drilling, completions, interventions
status: archived
priority: high
complexity: complex
created_at: 2026-01-29T00:00:00Z
target_repos:
  - worldenergydata
commit: fe0168b
spec_ref:
related: [WRK-009, WRK-010, WRK-011, WRK-016]
blocked_by: []
synced_to: []
---
# Streamline BSEE field data analysis and interpretation pipeline

## What
Build a streamlined, end-to-end analysis and interpretation pipeline for BSEE field data covering:
1. **Wellbore data**: wellbore counts per lease/field/region
2. **Well path data**: directional survey interpretation and visualization
3. **Casing program schematics**: auto-generated casing diagrams drawn from size data, supporting both graphical schematics and old-style matrix format
4. **Drilling and completion activities**: timeline and summary analysis
5. **Intervention activities**: analysis and filtering by lease, field, and geological region

The pipeline should accept a lease, field, or geological region as input and produce a consolidated data package with analysis and visualizations.

## Why
Currently, field data analysis requires manual assembly across multiple BSEE data tables. A streamlined pipeline reduces turnaround time, ensures consistency, and enables rapid field-level reporting for client deliverables. Casing schematics drawn programmatically eliminate manual drafting effort.

## Acceptance Criteria
- [x] Wellbore count summary by lease, field, and geological region
- [ ] Well path data extraction and interpretation (deferred — requires LFS pull for directional surveys)
- [x] Casing program schematic generation:
  - Graphical schematic drawn from casing size/depth data
  - Old-style matrix format output (tabular casing string summary)
- [x] Drilling activity analysis: spud dates, duration, rig types, water depth distribution
- [x] Completion activity analysis: completion types, dates, intervals
- [x] Intervention activity analysis: workover types, frequencies, filtered by lease/field/geological region
- [x] Consolidated output per field or lease query
- [x] Pipeline accepts lease number, field name, or geological region as input parameter
- [x] Visualizations for each data domain
- [x] Document data sources, pipeline steps, and output formats

## Implementation Notes (2026-02-12)

**Commit**: worldenergydata `fe0168b`
**Package**: `src/worldenergydata/bsee/pipeline/` (5 source files, 1,490 lines)
**Tests**: 80 unit tests across 4 test files (1,774 lines), all passing

| Module | Lines | Tests | Description |
|--------|-------|-------|-------------|
| `field_query.py` | 336 | 15 | FieldContext + resolve_field() — lease/code/name/era resolution |
| `casing_schematic.py` | 400 | 23 | SVG schematic + tabular matrix from well_tubulars.csv |
| `pipeline_runner.py` | 378 | 21 | Fault-tolerant orchestrator composing existing analyzers |
| `field_report.py` | 335 | 21 | Self-contained HTML report with Plotly charts |
| `__init__.py` | 41 | — | Package exports |

**Key design decisions**:
- Dependency injection throughout (field_resolver, era_classifier, analyzer overrides)
- Every analysis stage wrapped in try/except — failures produce warnings, not crashes
- LFS stub detection via 40-byte header check
- XSS-safe HTML output with html.escape() on all DataFrame-derived values
- Self-contained SVG primitives (no digitalmodel dependency)

**Deferred items**:
- Well path / directional survey visualization (LFS pull required for survey data)
- Decline curve integration (covered by WRK-077)

## Plan

**Spec**: `specs/modules/wrk-017-bsee-field-pipeline.md`
**Target**: `src/worldenergydata/bsee/pipeline/`

### Existing Assets (reuse)
- `AllFieldsRunner` + `FieldNameResolver` + `EraClassifier` — field aggregation
- `ComprehensiveActivityAnalyzer` — 7-module WAR analyzer (drilling efficiency, depth, era, cross-activity, lifecycle, operator, benchmarking)
- `WellAPI12` — well history/timeline; `ProductionAPI12Analysis` — production aggregation
- `analysis/intervention/` — activity aggregation, enrichment, dashboards, field vis, insight generator
- `analysis/financial/` — NPV, cash flow, drilling cost modeling
- Data loaders: `bsee/data/loaders/well/`, `bsee/data/loaders/block/`, `bsee/data/loaders/lease/`, `bsee/data/loaders/infrastructure/`, `bsee/data/loaders/rig_fleet/`
- Catalog data: `well_tubulars.csv` (casing size/grade/weight/depth), `completion_*.csv`
  - **Prerequisite**: Confirm `well_tubulars.csv` exists and document its exact path. If not present, add data acquisition as Phase 0.

### Phase 1 — Unified Query Interface (new)
- `field_query.py` — Accept lease number, field name, or geological region
- Resolve to lease set via `FieldNameResolver` + `EraClassifier`
- Return `FieldContext` dataclass (leases, field name, area code, geological era)

### Phase 2 — Casing Schematic Generator (new, gap)
- `casing_schematic.py` — Read `well_tubulars.csv` casing data
- SVG schematic output (ref: digitalmodel `svg_primitives.py` pattern)
- Old-style matrix tabular output (DataFrame)

### Phase 3 — Pipeline Orchestrator (new)
- `pipeline_runner.py` — Takes `FieldContext`, runs existing analyzers:
  1. Wellbore count summary (AllFieldsRunner)
  2. Production analysis (ProductionAPI12Analysis)
  3. Drilling/completion activities (ComprehensiveActivityAnalyzer)
  4. Intervention analysis (intervention/ module)
  5. Casing schematics (Phase 2)
  6. Financial summary (analysis/financial/)
- Consolidate into `FieldReport` dataclass

### Phase 4 — Report Generation (new)
- `field_report.py` — HTML/Markdown report with Plotly charts from `intervention/dashboard.py`
- Reuse `reports/comprehensive/exporters/` for Excel/PDF

### Phase 5 — Tests
- Unit tests per new module (target: 15+ per module, 80% coverage)
- Integration test with Buckskin field (known data, see WRK-024)
- Golden-field integration test with fixed expected row counts
- Test with materialized production data (`mv_productionsum.bin`)
- Test LFS stub fallback behavior per analyzer (return empty DataFrame + warning)

### Data Constraints
- 129/133 `.bin` files are LFS stubs — pipeline must handle gracefully
- Deferred: wellbore path visualization (requires LFS pull for directional surveys)
- Deferred: decline curves (WRK-077)

### Review Notes
- **Verdict**: Claude: MINOR | Codex: MINOR | Gemini: APPROVE
- **Actions taken**:
  - Replaced "Data routers: WellRouter, BlockRouter, ..." with actual loader directory paths (no router classes exist in codebase)
  - Added prerequisite to verify `well_tubulars.csv` path before Phase 2
  - Expanded Phase 5 test strategy with specific targets (15+ tests/module, 80% coverage, named integration field)
  - Added LFS stub fallback testing requirement
- *Cross-reviewed: 2026-02-09*

*Approved by user: 2026-02-09*

---
*Source: for bsee data, stream line all field data analysis and interpretation i.e. wellbore count, well path data, casing program schematic (drawn based on sizes and old style matrix format), drilling and completion activities, intervention activities based on the lease, field, geological region etc.*
