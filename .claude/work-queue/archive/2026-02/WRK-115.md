---
id: WRK-115
title: "Link RAO data to hull shapes in hull library catalog"
status: archived
priority: medium
complexity: medium
compound: false
created_at: 2026-02-10T22:00:00Z
completed_at: 2026-02-13T00:00:00Z
target_repos:
  - digitalmodel
commit: 77690c76a
spec_ref:
related: [WRK-114, WRK-031, WRK-043]
blocked_by: []
synced_to: []
plan: inline
plan_reviewed: true
plan_approved: true
percent_complete: 100
brochure_status:
tags: [hull-library, raos, diffraction, hydrodynamics, data-linking]
---
# Link RAO Data to Hull Shapes in Hull Library Catalog

## What
Add RAO (Response Amplitude Operator) linkage to hull shapes in the hull library catalog. Each hull entry should be able to reference associated RAO datasets that accumulate over time as diffraction analyses are performed. When a new diffraction analysis produces RAOs for a cataloged hull, the link is established automatically.

## Why
Hull panel meshes (WRK-114) and diffraction solver results (RAOs) are currently disconnected. Linking them creates a growing knowledge base: each hull gains a history of RAO results across different analysis conditions (wave headings, drafts, solver types). This enables rapid lookup of existing RAOs before re-running expensive diffraction analyses, and feeds into the parametric hull pipeline (WRK-043) and solver benchmarking (WRK-031).

## Acceptance Criteria
- [x] PanelCatalogEntry schema extended with RAO reference field(s)
- [x] RAO registry/index that maps hull_id → list of RAO datasets (solver, draft, date, file path)
- [x] Hook or utility to register new RAO results against a hull after diffraction analysis
- [x] Catalog YAML/CSV updated to include RAO link metadata
- [ ] HTML report updated to show RAO availability per hull (deferred to WRK-136)
- [x] Tests covering RAO linking, lookup, and catalog round-trip

## Results
- **Commit**: `77690c76a` (digitalmodel)
- **New**: `rao_registry.py` (187 lines) — RaoRegistry class with register/lookup/link/persist
- **Extended**: `panel_catalog.py` — RaoReference Pydantic model, PanelCatalogEntry.raos field
- **Extended**: `__init__.py` — exports RaoReference, RaoRegistry
- **New**: `data/hull_library/raos/registry.yaml` — initial empty registry
- **Tests**: 18 new tests in `test_rao_registry.py` (40 total hull_library tests pass)
- **Also fixed**: `pyproject.toml` dual `[tool.pytest]` config conflict
- **Deferred**: HTML report update (5th acceptance criterion) → WRK-136 or dedicated follow-up

## Plan

**Target**: `data/hull_library/catalog/hull_panel_catalog.yaml` (extend) + `data/hull_library/raos/` (new)

### Existing Assets (reuse)
- `data/hull_library/catalog/hull_panel_catalog.yaml` — 23 entries, PanelCatalogEntry schema
- `src/digitalmodel/hydrodynamics/hull_library/panel_catalog.py` — PanelCatalogEntry Pydantic model
- Benchmark RAO data: `benchmark_output/barge_benchmark/r4/`, `benchmark_output/ship_benchmark/r1/`, `benchmark_output/spar_benchmark/r1/`
- `src/digitalmodel/hydrodynamics/diffraction/` — DiffractionSpec, OrcaWave/AQWA backends
- `scripts/run_3way_benchmark.py` — produces RAO comparison data as JSON

### Phase 1 — Schema Extension
- Extend `PanelCatalogEntry` (in `hydrodynamics/hull_library/panel_catalog.py`) with optional `raos: list[RaoReference]` field
- `RaoReference` schema: `solver` (AQWA/OrcaWave/BEMRosetta), `draft_m`, `loading_condition` (ballast/loaded/intermediate), `headings_deg: list`, `date`, `file_path`, `benchmark_revision`
- Backward compatible: existing entries without `raos` field remain valid
- Draft-matching: lookup must filter by draft_m tolerance (±0.5m) to prevent using ballast RAOs for loaded condition

### Phase 2 — RAO Registry
- `data/hull_library/raos/` directory structure: `raos/{hull_id}/{solver}_{draft}m_{date}.json`
- Registry index: `data/hull_library/raos/registry.yaml` — maps hull_id → list of RAO datasets
- Each RAO dataset JSON: frequencies, headings, 6-DOF RAO amplitude + phase arrays
- Populate with existing benchmark data (barge r4, ship r1, spar r1)

### Phase 3 — Auto-Linking Hook
- Shared diffraction postprocessor function (not only in benchmark script): `register_rao(hull_id, solver, draft, headings, rao_data, output_dir)`
- Called from: `run_3way_benchmark.py`, `orcawave_backend.py`, `aqwa_backend.py` — any diffraction entry point
- Updates both registry.yaml and catalog entry
- Idempotent: re-running same analysis overwrites previous entry for same hull+solver+draft+loading_condition

### Phase 4 — Catalog & Report Updates
- Update catalog YAML with RAO references for benchmarked hulls
- Extend HTML report: per-hull row shows RAO availability (checkmarks per solver)
- Add lookup utility: `get_raos(hull_id, solver=None, draft=None)` → returns matching RAO datasets
- Tests: registration, lookup, catalog round-trip, backward compatibility

---
*Source: "add to hull shapes a link to the RAOs over time. Link the raos as diffraction analysis is performed."*
