---
id: WRK-279
title: "Fix DNV_RP_F103_2010 critical defects G-1 through G-4 — replace fabricated table refs + non-standard formulas"
status: pending
priority: critical
complexity: medium
compound: false
created_at: 2026-02-20T00:00:00Z
target_repos:
  - digitalmodel
commit:
spec_ref:
related: [WRK-269, WRK-272, WRK-271]
blocked_by: []
synced_to: []
plan_reviewed: false
plan_approved: false
percent_complete: 0
brochure_status: n/a
provider: claude
provider_alt: codex
tags: [cathodic-protection, bug-fix, dnv-f103, critical]
group: CP-stream
---

# Fix DNV_RP_F103_2010 Critical Defects

## What

WRK-269 (standards research) identified 5 defects in the `DNV_RP_F103_2010` route inside
`cathodic_protection.py`. Three are critical — the code produces results that cannot be
traced to any recognized standard. Must be fixed before any DNV route work proceeds
(WRK-272 F103 path is blocked on this).

**Source file:**
`digitalmodel/src/digitalmodel/infrastructure/common/cathodic_protection.py`

**Standards reference:**
`digitalmodel/docs/domains/cathodic_protection/standards-inventory.md` (WRK-269 output)

## Defects to Fix

### G-1 (Critical) — Fabricated table references in `_dnv_current_densities`

The method references "Table 4-1" and "Table 4-2" which do not exist in any edition of
DNV-RP-F103. F103-2010 uses Table 5-1; F103-2016 uses Table 4-1/4-2 (but those are
different documents with different numbers).

**Fix:** Replace the table reference strings with correct "Table 5-1" (2010) reference.
Determine which table is actually being implemented and make the reference accurate.

### G-2 (Critical) — Non-standard coating-quality lookup in `_dnv_current_densities`

The method uses coating quality categories (excellent/good/average/poor). F103-2010
Table 5-1 provides current densities by **burial condition** (non-buried vs buried) and
**internal fluid temperature** (≤30°C vs >30°C), not by coating quality.

**Fix:** Replace the coating-quality lookup with a correct Table 5-1 implementation:

```python
# F103-2010 Table 5-1 structure:
# burial_condition: "non_buried" | "buried"
# internal_fluid_temperature_c: float  →  ≤30°C or >30°C
# Units: mA/m²
TABLE_5_1 = {
    "non_buried": {"initial": {"<=30": 0.10, ">30": 0.150},
                   "mean":    {"<=30": 0.07, ">30": 0.100},
                   "final":   {"<=30": 0.05, ">30": 0.060}},
    "buried":     {"initial": {"<=30": 0.020, ">30": 0.025},
                   "mean":    {"<=30": 0.015, ">30": 0.020},
                   "final":   {"<=30": 0.010, ">30": 0.015}},
}
```

Note: Verify exact values from the F103-2010 PDF at:
`/mnt/ace/O&G-Standards/DNV/DNV_RP_F103_(2010)_Cathodic_Protection_of_Submarine_Pipelines_by_Galvanic_Anodes.pdf`

### G-3 (Critical) — Arrhenius temperature correction in `_dnv_current_densities`

The method applies an Arrhenius temperature correction factor to current densities.
No edition of DNV-RP-F103 specifies an Arrhenius correction for current densities.
F103-2010 provides discrete values by temperature bracket.

**Fix:** Remove the Arrhenius correction entirely. Use discrete temperature-bracket
lookup from Table 5-1 as described in G-2 fix.

### G-4 (Critical) — Compound exponential coating breakdown in `_dnv_coating_breakdown`

The method uses a compound exponential formula. F103-2010 Annex 1 specifies a LINEAR
formula:

```
f_ci = a
f_cm = a + 0.5·b·t_f
f_cf = a + b·t_f
```

Constants `a` and `b` come from F103-2010 Tables A.1/A.2 by coating type.

The wet storage period (`wet_storage_years`) is a 2016 feature not present in 2010.

**Fix:** If implementing F103-2010 (clean):
- Replace compound exponential with linear `f_cm = a + 0.5·b·t_f`
- Remove `wet_storage_years` input parameter
- Add coating type lookup from Tables A.1/A.2

If implementing F103-2016 (clean):
- Document separately from 2010; rename class `DNV_RP_F103_2016`

**Decision required:** See "Target Version Decision" below.

### G-5 (Major) — Longitudinal resistance formula mismatch in `_dnv_pipeline_geometry`

The method uses `RL = ρ_Me / A_s` which is the F103-2016 formula. F103-2010 Eq.8 uses:
`R_Me = L·ρ_Me / (π·d·(D−d))`

Not critical if we decide to target 2016, but the class name `DNV_RP_F103_2010` is
misleading.

## Target Version Decision

**Required decision before implementing G-2/G-3/G-4 fixes:**

The class is named `DNV_RP_F103_2010` but contains explicit comments "DNV RP-F103 2016 /
Saipem approach" in three private methods. The code is a hybrid that is neither clean.

**Option A — Fix to clean F103-2010:**
- Replace current density lookup with Table 5-1 (burial × temp)
- Replace coating breakdown with linear Annex 1 formula
- Remove wet storage period input
- Fix longitudinal resistance to Eq.8 formula
- Keep class name `DNV_RP_F103_2010`
- Add `DNV_RP_F103_2016` as a separate class later (WRK-272)

**Option B — Fix to clean F103-2016:**
- Replace current density lookup with Table 4-1/4-2 from 2016 (requires obtaining PDF)
- Keep enhanced attenuation formula
- Keep wet storage period
- Rename class to `DNV_RP_F103_2016`
- This option BLOCKED until DNVGL-RP-F103 July 2016 PDF is obtained

**Recommendation: Option A** — 2010 PDF is available locally, can implement and verify
immediately. 2016 can be added as a separate route once the PDF is sourced. The CTR2
Excel calcs (WRK-276 E1/E2) used 2010 and can serve as immediate regression tests.

## Acceptance Criteria

- [ ] `_dnv_current_densities` replaced with F103-2010 Table 5-1 lookup (burial × temp)
- [ ] Arrhenius correction removed
- [ ] Table reference strings corrected to "Table 5-1" (2010)
- [ ] `_dnv_coating_breakdown` replaced with F103-2010 linear formula (Annex 1)
- [ ] `wet_storage_years` parameter documented as optional / removed from 2010 path
- [ ] `_dnv_pipeline_geometry` updated to F103-2010 Eq.8 formula (if Option A chosen)
- [ ] Class-level docstring updated to state actual standard and version
- [ ] Existing DNV tests updated to reflect corrected current density inputs
- [ ] All existing ABS tests still pass: `PYTHONPATH=src python3 -m pytest tests/specialized/cathodic_protection/ -v`
- [ ] At least 3 new DNV tests using corrected Table 5-1 input structure
- [ ] Standards-inventory.md G-1 through G-4 status updated to "Fixed"

## Agentic AI Horizon

- Blocking defect for all downstream DNV route work (WRK-272 F103 path)
- The CTR2 Excel calcs (WRK-276 E1/E2) use F103-2010 — once fixed, they become
  regression tests that confirm the repair
- **Disposition: Route B — implement immediately; unblocks WRK-272 F103 path**

---
*Source: WRK-269 standards audit 2026-02-20 — 5 defects found, 3 critical, DNV route
outputs are currently unauditable against any recognized standard*
