---
id: WRK-641
title: "fix(agents): formalize and close codex session-wrapper launch bugfix"
status: pending
priority: high
complexity: medium
route: B
compound: false
created_at: 2026-02-27T00:00:00Z
target_repos:
  - workspace-hub
commit:
spec_ref:
related:
  - WRK-624
  - WRK-640
blocked_by: []
parent:
synced_to: []
plan_reviewed: false
plan_approved: false
percent_complete: 0
brochure_status: n/a
computer: [ace-linux-1]
provider: codex
provider_alt: claude
---

# fix(agents): Formalize and Close Codex Session-Wrapper Launch Bugfix

## Problem

Agent wrapper fixes for Codex launch safety were implemented directly in the repo, but
the work was not captured under its own WRK item. That leaves the queue without a formal
record for:

- `scripts/agents/session.sh` no longer mutating queue state on `init` by default
- `scripts/agents/session.sh end` clearing session ownership cleanly
- `scripts/agents/work.sh` honoring `WORK_ITEM_ROOT` for isolated execution
- regression coverage added in `scripts/agents/tests/test-session-wrapper.sh`

Without a dedicated WRK, the bugfix cannot be reviewed and closed through the normal
WRK-624 workflow requirements.

## What

Backfill a formal WRK for the already-implemented bugfix, then complete the missing
workflow steps needed to close it correctly:

1. capture the exact scope of the wrapper fixes and affected files
2. verify the current implementation and test evidence
3. generate the required HTML review artifact
4. run cross-review appropriate to Route B
5. close the item formally if review findings are non-blocking

## Current Implementation Evidence

- `scripts/agents/lib/session-store.sh`
- `scripts/agents/session.sh`
- `scripts/agents/work.sh`
- `scripts/agents/tests/test-session-wrapper.sh`

Known behaviors already validated locally:

- `session.sh init --provider codex` works without forcing stale-item mutation
- `session.sh end` clears `.claude/work-queue/session-state.yaml`
- `work.sh list` and `work.sh next` respect `WORK_ITEM_ROOT`
- regression test covers init/end/isolation behavior

## Plan

### Phase 1 - Verify and package evidence

- inspect the current diff for the four wrapper/test files
- rerun the wrapper regression test and queue validation
- collect command outputs and affected-file summary into WRK assets

### Phase 2 - Produce review artifacts

- generate the WRK HTML review output required by the WRK-624 workflow
- create a compact implementation review bundle describing the bug, root cause, fix,
  and verification evidence
- run cross-review for the implementation bundle

### Phase 3 - Close formally

- address any MAJOR findings if they appear
- update WRK metadata and completion checklist
- move the item through close flow only after review is clean

## Acceptance Criteria

- [ ] Dedicated WRK exists for the agent-wrapper bugfix
- [ ] Wrapper regression test passes from the current repo state
- [ ] Queue validation passes from the current repo state
- [ ] HTML review artifact exists for this WRK
- [ ] Cross-review recorded with no unresolved MAJOR findings
- [ ] WRK closed through the normal queue flow with index regeneration

## Notes

- This is a backfill/closure WRK for work already implemented before formal capture.
- The purpose is not to redesign the wrapper behavior again unless review finds a real
  defect.
- Any remaining failures after this point should be treated as review or close-process
  gaps, not missing initial implementation.
