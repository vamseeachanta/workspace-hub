---
id: WRK-132
title: "Refine OrcaWave benchmarks: barge/ship/spar RAO fixes + damping/gyradii/Km comparison"
status: pending
priority: high
complexity: medium
compound: false
created_at: 2026-02-11T10:00:00Z
target_repos:
  - digitalmodel
commit:
spec_ref:
related: [WRK-031, WRK-039]
blocked_by: []
synced_to: []
plan: inline
plan_reviewed: true
plan_approved: true
percent_complete: 0
brochure_status:
---

# Refine OrcaWave Benchmarks: Barge/Ship/Spar RAO Fixes + Damping/Gyradii/Km Comparison

## What
OrcaWave vs AQWA benchmarks (WRK-031 Phase 3) for barge, ship, and spar show specific DOF mismatches that need investigation and correction. Additionally, expand the comparison to include damping coefficients, gyration radii, and metacentric height (Km) distance in vectorial manner.

### Specific RAO Issues
- **Barge**: Roll and sway RAOs not matching between solvers
- **Ship**: Heave RAO not matching between solvers
- **Spar**: Overall trends are good but motion magnitudes do not follow

### Additional Comparison Dimensions
1. **Damping values**: Extract damping coefficients from both solver outputs and compare
2. **Gyration radii**: Compare radii of gyration (Kxx, Kyy, Kzz) between solver input models to ensure consistency
3. **Km distance**: Compare metacentric height (Km) in vectorial manner between solvers

## Why
Benchmark mismatches indicate either input parameter inconsistencies (mass, inertia, CoG, Km) or solver-specific behavior differences. Comparing damping, gyration radii, and Km will help isolate whether discrepancies are from input setup or solver numerics.

## Acceptance Criteria
- [ ] Barge roll and sway RAOs investigated — amplitude error < 15% at peak frequency, phase error < 20 deg; OR root cause documented as solver-inherent difference with justification
- [ ] Ship heave RAO investigated — amplitude error < 10% across frequency range; OR documented as solver-inherent
- [ ] Spar motion magnitudes investigated — amplitude ratio between solvers within 0.8-1.2 for dominant DOFs; OR documented as solver-inherent
- [ ] Damping coefficients extracted from both OrcaWave and AQWA outputs
- [ ] Damping comparison plots generated (per DOF, per hull)
- [ ] Gyration radii (Kxx, Kyy, Kzz) compared between solver input models
- [ ] Metacentric height (Km) compared in vectorial manner between solvers
- [ ] Updated benchmark report with corrected results and new comparison dimensions

## Plan

**Target**: Extend existing benchmark scripts + `src/digitalmodel/hydrodynamics/diffraction/` modules

### Existing Assets (reuse)

| Component | Path | Purpose |
|-----------|------|---------|
| Barge benchmark | `scripts/benchmark/regenerate_barge_benchmark.py` | Barge r4 orchestration |
| Ship benchmark | `scripts/benchmark/regenerate_ship_benchmark.py` | Ship r1 orchestration |
| Spar benchmark | `scripts/benchmark/run_spar_benchmark.py` | Spar r1 orchestration |
| 3-way runner | `scripts/benchmark/run_3way_benchmark.py` | Multi-solver comparison engine |
| BenchmarkPlotter | `hydrodynamics/diffraction/benchmark_plotter.py` | Plot generation (r4 format) |
| AQWA result extractor | `hydrodynamics/diffraction/aqwa_result_extractor.py` | AQWA output parsing |
| OrcaWave data extraction | `hydrodynamics/diffraction/orcawave_data_extraction.py` | OrcaWave output parsing |
| DiffractionSpec files | `docs/modules/orcaflex/diffraction/{barge,ship,spar}/spec.yml` | Solver input specs |
| Benchmark data | `benchmark_output/barge_benchmark/r4_per_dof_report/` | Existing JSON results |
| Freq harmonization | `run_3way_benchmark.py::_harmonize_frequencies()` | Grid alignment |

### Phase 1 — Input Parameter Audit (Root Cause Investigation)

For each hull (barge, ship, spar), compare solver input parameters side-by-side:

| Parameter | Extract From | Compare |
|-----------|-------------|---------|
| Mass / Displacement | spec.yml + solver input files | Should match exactly |
| CoG (x, y, z) | spec.yml → solver mapping | OrcaWave vs AQWA conventions |
| Gyration radii (Kxx, Kyy, Kzz) | spec.yml `radii_of_gyration` | Both solvers using same values |
| Metacentric height (GM, Km, KB) | Solver hydrostatic output | Compute Km = KB + BM vectorially |
| Draft / Waterplane area | spec.yml + solver hydrostatics | Consistency check |
| External damping | spec.yml `external_damping` | Verify units match (no /1000 bug for damping) |

- Create `scripts/benchmark/audit_solver_inputs.py`:
  - Load spec.yml for each hull
  - Extract equivalent parameters from OrcaWave .yml and AQWA .dat inputs
  - Print side-by-side comparison table
  - Flag mismatches > 0.1%

### Phase 2 — Fix Known RAO Mismatches

**Contingency**: If root cause is solver-inherent (potential theory implementation differences, not input errors), document the difference with quantitative bounds and mark as "Accepted Solver Difference" in the benchmark report. Not all mismatches are fixable — the goal is to distinguish input errors (fixable) from solver theory differences (document and accept).

**Also check**: Solver interaction/multibody settings, near-field formulation differences, and irregular frequency treatment — these often hide as subtle RAO discrepancies.

**Barge (roll + sway)**:
- Likely cause: roll damping (viscous component not matched between solvers), or sway-roll coupling sign convention (M24/M42 negation — already applied, verify correctness)
- Actions:
  1. Check external_damping matrix: roll diagonal (M44) values in both solvers
  2. Verify sway-roll coupling (M24/M42) sign: AQWA ISO convention vs OrcaWave Orcina convention
  3. Check roll gyration radius Kxx consistency
  4. If needed: run sensitivity on roll damping to match RAO peaks

**Ship (heave)**:
- Likely cause: heave added mass mismatch, or different mesh resolution at waterplane
- Actions:
  1. Compare heave added mass (A33) at low frequency between solvers
  2. Check waterplane area from hydrostatics output
  3. Verify mesh panel density near waterline (affects heave accuracy)
  4. Compare heave natural period from both solvers

**Spar (magnitude)**:
- Likely cause: deep draft → fewer mesh panels at waterline, or CoG/draft mismatch
- Actions:
  1. Verify draft matches between solvers (spar has large draft)
  2. Check panel count at waterline region
  3. Compare displacement from hydrostatics (should match spec within 0.1%)
  4. Verify all inertia terms (deep draft amplifies inertia sensitivity)

### Phase 3 — Damping Coefficient Extraction & Comparison

- Extend AQWA result extractor to extract radiation damping matrix (B_ij(ω)) from .LIS output
- Extend OrcaWave data extraction to extract radiation damping from .owr output
- Create comparison plots: B_ii(ω) per diagonal DOF, overlaid OrcaWave vs AQWA
- Add to benchmark report as new section: "Radiation Damping Comparison"
- Also compare external (viscous) damping input values

### Phase 4 — Gyration Radii & Km Vectorial Comparison

- **Gyration radii**: Extract from spec.yml → verify propagated correctly to both solvers
  - OrcaWave: check `BodyMassInertias` or equivalent property
  - AQWA: check HYDROSTATIC DATA deck card inertia values
  - Generate table: Kxx, Kyy, Kzz per hull per solver

- **Km vectorial comparison**:
  - Extract from hydrostatic output: KB (center of buoyancy), BM (metacentric radius), GM
  - Compute: Km = KB + BM (for each transverse and longitudinal)
  - Compare: Km_transverse, Km_longitudinal between solvers
  - Report as vector: [KM_x, KM_y, KM_z] relative to keel

### Phase 5 — Updated Benchmark Reports

- Re-run all 3 benchmarks with fixes applied
- Generate updated reports (r5 for barge, r2 for ship, r2 for spar)
- New report sections:
  1. Input parameter audit table (solver-column format)
  2. Radiation damping comparison plots
  3. Gyration radii comparison table
  4. Km vectorial comparison
  5. Before/after RAO comparison (showing fix impact)
- Update `benchmark_output/` with new revision directories

### Test Strategy

- **Unit tests** (no solver): input audit comparison logic with mock data, Km vectorial computation
- **Integration tests** (solver license): re-run benchmarks, validate improved RAO agreement meets thresholds
- **Regression**: updated benchmark JSON becomes new baseline; future changes must not regress beyond thresholds

---
*Source: orcawave benchmarking for barge, ship and spar need further refinements. barge roll and sway are not matching. ship: heave is not matching. spar: trends are good but the overall motions do not follow. Ensure the damping values are extracted from output for comparison. also compare gyration radii are compared between softwares. also compare the km distance in vectorial manner*
