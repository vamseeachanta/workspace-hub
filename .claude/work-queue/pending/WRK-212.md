---
id: WRK-212
title: 'Agent teams protocol skill — orchestrator routing, subagent patterns, team lifecycle'
status: pending
priority: medium
complexity: medium
compound: false
created_at: 2026-02-19T00:00:00Z
target_repos:
  - workspace-hub
module: automation
tags:
  - agent-teams
  - orchestration
  - protocols
  - skills
  - coordination
related:
  - WRK-211
  - WRK-207
  - WRK-213
blocked_by: []
synced_to: []
provider: claude
spec_ref: ''
plan_reviewed: false
plan_approved: true
percent_complete: 0
brochure_status: n/a
---

# WRK-212: Agent Teams Protocol Skill

## What

Create a skill (or skill cluster) documenting workspace-hub's agent team
protocols: when to use teams vs sequential work, how the orchestrator routes
tasks to subagents, team lifecycle (create → assign → work → shutdown),
communication patterns (SendMessage vs broadcast), and decision criteria for
Route A/B/C vs agent team parallelism.

## Why

**Session trigger (2026-02-19)**: User asked "all these related pending items
may need to agent teams to work on — to talk to each other?" and "we need to
start maintaining an agent teams protocols skills to use." The current session
had to reason about this from scratch (small file-write tasks = no team needed;
WRK-205 with 115 files = team makes sense). This reasoning should be a
reusable skill, not re-derived each session.

User also raised: "Can main orchestrator be ready to take my messages and send
the work to another subagent? So my messages can be routed to subagents
appropriately." This points to an orchestrator pattern where the main session
stays light and delegates heavy work to subagents — the skill should document
how to implement this.

## Scope

### Skill 1: `agent-teams/SKILL.md` — team decision framework

Covers:
- Decision matrix: when to use teams vs sequential execution
- Max teammates policy (MAX_TEAMMATES=3 per CLAUDE.md)
- Team lifecycle: TeamCreate → TaskCreate → Task(spawn) → SendMessage → TeamDelete
- Communication patterns: DM vs broadcast (broadcast = expensive, use sparingly)
- Plan approval flow for teammates with `plan_mode_required`
- Shutdown protocol: shutdown_request → shutdown_response

### Skill 2: `agent-teams/orchestrator-routing/SKILL.md` — main session as router

Covers:
- Main session = lightweight orchestrator (takes user messages, routes to subagents)
- How to stay responsive while subagents do heavy work (run_in_background)
- Reading subagent output files (TaskOutput / Read output_file)
- When to resume vs spawn new agent
- Parallel vs sequential subagent patterns

## Decision Matrix (core of Skill 1)

| Task profile | Team? | Rationale |
|-------------|-------|-----------|
| < 5 files, single domain | No | Sequential faster than team overhead |
| 3+ independent workstreams > 30 min each | Yes | Parallelism wins |
| Research + implementation (separate concerns) | Yes | Explore agent + Bash agent |
| Writing WRK items / skill files | No | Small, sequential |
| Bulk file operations (115+ files) | Yes | Bash agent per batch |
| Cross-repo changes | Yes | One agent per repo |

## Acceptance Criteria

- [ ] `SKILL.md` created for team decision framework
- [ ] `orchestrator-routing/SKILL.md` created for main-as-router pattern
- [ ] Decision matrix documented (when teams help vs hurt)
- [ ] Team lifecycle with code examples (TeamCreate, Task, SendMessage, TeamDelete)
- [ ] Orchestrator routing pattern: user → main → subagent delegation
- [ ] MAX_TEAMMATES=3 constraint documented with rationale
- [ ] Cross-linked to: improve, ecosystem-health, WRK-211

## Plan

Route A — inline plan. User approved 2026-02-19.

**Deliverables**:
1. `.claude/skills/workspace-hub/agent-teams/SKILL.md`
2. `.claude/skills/workspace-hub/agent-teams/orchestrator-routing/SKILL.md`
3. Update `improve` skill: reference agent-teams skill for Phase 3 spawning decisions
