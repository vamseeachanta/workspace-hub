---
id: WRK-067
title: Acquire OSHA enforcement and fatality data
status: in_progress
priority: high
complexity: simple
created_at: 2026-02-01T00:00:00Z
target_repos:
  - worldenergydata
commit:
spec_ref:
related: [WRK-012, WRK-013]
blocked_by: []
synced_to: []
---

# Acquire OSHA enforcement and fatality data

## What
Download OSHA enforcement data (inspections + violations) from enforcedata.dol.gov, OSHA severe injury reports from osha.gov/severe-injury-reports, and OSHA fatality data from osha.gov/fatalities. Filter for oil & gas NAICS codes (211, 213111, 213112). Build importers in the HSE module.

## Why
Zero onshore oil & gas incident data currently exists. OSHA data covers 1973-present with daily updates.

## Acceptance Criteria
- [ ] Download OSHA enforcement CSVs (inspections, violations, accidents)
- [ ] Download OSHA severe injury reports CSV
- [ ] Download OSHA fatality data CSV
- [ ] Filter for oil & gas NAICS codes
- [ ] Build importer(s) in HSE module
- [ ] Import data into database
- [ ] Document record counts and date ranges

---
*Source: HSE data acquisition - OSHA enforcement and fatality data for onshore oil & gas*

## Progress
- 2026-02-01: Acquirer code built (osha_acquirer.py, osha_importer.py, osha_fatalities_acquirer.py). DOL portal rate-limited initial download. Retry in progress.
- 2026-02-01: All 13 OSHA datasets downloaded successfully (40.6M records, 6.6GB). DOL moved downloads to enfxfr.dol.gov with date-stamped URLs. Pending: filter for oil & gas NAICS codes and run import.

## Plan

> Remaining work only. Acquirer (`osha_acquirer.py`) and importer (`osha_importer.py`) are already built. Raw data is on disk at `data/modules/hse/raw/osha/` (6.6GB, 13 datasets). No filtered files or database exist yet.

### Phase 1 — NAICS Filtering (run existing code)

1. **Filter inspection data** for oil & gas NAICS (211, 213111, 213112) and SIC (1311, 1381, 1382, 1389) codes.
   - Run: `python3 -c "from worldenergydata.hse.acquirers.osha_acquirer import OSHAAcquirer; a = OSHAAcquirer(); a.filter_oil_and_gas('data/modules/hse/raw/osha/osha_inspection0.csv', 'data/modules/hse/raw/osha/filtered/osha_inspection_oil_gas.csv')"`
   - Note: Raw inspection data is split into 6 chunks (`osha_inspection0.csv` through `osha_inspection5.csv`, ~1.5GB total). The existing `filter_oil_and_gas()` method processes one file at a time. Need to concatenate filtered outputs or loop through all chunks.
   - **Fix needed**: The acquirer's `filter_oil_and_gas()` uses append mode. Create a small wrapper script that iterates over all `osha_inspection*.csv` chunks and appends to a single filtered output.
   - Target output: `data/modules/hse/raw/osha/filtered/osha_inspection_oil_gas.csv`

2. **Filter accident data** — same approach for `osha_accident.csv` (38MB, single file).
   - Target output: `data/modules/hse/raw/osha/filtered/osha_accident_oil_gas.csv`

3. **Filter accident_injury data** — `osha_accident_injury.csv` (28MB, single file).
   - Target output: `data/modules/hse/raw/osha/filtered/osha_accident_injury_oil_gas.csv`

4. **Write chunked filter script**: `scripts/filter_osha_oil_gas.sh`
   - Loops over `osha_inspection{0..5}.csv`, `osha_violation{0..13}.csv`, `osha_accident.csv`, `osha_accident_injury.csv`
   - Calls `OSHAAcquirer.filter_oil_and_gas()` per chunk, appending to single output per dataset
   - Reports record counts post-filter
   - Uses system `python3` with `PYTHONPATH="src"` (no uv)

### Phase 2 — Database Import

1. **Create HSE database**: The `osha_importer.py` already calls `Base.metadata.create_all(engine)`.
   - DB path: `data/modules/hse/hse_incidents.db` (SQLite, as configured in `DEFAULT_DB_URL`)
   - Run: `PYTHONPATH="src" python3 -m worldenergydata.hse.importers.osha_importer --data-dir data/modules/hse/raw/osha`
   - The importer's `_resolve_path()` automatically prefers `filtered/` subdirectory when `use_filtered=True` (default)

2. **Import flow**: inspections -> accidents -> accident_injuries (all via `OSHAImporter.import_data()`)
   - Deduplication by `bsee_incident_id` (prefixed `OSHA-INSP-`, `OSHA-ACC-`, `OSHA-INJ-`)
   - Chunk-based commits (50K rows per chunk) for memory efficiency

3. **Known issue**: The `osha_importer.py` currently has a single `_resolve_path()` that looks for `osha_inspection.csv` (not `osha_inspection0.csv`). Since Phase 1 produces a single concatenated filtered file per dataset, this works. But if using unfiltered data, the chunked files need handling.

### Phase 3 — Validation and Documentation

1. **Run data quality validator**:
   - `DataQualityValidator` at `src/worldenergydata/hse/importers/data_quality_validator.py`
   - Validates completeness, ranges, consistency, temporal patterns
   - Export report: `data/modules/hse/quality_report_osha.json`

2. **Document record counts**: Update this WRK file with:
   - Total raw records (from 40.6M)
   - Filtered oil & gas records per dataset
   - Successfully imported records
   - Skipped/error counts
   - Date range of imported data (expect 1973-present for inspections)

3. **Update data catalog**: Add OSHA entries to `data/catalog/data-catalog.yml` under `hse` module

### Phase 4 — Tests

1. **Unit test**: `tests/unit/hse/test_osha_filter.py`
   - Test NAICS/SIC prefix matching logic
   - Test chunked file handling
   - Test edge cases: missing columns, empty DataFrames

2. **Integration test**: `tests/unit/hse/test_osha_import.py`
   - Use small sample CSV fixture (10-20 rows)
   - Verify HSEIncident records created with correct field mapping
   - Verify deduplication behavior
   - Verify severity mapping from inspection types

3. **Path**: `PYTHONPATH="src:../assetutilities/src" python3 -m pytest tests/unit/hse/ -v --tb=short --noconftest`

### Existing Code to Build On
- Acquirer: `src/worldenergydata/hse/acquirers/osha_acquirer.py` (complete, 380 lines)
- Fatalities acquirer: `src/worldenergydata/hse/acquirers/osha_fatalities_acquirer.py`
- Importer: `src/worldenergydata/hse/importers/osha_importer.py` (complete, 633 lines)
- DB models: `src/worldenergydata/hse/database/models.py` (HSEIncident, InjuryIncident, ViolationIncident, etc.)
- Validator: `src/worldenergydata/hse/importers/data_quality_validator.py`
- Refresh script: `scripts/refresh_osha_data.sh` (uses `uv run`, needs adaptation to system python3)

### Data State
- **Downloaded (6.6GB)**: `data/modules/hse/raw/osha/` — 13 datasets (inspection x6, violation x14, accident, accident_injury, etc.)
- **Not yet created**: `data/modules/hse/raw/osha/filtered/` — oil & gas subset
- **Not yet created**: `data/modules/hse/hse_incidents.db` — SQLite database
- **Not yet created**: `data/modules/hse/raw/osha/fatalities/` — OSHA severe injury/fatality data (separate acquirer)

### Dependencies
- None (all code exists, data downloaded)
- System python3 (3.12.3), pandas, httpx, sqlalchemy available in PYTHONPATH
