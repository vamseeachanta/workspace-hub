---
id: WRK-304
title: "cleanup: move Stop-hook analysis to comprehensive-learning pipeline"
status: pending
priority: high
created: 2026-02-22
tags: [hooks, session-design, comprehensive-learning, cleanup]
computer: ace-linux-1
blocked_by: []
---

## Goal

Remove analysis logic from Stop-time hooks so sessions stay lean (< 5s at Stop).
Move that logic into the correct comprehensive-learning pipeline phases.

## Motivation

Three hooks currently run heavy analysis synchronously at every session Stop:

| Hook | Lines | Cost per session |
|------|-------|
-----------------|
| `consume-signals.sh` | 444 | Reads + analyses all JSONL signals |
| `session-end-evaluate.sh` | 120 | Scores session quality |
| `ecosystem-health-check.sh` | 321 | Full ecosystem health scan |

These interrupt session flow and duplicate work that comprehensive-learning already does.

## Scope

### 1. `consume-signals.sh`

Keep: signal-file writes (fast JSONL appends, < 1s).
Remove / stub: all analysis loops, aggregation, report generation.
Move to: comprehensive-learning Phase 1 (Insights).

### 2. `session-end-evaluate.sh`

Keep: raw score entry written to `.claude/state/session-signals/` (< 1s).
Remove: any blocking output, checklist display, or summary generation.
Move scoring computation to: comprehensive-learning Phase 10 (Report).

### 3. `ecosystem-health-check.sh`

Keep: none of it in Stop hook — it's pure analysis.
Move entirely to: comprehensive-learning Phase 6 (WRK Feedback / Ecosystem).

### 4. Test

Verify `time bash .claude/hooks/post-stop.sh` completes in < 5s after change.

## Acceptance Criteria

- [ ] `consume-signals.sh` Stop-time execution ≤ 1s (raw write only)
- [ ] `session-end-evaluate.sh` Stop-time execution ≤ 1s
- [ ] `ecosystem-health-check.sh` removed from Stop hook; added to pipeline
- [ ] comprehensive-learning pipeline phases updated to call moved logic
- [ ] Stop hook total time < 5s verified
- [ ] Codex cross-review passes

## Route

Route A — hook file edits + SKILL.md pipeline section update.
