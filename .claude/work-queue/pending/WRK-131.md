---
id: WRK-131
title: "Passing ship analysis for moored vessels — AQWA-based force calculation and mooring response"
status: working
priority: high
complexity: complex
compound: false
created_at: 2026-02-11T21:00:00Z
target_repos:
  - digitalmodel
commit:
spec_ref: specs/modules/wrk-131-passing-ship-analysis.md
related: [WRK-039, WRK-125, WRK-129, WRK-130]
blocked_by: []
synced_to: []
plan: inline
plan_reviewed: true
plan_approved: true
percent_complete: 25
brochure_status:
tags: [passing-ship, mooring, aqwa, hydrodynamics, port-engineering, force-calculation]
---

# Passing Ship Analysis for Moored Vessels

## What
Build a passing ship analysis capability for moored vessels. Calculate hydrodynamic forces on a moored vessel due to a passing ship (surge, sway, yaw), evaluate mooring line tensions under passing ship events, and generate standardized reports. Covers perpendicular and parallel passing cases, with/without wind, at varying speeds and distances.

## Why
- Passing ship effects are a critical design case for port/terminal mooring systems
- ~15+ historical projects demonstrate recurring demand for this analysis type
- Currently relies on standalone Excel tool (`PassingShipForceCalculator.xlsm`) and manual AQWA runs
- Standardizing into the digitalmodel framework enables parametric studies, consistent reporting, and reuse

## Resources (local, not in repo)
- **Tool**: `G:\ACMA Tool\Passing Ships\` — existing passing ship force calculator (Excel-based)
- **Archive**: `R:\Archive - Drive J\` — ~15+ past project folders with AQWA models, reports, and results
- **Key tool files**: `PassingShipForceCalculator.xlsm` (force calculation), `PassingShipForceCalculator 3.7 knot.xlsm` (speed variant)
- **Output examples**: Line tension plots at various passing speeds (3.0 knot, 3.7 knot), mooring line groups (1-6, 7-12)

## Technical Scope
1. **Passing ship force model** — hydrodynamic interaction forces (surge, sway, yaw) as function of:
   - Passing ship speed, size (displacement, length, beam, draft)
   - Moored vessel dimensions
   - Separation distance (lateral)
   - Water depth / depth-to-draft ratio
   - Passing angle (parallel, perpendicular, oblique)
2. **Mooring response** — time-domain mooring analysis with passing ship force time history:
   - Line tensions per mooring line
   - Vessel motions (surge, sway, yaw excursions)
   - Fender loads
   - Combined with wind, current, wave (with/without passing vessel scenarios)
3. **Analysis cases** — parametric matrix:
   - Wind with passing vessel / wind without passing vessel
   - Perpendicular passing / parallel passing
   - Multiple passing speeds
   - Short ship / long ship variants
4. **PassingShipForceCalculator extraction** — reverse-engineer the Excel tool logic into Python
5. **AQWA integration** — passing ship force application in AQWA mooring analysis (or OrcaFlex equivalent)
6. **Reporting** — standardized HTML report per WRK-129 convention

## PassingShipSpec — Analysis Specification
Create a `PassingShipSpec` (similar to `DiffractionSpec` pattern) that fully defines a passing ship analysis:
- **Moored vessel**: hull geometry, mooring arrangement, loading condition, RAOs
- **Passing ship**: type, displacement, LOA, beam, draft, speed, track (distance, angle)
- **Environment**: water depth, wind speed/direction, current, wave conditions
- **Analysis matrix**: cases (with/without wind, with/without passing, speeds, angles)
- **Output requests**: line tensions, vessel motions, fender loads, force time histories
- Spec format: YAML (`spec.yml`), validated by Pydantic schema, drives automated analysis pipeline

## Benchmarking — 5-7 Historical Projects
Reproduce 5-7 past passing ship projects from `R:\Archive - Drive J\` to validate the new implementation:
1. Extract original analysis inputs (vessel data, mooring layout, passing ship parameters, environmental conditions)
2. Sanitize all client/project references per legal compliance
3. Create `spec.yml` for each benchmark case
4. Run through new Python pipeline
5. Compare results against original project outputs (line tensions, vessel motions)
6. Acceptance: within 5% of original results for line tensions, 10% for vessel motions

Target benchmark set (select 5-7 from ~15 archived projects covering diverse scenarios):
- At least 1 perpendicular passing case
- At least 1 parallel passing case
- At least 1 with wind + passing vessel combined
- At least 1 port/dock berth configuration
- At least 1 open water / VLCC terminal configuration
- Range of passing speeds (2-5 knots)

## Acceptance Criteria
- [ ] `PassingShipSpec` Pydantic schema defined and validated
- [ ] Passing ship force calculation implemented in Python (from Excel tool extraction)
- [ ] Force time history generation for given passing scenario (speed, distance, ship size)
- [ ] Mooring response analysis with passing ship forces (line tensions, motions)
- [ ] Parametric study capability (speed × distance × wind × passing angle matrix)
- [ ] 5-7 benchmark cases reproduced from historical projects, results within tolerance
- [ ] Each benchmark has sanitized `spec.yml` in `docs/modules/orcaflex/passing_ship/`
- [ ] Standardized HTML report with force plots, tension envelopes, motion time histories
- [ ] Integration with existing hydrodynamics module

## Plan

**Target**: `src/digitalmodel/hydrodynamics/passing_ship/` (new module) + `docs/modules/orcaflex/passing_ship/`

**Primary solver**: AQWA (matches historical project workflow). OrcaFlex is secondary/alternative path for mooring response only — not required for Phase 1-2.

**Prerequisites** (not WRK items — local resource access):
- Access to `G:\ACMA Tool\Passing Ships\` for Excel tool extraction (Phase 1)
- Access to `R:\Archive - Drive J\` for benchmark data (Phase 5)
- AQWA v252 license for mooring analysis (Phase 3)
- All archive data must pass legal sanitization before entering repo

**Phase gates**: Each phase produces a testable deliverable. Phase 1-2 (force model + schema) can proceed independently. Phase 3 (mooring) requires Phase 1. Phase 5 (benchmarks) requires Phases 1-4. Phase 6 (reporting) depends on WRK-130 for report template.

### Existing Assets (reuse)

| Component | Path | Purpose |
|-----------|------|---------|
| DiffractionSpec pattern | `hydrodynamics/diffraction/input_schemas.py` | Pydantic spec pattern to follow |
| AQWA runner | `hydrodynamics/aqwa/aqwa_router.py` | AQWA execution orchestration |
| AQWA .dat parser | `hydrodynamics/diffraction/aqwa_lis_parser.py` | AQWA output parsing |
| Benchmark framework | `hydrodynamics/diffraction/benchmark_runner.py` | Report generation pattern |
| Report generator | WRK-130 (once complete) | HTML report template |
| Legal deny list | `.legal-deny-list.yaml` | Client reference sanitization |
| Excel tool | `G:\ACMA Tool\Passing Ships\PassingShipForceCalculator.xlsm` | Reference implementation (local) |
| Archive projects | `R:\Archive - Drive J\` | ~15 benchmark sources (local) |

### Phase 1 — Extract Excel Tool Logic

- Read `PassingShipForceCalculator.xlsm` worksheets: identify formulas, input cells, output ranges
- Document the force model: expected to be Flory (2002) or Wang (1975) passing ship interaction theory
- Key equations to extract:
  - Surge force: F_x(t) as function of ship speed, separation, vessel dimensions, water depth
  - Sway force: F_y(t) — lateral suction/repulsion
  - Yaw moment: M_z(t) — bow-in/bow-out turning
  - Time history shape: typically bell-curve or double-peak as passing ship traverses
- Implement in `passing_ship/force_model.py`:
  - `compute_passing_forces(moored_vessel, passing_ship, track, environment) -> ForceTimeHistory`
  - Return: time series of [Fx, Fy, Mz] at specified time steps
- Validate against Excel tool: same inputs → same outputs (within 0.1%)
- **VBA contingency**: If logic resides in VBA macros (not cell formulas), use `openpyxl` for cell formulas + manual VBA inspection. If VBA is too complex, use the Excel tool as a black-box validator: run N test cases via `xlwings`, capture outputs, validate Python implementation against those outputs.
- Create 1 synthetic regression test case (not from client data) that can run in CI without archive access

### Phase 2 — PassingShipSpec Pydantic Schema

Create `passing_ship/schema.py`:

```
PassingShipSpec:
  moored_vessel:
    hull: {LOA, beam, draft, displacement, Cb}
    mooring: {lines: [{type, length, pretension, fairlead_pos, anchor_pos}]}
    loading_condition: {draft, trim, GM}
    rao_source: {type: file|catalog, path: str}
  passing_ship:
    type: {tanker|container|bulk|LNG}
    dimensions: {LOA, beam, draft, displacement, Cb}
    track:
      speed: float (knots)
      separation: float (m, CL-to-CL)
      angle: float (deg, 0=parallel, 90=perpendicular)
      closest_approach_offset: float (m, longitudinal)
  environment:
    water_depth: float (m)
    wind: {speed, direction} | null
    current: {speed, direction} | null
    wave: {Hs, Tp, gamma, direction} | null
  analysis_matrix:
    cases: [{name, wind: bool, passing: bool, speed, separation, angle}]
  output:
    line_tensions: bool
    vessel_motions: bool
    fender_loads: bool
    force_time_histories: bool
```

- Validate with Pydantic: required fields, value ranges (speed > 0, separation > 0)
- YAML format: `spec.yml` in each analysis directory

### Phase 3 — Mooring Response Analysis

- `passing_ship/mooring_analysis.py`:
  - Load moored vessel OrcaFlex model (from spec or pre-built .yml)
  - Apply passing ship force time history as external loads (surge, sway, yaw)
  - Run time-domain analysis via OrcaFlex (preferred) or AQWA
  - Extract results: line tensions, vessel motions, fender loads
- OrcaFlex integration path:
  - Create `ExternallyCalculatedForce` or apply via `TimeHistory` data on vessel
  - Alternatively: generate force .csv, reference from OrcaFlex model
- AQWA integration path:
  - Apply forces via AQWA deck input (time-varying external force cards)
  - Run AQWA drift analysis with mooring

### Phase 4 — Parametric Study Engine

- `passing_ship/parametric.py`:
  - Read `analysis_matrix` from spec
  - Generate case combinations: speed × separation × wind × angle
  - Run each case (reuse base model, vary force time history + environment)
  - Collect results into structured output
- Case naming convention: `{speed}kn_{sep}m_{angle}deg_{wind_status}`
- Parallel execution support: independent cases can run concurrently

### Phase 5 — Benchmark Against Historical Projects

- Select 5-7 projects from `R:\Archive - Drive J\` covering:
  - 1+ perpendicular passing
  - 1+ parallel passing
  - 1+ wind + passing combined
  - 1+ port/dock berth
  - 1+ open water / VLCC terminal
  - Speed range: 2-5 knots
- For each:
  1. Extract original inputs (vessel data, mooring, passing ship params, environment)
  2. Sanitize per `.legal-deny-list.yaml` — replace all client/project names
  3. Create `spec.yml` in `docs/modules/orcaflex/passing_ship/<benchmark_name>/`
  4. Run through Python pipeline
  5. Compare: line tensions within 5%, vessel motions within 10%
- Store benchmark results in `benchmark_output/passing_ship/`

### Phase 6 — Reporting

- `passing_ship/report_generator.py`:
  - Single-page HTML report per analysis case (follows WRK-129/130 convention)
  - Sections: input summary, force time history plots, line tension envelopes, vessel motion time histories, fender load summary, parametric comparison table
  - Plotly interactive plots: force vs time, tension vs time per line group
  - Pass/fail design check annotations (MBL utilization, motion exceedance)
- Summary report for parametric study: matrix of cases × peak values

### Test Strategy

- **Unit tests** (no solver): force model against known analytical/Excel outputs, schema validation, parametric case generation
- **Integration tests** (AQWA license): single passing case end-to-end, mooring response convergence
- **Benchmark tests** (archive access): 5-7 historical reproductions, tolerance: tension 5%, motions 10%
- **Synthetic regression**: 1 non-client test case permanently in repo for CI

---
*Source: passing ship analysis for moored vessels. Resources: G:\ACMA Tool\Passing Ships; R:\Archive - Drive J (15+ past projects)*
