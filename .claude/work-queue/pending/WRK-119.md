---
id: WRK-119
title: "Test suite optimization — tiered test profiles for commit, task, and session workflows"
status: pending
priority: high
complexity: complex
created_at: 2026-02-11T00:00:00Z
target_repos:
  - workspace-hub
  - worldenergydata
  - digitalmodel
commit:
spec_ref:
related: []
blocked_by: []
synced_to: []
plan_reviewed: false
plan_approved: false
percent_complete: 0
brochure_status:
---

# Test Suite Optimization — Tiered Test Profiles

## What
Speed up test execution across all repositories by designing tiered test profiles matched to workflow context. Instead of running the full test suite every time, define scoped test sets for three workflows: (1) pre-commit — fast, focused on changed files; (2) per-task — moderate, covers the module being worked on; (3) per-session — comprehensive, full regression before pushing or ending a session.

## Why
Current test runs are slow and one-size-fits-all. Running 762+ tests on every commit wastes time and discourages frequent testing. A tiered approach gives fast feedback when it matters most (commits) while preserving full coverage at session boundaries. This also addresses the `--noconftest` workaround and broken venv issues that make test invocation inconsistent across repos.

## Acceptance Criteria

### Audit & Baseline
- [ ] Benchmark current test suite run times for worldenergydata, digitalmodel, and assetutilities
- [ ] Identify slowest tests (>1s each) and categorize: unit, integration, data-dependent, LFS-dependent
- [ ] Document current test invocation pain points (broken venv, noconftest, PYTHONPATH, conftest deprecation)

### Tier 1: Pre-Commit Profile (~5-10s target)
- [ ] Run only tests for files changed in the current commit (git diff --cached based)
- [ ] Map changed source files to their test files (convention-based + explicit mapping)
- [ ] Skip data-dependent and LFS-dependent tests
- [ ] Integrate as optional pre-commit hook (fast enough to not annoy)
- [ ] Script: `scripts/test/test-commit.sh` — auto-detects changed files, runs matching tests

### Tier 2: Per-Task Profile (~30-60s target)
- [ ] Run all tests for the module(s) being worked on (e.g., `bsee/`, `hse/`, `dynacard/`)
- [ ] Include unit + integration tests for the module
- [ ] Skip unrelated modules entirely
- [ ] Script: `scripts/test/test-task.sh <module>` — accepts module name or auto-detects from WRK item

### Tier 3: Per-Session Profile (full suite)
- [ ] Run complete test suite across target repos
- [ ] Include all test types: unit, integration, data-dependent (where data available)
- [ ] Generate coverage report
- [ ] Script: `scripts/test/test-session.sh` — full regression, suitable for end-of-session or pre-push

### Cross-Repo Infrastructure
- [ ] Standardize test invocation across repos (consistent PYTHONPATH, conftest handling)
- [ ] Fix or replace broken venv setup (system python3 with proper path config)
- [ ] Create shared pytest configuration (markers, fixtures, timeouts)
- [ ] Document test infrastructure in `docs/testing/README.md`

---
*Source: add to speed up the git test suites for all repositories. come up with test suite suitable for various workflows i.e. for commit, for given task, for a given session.*
