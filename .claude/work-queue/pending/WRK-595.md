---
id: WRK-595
title: "feat(orcaflex): rewrite enrichment pipeline — worldenergydata-first, all stages on acma-ansys05"
status: pending
priority: high
complexity: medium
compound: false
created_at: 2026-02-25T00:00:00Z
target_repos:
  - workspace-hub
  - digitalmodel
commit:
spec_ref:
  - scripts/data/orcaflex/enrich-and-clean.py
  - scripts/data/orcaflex/dat-to-yaml.py
related:
  - WRK-589
  - WRK-593
  - WRK-594
blocked_by:
  - WRK-593
  - WRK-594
synced_to: []
plan_reviewed: false
plan_approved: false
percent_complete: 0
brochure_status: n/a
computer: acma-ansys05
---

# feat(orcaflex): Rewrite Enrichment Pipeline — worldenergydata-First

## What

Replace the blind string-anonymization approach in `anonymize-import.py`
with an enrichment-first design. All 3 pipeline stages now run on
acma-ansys05 (same ecosystem: OrcaFlex + worldenergydata + repo access).

### Revised Pipeline (all on acma-ansys05)

```
Stage 1: .dat + OrcFxAPI → extract raw model params
Stage 2: raw params + worldenergydata lookups → enriched YAML
          → client_projects/data/raw/orcaflex-extracted/ (with client names)
Stage 3: enriched YAML → strip client-identifying names → legal scan
          → digitalmodel/data/orcaflex/ (clean, enriched fixtures)
```

## Revised Anonymization Logic

### Old approach (WRONG)
Replace all string fields with generic labels:
```yaml
lines:
- name: Obj1          # was "Drilling Riser Section 1" — lost all context
  OD: 0.5334
```

### New approach — Enrich, then strip name
```yaml
lines:
- component_type: marine_drilling_riser_joint
  nps_in: 21.0
  od_m: 0.5334
  wt_m: 0.025
  length_m: 15.24         # 50ft — confirmed standard length
  public_match:
    manufacturer_class: marine_drilling_riser
    grade_range: [G105, S135]
    api_standard: API-STD-16F
    source: worldenergydata.vessel_fleet.DrillingRiserLoader
  dat_properties:          # numeric props from .dat — unchanged
    Length: [15.24, 15.24, 15.24]
    OD: [0.5334]
    WallThickness: [0.025]
    CDt: 0.01
    CDn: 1.0
  # name field: STRIPPED (client-specific, not needed with public enrichment)
```

### Vessel enrichment (using DrillingRigEntry)
```yaml
vessels:
- vessel_class: drillship
  generation: ultra_deepwater           # from public rig fleet data
  water_depth_rating_m: 3658            # from BSEE rig fleet
  dp_class: DP3                         # from public classification
  public_source: worldenergydata.vessel_fleet.DrillingRigEntry
  dat_properties:
    InitialX: 0.0
    InitialY: 0.0
    InitialZ: 0.0
  # name: STRIPPED — replaced with classification data above
```

## New Script: enrich-and-clean.py

Replaces `anonymize-import.py`. Runs on acma-ansys05:

```bash
python scripts\data\orcaflex\enrich-and-clean.py \
    --input client_projects\data\raw\orcaflex-extracted\ \
    --output digitalmodel\data\orcaflex\ \
    --vessel-db worldenergydata\data\modules\vessel_fleet\curated\ \
    --pipe-schedule worldenergydata\data\modules\pipeline\api_5l_pipe_schedule.csv \
    --dry-run
```

### Enrichment priority order
1. **Line OD match**: `PipelineSpecLookup.match_od_wt(od_m, wt_m)` → NPS, schedule, grade_range
2. **Riser joint match**: `DrillingRiserLoader.query_by_od(od_in)` → manufacturer class, standard
3. **Vessel lookup**: `DrillingRigEntry` from BSEE rig fleet by approximate water depth + type
4. **Fallback**: retain all numeric data, set `component_type: unknown`

## Steps

1. Create `scripts/data/orcaflex/enrich-and-clean.py` with enrichment logic
2. Update `dat-to-yaml.py` to pass project context to enrichment step
3. Update `scripts/data/orcaflex/README.md` to reflect all-acma-ansys05 pipeline
4. Archive `anonymize-import.py` (replace with enrich-and-clean.py)
5. Add section to SKILL.md for worldenergydata lookup pattern

## Acceptance Criteria

- [ ] `enrich-and-clean.py` matches 21" OD → `component_type: marine_drilling_riser_joint`
- [ ] Vessel objects enriched with rig_class + water_depth_rating_m from worldenergydata
- [ ] All client-name string fields stripped; all numeric fields preserved
- [ ] `_enrich_log.yaml` per file showing lookups performed and matches found
- [ ] Legal scan passes on output
- [ ] One drilling riser + one wellhead fixture committed to digitalmodel/data/orcaflex/
