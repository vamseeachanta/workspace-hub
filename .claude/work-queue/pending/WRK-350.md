---
id: WRK-350
title: Fix pre-existing test failures in assetutilities
status: done
priority: medium
complexity: medium
compound: false
created_at: 2026-02-23T00:00:00Z
target_repos:
  - assetutilities
commit:
spec_ref:
related: [WRK-344, WRK-345]
blocked_by: []
synced_to: []
plan_ensemble: false
ensemble_consensus_score: null
plan_reviewed: false
plan_approved: false
percent_complete: 85
brochure_status: n/a
computer: ace-linux-1
---

# Fix pre-existing test failures in assetutilities

## What
50 collection errors across the assetutilities test suite prevent any test from
running. All failures occur at import/collection time — zero tests execute. This
must be resolved before downstream repos (digitalmodel, worldenergydata, assethold)
can use pytest as a quality gate against assetutilities changes.

## Failure Summary

| Module / Directory              | Error count |
|---------------------------------|
-------------|
| tests/unit/                     | 17          |
| tests/modules/visualization/    | 14          |
| tests/modules/excel_utilities/  | 6           |
| tests/modules/file_management/  | 3           |
| tests/modules/file_edit/        | 3           |
| tests/modules/word_utilities/   | 2           |
| tests/modules/yml_utilities/    | 5           |
| **Total**                       | **50**      |

## Root Cause Categories

### 1. Missing `pythonpath = src` in pytest.ini (17 errors — all of tests/unit/)
`pytest.ini` has no `pythonpath` directive. The package lives under `src/` but
pytest does not add `src/` to `sys.path`, so every unit test that does
`from assetutilities.units import ...` fails with:

    ModuleNotFoundError: No module named 'assetutilities.units'

Fix: add `pythonpath = src` to `[pytest]` block in `pytest.ini`.

### 2. Missing `test_utils` helper on sys.path (24 errors — visualization + modules)
Many test modules import a local `test_utils` helper
(`from test_utils import get_test_file_path`). The helper exists inside a tests
sub-directory but is never on `sys.path` when pytest runs from the repo root.

Fix: add the relevant `tests/` sub-directory to `pythonpath`, or convert
`test_utils` to a proper `conftest.py` fixture or shared package under
`tests/helpers/`.

### 3. Missing optional dependencies (6 errors — excel_utilities)
`excel2img` and `assetutilities.modules.excel_utilities.excel_utilities_parallel`
are not installed in the active environment:

    ModuleNotFoundError: No module named 'excel2img'
    ModuleNotFoundError: No module named '...excel_utilities_parallel'

Fix: mark these tests with `@pytest.mark.skipif` when the optional dep is absent,
or add `excel2img` to the dev-extras in `pyproject.toml`.

### 4. Fixture-path assumptions / FileNotFoundError (4 errors — yml_utilities)
Tests reference input files via paths relative to a presumed working directory
that differs from the pytest root:

    FileNotFoundError: Input file tests/ not found ... FAIL

Fix: replace hard-coded relative paths with `Path(__file__).parent / ...`
anchored to the test file location.

## Why Fix Now
assetutilities is the shared dependency for digitalmodel, worldenergydata, and
assethold. Pre-existing failures prevent agents from using pytest as a quality
gate in these repos. WRK-344 flagged this during tier-1 consistency review.

## Acceptance Criteria
- [ ] `pytest tests/ --noconftest -q` runs with 0 collection errors
- [ ] pytest passes with >80% coverage across all modules
- [ ] No import errors in core modules (common, units, modules)
- [ ] CI-friendly: no fixture-path assumptions (all paths anchored to __file__)
- [ ] Optional-dep tests skip gracefully when deps absent (not error)
