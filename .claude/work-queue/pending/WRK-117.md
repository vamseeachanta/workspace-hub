---
id: WRK-117
title: "Refine and coarsen hull panel meshes for mesh convergence sensitivity analysis"
status: pending
priority: medium
complexity: complex
compound: false
created_at: 2026-02-10T22:15:00Z
target_repos:
  - digitalmodel
commit:
spec_ref:
related: [WRK-114, WRK-116, WRK-031]
blocked_by: []
synced_to: []
plan: inline
plan_reviewed: true
plan_approved: true
percent_complete: 0
brochure_status:
tags: [hull-library, mesh-refinement, convergence, hydrodynamics, panel-mesh, sensitivity]
---

# Refine and Coarsen Hull Panel Meshes for Mesh Convergence Sensitivity

## What
Build mesh refinement and coarsening tools that take a cataloged hull panel mesh and produce finer or coarser versions for mesh convergence studies in hydrodynamic diffraction analysis. Generate a family of meshes (e.g., coarse/medium/fine/very-fine) from a single source hull to systematically test sensitivity of RAO results to panel density.

## Why
Mesh convergence is a fundamental quality check in any panel-method diffraction analysis. Analysts need to demonstrate that results (added mass, damping, RAOs) are insensitive to further mesh refinement. Currently this requires manual re-meshing in external tools. Automating refinement/coarsening within the hull library enables systematic convergence studies directly from the catalog, feeding into solver benchmarking (WRK-031).

## Acceptance Criteria
- [ ] Mesh refinement: subdivide each quad panel into 4 (or 9) sub-panels with interpolated vertices
- [ ] Mesh coarsening: merge adjacent panels to reduce panel count while preserving hull shape
- [ ] Generate mesh family from single source (e.g., 0.25x, 0.5x, 1x, 2x, 4x panel density)
- [ ] Preserve hull geometry fidelity: coarsened mesh stays within tolerance of original surface
- [ ] Output each mesh variant as GDF file with descriptive naming (e.g., hull_name_coarse_500p.gdf)
- [ ] Mesh quality metrics: aspect ratio, skewness, min/max panel area per variant
- [ ] Convergence report template: table of mesh variants with panel count and key results columns
- [ ] Tests covering refinement, coarsening, quality metrics, and GDF output

## Plan

**Target**: `src/digitalmodel/hydrodynamics/hull_library/mesh_refiner.py` (new) + convergence study script

### Existing Assets (reuse)
- `src/digitalmodel/hydrodynamics/hull_library/mesh_generator.py` — GDF mesh generation, PanelMesh handling
- `src/digitalmodel/hydrodynamics/hull_library/coarsen_mesh.py` — existing vertex clustering coarsener (249 lines, feature-preserving)
- `src/digitalmodel/hydrodynamics/hull_library/mesh_scaler.py` (WRK-116) — mesh manipulation patterns
- `src/digitalmodel/hydrodynamics/bemrosetta/models/mesh_models.py` — PanelMesh, MeshFormat
- `data/hull_library/panels/` — source meshes for refinement
- `scripts/mesh_sensitivity_riser.py` — existing convergence study pattern (riser domain)
- Benchmark solvers: OrcaWave + AQWA backends in `hydrodynamics/diffraction/`

### Phase 1 — Mesh Refinement
- Quad subdivision: split each quad panel into 4 sub-quads (midpoint insertion)
- For triangular panels: split into 4 sub-triangles (edge midpoints)
- Iterative: apply N times for 4^N panel multiplier (1x→4x→16x→64x)
- Preserve hull surface: interpolate new vertices on original surface (not just flat subdivision)
- Handle mixed quad/tri meshes gracefully

### Phase 2 — Mesh Coarsening (reuse existing)
- **NOTE**: `coarsen_mesh.py` already implements vertex clustering with feature-preserving subdivision
- Wrap existing `coarsen_mesh()` function for the mesh family API
- Additional coarsening strategies only if existing vertex clustering is insufficient:
  - Panel merging: identify adjacent coplanar panels → merge (complex topology work)
  - Fallback: VTK `vtkQuadricClustering` via PyVista (optional dependency)

### Phase 3 — Mesh Family Generation
- `generate_mesh_family(source_mesh, factors=[0.25, 0.5, 1.0, 2.0, 4.0]) → list[PanelMesh]`
- factor < 1.0: coarsen; factor > 1.0: refine; factor = 1.0: original
- Output naming: `{hull_name}_{panel_count}p.gdf` (e.g., `barge_500p.gdf`, `barge_2000p.gdf`)
- Each mesh includes quality metrics: panel count, min/max/mean area, aspect ratio stats

### Phase 4 — Convergence Study Script
- `scripts/mesh_convergence_hull.py` — runs diffraction analysis on mesh family
- For each mesh variant: run OrcaWave → extract RAOs, added mass, damping
- Convergence metric: relative change in RAO peak between successive refinements
- Convergence criterion: <2% change in key DOF RAO peaks between levels
- Output: `benchmark_output/mesh_convergence/{hull_name}/convergence_report.html`
- Report: table (panel_count × DOF × metric) + convergence plots

### Phase 5 — Tests
- Unit: refine single quad → verify 4 sub-quads with correct vertices
- Unit: coarsen 4 coplanar quads → verify merged to 1
- Integration: generate family for benchmark barge → verify panel counts match expected
- Mesh quality: verify no degenerate panels, normals consistent across all family members

---
*Source: "refine or coarse panel mesh for hydrodynamic analysis to perform sensitivity on mesh convergence"*
