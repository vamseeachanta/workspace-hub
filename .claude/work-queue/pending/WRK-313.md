---
id: WRK-313
title: "feat: new-machine setup guide + bootstrap script — statusline, CLI parity, cron jobs"
status: done
priority: high
created: 2026-02-23
completed: 2026-02-24
percent_complete: 100
tags: [setup, cross-machine, onboarding, cron, statusline, cli, devex, architecture]
computer: any
blocked_by: []
---

## Problem

There is no single authoritative source for setting up a new machine in the
workspace-hub ecosystem. Onboarding requires tribal knowledge: install Claude
CLI, configure statusline, wire cron jobs, set shell defaults. This means:

- New machines start with inconsistent experience vs existing ones
- After a rebuild/reinstall, muscle memory is lost restoring the setup
- Ecosystem improvements (lean hooks WRK-308, Stop hook cleanup WRK-304) don't
  have an onboarding path — new machines miss them silently

## Goal

A single command bootstraps a new machine to full workspace-hub parity:

```bash
bash scripts/setup/new-machine-setup.sh
```

Plus a living reference doc at `.claude/docs/new-machine-setup.md` that
captures every architectural decision for manual review/customisation.

## Scope

### a) Git Hooks (WRK-312)
- Run `scripts/setup/install-all-hooks.sh` (blocks on WRK-312)
- Wires `post-merge` self-updater so subsequent pulls stay current

### b) Statusline
- Install Claude Code statusline: `claude config set statusBarEnabled true`
  (or equivalent settings.json entry)
- Confirm terminal supports it (iTerm2 / Windows Terminal / Warp)
- Document statusline config location and toggle command

### c) CLI Parity — Linux terminal + Windows Git Bash (MINGW64)
- Shared shell aliases: `~/.bashrc` / `~/.bash_profile` snippets
  - `alias ws='cd /mnt/local-analysis/workspace-hub'` (Linux)
  - `alias ws='cd D:/workspace-hub'` (Windows)
  - `alias wrk='bash scripts/work-queue/queue-status.sh'`
- Shell prompt: show active WRK item + git branch
- Claude CLI start location: configure default working directory
- PATH entries: ensure `claude`, `codex`, `gemini` CLIs are on PATH
- Windows-specific: confirm MINGW64 is used (not PowerShell), LF line endings

### d) Cron Jobs (ace-linux-1 primary; other machines: session-end commit only)
- `comprehensive-learning-nightly.sh` — 22:00 nightly (ace-linux-1 only)
- `session-end commit` — post-session git add/commit/push for state files
- SSH key auth for rsync between machines (ace-linux-1 pulls from others)
- Crontab template committed to `scripts/cron/crontab-template.sh`

### e) Environment variables / secrets
- `.env.example` listing required vars (API keys, SSH agent, etc.)
- Validate presence check on session start (readiness.sh R8 already checks tools)

### f) One-time setup validation
- `scripts/setup/verify-setup.sh` — runs all readiness checks and reports
  what's missing vs expected for a fully configured machine

## Deliverables

| File | Purpose |
|------|---------|
| `scripts/setup/new-machine-setup.sh` | Master bootstrap script |
| `scripts/setup/install-all-hooks.sh` | Git hooks (from WRK-312) |
| `scripts/setup/verify-setup.sh` | Post-setup validation |
| `scripts/cron/crontab-template.sh` | Crontab entries per machine role |
| `.claude/docs/new-machine-setup.md` | Living reference doc |
| `config/shell/bashrc-snippets.sh` | Shared shell aliases + prompt |

## Acceptance Criteria

- [ ] `new-machine-setup.sh` runs end-to-end on a fresh Linux machine (Ubuntu/Debian)
- [ ] `new-machine-setup.sh` runs on Windows MINGW64 (Git Bash)
- [ ] After setup: `verify-setup.sh` reports all checks green
- [ ] Git hooks auto-update on `git pull` (WRK-312 integrated)
- [ ] Statusline enabled and documented
- [ ] CLI start location correct on both platforms
- [ ] Crontab template committed; ace-linux-1 cron confirmed from template
- [ ] Shell aliases for `ws`, `wrk` documented and installable
- [ ] `.claude/docs/new-machine-setup.md` covers manual steps for anything
      that cannot be automated

## Route

Route C — architectural scope, cross-platform, multi-subsystem.
Spec file: `specs/modules/wrk-313-new-machine-setup.md`

## Agentic AI Horizon

As the agent ecosystem grows (more machines, more contributors), onboarding
friction compounds. A robust setup script + validation tool pays dividends on
every new machine and rebuild. Also enables CI-based environment validation.

## Machine Inventory + Network Topology

| Machine | OS | Network | Role |
|---------|-----|---------|------|
| ACMA-ANSYS05 | Windows / MINGW64 | 192.168.0.x (office) | Dev workstation — current machine |
| acma-ws014 | Windows / MINGW64 | 192.168.0.x (office) | Dev workstation — same LAN as ACMA-ANSYS05 |
| ace-linux-1 | Linux | 192.168.1.x (home/lab) | Nightly cron host (comprehensive-learning) |
| ace-linux-2 | Linux | 192.168.1.x (home/lab) | Contributing machine — rsync'd by ace-linux-1 |

**Network separation:** Office (192.168.0.x) and home/lab (192.168.1.x) are isolated.
SSH between networks requires Tailscale or VPN (see config/tabby/).

**Bootstrap status after WRK-312:**

| Machine | Bootstrap needed | Method |
|---------|-----------------|--------|
| ACMA-ANSYS05 | Done (ran this session) | Direct |
| acma-ws014 | Pending — same LAN, SSH not yet configured | Manual: `git pull && bash scripts/setup/install-all-hooks.sh` |
| ace-linux-1 | Pending — different network | Manual on next login |
| ace-linux-2 | Pending — different network | Manual on next login |

SSH setup between office machines (ACMA-ANSYS05 ↔ acma-ws014) is part of WRK-313 scope.

## Related

- WRK-312: git hooks cross-machine sync (hard dependency)
- WRK-308: lean pre-commit (content of canonical pre-commit hook)
- WRK-304: Stop hook cleanup (already committed; setup.sh verifies)
- `.claude/docs/new-machine-setup.md`: living reference (to be created)
- `config/tabby/`: Tailscale/SSH config for cross-network access
