---
id: WRK-154
title: "CI workflow rewrite — fix 2 GitHub Actions workflows"
status: pending
priority: high
complexity: medium
created_at: 2026-02-16T00:00:00Z
target_repos:
  - workspace-hub
target_module:
commit:
spec_ref:
related: [WRK-086]
blocked_by: []
plan: inline
plan_reviewed: true
plan_approved: true
percent_complete: 0
brochure_status: n/a
provider: codex
provider_alt:
task_agents:
  phase_1: codex    # Audit & test
  phase_2: codex    # Fix baseline-check.yml
  phase_3: codex    # Fix multi-ai-review.yml
  phase_4: codex    # Verify & document
---

# CI Workflow Rewrite

## What
Fix 2 existing GitHub Actions workflows for the Python/bash workspace. Audit found only 2 workflows (not 4 as originally estimated): `baseline-check.yml` (4.5 KB, push/PR trigger) and `multi-ai-review.yml` (6.7 KB, PR trigger). Both are syntactically enabled but untested. WRK-086 was planned but never executed. CI is functionally non-operational.

## Why
- Zero automated checks on any push or PR
- No coverage reporting, no linting, no baseline verification
- Blocks quality assurance for all repos

## Acceptance Criteria
- [ ] baseline-check.yml rewritten for Python/bash (not JS)
- [ ] multi-ai-review.yml assessed — rewrite or remove
- [ ] At least 1 workflow triggers on push to main
- [ ] All enabled workflows pass on current main

## Notes
- Original WRK-086 plan available in archive (cross-reviewed 2026-02-09)
- Current workflows are JS-era artifacts from before Python migration
- Consider: workflow scope needed on OAuth token to push workflow changes

## Plan

**Target**: `.github/workflows/` in workspace-hub

### Current State (from audit)
- 2 workflows exist (not 4 as originally estimated)
- `baseline-check.yml`: triggers on push (main, feature/*), PR to main, workflow_dispatch
- `multi-ai-review.yml`: triggers on PR to main, workflow_dispatch
- Both are syntactically enabled but may fail on execution (untested)

### Phase 1 — Audit & Test
- Trigger each workflow manually via `gh workflow run`
- Capture and diagnose failures
- Check: Python version, dependency installation, test command, PYTHONPATH
- Check: AI review scripts exist and are executable

### Phase 2 — Fix baseline-check.yml
- Ensure Python 3.12 setup
- Fix dependency installation (no uv — use pip or system packages)
- Fix test command: `PYTHONPATH="src:../assetutilities/src" python3 -m pytest tests/ -v --tb=short --noconftest`
- Add tiered test execution (commit/task/session per manual input)
- Verify workflow passes on current main

### Phase 3 — Fix multi-ai-review.yml
- Verify `scripts/review/` scripts exist and work
- Check: codex, gemini CLI availability in GitHub Actions runner
- If AI CLIs not available in CI: convert to workflow_dispatch manual trigger only
- Assess: keep, rewrite, or remove based on practical value

### Phase 4 — Verify & Document
- Both workflows pass on main branch
- Document trigger conditions and manual dispatch options
- Add workflow status badges to README if desired

### Test Strategy
- Use `gh workflow run` for manual testing
- Check `gh run list` for status
- OAuth token needs `workflow` scope to push workflow changes

### Dependencies
- GitHub Actions runner (ubuntu-latest)
- `workflow` scope on OAuth token (known limitation from memory)
