---
id: WRK-599
title: "feat(productivity): modular daily report section scripts"
status: done
priority: medium
complexity: medium
compound: false
created_at: 2026-02-25T00:00:00Z
target_repos:
  - workspace-hub
commit: eae09ba
spec_ref:
  - scripts/productivity/daily_today.sh
  - scripts/productivity/sections/
related:
  - WRK-253
blocked_by: []
synced_to: []
plan_reviewed: true
plan_approved: true
percent_complete: 100
brochure_status: n/a
completed_at: 2026-02-25
computer: [ace-linux-1, ace-linux-2]
---

# feat(productivity): Modular Daily Report Section Scripts

## What

Refactored `scripts/productivity/daily_today.sh` from a monolithic 370-line
script into a thin orchestrator that delegates to independent section scripts
in `scripts/productivity/sections/`.

## Section Scripts (all in `scripts/productivity/sections/`)

| Script | Description |
|--------|-------------|
| `summary-header.sh` | Compact top-of-report table: work queue totals, machine load, AI usage %, active WRK, dirty repos |
| `ai-usage-summary.sh` | Weekly usage remaining (bar + %) → tool versions → active sessions → models in use |
| `wrk-health.sh` | Pipeline → Machine Load (with orcaflex-license-machine alias) → In Progress → Priority/Complexity |
| `session-analysis.sh` | Latest session-analysis report, signal coverage, top skills, history |
| `data-health.sh` | Tier-1 repo git status, test file counts, document index freshness, data-source spec list |
| `git-summary.sh` | Yesterday's commits with `timeout 8` guard (digitalmodel 4.2 GB pack files) |
| `branch-status.sh` | Active branches across tier-1 repos |
| `suggestions.sh` | Auto-suggestions from work queue state and daily log history |

## Key Design Decisions

- `set -euo pipefail` on all scripts; `|| true` guards on pipelines inside `$(...)`
- AI quota reads `~/.cache/agent-quota.json` (≤2h fresh) → fallback to `config/ai-tools/agent-quota-latest.json`
- Both quota formats handled: `week_pct` (% used) and `pct_remaining` (% remaining)
- YAML inline comments stripped before `int()` in skill-scores.yaml parser
- Machine load normalises `orcaflex-license-machine` → `acma-ansys05`
- All machines shown even if count is 0 (WRK-599 fix)
- `timeout 8` on all `git log` calls to guard against slow repos

## Invocation

```bash
# Daily log (auto-detect morning/midday/evening)
bash scripts/productivity/daily_today.sh

# Weekly
bash scripts/productivity/daily_today.sh --week

# Interactive (opens claude --resume at end)
bash scripts/productivity/daily_today.sh --interactive

# Run a single section directly
bash scripts/productivity/sections/summary-header.sh /mnt/local-analysis/workspace-hub
```

## Acceptance Criteria

- [x] Modular architecture — each section independently executable
- [x] summary-header.sh — compact 4-row table at top of log
- [x] data-health.sh — tier-1 repo status table
- [x] ai-usage-summary.sh — weekly usage remaining first, bar graph
- [x] wrk-health.sh — pipeline first, orcaflex alias merged
- [x] session-analysis.sh — pipefail guard + YAML comment stripping
- [x] git-summary.sh — timeout 8 on all git log calls
- [x] daily_today.sh — thin orchestrator, all 8 sections wired
- [x] All machines shown in machine load (even if count = 0)

## Replication on Another Machine

```bash
# All scripts are in workspace-hub repo — just sync the repo:
git pull origin main

# Ensure sections are executable:
chmod +x scripts/productivity/sections/*.sh
chmod +x scripts/productivity/daily_today.sh

# Run:
bash scripts/productivity/daily_today.sh
```

No external dependencies beyond standard bash + python3. Quota data is
optional — sections degrade gracefully when files are absent.
