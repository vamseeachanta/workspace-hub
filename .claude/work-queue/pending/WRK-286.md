---
id: WRK-286
title: "Harden chore: commits — require WRK ref for multi-file changes"
status: pending
priority: medium
complexity: simple
compound: false
created_at: 2026-02-21T00:00:00Z
target_repos:
  - workspace-hub
related: [WRK-285]
blocked_by: []
---

# Harden chore: commits — require WRK ref for multi-file changes

## What

`check-commit-msg.sh` fully exempts `chore:` commits from WRK-NNN enforcement.
This allows multi-file harness/ecosystem work to bypass the WRK gate. This
session committed CLAUDE.md, MEMORY.md, AGENTS.md, CRLF fixes, and submodule
updates all under `chore:` without any WRK item.

## Plan (Route A)

Modify `check-commit-msg.sh`:
- `chore:` with ≤ 3 files changed → still exempt (single-touch housekeeping)
- `chore:` with > 3 files changed and no WRK-NNN → warn (non-blocking)
- Add note in AGENTS.md Policies bullet clarifying `chore:` scope

Use `git diff --cached --name-only | wc -l` to count staged files.

## Acceptance Criteria

- [ ] Single-file `chore:` commits pass without WRK ref
- [ ] Multi-file (>3) `chore:` commits without WRK ref print a non-blocking warning
- [ ] Multi-file `chore:` commits WITH WRK ref pass silently
- [ ] Existing `feat/fix/refactor` blocking behaviour unchanged
- [ ] Warning message points to `.claude/work-queue/pending/`

## Implementation Notes

Threshold of 3 files covers: single submodule pointer update, single config
tweak + its test, or a two-file rename. Anything broader is tracked work.

## Session Notes (2026-02-21)

**Motivating example from this session**: a 7-file `chore:` commit touched CLAUDE.md,
MEMORY.md, AGENTS.md, .gitmodules, suggest-future-work.sh, and 3 TSV data files — all
under a single `chore:` subject with no WRK-NNN ref. `check-commit-msg.sh` passed it
silently. This is exactly the class of commit this WRK is designed to catch.

**Threshold rationale**: ≤ 3 files comfortably exempts routine pointer bumps (1 file),
config-plus-test pairs (2 files), and two-file renames (2 files). Anything reaching 4+
files almost always represents tracked work. Non-blocking warn (not block) keeps the
gate from being disruptive during emergencies.
