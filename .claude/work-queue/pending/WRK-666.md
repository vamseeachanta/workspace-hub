---
id: WRK-666
title: "feat(workspace-hub): WhatsApp → WRK capture pipeline — monitor number/channel and auto-create work items"
status: pending
route: B
priority: high
complexity: medium
compound: false
created_at: 2026-03-01T00:00:00Z
target_repos:
  - workspace-hub
commit:
spec_ref:
related:
  - WRK-665
  - WRK-658
blocked_by: []
synced_to: []
plan_reviewed: false
plan_approved: false
percent_complete: 0
brochure_status: n/a
computer: ace-linux-1
execution_workstations: [ace-linux-1]
plan_workstations: [ace-linux-1]
provider: codex
orchestrator: claude
cross_review: pending
---

# feat(workspace-hub): WhatsApp → WRK Capture Pipeline

## What

Build a lightweight listener that monitors a designated WhatsApp number or group
channel and converts incoming messages into WRK items in the repo ecosystem —
the same way `/work add <desc>` does from the CLI.

### Architecture

```
WhatsApp (phone/group) → OpenClaw Narada agent → capture script → WRK-NNN.md
                                                       ↓
                                               git commit + push
                                                       ↓
                                           INDEX.md regenerated
```

The Narada agent (WRK-665) acts as the listener. When a message arrives on the
configured number/channel it is passed to a capture handler that:
1. Classifies the message as a work item (vs. general chat)
2. Extracts title, repo target, and priority hints from the text
3. Calls `scripts/work-queue/next-id.sh` to get the next WRK-NNN
4. Writes the WRK file, commits, and pushes

### Monitored sources

- **Self number**: messages sent to own WhatsApp number (voice-note transcription supported)
- **Dedicated group**: a "Work Capture" WhatsApp group where any member can drop tasks

### Message format (loose — Narada normalises)

```
Plain text:   "Add auth module to aceengineer-website"
Structured:   "WRK: Fix login redirect | repo: aceengineer-website | priority: high"
Voice note:   transcribed via Whisper or OpenAI audio before routing
```

### Components

**1. OpenClaw skill file** (inside the Narada workspace):
```
~/.openclaw/workspace-whatsapp-ai-group/skills/wrk-capture.js
```
- Triggered on every message from the configured source number/group
- Calls `classify_message()` → returns `{is_wrk: bool, title, repo, priority}`
- If `is_wrk`, calls the capture script via `child_process.exec`

**2. Capture script** (in workspace-hub):
```
scripts/work-queue/whatsapp-capture.sh <title> <repo> <priority>
```
- Wraps `next-id.sh` + WRK file creation + `git add/commit/push`
- Writes minimal WRK frontmatter + `## What` from the title
- Logs to `.claude/work-queue/logs/whatsapp-capture.log`

**3. Acknowledgement** (Narada replies to WhatsApp):
```
"✓ Captured as WRK-NNN: <title> (repo: <repo>, priority: <priority>)"
```

**4. Configuration** (`.env` or `openclaw.json` extension):
```
WRK_CAPTURE_SOURCE_NUMBER=+1XXXXXXXXXX   # self or group JID
WRK_CAPTURE_REPO_DEFAULT=workspace-hub
WRK_CAPTURE_PRIORITY_DEFAULT=medium
WRK_REPO_PATH=/mnt/local-analysis/workspace-hub
```

## Plan

### Phase 1 — Capture script (30 min)

Write `scripts/work-queue/whatsapp-capture.sh`:
```bash
#!/usr/bin/env bash
set -euo pipefail
TITLE="$1"; REPO="${2:-workspace-hub}"; PRIORITY="${3:-medium}"
NEXT_ID=$(bash "$(git rev-parse --show-toplevel)/scripts/work-queue/next-id.sh" 2>/dev/null)
# write WRK-NNN.md with minimal frontmatter
# git add + commit + push
# echo "WRK-$NEXT_ID: $TITLE" >> whatsapp-capture.log
```

Test standalone: `bash scripts/work-queue/whatsapp-capture.sh "Test item" workspace-hub medium`

### Phase 2 — OpenClaw skill (45 min)

Create `~/.openclaw/workspace-whatsapp-ai-group/skills/wrk-capture.js` with:
- `classify_message(text)` — returns structured object
- `handle(message)` — orchestrates classify → exec → reply
- Source filter: only process messages from `WRK_CAPTURE_SOURCE_NUMBER`

Register in `~/.openclaw/workspace-whatsapp-ai-group/openclaw.json` under `skills`.

### Phase 3 — End-to-end test (15 min)

1. Start Narada gateway: `cd ~/.openclaw/workspace-whatsapp-ai-group && npm start`
2. Send test message from configured number: "Add dark mode to aceengineer-website"
3. Verify: WRK-NNN.md appears in `pending/`, commit exists, Narada replied with confirmation

### Phase 4 — Hardening (15 min)

- Rate limit: max 10 captures per hour (prevent accidental spam)
- Dedup: if identical title captured in last 24h, reply with existing WRK-NNN instead
- Git conflict guard: pull before commit; retry once on push failure

## Acceptance Criteria

- [ ] `scripts/work-queue/whatsapp-capture.sh` creates a valid WRK file and commits
- [ ] OpenClaw skill classifies messages and routes to capture script
- [ ] Source filter prevents processing messages from unrecognised numbers
- [ ] End-to-end: WhatsApp message → WRK-NNN.md in repo within 10 seconds
- [ ] Narada sends acknowledgement reply with WRK ID
- [ ] Rate limit (10/hr) and dedup (24h) guards in place
- [ ] Capture log at `.claude/work-queue/logs/whatsapp-capture.log`
- [ ] Config documented in `docs/agents/narada-openclaw-setup-guide.md` (WRK-665)
- [ ] Legal scan passes (no secrets in committed files)

## Notes

- Depends on Narada being set up (WRK-665) but WRK-665 completion is not a hard gate —
  the capture script (Phase 1) is standalone and useful even without WhatsApp
- Voice note support: defer to follow-on WRK; text-only for MVP
- `next-id.sh` must be called with git pull first to avoid ID collisions when
  multiple sessions are running concurrently

## Agentic AI Horizon

High fit: Codex writes the shell script and JS skill; Claude reviews for security
(exec injection, source filter bypass). The integration point (OpenClaw skill API)
is well-documented in the Narada guide (WRK-665).
