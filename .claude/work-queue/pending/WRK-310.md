---
id: WRK-310
title: Daily network-mount readiness check — SSHFS mounts always available on both machines
status: pending
priority: high
complexity: low
compound: false
created_at: 2026-02-22T00:00:00Z
target_repos:
  - workspace-hub
commit:
spec_ref:
related:
  - WRK-287
blocked_by: []
synced_to: []
plan_reviewed: false
plan_approved: true
percent_complete: 50
brochure_status: n/a
---

# Daily network-mount readiness check

## What

Deploy `scripts/readiness/check-network-mounts.sh` as a daily cron job on both
`ace-linux-1` and `ace-linux-2` so that SSHFS mounts are verified (and auto-recovered
if stale) every morning before the work day begins.

## Why

SSHFS mounts do not always survive network interruptions or idle timeouts. Without a
daily check, a stale mount is only discovered mid-session, causing confusion. The
readiness check brings machines to a known-good state before work starts.

## Script (already written)

`scripts/readiness/check-network-mounts.sh` — written and tested 2026-02-22.

- ace-linux-1 dry run: `ok=2 recovered=0 failed=0` ✅
- ace-linux-2 dry run: `ok=3 recovered=0 failed=0` ✅

Logic:
1. Detect hostname — load expected mount list for that machine
2. Probe each mount with `ls` + 10s timeout
3. If stale: check SSH reachability of remote first
4. If reachable: `fusermount -u` stale FUSE + `systemctl start <unit>`
5. Re-probe after remount
6. Log JSONL to `.claude/state/session-signals/network-mounts.jsonl`
7. Exit 0 if all OK/recovered; exit 1 if any failed

## Mounts checked

**ace-linux-1** — checks these two remote mounts:
- `/mnt/remote/ace-linux-2/local-analysis`
- `/mnt/remote/ace-linux-2/dde`

**ace-linux-2** — checks these three remote mounts:
- `/mnt/workspace-hub`
- `/mnt/remote/ace-linux-1/local-analysis`
- `/mnt/remote/ace-linux-1/ace`

---

## Manual Steps — Run on Each Machine

### Step 1 — ace-linux-1 (sit at ace-linux-1 terminal)

**1a. Verify the script runs cleanly:**
```bash
sudo bash /mnt/local-analysis/workspace-hub/scripts/readiness/check-network-mounts.sh
# Expected: [2026-XX-XX] ace-linux-1 network-mounts: ok=2 recovered=0 failed=0 total=2
```

**1b. Install the root cron entry:**
```bash
(sudo crontab -l 2>/dev/null; echo "0 7 * * * /mnt/local-analysis/workspace-hub/scripts/readiness/check-network-mounts.sh >> /mnt/local-analysis/workspace-hub/.claude/state/session-signals/network-mounts-cron.log 2>&1") | sudo crontab -
```

**1c. Verify cron was installed:**
```bash
sudo crontab -l
# Expected: 0 7 * * * /mnt/local-analysis/workspace-hub/scripts/readiness/check-network-mounts.sh ...
```

---

### Step 2 — ace-linux-2 (sit at ace-linux-2 terminal or SSH from ace-linux-1)

**2a. Verify the script runs cleanly:**
```bash
sudo bash /mnt/workspace-hub/scripts/readiness/check-network-mounts.sh
# Expected: [2026-XX-XX] ace-linux-2 network-mounts: ok=3 recovered=0 failed=0 total=3
```

**2b. Install the root cron entry:**
```bash
(sudo crontab -l 2>/dev/null; echo "0 7 * * * /mnt/workspace-hub/scripts/readiness/check-network-mounts.sh >> /tmp/network-mounts-cron.log 2>&1") | sudo crontab -
```

**2c. Verify cron was installed:**
```bash
sudo crontab -l
# Expected: 0 7 * * * /mnt/workspace-hub/scripts/readiness/check-network-mounts.sh ...
```

**Note:** ace-linux-2's cron references `/mnt/workspace-hub` (the SSHFS mount itself).
This is fine — at 07:00 the automount triggers on first access, then the script proceeds.

---

### Step 3 — After first scheduled run (next day, ~07:01)

**Check the logs on ace-linux-1:**
```bash
tail -20 /mnt/local-analysis/workspace-hub/.claude/state/session-signals/network-mounts-cron.log
cat /mnt/local-analysis/workspace-hub/.claude/state/session-signals/network-mounts.jsonl | tail -5
```

**Check the log on ace-linux-2:**
```bash
ssh ace-linux-2 'tail -20 /tmp/network-mounts-cron.log'
```

---

## Acceptance Criteria

- [ ] Dry run passes on ace-linux-1 (`ok=2/2`)
- [ ] Dry run passes on ace-linux-2 (`ok=3/3`)
- [ ] Cron installed on ace-linux-1 (`sudo crontab -l` shows entry)
- [ ] Cron installed on ace-linux-2 (`sudo crontab -l` shows entry)
- [ ] JSONL log written after first scheduled run
- [ ] Integrate into comprehensive-learning Phase 1 signals (future)

## Notes

- Script must run as root (needs `systemctl` + `fusermount`)
- Root `/root/.ssh/known_hosts` must contain target host keys (done on both machines 2026-02-22)
- Future: add ntfy/email alert on persistent failure (exit 1)
