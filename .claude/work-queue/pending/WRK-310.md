---
id: WRK-310
title: "explore: OrcFxAPI schematic capture for OrcaWave models (program screenshots)"
status: pending
priority: medium
complexity: medium
compound: false
created_at: 2026-02-23T00:00:00Z
target_repos:
  - digitalmodel
  - workspace-hub
commit:
spec_ref:
related: [WRK-311]
blocked_by: []
synced_to: []
plan_ensemble: false
ensemble_consensus_score: null
plan_reviewed: false
plan_approved: false
percent_complete: 60
brochure_status: n/a
---

# explore: OrcFxAPI schematic capture for OrcaWave models (program screenshots)

## Context

The 3.1 benchmark report now has an interactive Plotly Mesh3d visualization
(body panels + free-surface zone). For human comfort and consistency across
viewers (printed PDFs, slide decks, stakeholders without a browser), static
program-generated screenshots are highly valuable — keeping the view consistent
regardless of how the report is consumed.

OrcaFlex uses `Model.SaveModelView(path, viewParameters)` for programmatic
screenshot capture. OrcaWave uses `OrcFxAPI.Diffraction` which has NO equivalent
`SaveModelView`. This item explores what is actually feasible.

## What to Explore

### 1. OrcFxAPI.Diffraction view-related attributes
- List all attributes/methods of a loaded `Diffraction` object
- Look for any `View`, `Save`, `Screenshot`, `Export`, `Render` methods
- Check OrcFxAPI Python wrapper docs/changelog for recent additions

### 2. OrcaWave COM/DDE interface
- OrcaWave may expose a COM automation interface similar to OrcaFlex
- Test: `win32com.client` → connect to running OrcaWave instance
- Enumerate available methods; test if view capture is supported

### 3. OrcaFlex Model + GDF workaround
- `OrcFxAPI.Model` has `SaveModelView()` and can load GDF body meshes
- Test: load BMC.gdf into OrcaFlex Model → `SaveModelView()` for
  elevation, plan, perspective views → embed resulting images in HTML
- Risk: OrcaFlex model will not have the free-surface zone geometry

### 4. Headless rendering (Pyvista / PyOpenGL)
- If no GUI API exists, evaluate Pyvista for offscreen rendering of GDF/FDF
- Does not require a running OrcaWave/OrcaFlex process

### 5. Subprocess + screenshot automation
- Launch OrcaWave with model file as argument (check command-line API)
- Use `mss` / `pyautogui` to capture the OrcaWave window after it renders
- Fragile but may be the only option if no programmatic API exists

## Output / Deliverables

- Documented findings in `orcaflex-visualization` skill (v1.2.0 bump)
- If any approach works: `save_orcawave_views(owd_path, out_dir)` helper
  added to digitalmodel (new `mesh_capture.py` or extend `benchmark_plotter.py`)
- Images: elevation (front XZ), plan (top XY), perspective (isometric)
- Integration: `build_mesh_schematic_html()` — static images placed ABOVE
  or ALONGSIDE existing Plotly Mesh3d (complementary, not replacing it)

## Acceptance Criteria

- [ ] Approaches 1–5 investigated; findings documented in skill (v1.2.0)
- [ ] At least one working approach demonstrated with actual screenshots
- [ ] Screenshot helper committed to digitalmodel
- [ ] `build_mesh_schematic_html()` updated to embed static images when available
- [ ] Static images match the 3-view layout of Figure 30 in the WAMIT guide

## Findings (2026-02-24 — exploration complete)

### 1. OrcFxAPI.Diffraction — no SaveModelView

`OrcFxAPI.Diffraction` (loads `.owd`/`.owr`) has **no** `SaveModelView`.
OrcaWave files carry the binary header `\x08OrcaWave` and cannot be loaded by
`OrcFxAPI.Model`. This was already documented in the skill at v1.1.0.

### 2. OrcaWave COM interface — implemented in codebase

`src/digitalmodel/workflows/mcp_server/orcawave/api/orcawave_com.py`
wraps `win32com.client` / `OrcaWave.Application` COM. The interface provides
`ImportGeometry`, `RunAnalysis`, `GetAnalysisProgress` etc. No view-export or
screenshot method was found in the COM enumeration — the interface is analysis-
oriented, not GUI-oriented. COM screenshot capture would require calling OrcaWave
with `Visible=True` then falling back to Win32 `PrintWindow` (approach 5).

### 3. Recommended approach — GDF export + Plotly Mesh3d

`OrcFxAPI.Diffraction` exposes two mesh-export methods that work without GUI:
```python
d.SaveSymmetrisedBodyMesh(ofx.PanelMeshSymmetry.XZ, 0.001, "body.gdf")
d.SaveAutoGeneratedFreeSurfacePanelledZoneMesh("freesurface.gdf")
```
Both GDFs can be rendered to a PNG via `gdf_to_mesh3d()` → `go.Figure` →
`fig.write_image()` (requires `kaleido`). This path is fully headless.
`benchmark_plotter.py::build_mesh_schematic_html()` already uses `panelGeometry`
from a live `Diffraction` object for interactive HTML rendering; the static-PNG
path is the natural complement.

### 4. Existing codebase — what was found

| Location | Coverage |
|---|---|
| `scripts/capture_riser_views.py` | Minimal `SaveModelView` for OrcaFlex `.dat` |
| `src/.../orcaflex/opp_visualization.py` | Batch parallel (30 workers) `save_all_views()` |
| `src/.../orcaflex/pipeline_schematic.py` | `OrcaFlexViewCapture` multi-view class |
| `scripts/build_sme_report.py` | `img_to_base64()` HTML embedding helper |
| `scripts/benchmark/validate_owd_vs_spec.py` | `panelGeometry` → 3D scatter in HTML |
| `src/.../diffraction/benchmark_plotter.py` | `build_mesh_schematic_html()` + `_build_panel_mesh3d_html()` |
| `src/.../orcawave/vision/screen_capture.py` | Win32/pyautogui window-capture fallback |
| `src/.../orcawave/api/orcawave_com.py` | COM automation (analysis, not view) |

### 5. Stub implementation committed

`src/digitalmodel/solvers/orcaflex/schematic_capture.py` added:
- `save_orcaflex_views()` — fully operational OrcaFlex 3-view capture
- `gdf_to_mesh3d()` — GDF → Plotly Mesh3d trace helper
- `capture_model_schematic()` — STUB; raises `NotImplementedError` with full
  approach documentation; deferred pending licence-holding validation
- `img_to_base64()` — HTML embedding helper (mirrors `build_sme_report.py`)
- `THREE_VIEW_CAMERAS` — elevation/plan/perspective camera presets

### 6. Remaining work (deferred)

- Validate `SaveSymmetrisedBodyMesh` GDF round-trip in live environment
- Wire `capture_model_schematic()` to `build_mesh_schematic_html()` output
- Add `kaleido` to digitalmodel dev dependencies for `fig.write_image()` PNG export
- Match 3-view layout of Figure 30 (WAMIT guide) with static images

## Notes

- Skill: `workspace-hub/.claude/skills/engineering/marine-offshore/orcaflex-visualization/SKILL.md`
- BMC model files: `docs/modules/orcawave/L00_validation_wamit/3.1/benchmark/`
- OrcaFlex `SaveModelView` reference: `scripts/capture_riser_views.py`
- Stub file: `src/digitalmodel/solvers/orcaflex/schematic_capture.py`
- Related: WRK-311 (QTF chart improvements — separate concern)
