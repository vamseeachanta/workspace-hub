---
id: WRK-026
title: "Unified input data format converter for diffraction solvers (AQWA, OrcaWave, BEMRosetta)"
status: done
priority: high
complexity: complex
compound: true
created_at: 2026-01-29T12:00:00Z
updated_at: 2026-01-31T00:00:00Z
target_repos:
  - digitalmodel
commit:
spec_ref:
related: [WRK-025, WRK-027, WRK-028, WRK-029, WRK-030, WRK-034, WRK-035, WRK-057, WRK-058, WRK-059, WRK-060, WRK-061, WRK-062]
blocked_by: []
synced_to: []
children: [WRK-057, WRK-058, WRK-059, WRK-060, WRK-061, WRK-062, WRK-063]
---

# Unified Input Data Format Converter for Diffraction Solvers

## What
Build a unified input data format converter that can create input files for AQWA, OrcaWave, and BEMRosetta from a common spec definition. Support three output modes:
1. **spec.yml** — canonical specification (solver-agnostic truth)
2. **single-input-file** — monolithic solver-specific input (e.g., AQWA `.dat`, OrcaWave `.yml`)
3. **modular-input-file** — split include-based input (deck files for AQWA, include sections for OrcaWave)

Mesh files should use a common intermediate format interchangeable between programs via BEMRosetta mesh handlers or GMSH scripts.

## Why
Currently each solver has its own input preparation path:
- AQWA: YAML config → deck templates → `.dat` files (via `aqwa_dat_files.py`)
- OrcaWave: YAML config → `.yml` project files (via `orchestrator.py`)
- BEMRosetta: parses output `.LIS` files, not input generation

There is no unified way to define a diffraction analysis once and generate inputs for any solver. This causes duplication, inconsistency, and makes solver benchmarking (WRK-031) difficult. A common spec format with solver-specific backends enables:
- Define once, run anywhere
- Consistent parametric studies across solvers
- Automated benchmarking between AQWA and OrcaWave
- Common mesh format reduces mesh-related errors

## Architecture

```
┌──────────────────────────────────────────────────────────┐
│  spec.yml (Canonical Solver-Agnostic Specification)      │
│  - vessel geometry, mass, inertia                        │
│  - environment (water depth, density)                    │
│  - frequencies, wave headings                            │
│  - solver options, output requests                       │
│  - mesh reference (common format)                        │
└───────────────────────┬──────────────────────────────────┘
                        │
          ┌─────────────┼─────────────┐
          ▼             ▼             ▼
   ┌────────────┐ ┌──────────┐ ┌───────────┐
   │ AQWA       │ │ OrcaWave │ │ BEMRosetta│
   │ Backend    │ │ Backend  │ │ Backend   │
   └─────┬──────┘ └────┬─────┘ └─────┬─────┘
         │              │              │
    ┌────┴────┐   ┌─────┴────┐   ┌────┴────┐
    │single   │   │single    │   │mesh     │
    │.dat     │   │.yml      │   │.gdf/.dat│
    ├─────────┤   ├──────────┤   │/.stl    │
    │modular  │   │modular   │   └─────────┘
    │deck/    │   │includes/ │
    └─────────┘   └──────────┘
```

## Existing Assets to Build On
- `diffraction/output_schemas.py` — unified `DiffractionResults`, `RAOSet`, `AddedMassSet`, `DampingSet` (output side; need input-side equivalent)
- `aqwa/aqwa_dat_files.py` — AQWA deck generation from YAML
- `aqwa/base_configs/modules/aqwa/template_decks/` — 30+ deck templates
- `orcawave/diffraction/orchestrator.py` — OrcaWave config generation
- `orcawave/diffraction/configs/base_diffraction_config.yml` — OrcaWave base template
- `bemrosetta/mesh/` — GDF, DAT, STL mesh handlers with `convert_mesh()`
- `gmsh_meshing/mesh_generator.py` — GMSH parametric mesh generation
- `orcaflex/templates/include_structure/` — modular include pattern docs

## Acceptance Criteria
- [ ] Canonical `spec.yml` schema defined with JSON Schema validation
- [ ] AQWA backend: spec → single `.dat` file
- [ ] AQWA backend: spec → modular deck files (header/body/footer per deck)
- [ ] OrcaWave backend: spec → single `.yml` project file
- [ ] OrcaWave backend: spec → modular includes (01_general through 09_shapes)
- [ ] Common mesh format with conversion to solver-specific formats
- [ ] Round-trip test: spec → AQWA `.dat` → parse back → validate against spec
- [ ] Round-trip test: spec → OrcaWave `.yml` → parse back → validate against spec
- [ ] Mesh interchangeability: GDF ↔ DAT ↔ STL via BEMRosetta or GMSH
- [ ] Example test cases from existing `docs/modules/aqwa/examples/` and `docs/modules/orcawave/examples/`
- [ ] CLI command: `digitalmodel convert-spec <spec.yml> --solver aqwa --format single`
- [ ] CLI command: `digitalmodel convert-spec <spec.yml> --solver orcawave --format modular`

## Work Breakdown
- **WRK-057**: Define canonical spec.yml schema
- **WRK-058**: AQWA input backend (single + modular)
- **WRK-059**: OrcaWave input backend (single + modular)
- **WRK-060**: Common mesh format and converter pipeline
- **WRK-061**: CLI and integration layer
- **WRK-062**: Test suite with existing example data
- **WRK-063**: Reverse parsers — AQWA .dat and OrcaWave .yml to spec.yml (enables cross-conversion)

---
*Source: WRK-026 expanded — review digitalmodel repo AQWA, BEMRosette, OrcaWave modules. Prepare input data format converter for spec.yml, single-input-file, modular-input-file. Common mesh format interchangeable between programs.*
