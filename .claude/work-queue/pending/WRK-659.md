---
id: WRK-659
title: "analysis(digitalmodel): God Object decomposition plan — 6 files >1000L via Gemini large-context sweep"
status: pending
route: B
priority: high
complexity: medium
compound: false
created_at: 2026-03-01T00:00:00Z
target_repos:
  - digitalmodel
commit:
spec_ref:
related:
  - WRK-590
  - WRK-591
blocked_by: []
synced_to: []
plan_reviewed: false
plan_approved: false
percent_complete: 0
brochure_status: n/a
computer: ace-linux-1
provider: gemini
orchestrator: gemini
cross_review: pending
---

# analysis(digitalmodel): God Object Decomposition Plan — 6 Files >1000L

## What

Use Gemini's 1M-token context to read all six God Object files in digitalmodel in one
pass and produce a concrete, file-by-file decomposition plan.

### Target files (lines)

| File | Lines |
|------|-------|
| `src/digitalmodel/infrastructure/base_solvers/well/wellpath3D.py` | 1985 |
| `src/digitalmodel/solvers/orcaflex/orcaflex_model_components.py` | 1905 |
| `src/digitalmodel/infrastructure/base_solvers/hydrodynamics/cathodic_protection.py` | 1853 |
| `src/digitalmodel/solvers/orcaflex/pipeline_schematic.py` | 1660 |
| `src/digitalmodel/structural/analysis/wall_thickness_mt_report.py` | 1522 |
| `src/digitalmodel/structural/pipe_capacity/custom/PipeCapacity.py` | 1476 |

Combined: ~10,400 lines — fits comfortably in Gemini's 1M context.

## Plan

### Phase 1 — Gather and submit (15 min)

```bash
cd digitalmodel
cat \
  src/digitalmodel/infrastructure/base_solvers/well/wellpath3D.py \
  src/digitalmodel/solvers/orcaflex/orcaflex_model_components.py \
  src/digitalmodel/infrastructure/base_solvers/hydrodynamics/cathodic_protection.py \
  src/digitalmodel/solvers/orcaflex/pipeline_schematic.py \
  src/digitalmodel/structural/analysis/wall_thickness_mt_report.py \
  src/digitalmodel/structural/pipe_capacity/custom/PipeCapacity.py \
| gemini -p "
For each of the 6 Python files above (identify them by their class/function structure):
1. List the distinct responsibilities (SRP violations) — one bullet per responsibility
2. Propose a split: new file names (kebab-case), which classes/functions go where
3. Identify the public API that external callers need (must stay importable after split)
4. Flag any circular dependency risk in the proposed split
5. Estimate lines per new file (target: each <400L)

Output as markdown with one H2 section per source file." -y \
> specs/wrk/WRK-659/god-object-decomposition-plan.md
```

### Phase 2 — Validate caller impact (10 min)

For each proposed split, grep call sites across the repo:
```bash
grep -r "from digitalmodel.infrastructure.base_solvers.well.wellpath3D" \
  src/ tests/ --include="*.py" -l
```
Add caller counts to the decomposition plan so implementation priority is clear.

### Phase 3 — Prioritize and capture follow-on WRKs (10 min)

- Rank the 6 files by: (lines × caller count × no-OrcaFlex-license-needed)
- Create one follow-on WRK per file for the actual split implementation
- Tag each with `blocked_by: WRK-659`

## Acceptance Criteria

- [ ] `specs/wrk/WRK-659/god-object-decomposition-plan.md` created with sections for
  all 6 files: responsibilities, proposed split, public API, circular-dep risk, line estimates
- [ ] Caller-count table appended (grep output per file)
- [ ] Priority ranking produced (which file to split first)
- [ ] Follow-on WRK items captured (one per file) with `blocked_by: WRK-659`

## Why

The 6 files violate the 400-line hard limit (coding-style.md) and the God Object
prohibition (patterns.md). Gemini's 1M context lets us analyse all of them together —
catching cross-file dependency risks that per-file analysis misses. The plan artifact
drives the split implementations (follow-on WRKs) with zero guesswork.

## Agentic AI Horizon

High fit: pure analysis with no code changes. Gemini reads, reasons, and outputs.
No license or external dependency needed. Output is a plan document, not code.
