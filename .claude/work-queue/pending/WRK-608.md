---
id: WRK-608
title: "chore(digitalmodel): catalog and port MATLAB riser/VIV/API scripts — 997 .m files"
status: pending
priority: medium
complexity: medium
compound: true
created_at: 2026-02-25T00:00:00Z
target_repos:
  - digitalmodel
  - OGManufacturing
commit:
related:
  - WRK-309
  - WRK-607
  - WRK-045
computer: ace-linux-1
execution_workstations: [ace-linux-1]
plan_workstations: [ace-linux-1]
percent_complete: 0
---

# Catalog and Port MATLAB Scripts — 997 .m Files

## What

997 MATLAB scripts indexed at `/mnt/ace/docs/disciplines/` implement engineering
calculations. Catalog them by calculation type, identify the Python status of each,
and port the highest-priority ones that have no Python equivalent.

## Script Groups (from document index)

| Group | Count | Paths | Priority |
|-------|-------|-------|----------|
| Riser analysis | 476 | `disciplines/*/codes/` | High |
| API-16Q min temperature | 99 | `disciplines/*/API1111WT/`, `TempKM/` | High |
| OrcaFlex automation | 80 | `disciplines/*/OrcaFlex Input Files/` | Medium |
| Modal/VIV analysis | 30 | `disciplines/*/` (FindModes, ModesFind) | High (prereq WRK-607) |
| API-579 FFS | 54 | `disciplines/*/` (API579LML, API579GML) | Done — ref only |
| Plotting/visualisation | 13 | misc | Low |
| Other | 239 | misc | Low |

## Phase 1 — Catalog (no porting, just documentation)

1. Find all `.m` files in the index with their paths:
   ```python
   uv run --no-project python scripts/data/document-index/query-ledger.py \
       --domain structural  # won't work — need direct index query
   python3 -c "
   import json
   with open('data/document-index/index.jsonl') as f:
       for line in f:
           rec = json.loads(line)
           if rec.get('ext') == 'm':
               print(rec['path'])
   " > /tmp/matlab_scripts.txt
   ```
2. For each key script, document in `specs/scripts/matlab-catalog.yaml`:
   ```yaml
   - path: /mnt/ace/docs/disciplines/.../API579GML.m
     topic: API-579 GML (General Metal Loss)
     python_equivalent: digitalmodel.asset_integrity.common.API579_components.gml
     status: done
   - path: /mnt/ace/docs/disciplines/.../FindModes.m
     topic: Modal analysis — natural frequencies of pipeline/riser spans
     python_equivalent: null
     status: gap  # → port as part of WRK-607 or standalone
   ```

## Phase 2 — Port: Modal/VIV MATLAB (30 files)

Target: `digitalmodel/src/digitalmodel/pipeline/free_span/natural_frequency.py`
(same module as WRK-607 — coordinate so these are the same implementation)

Key files to port:
- `FindModes.m` / `ModesFind.m` — natural frequency of pipeline spans
- `testmodes.m` — validation test cases (convert to pytest fixtures)
- `controlFileLML_01.m` — LML control file (→ YAML config template)

## Phase 3 — Port: API-16Q Min Temperature (99 files)

Target: `OGManufacturing/src/ogmanufacturing/drilling/api16q_min_temp.py`

API 16Q covers minimum pressure temperature rating for well control equipment.
These scripts compute minimum service temperature for BOP and wellhead components.

Key files to port:
- `API16QTMin_02.m` — minimum temperature calculation
- `API16QTMinEvaluation.m` — full evaluation loop

Standard: API RP 16Q (1st Ed, 1993) — "Recommended Practice for Design and
Operation of Subsea Production Systems" — minimum temperature assessment
per Table 2 (material performance class + temperature rating).

## Phase 4 — Port: OrcaFlex MATLAB Automation (80 files)

These are batch-run scripts driving OrcaFlex from MATLAB via COM interface.
Port the logic to `digitalmodel.solvers.orcaflex.batch` (Python OrcFxAPI).

## Acceptance Criteria

- [ ] `specs/scripts/matlab-catalog.yaml` committed — all 997 files categorised
- [ ] Phase 2: `natural_frequency.py` tests pass against MATLAB `FindModes` results
- [ ] Phase 3: `api16q_min_temp.py` with ≥5 unit tests; matches MATLAB outputs for sample inputs
- [ ] Phase 4: at least 1 OrcaFlex MATLAB → Python port documented as adapter

## Notes

- MATLAB scripts are client project work — strip any client identifiers before porting
- Run legal scan on all ported code before commit
- API-579 MATLAB scripts (`API579GML.m`, `API579LML.m`) are reference only — Python
  equivalent already exists in `digitalmodel.asset_integrity`
- `FindModes.m` / `ModesFind.m` are SHEAR7 post-processors (not F105 calculations) — skip
- `testmodes.m` (31245 Shell West Boreas) is a pluck-test FFT modal identifier — use as
  test fixture reference only
- **Project 0168** already has Python natural frequency FEA code:
  `natural_frequency_FEA_functions.py` + `estimate_natural_frequencies_FEA.py`
  (12-DOF FEA, scipy.linalg.eigh, Clamped-Free/Pinned-Pinned BCs) — reference for
  Phase 2 implementation (adapt to pipeline free-span, not drillstring)
