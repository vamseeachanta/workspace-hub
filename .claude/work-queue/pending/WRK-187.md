---
id: WRK-187
title: 'Improve /improve: configurable thresholds, classify retry, apply API content'
status: pending
priority: medium
complexity: medium
created_at: 2026-02-17 00:00:00+00:00
source: WRK-184-followup
target_repos:
- workspace-hub
module: automation
tags:
- improve
- robustness
- configuration
related:
- WRK-184
blocked_by: []
synced_to: []
provider: claude
spec_ref: ''
plan_reviewed: false
plan_approved: false
---

# WRK-187: Improve /improve — Robustness and Configuration

## What
Address remaining gaps in the /improve pipeline identified during WRK-184 bug review.

## Items

### 1. Configurable Thresholds
Currently hardcoded in guard.sh and ecosystem.sh:
- Skill sprawl threshold: 350
- Memory bloat threshold: 800 lines
- Signal backlog threshold: 50
- Score threshold: 0.6
- CLAUDE.md size limit: 100 lines
- Memory file limit: 200 lines
- Rules file limit: 400 lines

**Fix**: Extract to a config file (`scripts/improve/config.sh` or `config/improve-thresholds.yaml`) sourced by all lib modules.

### 2. Classify Retry Logic
`classify.sh` has no retry on API failure — single attempt, then skip. Add:
- 1 retry with exponential backoff (5s delay)
- Timeout bump from 30s to 45s for large signal sets
- Log the API error response for debugging

### 3. Apply Phase: Actual API Content Generation
`apply.sh` claims "60% API" but uses 0% API — it just writes content verbatim from classify phase. The classify prompt does all the content generation, which limits quality.

**Fix**: For `enhance` actions, call the API with the current file content + proposed improvement to generate a properly integrated edit (not just appended text). This would make enhancements context-aware.

## Acceptance Criteria
- [ ] Thresholds loaded from config file, not hardcoded
- [ ] Classify has 1 retry with backoff
- [ ] Apply uses API for enhance actions (optional — behind flag)
- [ ] All existing tests still pass
