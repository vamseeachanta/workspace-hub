# WRK-415: Break up digitalmodel infrastructure/ monolith

**Status**: in-progress
**Complexity**: complex
**Computer**: ace-linux-1
**Phase**: 5 (Phase D - Long Horizon)

## Problem
`src/digitalmodel/infrastructure/` has 40+ subdirs mixing config, solvers,
services, and validation. No clear domain alignment.

## Tasks
1. Audit all 40+ subdirs and classify by responsibility
2. Design target domain mapping (e.g., base_solvers/ → separate domains)
3. Migrate module by module with full test coverage
4. Fix all import chains
5. Commit in digitalmodel submodule

## Acceptance Criteria
- infrastructure/ split into ≤5 focused domain modules
- All tests pass
- Import graph has no circular dependencies

## Progress

### Phase 1 — Audit and Design (complete 2026-02-24)
- Audited all 12 top-level subdirs (218 Python files)
- Classified every subdir and file by responsibility
- Identified `common/` as the primary sprawl (52 files, 4 mixed responsibilities)
- Identified `services/` and `domains/` as misplaced modules
- Produced target 5-module structure spec
- Documented all external import callers that require path updates
- Spec: `digitalmodel/specs/modules/infrastructure-refactor.md`

### Phase 2 — Migration

#### Phase 2A — complete (2026-02-24, commit f92bc81)
- Merged `base_configs/config_framework.py` → `config/framework.py`, `config_models.py` → `config/models.py`
- `base_configs/__init__.py` → backward-compat DeprecationWarning shim
- Renamed `core/` → `persistence/` (5 files); `core/__init__.py` → DeprecationWarning shim
- Moved `templates/template_validator.py` → `validation/template_validator.py`
- NOTE: `base_configs/domains/` YAML dir NOT moved — 2 callers use pkgutil.get_data filesystem paths
  (`aqwa_dat_files.py`, `orcaflex_model_utilities.py`) — deferred to Phase 2D with import fixes

#### Phase 2B — pending: validators/ shim removal
#### Phase 2C — pending: services/ → web/
#### Phase 2D–F — pending: common/ decomposition into solvers/ and utils/
