---
id: WRK-635
title: "feat(memory): session scanner — extract learnings from all historical Claude sessions into auto-memory"
status: pending
priority: medium
complexity: medium
compound: false
created_at: 2026-02-27T00:00:00Z
target_repos:
  - workspace-hub
commit:
spec_ref:
related:
  - WRK-309
  - WRK-299
blocked_by: []
parent:
synced_to: []
plan_reviewed: false
plan_approved: false
percent_complete: 0
brochure_status: n/a
computer: [ace-linux-1, acma-ansys05]
provider: claude
---

# feat(memory): Session Scanner — Extract Learnings from Historical Claude Sessions

## What

Build `scripts/memory/scan-sessions.py` — a script that reads all historical Claude
Code session `.jsonl` files from disk and extracts learnings into the auto-memory files.

### Session file locations to scan

- **ace-linux-1**: `~/.claude/projects/-mnt-local-analysis-workspace-hub/*.jsonl`
  — 282 files, up to 121 MB each
- **acma-ansys05**: equivalent path if Claude Code sessions exist there
  — check `%USERPROFILE%\.claude\projects\` (Windows)

### Script: `scripts/memory/scan-sessions.py`

**Phase 1 — parse and filter**
- Walk all `*.jsonl` files in the project session directory
- Parse each line; extract records where `type=user` (role=user) and `type=assistant`
- Skip tool-result records (type=system, file-history-snapshot, etc.)
- Filter: skip sessions already after auto-memory activation date (2026-02-27)
- Output: list of `(timestamp, session_id, role, text)` tuples

**Phase 2 — summarise via LLM**
- Batch messages into ~50K-token chunks (Gemini preferred — large context, low cost)
- Prompt: extract factual learnings: commands discovered, module paths, patterns,
  bug fixes, architectural decisions, WRK completions not yet in MEMORY.md
- Output per batch: bullet list of learnings with source session_id

**Phase 3 — deduplicate against existing MEMORY.md**
- Load current `memory/MEMORY.md` and topic files
- Filter out learnings already captured (fuzzy match on key phrases)
- Bucket remaining learnings by topic (engineering, git, work-queue, ai-orchestration…)

**Phase 4 — write to memory files**
- Append new bullets to appropriate topic files (create new topic file if needed)
- Update `MEMORY.md` index if new topic files added
- Log: `memory/scan-sessions-run.log` — sessions processed, learnings added, skipped

### CLI interface

```
python3 scripts/memory/scan-sessions.py \
  --sessions-dir ~/.claude/projects/-mnt-local-analysis-workspace-hub \
  --memory-dir ~/.claude/projects/-mnt-local-analysis-workspace-hub/memory \
  --before 2026-02-27 \
  --dry-run          # print learnings without writing
  --topic engineering  # restrict to one topic bucket
```

### Helper: `scripts/memory/session-stats.sh`

Quick stats without full scan:
- Count sessions per project directory
- Total size on disk
- Date range (oldest → newest)
- Estimate token count

## Why

282+ historical sessions contain solved problems, discovered patterns, and confirmed
architectural decisions that pre-date the auto-memory feature. Scanning them retroactively
prevents re-discovering the same things in future sessions and enriches MEMORY.md with
ground-truth knowledge from actual work done.

## Acceptance Criteria

- [ ] `session-stats.sh` reports counts + date range for each project dir
- [ ] `scan-sessions.py --dry-run` prints extracted learnings without writing
- [ ] Deduplication correctly skips facts already in MEMORY.md
- [ ] Full run on 282 sessions completes without OOM (streaming, not bulk-load)
- [ ] At least 10 net-new learnings added to topic files from pre-auto-memory sessions
- [ ] `scan-sessions-run.log` records what was processed and added
- [ ] Script works on both Linux (`~/.claude/`) and Windows (`%USERPROFILE%\.claude\`)
- [ ] Legal scan passes (no client identifiers in output)

## Notes

- Use Gemini for summarisation (`echo batch | gemini -p "..." -y`) — cheaper than Claude
  for bulk processing; Gemini's 1M token window handles large batches
- Sessions are 600KB–121MB; stream line-by-line, never load full file into memory
- Skip sessions from agent subprocesses (isSidechain=true) to avoid noise
- acma-ansys05 is Windows — script must handle both path separators
