---
id: WRK-209
title: 'uv enforcement across workspace — eliminate python3/python fallback chains'
status: pending
priority: medium
complexity: medium
compound: false
created_at: 2026-02-19T00:00:00Z
target_repos:
  - workspace-hub
module: automation
tags:
  - uv
  - python
  - cross-platform
  - tooling
  - enforcement
related:
  - WRK-208
  - WRK-210
blocked_by: []
synced_to: []
provider: claude
spec_ref: ''
plan_reviewed: false
plan_approved: false
percent_complete: 0
brochure_status: n/a
---

# WRK-209: uv Enforcement Across Workspace

## What

Replace all `python3`/`python` detection chains in workspace-hub scripts with
`uv run --no-project python`. uv is the declared workspace tool manager and is
already required by `check-encoding.sh`, but many older scripts still use
multi-fallback detection (`python3 || python || error`). This creates silent
incompatibilities across Windows/Linux machines.

## Why

**Session trigger (2026-02-19)**: While writing `check-encoding.sh`, the
initial version used `python3`/`python` fallback detection. User feedback:
"should this not be flowing through uv" and "The solutions are not high
level.. one shot.. Too much intertwined." The clean solution: `uv` is a hard
dependency, not optional — if it's not installed, fail clearly with an
install instruction.

`uv run --no-project python` solves:
- `python3` vs `python` naming difference (Windows vs Linux)
- No system Python required — uv manages its own Python
- No virtual environment activation needed
- Consistent version across all machines

## Scope

### Files to audit and fix

| File | Current pattern | Fix |
|------|----------------|-----|
| `scripts/operations/setup-hooks.sh` | `python3 \|\| python` detection | Remove; uv check already in check-encoding.sh |
| `scripts/data/og-standards/rag.py` | Invoked as `python3 rag.py` | Add `#!/usr/bin/env -S uv run python` shebang |
| `scripts/development/ai-workflow/*.sh` | Any `python3` calls | Replace with `uv run --no-project python` |
| `scripts/improve/improve.sh` | Any `python3` calls | Replace with `uv run --no-project python` |
| `scripts/work-queue/*.py` | `python3 script.py` invocations | Replace with `uv run --no-project python script.py` |
| `CLAUDE.md` memory | "System python3 (3.12.3)" note | Update to "uv manages Python — use uv run" |

### Hub-level pyproject.toml

Add a minimal `pyproject.toml` at workspace-hub root declaring:
- `requires-python = ">=3.12"`
- `tool.uv` section pinning Python version
This allows `uv run python` (without `--no-project`) at hub root while
preserving `--no-project` for hook invocations from arbitrary working dirs.

## Acceptance Criteria

- [ ] All hub scripts that invoke Python use `uv run` (no `python3`/`python` chains)
- [ ] `setup-hooks.sh` Step 4 checks `uv` availability instead of `python3`
- [ ] `pyproject.toml` added at workspace-hub root (minimal — Python version pin only)
- [ ] `CLAUDE.md` memory updated: "uv is required; use `uv run` for all Python invocations"
- [ ] At least one script (e.g., `generate-index.py`) invocable as `uv run python scripts/work-queue/generate-index.py`

## Plan

Route B — inline plan. Requires Codex/Gemini cross-review before execution
(affects many scripts across the workspace).

**Sequence**:
1. Audit all scripts for `python3`/`python` patterns (Grep scan)
2. Fix `setup-hooks.sh` — remove python3 check, it's now redundant (uv check covers it)
3. Add hub-level `pyproject.toml` (minimal)
4. Fix remaining scripts in bulk (`sed` replacements where straightforward)
5. Update `CLAUDE.md` memory note

*Awaiting `plan_reviewed: true` — needs Codex/Gemini cross-review.*

## Execution Brief

### Provider
- **Executor**: Codex — focused single-file and config changes; batch replacements across scripts
- **Alt**: Claude Sonnet — fallback if Codex cannot handle multi-script audit

### Task for Executor

Enforce `uv run --no-project python` as the single Python invocation pattern
across all workspace-hub hub scripts. Do NOT touch submodule scripts (assethold,
worldenergydata, digitalmodel — they have their own environments).

**Step 1 — Audit first** (read-only):
```bash
grep -rn "python3\|command -v python" scripts/ --include="*.sh" | grep -v "uv run"
```
Report every hit. Do not change anything until audit is reviewed.

**Step 2 — Fix `scripts/operations/setup-hooks.sh`**:
Remove the python3/python detection block (Step 4). Replace with comment:
`# Python check removed — uv manages Python (see check-encoding.sh)`

**Step 3 — Add `pyproject.toml` at workspace-hub root**:
```toml
[project]
name = "workspace-hub"
requires-python = ">=3.12"

[tool.uv]
python = "3.12"
```

**Step 4 — Fix remaining hub scripts** (bulk):
Replace bare `python3 ` calls with `uv run --no-project python `.
Skip anything in submodule directories.

**Step 5 — Update MEMORY.md environment note**:
Change: `System python3 (3.12.3), NOT venv`
To: `uv manages Python for hub scripts — use uv run --no-project python`

### Done When
- [ ] `grep -rn "python3" scripts/ --include="*.sh" | grep -v "uv run" | grep -v "#"` → 0 hits in hub scripts
- [ ] `pyproject.toml` exists at workspace-hub root with requires-python = ">=3.12"
- [ ] `bash scripts/operations/setup-hooks.sh` completes without error
- [ ] `uv run python .claude/work-queue/scripts/generate-index.py` exits 0

### For User Review
- Confirm submodule scripts (assethold, worldenergydata) were NOT touched
- Verify setup-hooks.sh smoke test still passes after removing python3 check
