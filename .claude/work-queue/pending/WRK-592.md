---
id: WRK-592
title: "Split benchmark_plotter.py into 4 focused modules"
status: pending
priority: P1
complexity: high
route: B
computer: [ace-linux-1]
created: 2026-02-25
tags: [refactor, digitalmodel, god-object, clean-code, hydrodynamics]
blocked-by: [WRK-591]
---

## Goal

Split `digitalmodel/src/digitalmodel/hydrodynamics/diffraction/benchmark_plotter.py`
(2,700 lines) into 4 focused modules per the God Object Splits plan.

## Deliverables

1. `benchmark_helpers.py` (~200L) — `_SOLVER_STYLES`, `DOF_ORDER`, `_AMPLITUDE_UNITS`, `_NEGLIGIBLE_AMPLITUDE_RATIO`, `_is_phase_at_negligible_amplitude()`, `_parse_fdf_panels()`, `_FILE_DESCRIPTIONS` (moved from class attr)
2. `benchmark_rao_plots.py` (~600L) — `plot_amplitude_overlay()`, `plot_phase_overlay()`, `plot_difference_grid()`, heading/axis helpers; extracted as module-level fns accepting explicit `heading_x_axis` arg
3. `benchmark_correlation.py` (~400L) — `plot_pairwise_correlations()`, `build_dof_report_sections()`, `_build_dof_commentary()`
4. `benchmark_input_reports.py` (~400L) — `build_mesh_schematic_html()`, `_parse_fdf_panels()`, `build_input_files_html()`, `build_input_comparison_html()`; `_render_diff_table` nested closure must be inlined
5. `benchmark_plotter.py` → orchestrator + thin wrappers (≤400L)

## Critical Implementation Notes

- `_heading_x_axis` is instance attribute — 8 call sites must pass it explicitly when calling extracted module-level functions (silent failure risk if missed)
- `_render_diff_table` nested closure in `build_semantic_equivalence_html` captures `parts` by reference — MUST be inlined in the extracted function, not moved out as a standalone function
- `_FILE_DESCRIPTIONS` class attr (line ~1247) — must move to `benchmark_helpers.py` as module constant
- `BenchmarkPlotter` methods become thin wrappers calling module-level functions

## Acceptance Criteria

- `from digitalmodel.hydrodynamics.diffraction.benchmark_plotter import BenchmarkPlotter` — OK
- `from digitalmodel.hydrodynamics.diffraction import BenchmarkPlotter` — OK (__init__ re-export)
- `PYTHONPATH=digitalmodel/src python3 -m pytest digitalmodel/tests/hydrodynamics/diffraction/test_benchmark_plotter.py -q`
- Instantiation smoke: `BenchmarkRunner.__new__(BenchmarkRunner)` — OK

## Notes

- **Blocked by WRK-591** — same repo, same __init__.py; WRK-591 must commit first
- **COMMIT**: use git plumbing (4.2GB pack files)
- Purge `__pycache__` before tests to avoid stale bytecode
