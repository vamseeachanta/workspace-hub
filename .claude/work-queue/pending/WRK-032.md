---
id: WRK-032
title: Modular OrcaFlex pipeline installation input with parametric campaign support
status: pending
priority: medium
complexity: complex
created_at: 2026-01-29T12:00:00Z
updated_at: 2026-02-03T00:00:00Z
target_repos:
  - digitalmodel
commit:
spec_ref: specs/modules/orcaflex/pipeline-installation-modular/plan.md
related: []
blocked_by: []
synced_to: []
supersedes:
  - WRK-033
---

# Modular OrcaFlex Pipeline Installation Input with Parametric Campaign Support

> Merged scope from WRK-032 + WRK-033 (archived as superseded).

## What

Refactor OrcaFlex pipeline installation input into a modular include-file system with:
1. **Modular sections** — each OrcaFlex input file composed from independent, reusable include-file sections following the existing `_XX_DescriptiveName.yml` convention
2. **Parametric campaign matrix** — full installation sensitivity study across water depths, route lengths, environmental conditions, soil properties, and tension levels
3. **Roller arrangement as first-class parametric section** — count, spacing, type, V-angle, diameter, friction coefficient, height offset
4. **Both S-lay and floating tow** installation methods supported
5. **Include-file composition engine** — assemble runnable OrcaFlex models from selected section combinations with variable substitution

## Why

- Current `ProjectInputSpec` schema supports single pipeline + single equipment config only
- Legacy `OrcInstallation` uses `OrderedDict` manipulation outside the Pydantic schema system
- Roller model is minimal (single position + support count) — insufficient for parametric roller studies
- No batch campaign support for full installation sensitivity matrices
- WRK-033's include-file composition goal is inseparable from WRK-032's modular format goal

## Scope

### In Scope
- Extend Pydantic schema for multi-section pipeline installation input
- Roller arrangement model with full geometric parametrisation
- Campaign matrix definition (depth × length × environment × soil × tension)
- Section-based include-file composition (reuse existing `_XX_` convention)
- Variable substitution/templating within sections
- Both S-lay (vessel + stinger + tensioner + stinger rollers) and floating tow (tugs + buoyancy modules + rollers)
- Backward compatibility with current single-pipeline `ProjectInputSpec`
- Input validation for composed models
- Absorb/replace legacy `OrcInstallation` functionality into new schema

### Out of Scope
- J-lay installation method (future work)
- Multi-product pipelines in a single model (future — this is batch parametric only)
- OrcaFlex simulation execution (handled by existing batch runner WRK-029)
- Post-processing of results

## Existing Infrastructure to Build On

| Component | Path | Reuse Strategy |
|-----------|------|----------------|
| Pydantic schema | `solvers/orcaflex/modular_generator/schema/` | Extend `ProjectInputSpec`, `Equipment`, `Rollers` |
| Builder pattern | `solvers/orcaflex/modular_generator/builders/` | Extend `buoys_builder`, `lines_builder` |
| Include-file spec | `specs/modules/orcaflex/modular-input-file/` | Follow `_XX_` naming convention |
| Legacy installation | `solvers/orcaflex/orcaflex_installation.py` | Replace with new schema-driven approach |
| Equipment models | `schema/equipment.py` | Extend `Rollers`, add `RollerArrangement` |

## Acceptance Criteria

### Schema & Data Model
- [ ] `RollerArrangement` Pydantic model with: count, spacing_pattern, type (V-roller/flat/cradle), V-angle, diameter, friction_coefficient, height_offset, support_count
- [ ] `InstallationSection` model representing a named section of the include-file system
- [ ] `CampaignMatrix` model defining parameter variations (water_depths, route_lengths, environments, soil_properties, tensions)
- [ ] Extended `ProjectInputSpec` supporting campaign mode alongside single-run mode
- [ ] S-lay equipment section (vessel + stinger + tensioner + stinger rollers)
- [ ] Floating tow equipment section (tugs + buoyancy modules + route rollers)

### Include-File Composition
- [ ] Section registry mapping section types to `_XX_DescriptiveName.yml` files
- [ ] Composition engine that assembles sections into valid OrcaFlex YAML
- [ ] Variable substitution within sections (e.g., `${water_depth}`, `${tension}`)
- [ ] Validation that composed models are structurally complete for OrcaFlex

### Campaign Generation
- [ ] Campaign matrix parsed from YAML config
- [ ] Cartesian product of parameter variations generates individual run configs
- [ ] Each run config is a composed set of include-file sections with substituted variables
- [ ] Output: directory of runnable OrcaFlex YAML files, one per matrix combination

### Quality
- [ ] Backward compatibility: existing single-pipeline YAML inputs still parse correctly
- [ ] Tests: schema validation, section composition, campaign matrix expansion, roller parametrisation
- [ ] Legacy `OrcInstallation` functionality preserved in new system (elevation-based model generation)

## SME Q&A Log

| # | Question | Answer | Date |
|---|----------|--------|------|
| 1 | Installation method scope? | Both S-lay and floating tow | 2026-02-03 |
| 2 | Multi-pipeline meaning? | Batch parametric (same pipeline, parameter matrix) | 2026-02-03 |
| 3 | "Section" meaning? | Modular input file sections (include-file modules) | 2026-02-03 |
| 4 | WRK-032 vs WRK-033? | Merge into WRK-032 | 2026-02-03 |
| 5 | Parameter matrix scope? | Full campaign: depth × length × environment × soil × tension | 2026-02-03 |
| 6 | Roller parametrisation? | Count + spacing + type + V-angle, diameter, friction, height offset | 2026-02-03 |

---
*Source: refactor pipeline input file to have roller section, floating section to have modular format. ability to have multiple pipelines, water depths, lengths etc. for installation. This is for pipeline OrcaFlex analysis. Merged with WRK-033: develop an OrcaFlex includefile modular skill to help prepare an analysis input file into sections so the variables can be easily parametrised.*
