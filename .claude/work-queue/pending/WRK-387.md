---
id: WRK-387
title: Claude Code session auto-refresh with WRK context persistence
status: done
priority: high
complexity: complex
compound: false
created_at: 2026-02-24T06:15:00Z
target_repos:
  - workspace-hub
commit:
spec_ref:
related: []
blocked_by: []
synced_to: []
plan_ensemble: false
ensemble_consensus_score: null
plan_reviewed: false
plan_approved: false
percent_complete: 100
brochure_status: n/a
computer: ace-linux-1
commit: 57f34d9f5786cc4e1713286fda76da71eb7c29be
---

# Claude Code Session Auto-Refresh with WRK Context Persistence

## What

Build a session-refresh mechanism that automatically relaunches Claude Code for long-running sessions while preserving full working context. Applies to both **main sessions** and **subagents** (Task tool spawns). When a session or subagent approaches context limits or the user returns after idle time, the script writes key state (active WRK items, progress notes, modified files, validation results) to the WRK item file, then relaunches with that context pre-loaded. This enables multi-day workflows without context degradation and lets subagents hand off mid-task to fresh subagents.

## Why

Long-running Claude Code sessions degrade as context compresses. Multi-day user interactions (like WRK-372 Phase 5 validation across 7 skills) require fresh context pickup without losing progress. Currently this is manual — the user must re-explain where things left off. An automated refresh mechanism would let the AI resume exactly where it stopped.

## Acceptance Criteria

- [x] Script detects when session is approaching context limits (token count heuristic or turn count)
- [x] Writes structured session state to active WRK item(s) — progress, findings, next steps, modified files
- [x] Auto-relaunches Claude Code with `--resume` or equivalent, feeding the WRK context as initial prompt
- [x] Works for both interactive and idle-timeout scenarios (user walks away, comes back next day)
- [x] Preserves key file paths, validation results, and uncommitted change state
- [x] Integrates with existing `/work` skill — WRK item becomes the persistence medium
- [x] Handles multiple active WRK items (writes state to each relevant one)
- [x] Session memory (MEMORY.md) updated with durable findings before refresh
- [x] Subagent support: subagents can serialize state to a checkpoint file, and a new subagent can resume from that checkpoint
- [x] Subagent handoff protocol: outgoing subagent writes findings + next steps, incoming subagent reads and continues
- [x] Works with Task tool's `resume` parameter where applicable
- [x] **Harness refresh**: on relaunch, capture the latest Claude Code harness version and default model — ensures the refreshed session uses the most up-to-date Claude Code with any model updates that shipped since the session started (no custom config, just the default latest)

## Agentic AI Horizon

- This directly boosts agentic AI capability — solves the #1 friction point in multi-day workflows
- Claude Code's context compression already handles some of this, but structured WRK-based persistence is more reliable
- In 3-4 months, native session persistence may exist in Claude Code — but this WRK-based approach adds value regardless as it ties context to work items, not just sessions
- Shape: build the groundwork now (state serialization + WRK writing), iterate on auto-detection later

---
*Source: "refresh claudecode for long running sessions while waiting for user input. A script that can run automatically and relaunch previous session with all key notes/files written to appropriate WRK item so the pick up can be with fresh context of the WRK-item(s). This will help to enhance our work as we progress things with user interaction for multiple days."*
