---
id: WRK-084
title: Integrate metocean data sources into unified aggregation interface
status: pending
priority: medium
complexity: complex
compound: false
created_at: 2026-02-02 14:00:00+00:00
target_repos:
- worldenergydata
commit: null
spec_ref: null
related:
- WRK-073
blocked_by: []
synced_to: []
provider: claude
plan_reviewed: false
plan_approved: false
---

# Integrate metocean data sources into unified aggregation interface

## What
Wire the 7 existing metocean data source clients (COOPS, ERDDAP, Met Norway, NDBC, OpenMeteo, etc.) into a single unified query interface with combined output. Currently they exist as independent clients with no aggregation layer.

## Why
Metocean data is part of the marketed data offering. Clients exist but are fragmented — no way to query "give me metocean data for location X" across all sources at once.

## Acceptance Criteria
- [ ] Unified query interface accepting lat/lon and time range
- [ ] Automatically queries relevant clients based on location/coverage
- [ ] Combined output with source attribution
- [ ] Plotly visualization of combined metocean data
- [ ] CLI command for unified metocean query
- [ ] Tests with at least 2 real locations

## Plan

**Target**: `src/worldenergydata/metocean/unified/`

### Existing Assets (reuse)
- `metocean/clients/coops_client.py` — NOAA CO-OPS client (tides, currents)
- `metocean/clients/erddap_client.py` — ERDDAP client (gridded data, SST, bathymetry)
- `metocean/clients/met_norway_client.py` — Met Norway API client
- `metocean/clients/ndbc_client.py` — NDBC buoy client (wave, wind)
- `metocean/clients/open_meteo_client.py` — OpenMeteo client (forecast, historical)
- `metocean/statistics/` — Weibull fitting, extreme value analysis

### Phase 1 — Unified Query Interface
- `unified_query.py`:
  - Input: `MetoceanQuery(lat, lon, start_date, end_date, parameters=["Hs", "Tp", "wind_speed", "current"])`
  - Auto-select relevant clients based on location coverage:
    - NDBC: US coastal/offshore buoys
    - COOPS: US tidal stations
    - Met Norway: Norwegian waters
    - OpenMeteo: global forecast/reanalysis
    - ERDDAP: global gridded data
  - Parallel query execution across selected clients
  - Return `MetoceanResult` with combined data + source attribution

### Phase 2 — Data Harmonization
- `harmonizer.py`:
  - Standardize variable names: Hs, Tp, Tm, wind_speed, wind_dir, current_speed, current_dir
  - Standardize units: meters, seconds, m/s, degrees
  - **Time alignment**: default time grid is hourly. Interpolation: linear for continuous variables (Hs, wind_speed), nearest-neighbor for directional variables (wind_dir). Document when source resolution is coarser than target.
  - **Time zone handling**: normalize all timestamps to UTC before alignment
  - Source priority: measured data > reanalysis > forecast
  - Define exact selection rules per parameter (e.g., Hs from NDBC if available, else ERDDAP reanalysis)
  - Retry/backoff strategy per API client

### Phase 3 — Visualization
- `metocean_dashboard.py`:
  - Plotly time series: overlay data from multiple sources
  - Source comparison scatter plot
  - Coverage map: which sources have data at this location
  - Statistical summary table

### Phase 4 — CLI
- Extend existing `metocean/cli.py` with `unified` subcommand rather than creating new `unified/cli.py` (existing CLI framework: `cli.py`, `cli_fetch.py`, `cli_stations.py`)
- Usage: `python -m worldenergydata.metocean unified --lat 28.5 --lon -88.5 --start 2023-01-01 --end 2023-12-31`

### Phase 5 — Tests
- Unit tests: client selection logic, data harmonization
- Integration tests: query 2 real locations (Gulf of Mexico, North Sea)
- Mock tests for HTTP API calls at boundary

### Review Notes
- **Verdict**: Claude: MINOR | Codex: MINOR | Gemini: APPROVE
- **Actions taken**:
  - Fixed all Existing Assets paths: `data_sources/X/` corrected to `clients/X_client.py`
  - Added time alignment specification: hourly default, linear vs nearest-neighbor interpolation by variable type
  - Added UTC time zone normalization
  - Added per-parameter source selection rules and priority
  - Phase 4 CLI: extend existing `metocean/cli.py` instead of creating parallel entry point
  - Added retry/backoff strategy per API client per Codex feedback
- *Cross-reviewed: 2026-02-09*

*Approved by user: 2026-02-09*

---
*Source: Gap analysis — 7 metocean clients exist independently, no unified interface*

## Agentic AI Horizon

- Unified metocean aggregation interface consolidates 6+ data sources into a single query layer — a key infrastructure piece that agents use for all metocean-dependent analysis.
- API integration work is stable and not superseded by AI; the unified interface is exactly what enables agent-driven metocean workflows.
- **Disposition: invest now** — this is scaffolding that every metocean-dependent agent task (WRK-015, WRK-170) builds on; prioritise before the metocean analysis work.
