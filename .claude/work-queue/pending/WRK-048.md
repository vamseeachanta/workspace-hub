---
id: WRK-048
title: Blender working configurations for digitalmodel
status: pending
priority: low
complexity: medium
created_at: 2026-01-29 12:00:00+00:00
target_repos:
- digitalmodel
commit: null
spec_ref: null
related: []
blocked_by: []
synced_to: []
provider: codex
plan_reviewed: false
plan_approved: false
---

# Blender working configurations for digitalmodel

## What
Establish working Blender configurations within digitalmodel â€” setup files, scene templates, and configuration presets for marine/offshore engineering visualisation and 3D modelling workflows.

## Why
Having standardised Blender configurations ensures consistent 3D visualisation output, streamlines scene setup for engineering models, and enables repeatable rendering workflows for client deliverables and technical presentations.

## Acceptance Criteria
- [ ] Working Blender configuration files established
- [ ] Scene templates for relevant engineering visualisation use cases
- [ ] Configuration presets documented and version-controlled
- [ ] Integration with digitalmodel project structure
- [ ] Documentation of setup and usage

## Plan

### Phase 0: Prerequisites and Existing Code Inventory

**Software availability check:**
- Blender is NOT installed on this system (not found at `/snap/bin/blender`, `/usr/bin/blender`, or standard paths)
- Existing code must work in "configuration generation" mode even without Blender installed
- Tests requiring Blender runtime should be marked with `@pytest.mark.skipif` (pattern already used in `tests/solvers/blender_automation/test_blender_wrapper.py`)

**Existing Blender code in digitalmodel (26 files found):**
- `src/digitalmodel/solvers/blender_automation/` -- full module with:
  - `core/blender_wrapper.py` -- `BlenderWrapper` class: subprocess-based Blender execution, script running, import/export
  - `core/scene_manager.py` -- `SceneManager`: empty scene creation, object/camera/light setup, material application, rendering
  - `converters/cad_importer.py` -- `CADImporter`: STL/OBJ/FBX direct import, STEP/IGES via FreeCAD conversion
  - `converters/mesh_exporter.py` -- `MeshExporter`: export to STL/OBJ/FBX/GLTF/DAE/PLY/X3D with format-specific options
  - `utils/batch_processor.py` -- parallel batch processing
  - `utils/file_utils.py` -- Blender executable discovery, installation verification
  - `examples/marine_engineering_integration.py` -- offshore platform, hull analysis, mooring, subsea equipment catalog examples
  - `examples/basic_usage.py` -- basic usage patterns
- `src/digitalmodel/visualization/design_tools/blender_integration.py` -- `BlenderWorkflow` class: engineering scene creation, technical rendering (4 views), assembly animation, VR export; `AIVisualizationAssistant` for camera/lighting suggestions
- `src/digitalmodel/specialized/gis/scripts/blender/blender_gis.py` -- GIS-specific Blender integration

**Existing .blend files (10 found):** Example outputs in `solvers/blender_automation/examples/examples/` (marine_output and output directories) plus a test file in `visualization/design_tools/`

**Key finding:** The existing code is fragmented across two independent implementations (`solvers/blender_automation/` and `visualization/design_tools/blender_integration.py`) with overlapping functionality. The "working configurations" work item should unify these into a coherent configuration system.

### Phase 1: Configuration Schema and Presets

**Target path:** `src/digitalmodel/solvers/blender_automation/config/`

1. `src/digitalmodel/solvers/blender_automation/config/__init__.py`
2. `src/digitalmodel/solvers/blender_automation/config/models.py` -- Pydantic configuration models:
   - `BlenderConfig` -- top-level: Blender executable path, version constraints, default render engine
   - `SceneConfig` -- units (metric/imperial), scale, coordinate system (z-up for engineering)
   - `RenderConfig` -- engine (CYCLES/EEVEE), resolution, samples, output format, color management
   - `MaterialPreset` -- name, base_color, metallic, roughness, emission (dataclass)
   - `LightingPreset` -- key/fill/rim light configurations for different environments
   - `CameraPreset` -- lens, position strategy, depth of field settings
3. `src/digitalmodel/solvers/blender_automation/config/presets.py` -- predefined configuration presets:
   - `OFFSHORE_PLATFORM` -- wide-angle, high-contrast sun lighting, ocean HDRI background
   - `SUBSEA_EQUIPMENT` -- studio lighting, neutral background, close-up camera
   - `VESSEL_HULL` -- side-elevation camera, waterline-plane visualization
   - `PIPING_ISOMETRIC` -- orthographic projection, technical lighting
   - `MOORING_SYSTEM` -- elevated camera, deep-water color scheme
   - `STRUCTURAL_DETAIL` -- macro camera, section cut materials
4. `src/digitalmodel/solvers/blender_automation/config/materials.py` -- engineering material library:
   - Extend the material definitions already in `blender_integration.py` (stainless_steel, carbon_steel, painted_steel, aluminum, equipment)
   - Add: concrete, composite, rubber/elastomer, seawater (transparent), copper_nickel, titanium
   - Each material: `generate_bpy_script()` method that produces Blender Python code for node setup

**Tests:** `tests/solvers/blender_automation/test_config_models.py`
- Test preset serialization/deserialization to YAML
- Test material script generation produces valid Python
- Test all presets have required fields

### Phase 2: Scene Templates

**Target path:** `src/digitalmodel/solvers/blender_automation/templates/`

1. `src/digitalmodel/solvers/blender_automation/templates/__init__.py`
2. `src/digitalmodel/solvers/blender_automation/templates/scene_templates.py` -- scene template engine:
   - `SceneTemplate` base class with `setup(config: SceneConfig) -> str` (returns bpy script)
   - `OffshoreSceneTemplate` -- ocean plane, sky HDRI, sun position, fog/atmosphere
   - `StudioSceneTemplate` -- neutral backdrop, 3-point lighting, turntable camera
   - `TechnicalDrawingTemplate` -- orthographic cameras (front/side/top/iso), dimension annotations
   - `CutawayTemplate` -- boolean modifier setup for section views
3. `src/digitalmodel/solvers/blender_automation/templates/startup_blend.py`:
   - Generate a `.blend` startup file with pre-configured: units, grid, workspace layout, render settings
   - Can be produced without Blender running (write the data via template, apply on first launch)

**Tests:** `tests/solvers/blender_automation/test_scene_templates.py`
- Test each template generates syntactically valid Python script
- Test template + preset combination produces coherent configuration

### Phase 3: Unify Existing Implementations

**Refactoring existing code:**

1. Extract shared logic from `visualization/design_tools/blender_integration.py`:
   - Move `AIVisualizationAssistant.suggest_camera_angles()` to `config/presets.py` as data
   - Move `AIVisualizationAssistant.analyze_lighting_needs()` to `config/presets.py` as lighting presets
   - Refactor `BlenderWorkflow` to use `BlenderWrapper` from `solvers/blender_automation/core/` instead of duplicating subprocess execution
   - `blender_integration.py` becomes a thin facade importing from `solvers/blender_automation/`

2. Consolidate material definitions:
   - `blender_integration.py` has inline material creation (5 materials hardcoded in scene creation script)
   - Move to `config/materials.py` material library
   - Both `SceneManager.apply_material()` and `BlenderWorkflow.create_engineering_scene()` should use the same library

3. Update `examples/marine_engineering_integration.py` to use configuration presets instead of hardcoded values

**Files modified:**
- `src/digitalmodel/visualization/design_tools/blender_integration.py` -- refactor to use shared config
- `src/digitalmodel/solvers/blender_automation/core/scene_manager.py` -- accept `SceneConfig` / `LightingPreset` / `CameraPreset`
- `src/digitalmodel/solvers/blender_automation/examples/marine_engineering_integration.py` -- use presets

### Phase 4: Configuration File Management

**Target path:** `config/blender/` (at digitalmodel repo root, consistent with existing config patterns)

1. `config/blender/default.yml` -- default Blender configuration:
   ```yaml
   blender:
     executable: auto  # auto-detect or explicit path
     min_version: "3.6"
     render_engine: CYCLES
   scene:
     unit_system: METRIC
     scale: 1.0
     up_axis: Z
   render:
     resolution: [1920, 1080]
     samples: 128
     output_format: PNG
   ```
2. `config/blender/presets/` -- one YAML per preset (offshore_platform.yml, subsea_equipment.yml, etc.)
3. `src/digitalmodel/solvers/blender_automation/config/loader.py` -- YAML config loader:
   - Load and merge: defaults -> preset -> user overrides
   - Validate against Pydantic models
   - Return fully resolved `BlenderConfig`

**Tests:** `tests/solvers/blender_automation/test_config_loader.py`
- Test loading default config
- Test preset override merging
- Test validation rejects invalid configs

### Phase 5: Documentation and Integration

1. Add docstrings to all new modules (ABOUTME pattern used throughout digitalmodel)
2. Update `src/digitalmodel/solvers/blender_automation/__init__.py` to export new config classes
3. Add a `config/blender/README.md` explaining preset customization (only if explicitly requested)

### Risks and Mitigations

| Risk | Mitigation |
|------|-----------|
| Blender not installed on target system | All config generation and YAML management works without Blender; runtime operations gated behind `verify_blender_installation()` (already exists in `utils/file_utils.py`) |
| Blender API version differences (3.x vs 4.x) | Presets include `min_version` field; script generation uses API compatibility checks; target Blender 3.6+ (LTS) |
| Two existing implementations may have undiscovered users | Keep `blender_integration.py` functional as facade; add deprecation warnings on direct class usage |
| Material node setup differs across Blender versions | Use Principled BSDF which is stable since Blender 2.79; document any 4.x input name changes |
| .blend file format is binary and version-specific | Generate .blend files at runtime via Blender subprocess (existing pattern in `BlenderWrapper`); never version-control generated .blend files in new code |

### Dependency Summary

- **Required Python packages:** `pyyaml` (already available), `pydantic` (already used in `hull_library/mesh_generator.py`)
- **Optional external software:** Blender 3.6+ (for runtime operations only)
- **Internal dependencies:** `solvers/blender_automation/core/blender_wrapper.py`, `solvers/blender_automation/core/scene_manager.py`
- **No new pip dependencies required**

### Review Notes

**Cross-review date**: 2026-02-10

| Reviewer | Verdict |
|----------|---------|
| Claude Opus 4.6 | APPROVE |
| Gemini CLI | APPROVE |
| Codex CLI | NO_OUTPUT |

**Feedback incorporated**:
- Code fragmentation problem accurately identified; unification strategy in Phase 3 is sound
- Configuration-first approach is pragmatic

*Approved by user: 2026-02-10*

---
*Source: blender working configurations*
