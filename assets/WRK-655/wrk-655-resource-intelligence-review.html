<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WRK-655 Resource Intelligence Plan Review</title>
  <style>
    :root {
      --bg: #f3efe6;
      --panel: #fffdf8;
      --ink: #172126;
      --muted: #55636b;
      --accent: #0f766e;
      --accent-2: #8a5a2b;
      --line: #d9d0c0;
      --warn: #b45309;
      --good: #166534;
      --shadow: 0 16px 40px rgba(20, 33, 38, 0.08);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Georgia, "Times New Roman", serif;
      background: radial-gradient(circle at top, #fffaf0 0, var(--bg) 48%, #ebe5d7 100%);
      color: var(--ink);
      line-height: 1.5;
    }
    .hero {
      padding: 46px 24px 26px;
      border-bottom: 1px solid rgba(23, 33, 38, 0.08);
      background: linear-gradient(135deg, rgba(15,118,110,0.08), rgba(138,90,43,0.1));
    }
    .hero-inner, .content { max-width: 1160px; margin: 0 auto; }
    .eyebrow {
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-size: 0.72rem;
      color: var(--accent);
      font-weight: 700;
    }
    h1 {
      margin: 10px 0 12px;
      font-size: clamp(2rem, 4vw, 3.8rem);
      line-height: 0.95;
      max-width: 11ch;
    }
    .lede {
      max-width: 72ch;
      color: var(--muted);
      font-size: 1.04rem;
    }
    .meta {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 18px;
    }
    .pill {
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.82);
      padding: 7px 12px;
      border-radius: 999px;
      font-size: 0.9rem;
    }
    .content {
      padding: 28px 24px 56px;
      display: grid;
      gap: 22px;
    }
    .panel {
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 18px;
      box-shadow: var(--shadow);
      padding: 22px;
    }
    .panel h2 {
      margin: 0 0 12px;
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--accent-2);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.95rem;
    }
    th, td {
      text-align: left;
      padding: 10px 8px;
      border-top: 1px solid var(--line);
      vertical-align: top;
    }
    th {
      color: var(--ink);
      font-size: 0.86rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }
    .status-good { color: var(--good); font-weight: 700; }
    .status-warn { color: var(--warn); font-weight: 700; }
    code { color: var(--ink); }
    pre {
      margin: 0;
      padding: 14px;
      overflow-x: auto;
      border: 1px solid var(--line);
      border-radius: 12px;
      background: #f8f4ec;
      font-size: 0.9rem;
      line-height: 1.45;
    }
    .mermaid {
      border: 1px solid var(--line);
      border-radius: 12px;
      background: #f8f4ec;
      padding: 12px;
      overflow-x: auto;
    }
    ul { margin: 0; padding-left: 18px; }
  </style>
</head>
<body>
  <header class="hero">
    <div class="hero-inner">
      <div class="eyebrow">WRK-655 Plan Review</div>
      <h1>Resource Intelligence Skill</h1>
      <p class="lede">This HTML is the planning-stage review surface for `WRK-655`. It turns the loosest workflow stage into a first-class skill contract with a visible knowledge map, a `P1/P2/P3` gap model, and a validator-ready artifact definition.</p>
      <div class="meta">
        <div class="pill">Status: Draft plan</div>
        <div class="pill">Route: C</div>
        <div class="pill">Review gate: user HTML review before multi-agent review</div>
        <div class="pill">Seed depth: 3/provider</div>
      </div>
    </div>
  </header>

  <main class="content">
    <section class="panel">
      <h2>Executive Summary</h2>
      <p><strong>WRK-655</strong> exists because `Resource Intelligence` is still defined mostly in policy. The workflow now says the stage must rank gaps, pause on unresolved `P1` issues, and show the user a skill map, but there is not yet a reusable ecosystem skill that makes different agents execute the same stage the same way.</p>
      <p>This work item makes the stage operational: one skill path, one artifact contract, one gap-ranking model, one visible knowledge map, and one clear user decision between <code>pause and revise</code> or <code>continue to planning</code>.</p>
    </section>

    <section class="panel">
      <h2>Availability Schematic</h2>
      <p>This should be identified during planning, not after execution. The purpose is to separate what already exists from what this WRK must add.</p>
      <div class="mermaid">
flowchart TD
    A[Existing document intelligence] --> A1[Registry exists]
    A --> A2[Index exists]
    A --> A3[Mounted-drive content already indexed]
    A --> A4[Remote mounts monitored operationally]

    B[Current gaps] --> B1[No explicit source-registry contract]
    B --> B2[No canonical mapping: mount root to source bucket]
    B --> B3[No dedicated Resource Intelligence skill]
    B --> B4[No validator-ready completion contract]
    B --> B5[Routing authority not yet formally reviewed]

    C[WRK-655 improvements] --> C1[Define or enhance Resource Intelligence skill]
    C --> C2[Add source-registry contract]
    C --> C3[Add provenance, storage, and dedup rules]
    C --> C4[Add validator-ready stage rules]
    C --> C5[Review agent-router and agent-usage-optimizer authority]
    C --> C6[Add example-based validation set]

    A --> C
    B --> C
      </div>
    </section>

    <section class="panel">
      <h2>Planned Deliverables</h2>
      <table>
        <tr><th>Deliverable</th><th>Purpose</th></tr>
        <tr><td>Canonical Resource Intelligence skill</td><td>Create a new canonical skill so the stage executes through one defined ecosystem path rather than ad hoc research behavior.</td></tr>
        <tr><td>Artifact contract</td><td>Define what must exist in the resource pack for the stage to be considered complete.</td></tr>
        <tr><td>Gap model</td><td>Define `P1/P2/P3` priorities and the user-pause rule when unresolved `P1` gaps remain.</td></tr>
        <tr><td>Knowledge map</td><td>Show which skills and systems are used so the user can inspect and tweak the stage.</td></tr>
        <tr><td>Validator-ready rules</td><td>Make later enforcement and tooling integration possible.</td></tr>
        <tr><td>Downloaded reference set</td><td>Capture relevant online codes, standards, and documents in durable repo/document locations and index them for future reuse.</td></tr>
        <tr><td>Routing authority review</td><td>Review or bound `agent-router` and `agent-usage-optimizer` before treating them as authority for stage routing and quota decisions.</td></tr>
      </table>
    </section>

    <section class="panel">
      <h2>First-Pass Implemented Paths</h2>
      <table>
        <tr><th>Artifact</th><th>Path</th></tr>
        <tr><td>Canonical skill</td><td><code>.claude/skills/workspace-hub/resource-intelligence/SKILL.md</code></td></tr>
        <tr><td>Source-registry reference</td><td><code>.claude/skills/workspace-hub/resource-intelligence/references/source-registry.md</code></td></tr>
        <tr><td>Scaffolder</td><td><code>.claude/skills/workspace-hub/resource-intelligence/scripts/init-resource-pack.sh</code></td></tr>
        <tr><td>Validator</td><td><code>.claude/skills/workspace-hub/resource-intelligence/scripts/validate-resource-pack.sh</code></td></tr>
        <tr><td>Maturity sync/check</td><td><code>.claude/skills/workspace-hub/resource-intelligence/scripts/sync-maturity-summary.py</code></td></tr>
        <tr><td>Summary template</td><td><code>.claude/skills/workspace-hub/resource-intelligence/templates/resource-intelligence-summary.md</code></td></tr>
        <tr><td>Mounted-source registry</td><td><code>data/document-index/mounted-source-registry.yaml</code></td></tr>
        <tr><td>Maturity ledger</td><td><code>data/document-index/resource-intelligence-maturity.yaml</code></td></tr>
        <tr><td>Maturity summary</td><td><code>data/document-index/resource-intelligence-maturity.md</code></td></tr>
        <tr><td>Legal scan evidence</td><td><code>.claude/work-queue/assets/WRK-655/legal-scan.md</code></td></tr>
      </table>
    </section>

    <section class="panel">
      <h2>Knowledge Map</h2>
      <table>
        <tr><th>Role</th><th>Skill / System</th><th>Purpose</th></tr>
        <tr><td>Lifecycle wrapper</td><td><code>work-queue</code></td><td>Align stage artifacts to WRK lifecycle.</td></tr>
        <tr><td>Domain scoping</td><td><code>engineering-context-loader</code></td><td>Narrow relevant domain context and standards.</td></tr>
        <tr><td>Repo/document scan</td><td><code>document-inventory</code></td><td>Inventory source collections before deeper processing.</td></tr>
        <tr><td>Document intelligence</td><td><code>document-rag-pipeline</code></td><td>Build searchable document context when needed.</td></tr>
        <tr><td>Prior learnings</td><td><code>knowledge-manager</code></td><td>Surface prior decisions, patterns, corrections, and gotchas.</td></tr>
        <tr><td>Legal gate</td><td><code>legal-sanity</code></td><td>Check resource-pack artifacts for sensitive content.</td></tr>
        <tr><td>Agent fit</td><td><code>agent-router</code></td><td>Select the right provider mix for later stages.</td></tr>
        <tr><td>Quota awareness</td><td><code>agent-usage-optimizer</code></td><td>Keep downstream claim/review work within quota.</td></tr>
        <tr><td>Deep synthesis</td><td><code>comprehensive-learning</code></td><td>Consume outputs later for slower ecosystem learning.</td></tr>
      </table>
    </section>

    <section class="panel">
      <h2>Current Indexed Source State</h2>
      <table>
        <tr><th>Finding</th><th>Evidence</th><th>Implication for WRK-655</th></tr>
        <tr><td>Document-intelligence registry already exists</td><td><code>data/document-index/registry.yaml</code> tracks indexed source buckets.</td><td>`WRK-655` should complement and clarify existing indexed sources, not redefine them from scratch.</td></tr>
        <tr><td>Indexed source buckets already include mounted-storage content</td><td>Current buckets include <code>og_standards</code>, <code>ace_standards</code>, <code>ace_project</code>, <code>dde_project</code>, and <code>workspace_spec</code>.</td><td>The stage should treat these as baseline intelligence sources.</td></tr>
        <tr><td>Mounted-drive examples are already in the index</td><td>Example indexed paths include <code>/mnt/ace/0000 O&amp;G/...</code> and <code>/mnt/ace/docs/_standards/...</code>.</td><td>Mounted drives are not hypothetical future sources; they are already part of the indexed estate.</td></tr>
        <tr><td>Remote/network mounts are monitored operationally</td><td><code>scripts/readiness/check-network-mounts.sh</code> tracks remote mount points under <code>/mnt/remote/...</code>.</td><td>The workflow already knows these mounts exist, but not yet how they map into source buckets.</td></tr>
      </table>
    </section>

    <section class="panel">
      <h2>Current Document-Intelligence Assets</h2>
      <table>
        <tr><th>Asset</th><th>Path</th><th>Role</th></tr>
        <tr><td>Registry</td><td><code>data/document-index/registry.yaml</code></td><td>Source-bucket counts and aggregate registry.</td></tr>
        <tr><td>Main index</td><td><code>data/document-index/index.jsonl</code></td><td>Queryable document-intelligence index.</td></tr>
        <tr><td>Backup index</td><td><code>data/document-index/index.jsonl.bak</code></td><td>Safety copy of the main index.</td></tr>
        <tr><td>Shards</td><td><code>data/document-index/shards/</code></td><td>Sharded source-index inputs.</td></tr>
        <tr><td>Summaries</td><td><code>data/document-index/summaries/</code></td><td>Per-document summary artifacts.</td></tr>
        <tr><td>Transfer ledger</td><td><code>data/document-index/standards-transfer-ledger.yaml</code></td><td>Standards transfer tracking.</td></tr>
        <tr><td>Enhancement plan</td><td><code>data/document-index/enhancement-plan.yaml</code></td><td>Index improvement planning artifact.</td></tr>
      </table>
    </section>

    <section class="panel">
      <h2>Observed Source Buckets and Mount Roots</h2>
      <table>
        <tr><th>Source bucket</th><th>Example path</th><th>Mount/root class</th></tr>
        <tr><td><code>ace_project</code></td><td><code>/mnt/ace/docs/K07NL17002-M00-IA-A-REP-00037_1.pdf</code></td><td>local mounted drive</td></tr>
        <tr><td><code>ace_standards</code></td><td><code>/mnt/ace/docs/_standards/og_standards_api_search.txt</code></td><td>local mounted drive</td></tr>
        <tr><td><code>og_standards</code></td><td><code>/mnt/ace/0000 O&amp;G/0000 Codes &amp; Standards/Codes &amp; Standards Database.xls</code></td><td>local mounted drive</td></tr>
        <tr><td><code>dde_project</code></td><td><code>/mnt/remote/ace-linux-2/dde/documents/0000 Personal/11511/11511 Repair Analysis.pptx</code></td><td>remote mounted drive</td></tr>
        <tr><td><code>workspace_spec</code></td><td><code>/mnt/local-analysis/workspace-hub/specs/archive/legacy-agent-os/product/decisions.md</code></td><td>local workspace</td></tr>
        <tr><td><code>api_metadata</code></td><td><code>api://worldenergydata/BSEE</code></td><td>API source</td></tr>
      </table>
    </section>

    <section class="panel">
      <h2>Source Registry Gap</h2>
      <p>The remaining gap is not whether document-intelligence sources exist. They do. The gap is that there is not yet one explicit source-registry contract mapping mounted and remote-mounted roots to document-intelligence source buckets.</p>
      <p><strong>Recommended contract to add during WRK-655:</strong> <code>source_id</code>, <code>document_intelligence_bucket</code>, <code>mount_root</code>, <code>local_or_remote</code>, <code>index_artifact_ref</code>, <code>registry_ref</code>, <code>canonical_storage_policy</code>, <code>provenance_rule</code>, <code>dedup_rule</code>, and <code>availability_check_ref</code>.</p>
      <p><strong>User decision:</strong> choose the best-structured registry location as long as it is clearly linked to existing document-intelligence assets and well documented for AI agents.</p>
    </section>

    <section class="panel">
      <h2>Routing Capability Review</h2>
      <p>Before <code>agent-router</code> and <code>agent-usage-optimizer</code> are treated as authority for stage assignment, this WRK should either produce a reviewed capability matrix or document an explicit interim-routing rule with limits and override evidence.</p>
      <p><strong>Selected first-pass rule:</strong> use the interim-routing rule first. <code>agent-router</code> is advisory for agent fit, <code>agent-usage-optimizer</code> is advisory for quota/capacity, and the orchestrator retains final routing authority.</p>
      <p>This first-pass routing decision is adopted for <code>WRK-655</code>; it is no longer an open blocker for this item.</p>
    </section>

    <section class="panel">
      <h2>Gap Priority Model</h2>
      <table>
        <tr><th>Priority</th><th>Meaning</th><th>Examples</th></tr>
        <tr><td><span class="status-warn">P1</span></td><td>Blocking gaps that must be shown to the user first.</td><td>Missing source coverage, missing legal-scan result, unclear problem context, no credible path to domain knowledge.</td></tr>
        <tr><td>P2</td><td>Material weaknesses that should be resolved but do not automatically force a stop.</td><td>Incomplete constraints, stale repo knowledge, unresolved medium-impact open questions.</td></tr>
        <tr><td>P3</td><td>Useful enhancements rather than blockers.</td><td>Optional enrichment, broader indexing, extra ecosystem learnings.</td></tr>
      </table>
      <p><strong>User decision rule:</strong> unresolved <code>P1</code> gaps should produce <code>pause and revise</code>. If no <code>P1</code> gaps remain, the stage may <code>continue to planning</code>.</p>
    </section>

    <section class="panel">
      <h2>Intelligence Growth Requirement</h2>
      <p>Relevant codes, standards, and documents found online during intelligence gathering should be downloaded only when they complement existing document-intelligence sources, documented in document intelligence, recorded with provenance, and placed in the relevant long-term reference location for future reuse.</p>
      <p>Target maturity window: <strong>3 months</strong>. Success metric: <strong>&gt;80% of tracked documents marked read and key calculations implemented</strong> in the repository ecosystem or linked follow-on WRKs. Repository intelligence is considered richer when common workflow questions can be answered from curated local knowledge instead of repeatedly re-reading raw source documents.</p>
    </section>

    <section class="panel">
      <h2>Repository-Native Example Set</h2>
      <table>
        <tr><th>Example</th><th>Why it matters</th></tr>
        <tr><td><code>AGENTS.md</code></td><td>Canonical agent contract and workflow constraints.</td></tr>
        <tr><td><code>.claude/work-queue/process.md</code></td><td>Lifecycle and stage-transition source.</td></tr>
        <tr><td><code>specs/wrk/WRK-624/plan.md</code></td><td>Canonical workflow-hardening spec.</td></tr>
        <tr><td><code>assets/WRK-624/wrk-624-workflow-review.html</code></td><td>User-review surface for the governing workflow.</td></tr>
        <tr><td><code>scripts/work-queue/validate-queue-state.sh</code></td><td>Validator behavior and stage evidence checks.</td></tr>
        <tr><td><code>scripts/work-queue/claim-item.sh</code></td><td>Claim-stage implementation details.</td></tr>
        <tr><td><code>scripts/work-queue/close-item.sh</code></td><td>Close-stage implementation details.</td></tr>
        <tr><td><code>agent-router/SKILL.md</code></td><td>Routing-capability authority candidate.</td></tr>
        <tr><td><code>agent-usage-optimizer/SKILL.md</code></td><td>Quota-capability authority candidate.</td></tr>
        <tr><td><code>document-rag-pipeline/SKILL.md</code></td><td>Document-intelligence pipeline baseline.</td></tr>
      </table>
      <p><strong>Minimum first-pass execution cases:</strong> <code>AGENTS.md</code>, <code>WRK-624</code> spec, <code>validate-queue-state.sh</code>, <code>agent-router/SKILL.md</code>, and one remote-mounted <code>dde_project</code> example.</p>
    </section>

    <section class="panel">
      <h2>Tracking Artifacts</h2>
      <p>The 3-month maturity target should be tracked through both a YAML ledger and a linked Markdown summary.</p>
      <p><strong>Rule:</strong> YAML is the canonical state artifact. Markdown must link to it and summarize it without divergence.</p>
      <p><strong>First-pass enforcement:</strong> <code>sync-maturity-summary.py</code> generates the Markdown summary from YAML and <code>sync-maturity-summary.py --check</code> fails on drift.</p>
    </section>

    <section class="panel">
      <h2>User Decisions Recorded</h2>
      <table>
        <tr><th>Decision area</th><th>Decision</th></tr>
        <tr><td>Skill target</td><td>Create a new canonical <code>resource-intelligence</code> skill.</td></tr>
        <tr><td>Registry location</td><td>Use the best-structured location, provided it is clearly linked and documented for AI agents.</td></tr>
        <tr><td>Routing authority</td><td>Use interim-routing rule first; keep orchestrator as final authority.</td></tr>
        <tr><td>Metric tracking</td><td>Use both YAML and Markdown, with Markdown linked to YAML.</td></tr>
        <tr><td>First-pass examples</td><td>Use the recommended minimum example set.</td></tr>
      </table>
    </section>

    <section class="panel">
      <h2>Decision Needed Now</h2>
      <table>
        <tr><th>Decision</th><th>Why it matters</th><th>Current recommendation</th></tr>
        <tr><td>Accept the canonical skill path</td><td>This locks the stage onto one reusable execution path instead of ad hoc variations.</td><td>Use <code>.claude/skills/workspace-hub/resource-intelligence/SKILL.md</code> as the canonical skill.</td></tr>
        <tr><td>Accept the mounted-source registry model</td><td>This makes mounted and remote-mounted document sources explicit and validator-ready.</td><td>Use <code>data/document-index/mounted-source-registry.yaml</code> as the dedicated linked registry.</td></tr>
        <tr><td>Accept the YAML + Markdown maturity tracking pair</td><td>This keeps one canonical machine-readable ledger with a human review surface that should not drift.</td><td>Keep YAML as source of truth and Markdown as linked summary.</td></tr>
        <tr><td>Resolve routing-authority approach</td><td>This determines how strongly Resource Intelligence depends on routing skills during the first pass.</td><td>Adopted: use interim-routing rule first; keep orchestrator final authority.</td></tr>
      </table>
    </section>

    <section class="panel">
      <h2>Review Focus</h2>
      <ul>
        <li>Is the skill boundary clear, or is this still too vague to execute consistently?</li>
        <li>Is the knowledge map sufficient without becoming bloated?</li>
        <li>Is the `P1` pause rule operationally clear enough for user review and future tooling?</li>
        <li>Are the validator-ready requirements concrete enough to support later enforcement?</li>
      </ul>
    </section>
  </main>
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true, theme: 'neutral' });
  </script>
</body>
</html>
