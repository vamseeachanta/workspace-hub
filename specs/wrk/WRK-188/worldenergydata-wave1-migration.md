---
title: "WRK-188 Worldenergydata Wave-1 Migration Plan"
description: "Dry-run manifest and controlled apply checklist for worldenergydata spec centralization"
version: "1.13"
module: governance
status: "draft"
progress: 0
created: "2026-02-17"
updated: "2026-02-18"
priority: "high"
tags: [spec-migration, worldenergydata, governance]
links:
  wrk: ".claude/work-queue/pending/WRK-188.md"
  parent: "specs/wrk/WRK-185/ecosystem-centralization-review.md"
---

# WRK-188 Worldenergydata Wave-1 Migration

## Scope
- In scope: `worldenergydata/**/specs/**`
- In scope for blocking reference checks: governance surfaces `.claude/`, `docs/`, `specs/`, `scripts/`, `config/`, `modules/` only.
- Out of scope: all other repositories and workspace paths (advisory-only scans).

## Canonical Execution Order
1. `Phase-0`: run `Prerequisites` with clean trees (`git status --porcelain` empty in hub and submodule).
2. `Phase-1`: create approval artifacts from `Approval Matrix` (`APPROVED_FOR_DRYRUN`, later `APPROVED_FOR_SIMULATION`, then `APPROVED`).
3. `Phase-2`: run `Dry-Run Commands` and complete `Dry-run review gate`.
4. `Phase-2.5`: run `Multi-Provider Workflow Continuity Check` and generate `review-bindings.env` + `.sha256`.
5. `Phase-3`: run `Simulation Drill Phase` and produce simulation/drill PASS artifacts.
6. `Phase-4`: run `Apply Commands`, `Verification`, commit, publish, closure gate.
7. `Phase-5`: if apply has started and a gate fails, run `Rollback` per state model.
Execution invariants:
- `Phase-0` must run before any `reports/compliance/wrk-188-worldenergydata-*` artifact creation.
- `Phase-4` is blocked unless phases 0-3 PASS artifacts and phase-2.5 review bindings exist with valid hashes.

## Approval Matrix
- `APPROVED_FOR_DRYRUN`: required before dry-run commands.
- `APPROVED_FOR_SIMULATION`: required before fail-fast/simulation drills.
- `APPROVED`: required before apply/publish.
Phase-1 commands to create approval artifacts (run after `Phase-0`):
```bash
REGISTRY="config/governance/wrk-188-approvers.txt"
test -f "$REGISTRY"
# Registry format: one approver ID per line; blank/comment lines are not allowed.
DRYRUN_APPROVER_ID="${DRYRUN_APPROVER_ID:?}"
SIM_APPROVER_ID="${SIM_APPROVER_ID:?}"
APPLY_APPROVER_ID="${APPLY_APPROVER_ID:?}"
echo "$DRYRUN_APPROVER_ID" | rg -q '^[a-zA-Z0-9][a-zA-Z0-9_.@-]{2,}$'
echo "$SIM_APPROVER_ID" | rg -q '^[a-zA-Z0-9][a-zA-Z0-9_.@-]{2,}$'
echo "$APPLY_APPROVER_ID" | rg -q '^[a-zA-Z0-9][a-zA-Z0-9_.@-]{2,}$'
test "$DRYRUN_APPROVER_ID" != "$SIM_APPROVER_ID"
test "$DRYRUN_APPROVER_ID" != "$APPLY_APPROVER_ID"
test "$SIM_APPROVER_ID" != "$APPLY_APPROVER_ID"
rg -qx "$DRYRUN_APPROVER_ID" "$REGISTRY"
rg -qx "$SIM_APPROVER_ID" "$REGISTRY"
rg -qx "$APPLY_APPROVER_ID" "$REGISTRY"
printf "WRK=188\nSTATUS=APPROVED_FOR_DRYRUN\nAPPROVER=%s\nREGISTRY_SHA=%s\nDATE=%s\n" \
  "$DRYRUN_APPROVER_ID" "$(sha256sum "$REGISTRY" | awk '{print $1}')" "$(date -u +%Y-%m-%dT%H:%M:%SZ)" \
  > reports/compliance/wrk-188-worldenergydata-dryrun-approval.txt
printf "WRK=188\nSTATUS=APPROVED_FOR_SIMULATION\nAPPROVER=%s\nREGISTRY_SHA=%s\nDATE=%s\n" \
  "$SIM_APPROVER_ID" "$(sha256sum "$REGISTRY" | awk '{print $1}')" "$(date -u +%Y-%m-%dT%H:%M:%SZ)" \
  > reports/compliance/wrk-188-worldenergydata-simulation-approval.txt
```

## Migration State Model
- `pre-wave`: no centralized targets for this wave exist; fail-fast collision checks must be empty.
- `wave-applied`: centralized targets exist and local specs are pointer-only; second apply must be no-op.
- `partial-applied`: mixed state (some targets/pointers updated); rollback must run before any retry.

## Compliance Artifact Matrix
- `tracked-required`: `required-artifacts.txt`, `dryrun-approval.txt`, `contract-selftest.env`, `script-bindings.env`, `script-bindings.env.sha256`, `simulation-approval.txt`, `simulation-result.env`, `split-publish-drill.env`, `downstream-remediation.env`, `pre-apply-publishability.env`, `pre-apply-gate-pass.env`, `approval.txt`, `approval.txt.sha256`, `approved-heads.env`, `approved-heads.env.sha256`, `review-bindings.env`, `review-bindings.env.sha256`, `success-manifest.json`.
- `tracked-optional`: `execution-state.env`, `rollback-blocked.log`, `perf-override.env`, `review-override.env`, `protected-branch-signoff.env`, `semantic-restore-signoff.env`, `hard-restore-signoff.env`.
- `transient-generated`: other `reports/compliance/wrk-188-worldenergydata-*` files may exist during run and must be cleaned/archived before final clean-tree gate.
`tracked-required` is authoritative; closure gate and done checklist derive from this list. `closure-gate-pass.env` is a terminal output artifact generated by the closure gate itself.

Transient artifact lifecycle policy (reruns):
- `retain`: `tracked-required` and `tracked-optional` artifacts.
- `overwrite`: generated checksum/manifests (`*-apply-preflight.txt`, `*-hits*.txt`, `*-diff-after-*.txt`).
- `clean`: any `wrk-188-worldenergydata-*.tmp` and non-allowlisted `reports/compliance/wrk-188-worldenergydata-*` files before commit/closure gates.

## Migration Script Contract

`migrate_specs_to_workspace.sh` behavior expected for apply mode:
1. Copy files from repo-local `specs/` trees into `specs/repos/<repo>/<original-spec-path>/`.
2. Replace original local `specs/` directory with pointer `README.md`.
3. Leave no non-README files under migrated local `specs/` trees.
4. Fail-fast if any mapped target file exists before first approved apply (no overwrite of pre-wave files).
5. Idempotent apply: once wave-1 apply is complete, a second `--apply` on the same state must be a no-op (no content diff).
6. Dry-run summary line format is fixed:
   `repo=<repo> loc=<relative-spec-dir> files=<count> target=<absolute-target-path> dry_run=true`
7. Source `*/specs/README.md` is treated as ordinary source content during copy; local `README.md` is then replaced by pointer template (no merge/append mode).

Path mapping example:
- Source: `worldenergydata/data/modules/vessel_hull_models/hulls/converted_gdf/specs/README.md`
- Target: `specs/repos/worldenergydata/data/modules/vessel_hull_models/hulls/converted_gdf/specs/README.md`

Pointer README template (minimum):
```markdown
# Specs Pointer

Specs are centralized in:
`specs/repos/worldenergydata/<original-spec-path>/`
```

## Prerequisites

```bash
mkdir -p reports/compliance
command -v bash find cp mv rm awk sed rg python3 sha256sum sort xargs diff git du df timeout ls head cut date wc >/dev/null
test -x scripts/operations/compliance/migrate_specs_to_workspace.sh
scripts/operations/compliance/migrate_specs_to_workspace.sh --help >/dev/null
test -x scripts/operations/compliance/check_governance.sh
scripts/operations/compliance/check_governance.sh --help >/dev/null
scripts/operations/compliance/check_governance.sh --help | rg -q -- '--mode'
scripts/operations/compliance/check_governance.sh --help | rg -q -- '--scope'
scripts/operations/compliance/check_governance.sh --help | rg -q -- 'changed'
test -x scripts/review/cross-review.sh
test -x scripts/review/normalize-verdicts.sh
command -v claude codex gemini >/dev/null
test -f config/governance/wrk-188-approvers.txt
test -s config/governance/wrk-188-approvers.txt
test "$(rg -n '^[a-zA-Z0-9][a-zA-Z0-9_.@-]{2,}$' config/governance/wrk-188-approvers.txt | wc -l | tr -d ' ')" -ge 3
test -z "$(rg -n -v '^[a-zA-Z0-9][a-zA-Z0-9_.@-]{2,}$' config/governance/wrk-188-approvers.txt | cat)"
TMP_VERDICT="$(mktemp)"
printf "### Verdict: REQUEST_CHANGES\n" > "$TMP_VERDICT"
test "$(scripts/review/normalize-verdicts.sh "$TMP_VERDICT")" = "MAJOR"
rm -f "$TMP_VERDICT"
test -z "$(git status --porcelain)"
test -z "$(git -C worldenergydata status --porcelain)"
git submodule sync --recursive
git submodule update --init --recursive
git -C worldenergydata rev-parse --git-dir >/dev/null
test "$(git submodule status -- worldenergydata | wc -l | tr -d ' ')" = "1"
git submodule status -- worldenergydata | rg -q '^[ +-U]?[0-9a-f]{40}[[:space:]]+worldenergydata'
# Require upstream only when not detached HEAD.
if [ "$(git rev-parse --abbrev-ref HEAD)" != "HEAD" ]; then git rev-parse --abbrev-ref --symbolic-full-name @{u} >/dev/null; fi
if [ "$(git -C worldenergydata rev-parse --abbrev-ref HEAD)" != "HEAD" ]; then git -C worldenergydata rev-parse --abbrev-ref --symbolic-full-name @{u} >/dev/null; fi
mkdir -p specs/repos/worldenergydata
# clean-room baseline preferred; for retry runs use rollback first
test -z "$(find worldenergydata -path '*/specs/*' -type l)"
test "$(df -Pk . | awk 'NR==2{print $4}')" -gt "$(du -sk worldenergydata | awk '{print $1*2}')"
python3 - <<'PY'
import sys
raise SystemExit(0 if sys.version_info >= (3,10) else 1)
PY
bash --version | head -n1 | rg -q 'bash'
git --version | awk '{print $3}' | awk -F. '{exit !($1>2 || ($1==2 && $2>=39))}'
awk --version 2>/dev/null | head -n1 | rg -q 'GNU Awk|mawk'
sed --version 2>/dev/null | head -n1 | rg -q 'GNU sed'
sha256sum --version | head -n1 | rg -q 'sha256sum'
find --version | head -n1 | rg -q 'GNU findutils'
# commit identity/auth capability preflight
test -n "$(git config --get user.name)"
test -n "$(git config --get user.email)"
test -n "$(git -C worldenergydata config --get user.name)"
test -n "$(git -C worldenergydata config --get user.email)"
git remote get-url origin >/dev/null
git -C worldenergydata remote get-url origin >/dev/null
AUTH_READY=0
for i in 1 2 3; do
  if git ls-remote --exit-code origin >/dev/null && git -C worldenergydata ls-remote --exit-code origin >/dev/null; then
    AUTH_READY=1
    break
  fi
  sleep 5
done
test "$AUTH_READY" = "1"
# explicit branch policy mode (WRK-188 execute mode is direct push only; pr_only is unsupported-auth-policy)
BRANCH_POLICY_MODE="${BRANCH_POLICY_MODE:-direct_push}"
echo "$BRANCH_POLICY_MODE" | rg -q '^(direct_push|pr_only)$'
test "$BRANCH_POLICY_MODE" = "direct_push"
# publishability preflight (branch policy/permissions)
git -C worldenergydata push --dry-run
git push --dry-run
```
Assumptions:
- Commands target GNU/Linux shell toolchain (`bash`, GNU `find`, GNU `sed`, GNU coreutils).
- Unicode normalization collision handling (NFC/NFD) is out of scope for wave-1.
- Unsupported environment outcome is `UNSUPPORTED_ENV_ABORT` (non-zero exit and no apply).
- Unsupported auth/branch-policy mode outcome is `UNSUPPORTED_AUTH_POLICY_ABORT` (non-zero exit and no apply).

## File Handling Policy

1. Symlinks under `worldenergydata/**/specs/**` are not allowed for this wave (preflight rejects).
2. Content integrity is required (`sha256sum` parity).
3. Mode/timestamp differences are non-blocking for this wave (content-first migration).
4. Hidden and binary files are in scope if they match `*/specs/*`.
5. Pre-existing authored local `*/specs/README.md` is centralized as source content in target path before pointer replacement locally.

## Dry-Run Commands
```bash
# explicit pre-dry-run approval gate
test -f reports/compliance/wrk-188-worldenergydata-dryrun-approval.txt
rg -q '^STATUS=APPROVED_FOR_DRYRUN$' reports/compliance/wrk-188-worldenergydata-dryrun-approval.txt
# interface contract gate (required before dry-run approval can progress)
scripts/operations/compliance/migrate_specs_to_workspace.sh --help | rg -q -- '--apply'
scripts/operations/compliance/migrate_specs_to_workspace.sh --help | rg -q -- '--repos'
# early performance guard before expensive checksum generation
SRC_COUNT_EARLY="$(find worldenergydata -type f -path '*/specs/*' -print0 | tr -cd '\0' | wc -c)"
if [ "$SRC_COUNT_EARLY" -ge 50000 ] && [ "${PERF_OVERRIDE:-}" != "YES" ]; then
  echo "source file count $SRC_COUNT_EARLY exceeds guard; set PERF_OVERRIDE=YES with governance note to continue"
  exit 1
fi
scripts/operations/compliance/migrate_specs_to_workspace.sh --repos worldenergydata | tee reports/compliance/wrk-188-worldenergydata-dryrun.log
find worldenergydata -type f -path '*/specs/*' -print0 | sort -z | xargs -0 sha256sum > reports/compliance/wrk-188-worldenergydata-source-checksums.txt
python3 - <<'PY'
from pathlib import Path
roots = set()
src_files = []
tgt_files = []
bad_paths = []
for p in Path("worldenergydata").rglob("*"):
    s = str(p).replace("\\", "/")
    if p.is_file() and "/specs/" in s:
        if any(ord(ch) < 32 for ch in s):
            bad_paths.append(s)
        src_files.append(s)
        tgt_files.append(s.replace("worldenergydata/", "specs/repos/worldenergydata/", 1))
        roots.add(s.split("/specs/", 1)[0] + "/specs")
Path("reports/compliance/wrk-188-worldenergydata-source-spec-roots.txt").write_text("\n".join(sorted(roots)) + "\n")
Path("reports/compliance/wrk-188-worldenergydata-approved-source-files.txt").write_text("\n".join(sorted(src_files)) + "\n")
Path("reports/compliance/wrk-188-worldenergydata-approved-target-files.txt").write_text("\n".join(sorted(tgt_files)) + "\n")
Path("reports/compliance/wrk-188-worldenergydata-invalid-paths.txt").write_text("\n".join(sorted(bad_paths)))
if bad_paths:
    raise SystemExit(1)
PY
test -s reports/compliance/wrk-188-worldenergydata-dryrun.log
test -s reports/compliance/wrk-188-worldenergydata-source-spec-roots.txt
test -s reports/compliance/wrk-188-worldenergydata-approved-source-files.txt
test -s reports/compliance/wrk-188-worldenergydata-approved-target-files.txt
# performance guard enforced in dry-run review gate via SRC_COUNT and PERF_OVERRIDE policy.
test "$(wc -l < reports/compliance/wrk-188-worldenergydata-source-spec-roots.txt | tr -d ' ')" -eq "$(rg -c '^repo=worldenergydata loc=.* files=[0-9]+ target=.* dry_run=true$' reports/compliance/wrk-188-worldenergydata-dryrun.log)"
test "$(rg -c '^repo=worldenergydata loc=.* files=[0-9]+ target=.* dry_run=true$' reports/compliance/wrk-188-worldenergydata-dryrun.log)" -gt 0
test -z "$(rg -n -v '^repo=worldenergydata loc=.* files=[0-9]+ target=.* dry_run=true$|^  would-move: .+$' reports/compliance/wrk-188-worldenergydata-dryrun.log | cat)"
# pre-apply target collision gate (must be empty for wave-1 fail-fast policy)
python3 - <<'PY'
from pathlib import Path
collisions = []
collisions_fold = []
type_conflicts = []
for p in Path("worldenergydata").rglob("*"):
    s = str(p).replace("\\", "/")
    if p.is_file() and "/specs/" in s:
        t = s.replace("worldenergydata/", "specs/repos/worldenergydata/", 1)
        tp = Path(t)
        if tp.exists():
            collisions.append(f"{s} -> {t}")
            if tp.is_dir():
                type_conflicts.append(f"file->dir conflict: {s} -> {t}")
        # parent path collision: file exists where directory is needed
        parent = tp.parent
        while str(parent).startswith("specs/repos/worldenergydata") and str(parent) != "specs/repos/worldenergydata":
            if parent.exists() and parent.is_file():
                type_conflicts.append(f"dir->file conflict: {s} -> parent {parent}")
                break
            parent = parent.parent
        # Case-insensitive collision check for cross-platform safety
        if not tp.exists():
            parent = tp.parent
            if parent.exists():
                name_fold = tp.name.lower()
                for sibling in parent.iterdir():
                    if sibling.name.lower() == name_fold:
                        collisions_fold.append(f"{s} -> {sibling} (case-fold)")
Path("reports/compliance/wrk-188-worldenergydata-target-collisions.txt").write_text("\n".join(collisions))
Path("reports/compliance/wrk-188-worldenergydata-target-collisions-casefold.txt").write_text("\n".join(collisions_fold))
Path("reports/compliance/wrk-188-worldenergydata-target-type-conflicts.txt").write_text("\n".join(type_conflicts))
raise SystemExit(1 if collisions or collisions_fold or type_conflicts else 0)
PY
# duplicate target-path preflight check
python3 - <<'PY'
from pathlib import Path
targets = []
for p in Path("worldenergydata").rglob("*"):
    if p.is_file() and "/specs/" in str(p).replace("\\","/"):
        targets.append(str(p).replace("worldenergydata/", "specs/repos/worldenergydata/", 1))
seen = set()
dups = set()
seen_fold = {}
dups_fold = set()
for t in targets:
    if t in seen:
        dups.add(t)
    tf = t.lower()
    if tf in seen_fold and seen_fold[tf] != t:
        dups_fold.add(f"{seen_fold[tf]} <-> {t}")
    else:
        seen_fold[tf] = t
    seen.add(t)
Path("reports/compliance/wrk-188-worldenergydata-duplicate-targets.txt").write_text("\n".join(sorted(dups)))
Path("reports/compliance/wrk-188-worldenergydata-duplicate-targets-casefold.txt").write_text("\n".join(sorted(dups_fold)))
raise SystemExit(1 if dups or dups_fold else 0)
PY
```

Dry-run review gate (required before apply):
1. Verify explicit dry-run authorization artifact exists.
2. Attach `reports/compliance/wrk-188-worldenergydata-dryrun.log` to WRK-188 progress update.
3. Confirm dry-run contains summary lines matching:
   `repo=worldenergydata loc=<path> files=<n> target=<path> dry_run=true`
   and line count equals `reports/compliance/wrk-188-worldenergydata-source-spec-roots.txt`.
4. Capture approved dry-run artifact hash for traceability:
```bash
sha256sum reports/compliance/wrk-188-worldenergydata-dryrun.log > reports/compliance/wrk-188-worldenergydata-dryrun.log.sha256
sha256sum reports/compliance/wrk-188-worldenergydata-source-checksums.txt > reports/compliance/wrk-188-worldenergydata-source-checksums.txt.sha256
sha256sum reports/compliance/wrk-188-worldenergydata-approved-source-files.txt > reports/compliance/wrk-188-worldenergydata-approved-source-files.txt.sha256
SRC_COUNT="$(find worldenergydata -type f -path '*/specs/*' -print0 | tr -cd '\0' | wc -c)"
if [ "$SRC_COUNT" -ge 50000 ] && [ "${PERF_OVERRIDE:-}" != "YES" ]; then
  echo "source file count $SRC_COUNT exceeds guard; set PERF_OVERRIDE=YES with governance note to continue"
  exit 1
fi
if [ "${PERF_OVERRIDE:-}" = "YES" ]; then
  printf "PERF_OVERRIDE=YES\nAPPROVER=%s\nREASON=%s\nDATE=%s\n" "${APPLY_APPROVER_ID:-unknown}" "${PERF_OVERRIDE_REASON:?}" "$(date -u +%Y-%m-%dT%H:%M:%SZ)" > reports/compliance/wrk-188-worldenergydata-perf-override.env
fi
echo "$SRC_COUNT" > reports/compliance/wrk-188-worldenergydata-source-count.txt
git -C worldenergydata rev-parse HEAD > reports/compliance/wrk-188-worldenergydata-pre-apply-submodule-sha.txt
# explicit approval artifact (required before apply)
# apply approval must come from distinct, registry-authorized approver
REGISTRY="config/governance/wrk-188-approvers.txt"
test -f "$REGISTRY"
test -n "${APPLY_APPROVER_ID:-}"
echo "$APPLY_APPROVER_ID" | rg -q '^[a-zA-Z0-9][a-zA-Z0-9_.@-]{2,}$'
rg -qx "$APPLY_APPROVER_ID" "$REGISTRY"
DRYRUN_APPROVER="$(awk -F= '/^APPROVER=/{print $2}' reports/compliance/wrk-188-worldenergydata-dryrun-approval.txt)"
SIM_APPROVER="$(awk -F= '/^APPROVER=/{print $2}' reports/compliance/wrk-188-worldenergydata-simulation-approval.txt)"
test "$APPLY_APPROVER_ID" != "$DRYRUN_APPROVER"
test "$APPLY_APPROVER_ID" != "$SIM_APPROVER"
printf "WRK=188\nSPEC=worldenergydata-wave1-migration\nSTATUS=APPROVED\nAPPROVER=%s\nREGISTRY_SHA=%s\nDRY_RUN_HASH=%s\nDATE=%s\n" \
  "$APPLY_APPROVER_ID" \
  "$(sha256sum "$REGISTRY" | awk '{print $1}')" \
  "$(cut -d' ' -f1 reports/compliance/wrk-188-worldenergydata-dryrun.log.sha256)" \
  "$(date -u +%Y-%m-%dT%H:%M:%SZ)" \
  > reports/compliance/wrk-188-worldenergydata-approval.txt
sha256sum reports/compliance/wrk-188-worldenergydata-approval.txt > reports/compliance/wrk-188-worldenergydata-approval.txt.sha256
# approval artifacts must be committed before apply gate
git add reports/compliance/wrk-188-worldenergydata-approval.txt reports/compliance/wrk-188-worldenergydata-approval.txt.sha256
git commit -m "docs(approval): WRK-188 apply approval artifact"
# capture authoritative heads after approval commit
printf "HUB_HEAD=%s\nWORLDENERGYDATA_HEAD=%s\n" "$(git rev-parse HEAD)" "$(git -C worldenergydata rev-parse HEAD)" > reports/compliance/wrk-188-worldenergydata-approved-heads.env
sha256sum reports/compliance/wrk-188-worldenergydata-approved-heads.env > reports/compliance/wrk-188-worldenergydata-approved-heads.env.sha256
# note: phase-2.5 regenerates approved-heads to lock apply to the reviewed head state
# bind script immutability between approval and apply
printf "MIGRATE_SCRIPT_SHA=%s\nGOVERNANCE_SCRIPT_SHA=%s\nCROSS_REVIEW_SCRIPT_SHA=%s\nNORMALIZE_VERDICTS_SCRIPT_SHA=%s\n" \
  "$(sha256sum scripts/operations/compliance/migrate_specs_to_workspace.sh | awk '{print $1}')" \
  "$(sha256sum scripts/operations/compliance/check_governance.sh | awk '{print $1}')" \
  "$(sha256sum scripts/review/cross-review.sh | awk '{print $1}')" \
  "$(sha256sum scripts/review/normalize-verdicts.sh | awk '{print $1}')" \
  > reports/compliance/wrk-188-worldenergydata-script-bindings.env
sha256sum reports/compliance/wrk-188-worldenergydata-script-bindings.env > reports/compliance/wrk-188-worldenergydata-script-bindings.env.sha256
```

## Simulation Drill Phase (Required Before Apply)
```bash
test -f reports/compliance/wrk-188-worldenergydata-simulation-approval.txt
rg -q '^STATUS=APPROVED_FOR_SIMULATION$' reports/compliance/wrk-188-worldenergydata-simulation-approval.txt
# script-level fail-fast validation against disposable clone (must exercise migration script behavior)
TMP_CLONE="$(mktemp -d)"
git clone --quiet --shared . "$TMP_CLONE"
(
  cd "$TMP_CLONE"
  git submodule update --init --recursive >/dev/null
  test -x scripts/operations/compliance/migrate_specs_to_workspace.sh
  scripts/operations/compliance/migrate_specs_to_workspace.sh --repos worldenergydata >/dev/null
  SRC="$(find worldenergydata -type f -path '*/specs/*' | head -n1)"
  test -n "$SRC"
  TGT="$(python3 - <<'PY' "$SRC"
import sys
s = sys.argv[1]
print(s.replace("worldenergydata/", "specs/repos/worldenergydata/", 1))
PY
)"
  mkdir -p "$(dirname "$TGT")"
  printf "collision\n" > "$TGT"
  ! scripts/operations/compliance/migrate_specs_to_workspace.sh --apply --repos worldenergydata
)
rm -rf "$TMP_CLONE"
# fail-fast and split-publish drills execute on disposable fixture/staging context
TMP_FIXTURE="$(mktemp -d)"
mkdir -p "$TMP_FIXTURE/repo/specs"
echo test > "$TMP_FIXTURE/repo/specs/README.md"
ln -s README.md "$TMP_FIXTURE/repo/specs/link.md"
find "$TMP_FIXTURE/repo" -path '*/specs/*' -type l | rg -q .
mkdir -p "$TMP_FIXTURE/ro/specs"
touch "$TMP_FIXTURE/ro/specs/a.md"
chmod -w "$TMP_FIXTURE/ro/specs"
test ! -w "$TMP_FIXTURE/ro/specs"
! cp "$TMP_FIXTURE/ro/specs/a.md" "$TMP_FIXTURE/ro/specs/b.md"
rm -rf "$TMP_FIXTURE"
printf "CONTRACT_SELFTEST=PASS\nDATE=%s\n" "$(date -u +%Y-%m-%dT%H:%M:%SZ)" > reports/compliance/wrk-188-worldenergydata-contract-selftest.env
printf "SIMULATION_STATUS=PASS\nDATE=%s\n" "$(date -u +%Y-%m-%dT%H:%M:%SZ)" > reports/compliance/wrk-188-worldenergydata-simulation-result.env
printf "SPLIT_PUBLISH_DRILL=PASS\nDATE=%s\n" "$(date -u +%Y-%m-%dT%H:%M:%SZ)" > reports/compliance/wrk-188-worldenergydata-split-publish-drill.env
```

## Apply Commands (Do Not Run Before Approval)
```bash
# Authoritative pre-apply gate: run as one block; do not cherry-pick individual checks.
sha256sum -c reports/compliance/wrk-188-worldenergydata-approved-heads.env.sha256
source reports/compliance/wrk-188-worldenergydata-approved-heads.env
test -f reports/compliance/wrk-188-worldenergydata-contract-selftest.env
rg -q '^CONTRACT_SELFTEST=PASS$' reports/compliance/wrk-188-worldenergydata-contract-selftest.env
test -f reports/compliance/wrk-188-worldenergydata-script-bindings.env
test -f reports/compliance/wrk-188-worldenergydata-script-bindings.env.sha256
sha256sum -c reports/compliance/wrk-188-worldenergydata-script-bindings.env.sha256
source reports/compliance/wrk-188-worldenergydata-script-bindings.env
test "$MIGRATE_SCRIPT_SHA" = "$(sha256sum scripts/operations/compliance/migrate_specs_to_workspace.sh | awk '{print $1}')"
test "$GOVERNANCE_SCRIPT_SHA" = "$(sha256sum scripts/operations/compliance/check_governance.sh | awk '{print $1}')"
test "$CROSS_REVIEW_SCRIPT_SHA" = "$(sha256sum scripts/review/cross-review.sh | awk '{print $1}')"
test "$NORMALIZE_VERDICTS_SCRIPT_SHA" = "$(sha256sum scripts/review/normalize-verdicts.sh | awk '{print $1}')"
test ! -s reports/compliance/wrk-188-worldenergydata-rollback-blocked.log 2>/dev/null || { cat reports/compliance/wrk-188-worldenergydata-rollback-blocked.log; exit 1; }
# retries after rollback require explicit rollback PASS artifact
if test -f reports/compliance/wrk-188-worldenergydata-rollback-pre-snapshot.txt; then
  test -f reports/compliance/wrk-188-worldenergydata-rollback-pass.env
  rg -q '^ROLLBACK_STATUS=PASS$' reports/compliance/wrk-188-worldenergydata-rollback-pass.env
fi
test "$(git rev-parse HEAD)" = "$HUB_HEAD"
test "$(git -C worldenergydata rev-parse HEAD)" = "$WORLDENERGYDATA_HEAD"
# allow WRK-188 compliance artifacts during apply preflight
python3 - <<'PY'
import subprocess
out = subprocess.check_output(["git", "status", "--porcelain=v1", "-z"])
allowed_prefix = "reports/compliance/wrk-188-worldenergydata-"
for rec in out.decode("utf-8", "surrogateescape").split("\0"):
    if not rec:
        continue
    path = rec[3:]
    if " -> " in path:
        path = path.split(" -> ", 1)[1]
    if path and not path.startswith(allowed_prefix):
        raise SystemExit(1)
PY
test -z "$(git -C worldenergydata status --porcelain)"
# revalidate source manifests/checksums against approved dry-run artifacts
find worldenergydata -type f -path '*/specs/*' -print0 | sort -z | xargs -0 sha256sum > reports/compliance/wrk-188-worldenergydata-source-checksums-apply-preflight.txt
diff reports/compliance/wrk-188-worldenergydata-source-checksums.txt reports/compliance/wrk-188-worldenergydata-source-checksums-apply-preflight.txt
python3 - <<'PY'
from pathlib import Path
rows = []
for p in Path("worldenergydata").rglob("*"):
    s = str(p).replace("\\", "/")
    if p.is_file() and "/specs/" in s:
        rows.append(s)
Path("reports/compliance/wrk-188-worldenergydata-approved-source-files-apply-preflight.txt").write_text("\n".join(sorted(rows)) + "\n")
PY
diff reports/compliance/wrk-188-worldenergydata-approved-source-files.txt reports/compliance/wrk-188-worldenergydata-approved-source-files-apply-preflight.txt
# pre-apply downstream path safety gate
ALLOWLIST="reports/compliance/wrk-188-worldenergydata-downstream-allowlist.txt"
test -f "$ALLOWLIST" || : > "$ALLOWLIST"
# blocker scan limited to governance surfaces to avoid out-of-scope workspace noise
rg -n 'worldenergydata/(.*/)?specs/' -- .claude docs specs scripts config modules -g '!.git/**' -g '!worldenergydata/**' -g '!specs/repos/worldenergydata/**' -g '!reports/**' > reports/compliance/wrk-188-worldenergydata-downstream-hits.txt || true
if test -s "$ALLOWLIST"; then
  rg -n -v -f "$ALLOWLIST" reports/compliance/wrk-188-worldenergydata-downstream-hits.txt > reports/compliance/wrk-188-worldenergydata-downstream-hits-unallowed.txt || true
else
  cp reports/compliance/wrk-188-worldenergydata-downstream-hits.txt reports/compliance/wrk-188-worldenergydata-downstream-hits-unallowed.txt
fi
test ! -s reports/compliance/wrk-188-worldenergydata-downstream-hits-unallowed.txt
REGISTRY="config/governance/wrk-188-approvers.txt"
test -f "$REGISTRY"
REGISTRY_SHA_NOW="$(sha256sum "$REGISTRY" | awk '{print $1}')"
test -f reports/compliance/wrk-188-worldenergydata-simulation-approval.txt
rg -q '^STATUS=APPROVED_FOR_SIMULATION$' reports/compliance/wrk-188-worldenergydata-simulation-approval.txt
rg -q "^REGISTRY_SHA=$REGISTRY_SHA_NOW$" reports/compliance/wrk-188-worldenergydata-simulation-approval.txt
test -f reports/compliance/wrk-188-worldenergydata-simulation-result.env
rg -q '^SIMULATION_STATUS=PASS$' reports/compliance/wrk-188-worldenergydata-simulation-result.env
test -f reports/compliance/wrk-188-worldenergydata-dryrun-approval.txt
rg -q '^STATUS=APPROVED_FOR_DRYRUN$' reports/compliance/wrk-188-worldenergydata-dryrun-approval.txt
rg -q "^REGISTRY_SHA=$REGISTRY_SHA_NOW$" reports/compliance/wrk-188-worldenergydata-dryrun-approval.txt
test -f reports/compliance/wrk-188-worldenergydata-approval.txt
test -f reports/compliance/wrk-188-worldenergydata-approval.txt.sha256
sha256sum -c reports/compliance/wrk-188-worldenergydata-approval.txt.sha256
git ls-files --error-unmatch reports/compliance/wrk-188-worldenergydata-approval.txt >/dev/null
git ls-files --error-unmatch reports/compliance/wrk-188-worldenergydata-approval.txt.sha256 >/dev/null
rg -q '^STATUS=APPROVED$' reports/compliance/wrk-188-worldenergydata-approval.txt
APPROVER_APPROVAL="$(awk -F= '/^APPROVER=/{print $2}' reports/compliance/wrk-188-worldenergydata-approval.txt)"
echo "$APPROVER_APPROVAL" | rg -q '^[a-zA-Z0-9][a-zA-Z0-9_.@-]{2,}$'
rg -qx "$APPROVER_APPROVAL" "$REGISTRY"
rg -q "^REGISTRY_SHA=$REGISTRY_SHA_NOW$" reports/compliance/wrk-188-worldenergydata-approval.txt
DRYRUN_APPROVER="$(awk -F= '/^APPROVER=/{print $2}' reports/compliance/wrk-188-worldenergydata-dryrun-approval.txt)"
SIM_APPROVER="$(awk -F= '/^APPROVER=/{print $2}' reports/compliance/wrk-188-worldenergydata-simulation-approval.txt)"
test "$APPROVER_APPROVAL" != "$DRYRUN_APPROVER"
test "$APPROVER_APPROVAL" != "$SIM_APPROVER"
rg -q "^DRY_RUN_HASH=$(cut -d' ' -f1 reports/compliance/wrk-188-worldenergydata-dryrun.log.sha256)$" reports/compliance/wrk-188-worldenergydata-approval.txt
# protected-branch explicit gate
if echo "$(git rev-parse --abbrev-ref HEAD)" | rg -q '^(main|master)$'; then
  test -f reports/compliance/wrk-188-worldenergydata-protected-branch-signoff.env
  rg -q '^PROTECTED_BRANCH=APPROVED$' reports/compliance/wrk-188-worldenergydata-protected-branch-signoff.env
  rg -q '^APPROVER=[a-zA-Z0-9][a-zA-Z0-9_.@-]{2,}$' reports/compliance/wrk-188-worldenergydata-protected-branch-signoff.env
fi
# publishability gate (universal blocker before apply)
PUBLISHABLE=0
for i in 1 2 3; do
  if git -C worldenergydata push --dry-run && git push --dry-run; then
    PUBLISHABLE=1
    break
  fi
  sleep 5
done
test "$PUBLISHABLE" = "1"
printf "PUBLISHABILITY=PASS\nATTEMPTS=%s\nDATE=%s\n" "$i" "$(date -u +%Y-%m-%dT%H:%M:%SZ)" > reports/compliance/wrk-188-worldenergydata-pre-apply-publishability.env
# bind cross-review artifacts to current spec+heads
test -f reports/compliance/wrk-188-worldenergydata-review-bindings.env
test -f reports/compliance/wrk-188-worldenergydata-review-bindings.env.sha256
sha256sum -c reports/compliance/wrk-188-worldenergydata-review-bindings.env.sha256
source reports/compliance/wrk-188-worldenergydata-review-bindings.env
SPEC_SHA_NOW="$(sha256sum specs/wrk/WRK-188/worldenergydata-wave1-migration.md | awk '{print $1}')"
test "$REVIEW_SPEC_SHA" = "$SPEC_SHA_NOW"
test "$REVIEW_HUB_HEAD" = "$HUB_HEAD"
test "$REVIEW_WORLDENERGYDATA_HEAD" = "$WORLDENERGYDATA_HEAD"
if test -f reports/compliance/wrk-188-worldenergydata-review-override.env; then
  source reports/compliance/wrk-188-worldenergydata-review-override.env
  rg -q '^REVIEW_OVERRIDE=APPROVED$' reports/compliance/wrk-188-worldenergydata-review-override.env
  echo "$MISSING_PROVIDER" | rg -q '^(claude|codex|gemini)$'
  test "$REVIEW_CLAUDE_SHA" = "$(sha256sum "$REVIEW_CLAUDE_FILE" | awk '{print $1}')" || test "$MISSING_PROVIDER" = "claude"
  test "$REVIEW_CODEX_SHA" = "$(sha256sum "$REVIEW_CODEX_FILE" | awk '{print $1}')" || test "$MISSING_PROVIDER" = "codex"
  test "$REVIEW_GEMINI_SHA" = "$(sha256sum "$REVIEW_GEMINI_FILE" | awk '{print $1}')" || test "$MISSING_PROVIDER" = "gemini"
else
  test "$REVIEW_CLAUDE_SHA" = "$(sha256sum "$REVIEW_CLAUDE_FILE" | awk '{print $1}')"
  test "$REVIEW_CODEX_SHA" = "$(sha256sum "$REVIEW_CODEX_FILE" | awk '{print $1}')"
  test "$REVIEW_GEMINI_SHA" = "$(sha256sum "$REVIEW_GEMINI_FILE" | awk '{print $1}')"
fi
printf "PRE_APPLY_GATE=PASS\nDATE=%s\n" "$(date -u +%Y-%m-%dT%H:%M:%SZ)" > reports/compliance/wrk-188-worldenergydata-pre-apply-gate-pass.env
timeout 1800s scripts/operations/compliance/migrate_specs_to_workspace.sh --apply --repos worldenergydata || {
  printf "STATE=partial-applied\nDATE=%s\n" "$(date -u +%Y-%m-%dT%H:%M:%SZ)" > reports/compliance/wrk-188-worldenergydata-rollback-state.env
  exit 1
}
find specs/repos/worldenergydata -type f -path '*/specs/*' -print0 | sort -z | xargs -0 sha256sum > reports/compliance/wrk-188-worldenergydata-target-checksums.txt
```

## Verification
1. Pre/post count parity (pre-apply source vs post-apply centralized target):
```bash
python3 - <<'PY'
from pathlib import Path
rows = []
for p in Path("specs/repos/worldenergydata").rglob("*"):
    s = str(p).replace("\\", "/")
    if p.is_file() and "/specs/" in s:
        rows.append(s)
Path("reports/compliance/wrk-188-worldenergydata-applied-target-files.txt").write_text("\n".join(sorted(rows)) + "\n")
PY
diff reports/compliance/wrk-188-worldenergydata-approved-target-files.txt reports/compliance/wrk-188-worldenergydata-applied-target-files.txt
find specs/repos/worldenergydata -type f -path '*/specs/*' -print0 | tr -cd '\0' | wc -c > reports/compliance/wrk-188-worldenergydata-target-count.txt
test "$(cat reports/compliance/wrk-188-worldenergydata-source-count.txt)" -eq "$(cat reports/compliance/wrk-188-worldenergydata-target-count.txt)"
```
2. Checksum diff is empty after path-normalized comparison:
```bash
python3 - <<'PY'
from pathlib import Path
def load(path: str, drop_prefix: str):
    rows = set()
    for line in Path(path).read_text().splitlines():
        if not line.strip():
            continue
        h, p = line.split(maxsplit=1)
        norm = p.strip()
        if norm.startswith(drop_prefix):
            norm = norm[len(drop_prefix):]
        rows.add((h, norm))
    return rows
src = load("reports/compliance/wrk-188-worldenergydata-source-checksums.txt", "worldenergydata/")
dst = load("reports/compliance/wrk-188-worldenergydata-target-checksums.txt", "specs/repos/worldenergydata/")
if src != dst:
    missing = sorted(src - dst)[:10]
    extra = sorted(dst - src)[:10]
    print("checksum mismatch")
    print("missing", missing)
    print("extra", extra)
    raise SystemExit(1)
PY
```
3. `worldenergydata/**/specs/README.md` pointer exists and includes:
- heading: `# Specs Pointer`
- centralized path beginning with ``specs/repos/worldenergydata/``
```bash
while IFS= read -r d; do
  test -f "$d/README.md"
  rel="${d#worldenergydata/}"
  test -n "$rel"
  test "${rel#/}" = "$rel"
  expected="specs/repos/worldenergydata/${rel}"
  rg -q "^# Specs Pointer$" "$d/README.md"
  rg -Fq "$expected" "$d/README.md"
  python3 - <<'PY' "$d/README.md" "$expected"
from pathlib import Path
import sys
text = Path(sys.argv[1]).read_text()
expected = sys.argv[2]
if f"`{expected}`" not in text and expected not in text:
    raise SystemExit(1)
PY
done < reports/compliance/wrk-188-worldenergydata-source-spec-roots.txt
```
4. Local specs trees contain only pointer README files:
```bash
test -z "$(find worldenergydata -type f -path '*/specs/*' ! -name 'README.md')"
```
5. Multi-provider plan cross-review gate (machine-checkable):
- Claude, Codex, and Gemini plan reviews are recorded.
- No unresolved `MAJOR`.
- Claude must produce a non-`NO_OUTPUT` verdict.
- If Gemini or Codex is `NO_OUTPUT`, the other two must be `APPROVE` or `MINOR`.
```bash
ls scripts/review/results/*worldenergydata-wave1-migration.md-plan-claude.md >/dev/null
ls scripts/review/results/*worldenergydata-wave1-migration.md-plan-codex.md >/dev/null
ls scripts/review/results/*worldenergydata-wave1-migration.md-plan-gemini.md >/dev/null
F_CLAUDE="$(ls -1t scripts/review/results/*worldenergydata-wave1-migration.md-plan-claude.md | head -n1)"
F_CODEX="$(ls -1t scripts/review/results/*worldenergydata-wave1-migration.md-plan-codex.md | head -n1)"
F_GEMINI="$(ls -1t scripts/review/results/*worldenergydata-wave1-migration.md-plan-gemini.md | head -n1)"
test -n "$F_CLAUDE" && test -n "$F_CODEX" && test -n "$F_GEMINI"
V_CLAUDE="$(scripts/review/normalize-verdicts.sh "$F_CLAUDE")"
V_CODEX="$(scripts/review/normalize-verdicts.sh "$F_CODEX")"
V_GEMINI="$(scripts/review/normalize-verdicts.sh "$F_GEMINI")"
test "$V_CLAUDE" != "NO_OUTPUT"
echo "$V_CLAUDE $V_CODEX $V_GEMINI" | rg -q 'MAJOR|ERROR' && exit 1 || true
# NO_OUTPUT fallback enforcement for non-Claude providers
if [ "$V_CODEX" = "NO_OUTPUT" ] && [ "$V_GEMINI" = "NO_OUTPUT" ]; then
  echo "$V_CLAUDE" | rg -q '^(APPROVE|MINOR)$'
elif [ "$V_CODEX" = "NO_OUTPUT" ]; then
  echo "$V_CLAUDE" | rg -q '^(APPROVE|MINOR)$'
  echo "$V_GEMINI" | rg -q '^(APPROVE|MINOR)$'
elif [ "$V_GEMINI" = "NO_OUTPUT" ]; then
  echo "$V_CLAUDE" | rg -q '^(APPROVE|MINOR)$'
  echo "$V_CODEX" | rg -q '^(APPROVE|MINOR)$'
fi
```
6. Downstream path safety checks:
```bash
ALLOWLIST="reports/compliance/wrk-188-worldenergydata-downstream-allowlist.txt"
test -f "$ALLOWLIST" || : > "$ALLOWLIST"
# strict blocker scope for wave-1 governance surfaces only (`.claude`, `docs`, `specs`, `scripts`, `config`, `modules`)
rg -n 'worldenergydata/(.*/)?specs/' -- .claude docs specs scripts config modules -g '!.git/**' -g '!worldenergydata/**' -g '!specs/repos/worldenergydata/**' -g '!reports/**' > reports/compliance/wrk-188-worldenergydata-downstream-hits.txt || true
if test -s "$ALLOWLIST"; then
  rg -n -v -f "$ALLOWLIST" reports/compliance/wrk-188-worldenergydata-downstream-hits.txt > reports/compliance/wrk-188-worldenergydata-downstream-hits-unallowed.txt || true
else
  cp reports/compliance/wrk-188-worldenergydata-downstream-hits.txt reports/compliance/wrk-188-worldenergydata-downstream-hits-unallowed.txt
fi
test ! -s reports/compliance/wrk-188-worldenergydata-downstream-hits-unallowed.txt
ALLOWLIST_COUNT="$(test -s "$ALLOWLIST" && wc -l < "$ALLOWLIST" | tr -d ' ' || echo 0)"
HIT_COUNT="$(wc -l < reports/compliance/wrk-188-worldenergydata-downstream-hits.txt | tr -d ' ')"
UNALLOWED_COUNT="$(wc -l < reports/compliance/wrk-188-worldenergydata-downstream-hits-unallowed.txt | tr -d ' ')"
APPROVER_APPROVAL="$(awk -F= '/^APPROVER=/{print $2}' reports/compliance/wrk-188-worldenergydata-approval.txt)"
printf "DOWNSTREAM_REMEDIATION=PASS\nALLOWLIST_COUNT=%s\nHIT_COUNT=%s\nUNALLOWED_COUNT=%s\nAPPROVER=%s\nDATE=%s\n" \
  "$ALLOWLIST_COUNT" "$HIT_COUNT" "$UNALLOWED_COUNT" "$APPROVER_APPROVAL" "$(date -u +%Y-%m-%dT%H:%M:%SZ)" \
  > reports/compliance/wrk-188-worldenergydata-downstream-remediation.env
# advisory workspace hygiene (non-blocking)
rg -n 'worldenergydata/(.*/)?specs/' . -g '!.git/**' > reports/compliance/wrk-188-worldenergydata-downstream-hygiene.txt || true
```
7. Idempotency check:
```bash
git diff --name-status > reports/compliance/wrk-188-worldenergydata-diff-after-first-apply.txt
git diff --name-only -- worldenergydata specs/repos/worldenergydata > reports/compliance/wrk-188-worldenergydata-scope-after-first-apply.txt
# reassert approval/review artifacts still match before second apply
sha256sum -c reports/compliance/wrk-188-worldenergydata-approval.txt.sha256
test -f reports/compliance/wrk-188-worldenergydata-review-bindings.env
scripts/operations/compliance/migrate_specs_to_workspace.sh --apply --repos worldenergydata
git diff --name-status > reports/compliance/wrk-188-worldenergydata-diff-after-second-apply.txt
git diff --name-only -- worldenergydata specs/repos/worldenergydata > reports/compliance/wrk-188-worldenergydata-scope-after-second-apply.txt
diff reports/compliance/wrk-188-worldenergydata-diff-after-first-apply.txt reports/compliance/wrk-188-worldenergydata-diff-after-second-apply.txt
diff reports/compliance/wrk-188-worldenergydata-scope-after-first-apply.txt reports/compliance/wrk-188-worldenergydata-scope-after-second-apply.txt
test -z "$(git diff --name-only | rg -v '^(worldenergydata/|specs/repos/worldenergydata/|reports/compliance/)' | cat)"
```
8. Submodule pre-commit scope gate and commit:
```bash
git -C worldenergydata add -A
test -z "$(git -C worldenergydata diff --cached --name-only | rg -v '(^|/)specs/' | cat)" 
git -C worldenergydata commit -m "chore(specs): WRK-188 wave1 pointer migration"
SUB_SHA="$(git -C worldenergydata rev-parse HEAD)"
```
9. Hub pre-commit scope gate, governance gate, and commit:
```bash
# deterministic compliance artifact allowlist cleanup before stage
ALLOWED_REPORTS='(required-artifacts.txt|dryrun-approval.txt|contract-selftest.env|script-bindings.env|script-bindings.env.sha256|simulation-approval.txt|simulation-result.env|split-publish-drill.env|downstream-remediation.env|dryrun.log|dryrun.log.sha256|source-checksums.txt|source-checksums.txt.sha256|approved-source-files.txt|approved-source-files.txt.sha256|approved-target-files.txt|source-spec-roots.txt|approved-heads.env|approved-heads.env.sha256|pre-apply-submodule-sha.txt|approval.txt|approval.txt.sha256|review-bindings.env|review-bindings.env.sha256|pre-apply-publishability.env|pre-apply-gate-pass.env|closure-gate-pass.env|perf-override.env|review-override.env|protected-branch-signoff.env|semantic-restore-signoff.env|hard-restore-signoff.env|execution-state.env|success-manifest.json)'
find reports/compliance -maxdepth 1 -type f -name 'wrk-188-worldenergydata-*' -print | rg -v "$ALLOWED_REPORTS" | xargs -r rm -f
git add worldenergydata specs/repos/worldenergydata reports/compliance
test "$(git rev-parse :worldenergydata)" = "$SUB_SHA"
test -z "$(git diff --cached --name-only | rg -v '^(worldenergydata$|worldenergydata/|specs/repos/worldenergydata/|reports/compliance/)' | cat)"
scripts/operations/compliance/check_governance.sh --mode gate --scope changed
git commit -m "chore(spec-migration): WRK-188 wave1 worldenergydata apply"
TMP_STATE="reports/compliance/wrk-188-worldenergydata-execution-state.env.tmp"
printf "PRE_HUB_HEAD=%s\nPRE_WORLDENERGYDATA_HEAD=%s\nPOST_HUB_HEAD=%s\nPOST_WORLDENERGYDATA_HEAD=%s\n" \
  "$HUB_HEAD" \
  "$WORLDENERGYDATA_HEAD" \
  "$(git rev-parse HEAD)" \
  "$SUB_SHA" \
  > "$TMP_STATE"
mv "$TMP_STATE" reports/compliance/wrk-188-worldenergydata-execution-state.env
test -s reports/compliance/wrk-188-worldenergydata-execution-state.env
```
10. Publish in one release window:
```bash
# publishability check (retry policy in Failure Policy #7)
test "$(git rev-parse --abbrev-ref HEAD)" != "HEAD"
test "$(git -C worldenergydata rev-parse --abbrev-ref HEAD)" != "HEAD"
git -C worldenergydata push --dry-run
git push --dry-run
git -C worldenergydata symbolic-ref --short HEAD
git -C worldenergydata push
git push
```
11. Post-commit scope audit (defense in depth):
```bash
APPLY_SHA="$(git rev-parse HEAD)"
git diff --name-only "${APPLY_SHA}^..${APPLY_SHA}" | rg -v '^(worldenergydata/|specs/repos/worldenergydata/|reports/compliance/)'
```
Expected output: empty.
11.5 Generate canonical required-artifacts list (single source of truth for closure + manifest):
```bash
cat > reports/compliance/wrk-188-worldenergydata-required-artifacts.txt <<'EOF'
reports/compliance/wrk-188-worldenergydata-dryrun-approval.txt
reports/compliance/wrk-188-worldenergydata-contract-selftest.env
reports/compliance/wrk-188-worldenergydata-script-bindings.env
reports/compliance/wrk-188-worldenergydata-script-bindings.env.sha256
reports/compliance/wrk-188-worldenergydata-simulation-approval.txt
reports/compliance/wrk-188-worldenergydata-simulation-result.env
reports/compliance/wrk-188-worldenergydata-split-publish-drill.env
reports/compliance/wrk-188-worldenergydata-downstream-remediation.env
reports/compliance/wrk-188-worldenergydata-pre-apply-publishability.env
reports/compliance/wrk-188-worldenergydata-pre-apply-gate-pass.env
reports/compliance/wrk-188-worldenergydata-approval.txt
reports/compliance/wrk-188-worldenergydata-approval.txt.sha256
reports/compliance/wrk-188-worldenergydata-approved-heads.env
reports/compliance/wrk-188-worldenergydata-approved-heads.env.sha256
reports/compliance/wrk-188-worldenergydata-review-bindings.env
reports/compliance/wrk-188-worldenergydata-review-bindings.env.sha256
reports/compliance/wrk-188-worldenergydata-success-manifest.json
EOF
test -s reports/compliance/wrk-188-worldenergydata-required-artifacts.txt
```
12. Write machine-readable success manifest:
```bash
python3 - <<'PY'
import json, subprocess, pathlib
def sh(cmd):
    return subprocess.check_output(cmd, shell=True, text=True).strip()
p = pathlib.Path("reports/compliance")
required = [r.strip() for r in pathlib.Path("reports/compliance/wrk-188-worldenergydata-required-artifacts.txt").read_text().splitlines() if r.strip()]
for r in required:
  if r.endswith("wrk-188-worldenergydata-success-manifest.json"):
    continue
  rp = pathlib.Path(r)
  if not rp.exists() or rp.stat().st_size == 0:
    raise SystemExit(f"missing required artifact: {r}")
manifest = {
  "wrk": "WRK-188",
  "spec": "worldenergydata-wave1-migration",
  "spec_sha256": sh("sha256sum specs/wrk/WRK-188/worldenergydata-wave1-migration.md | awk '{print $1}'"),
  "hub_head": sh("git rev-parse HEAD"),
  "worldenergydata_head": sh("git -C worldenergydata rev-parse HEAD"),
  "approval_sha256": sh("sha256sum reports/compliance/wrk-188-worldenergydata-approval.txt | awk '{print $1}'"),
  "approved_heads_sha256": sh("sha256sum reports/compliance/wrk-188-worldenergydata-approved-heads.env | awk '{print $1}'"),
  "review_bindings_sha256": sh("sha256sum reports/compliance/wrk-188-worldenergydata-review-bindings.env | awk '{print $1}'"),
  "script_bindings_sha256": sh("sha256sum reports/compliance/wrk-188-worldenergydata-script-bindings.env | awk '{print $1}'"),
  "simulation_result_sha256": sh("sha256sum reports/compliance/wrk-188-worldenergydata-simulation-result.env | awk '{print $1}'"),
  "dry_run_log_sha256": sh("cut -d' ' -f1 reports/compliance/wrk-188-worldenergydata-dryrun.log.sha256"),
  "source_checksums_sha256": sh("cut -d' ' -f1 reports/compliance/wrk-188-worldenergydata-source-checksums.txt.sha256"),
  "approved_source_files_sha256": sh("cut -d' ' -f1 reports/compliance/wrk-188-worldenergydata-approved-source-files.txt.sha256"),
  "review_bindings_file": "reports/compliance/wrk-188-worldenergydata-review-bindings.env",
  "status": "PASS"
}
(p / "wrk-188-worldenergydata-success-manifest.json").write_text(json.dumps(manifest, indent=2) + "\n")
PY
test -s reports/compliance/wrk-188-worldenergydata-success-manifest.json
```
13. Consolidated closure gate (authoritative for `tracked-required` artifacts):
```bash
while IFS= read -r f; do
  test -n "$f"
  test -s "$f"
done < reports/compliance/wrk-188-worldenergydata-required-artifacts.txt
sha256sum -c reports/compliance/wrk-188-worldenergydata-approval.txt.sha256
sha256sum -c reports/compliance/wrk-188-worldenergydata-approved-heads.env.sha256
sha256sum -c reports/compliance/wrk-188-worldenergydata-script-bindings.env.sha256
sha256sum -c reports/compliance/wrk-188-worldenergydata-review-bindings.env.sha256
rg -q '^SIMULATION_STATUS=PASS$' reports/compliance/wrk-188-worldenergydata-simulation-result.env
rg -q '^SPLIT_PUBLISH_DRILL=PASS$' reports/compliance/wrk-188-worldenergydata-split-publish-drill.env
rg -q '^DOWNSTREAM_REMEDIATION=PASS$' reports/compliance/wrk-188-worldenergydata-downstream-remediation.env
rg -q '^PUBLISHABILITY=PASS$' reports/compliance/wrk-188-worldenergydata-pre-apply-publishability.env
rg -q '^PRE_APPLY_GATE=PASS$' reports/compliance/wrk-188-worldenergydata-pre-apply-gate-pass.env
if test -f reports/compliance/wrk-188-worldenergydata-perf-override.env; then
  rg -q '^PERF_OVERRIDE=YES$' reports/compliance/wrk-188-worldenergydata-perf-override.env
  rg -q '^APPROVER=[a-zA-Z0-9][a-zA-Z0-9_.@-]{2,}$' reports/compliance/wrk-188-worldenergydata-perf-override.env
  rg -q '^REASON=.+$' reports/compliance/wrk-188-worldenergydata-perf-override.env
fi
printf "CLOSURE_GATE=PASS\nDATE=%s\n" "$(date -u +%Y-%m-%dT%H:%M:%SZ)" > reports/compliance/wrk-188-worldenergydata-closure-gate-pass.env
```

Failure policy:
1. Any failed check => stop immediately.
2. If apply already ran, execute rollback.
3. Record failure + command output in WRK-188 progress notes before retry.
4. If `git -C worldenergydata push` succeeds but `git push` fails, run `Split Publish Recovery Runbook` (authoritative sequence).
5. If recovery push is blocked (remote/policy outage), freeze further migration writes, record published submodule SHA + blocked hub SHA in WRK-188, and open a containment work item before any retry.
6. Cross-review provider outage policy: retry each failed provider up to 3 times with 5-minute gaps; if still unavailable, require governance override note in WRK-188 with approver + reason + timestamp before proceed/no-proceed decision.
7. Publishability outage policy: if `push --dry-run` fails after 3 retries, do not proceed with apply or publish on any branch.
8. Outcome classification:
- `MIGRATION_AND_PUBLISH_PASS`: migration and publish both completed.
- `MIGRATION_PASS_PUBLISH_BLOCKED`: local migration checks pass but publish deferred by policy.
- `UNSUPPORTED_ENV_ABORT`: prerequisites/toolchain gate failed; stop before apply.
- `UNSUPPORTED_AUTH_POLICY_ABORT`: git identity/auth/branch-policy prerequisite failed; stop before apply.

## Done Checklist
- Dry-run log + hash captured and attached to WRK-188.
- No exact or casefold duplicate target paths.
- Source/target file counts match.
- Source/target checksum sets match.
- Pointer README checks pass for every recorded source spec root.
- Cross-review gate passes per normalized verdict rules.
- Contract self-test passed before dry-run/apply approvals.
- Script-binding integrity gate passed (migration/governance/review scripts unchanged between approval and apply).
- Simulation approval and simulation PASS artifact verified before apply.
- Split-publish recovery drill artifact recorded as PASS.
- Idempotency second-apply diff check passed.
- Scope checks pass before and after commit.
- Success manifest exists: `reports/compliance/wrk-188-worldenergydata-success-manifest.json`.
- Canonical required-artifacts list exists and is used by both manifest + closure gates (`required-artifacts.txt`).
- Approval/review env artifacts pass `sha256sum -c` checks.
- Publishability pre-apply gate passed and recorded in `pre-apply-publishability.env`.
- Downstream remediation artifact recorded as PASS (`downstream-remediation.env`).
- Consolidated closure gate passed (`closure-gate-pass.env`).
- Override artifacts (if used) include approver + reason + timestamp (`perf-override.env`, `review-override.env`).
- Protected/rollback signoff artifacts present only when corresponding guarded paths are invoked (`protected-branch-signoff.env`, `semantic-restore-signoff.env`, `hard-restore-signoff.env`).
- Filename edge checks passed (control-char rejection + pointer path assertion).
- Unsupported environment/toolchain runs terminate with non-zero status in prerequisites.
- Type-conflict gate passed (`target-type-conflicts.txt` empty).
- Performance guard passed (`< 50000` source spec files).
- Split-publish convergence acceptance checks passed when recovery path invoked.

## Collision Remediation
1. Inspect `reports/compliance/wrk-188-worldenergydata-target-collisions.txt`, `reports/compliance/wrk-188-worldenergydata-duplicate-targets.txt`, and `reports/compliance/wrk-188-worldenergydata-duplicate-targets-casefold.txt`.
2. Remove or relocate conflicting paths under `specs/repos/worldenergydata/` (or rollback to clean baseline).
3. Re-run dry-run preflight and regenerate compliance artifacts before apply.

## Fail-Fast Injection Checks
Run on disposable fixture before approval:
```bash
test -f reports/compliance/wrk-188-worldenergydata-simulation-approval.txt
rg -q '^STATUS=APPROVED_FOR_SIMULATION$' reports/compliance/wrk-188-worldenergydata-simulation-approval.txt
TMP_FIXTURE="$(mktemp -d)"
mkdir -p "$TMP_FIXTURE/repo/specs"
echo test > "$TMP_FIXTURE/repo/specs/README.md"
ln -s README.md "$TMP_FIXTURE/repo/specs/link.md"
find "$TMP_FIXTURE/repo" -path '*/specs/*' -type l | rg -q .
rm -rf "$TMP_FIXTURE"
```

Rollback/publish failure drills (staging branch recommended):
```bash
# Simulate submodule push succeeds, hub push fails containment branch
echo "simulate" > /tmp/wrk188-simulate.txt
# Validate state machine commands are documented and executable in sequence
rg -q 'submodule-pushed-hub-push-failed' specs/wrk/WRK-188/worldenergydata-wave1-migration.md
rg -q 'rollback blocked: conflict/protection' specs/wrk/WRK-188/worldenergydata-wave1-migration.md
# Permission-denied simulation (readonly target should fail)
TMP_FIXTURE="$(mktemp -d)"
mkdir -p "$TMP_FIXTURE/ro/specs"
touch "$TMP_FIXTURE/ro/specs/a.md"
chmod -w "$TMP_FIXTURE/ro/specs"
test ! -w "$TMP_FIXTURE/ro/specs"
! cp "$TMP_FIXTURE/ro/specs/a.md" "$TMP_FIXTURE/ro/specs/b.md"
# Markdown/path escaping edge case (spaces + backticks)
EDGE_PATH='specs/repos/worldenergydata/a path/with`tick/specs'
printf "# Specs Pointer\n\n`%s`\n" "$EDGE_PATH" > "$TMP_FIXTURE/pointer.md"
rg -Fq "$EDGE_PATH" "$TMP_FIXTURE/pointer.md"
rm -rf "$TMP_FIXTURE"
```

## Negative-Path Checks
Run before approval to verify fail-fast behavior:
```bash
test -z "$(cat reports/compliance/wrk-188-worldenergydata-target-collisions.txt)"
test -f reports/compliance/wrk-188-worldenergydata-duplicate-targets.txt && test ! -s reports/compliance/wrk-188-worldenergydata-duplicate-targets.txt
test -f reports/compliance/wrk-188-worldenergydata-duplicate-targets-casefold.txt && test ! -s reports/compliance/wrk-188-worldenergydata-duplicate-targets-casefold.txt
test -z "$(find worldenergydata -path '*/specs/*' -type l)"
```

## Multi-Provider Workflow Continuity Check
Run after dry-run approval commit and `approved-heads.env` generation, then before apply:
```bash
timeout 900s scripts/review/cross-review.sh specs/wrk/WRK-188/worldenergydata-wave1-migration.md all --type plan || { echo "cross-review timed out/failed; rerun provider submissions before apply"; exit 1; }
F_CLAUDE="$(ls -1t scripts/review/results/*worldenergydata-wave1-migration.md-plan-claude.md | head -n1)"
F_CODEX="$(ls -1t scripts/review/results/*worldenergydata-wave1-migration.md-plan-codex.md | head -n1)"
F_GEMINI="$(ls -1t scripts/review/results/*worldenergydata-wave1-migration.md-plan-gemini.md | head -n1)"
test -n "$F_CLAUDE" && test -n "$F_CODEX" && test -n "$F_GEMINI"
SPEC_SHA="$(sha256sum specs/wrk/WRK-188/worldenergydata-wave1-migration.md | awk '{print $1}')"
printf "REVIEW_SPEC_SHA=%s\nREVIEW_HUB_HEAD=%s\nREVIEW_WORLDENERGYDATA_HEAD=%s\nREVIEW_CLAUDE_FILE=%s\nREVIEW_CLAUDE_SHA=%s\nREVIEW_CODEX_FILE=%s\nREVIEW_CODEX_SHA=%s\nREVIEW_GEMINI_FILE=%s\nREVIEW_GEMINI_SHA=%s\n" \
  "$SPEC_SHA" \
  "$(git rev-parse HEAD)" \
  "$(git -C worldenergydata rev-parse HEAD)" \
  "$F_CLAUDE" "$(sha256sum "$F_CLAUDE" | awk '{print $1}')" \
  "$F_CODEX" "$(sha256sum "$F_CODEX" | awk '{print $1}')" \
  "$F_GEMINI" "$(sha256sum "$F_GEMINI" | awk '{print $1}')" \
  > reports/compliance/wrk-188-worldenergydata-review-bindings.env
sha256sum reports/compliance/wrk-188-worldenergydata-review-bindings.env > reports/compliance/wrk-188-worldenergydata-review-bindings.env.sha256
# phase-2.5 head refresh to pin apply against reviewed head state
printf "HUB_HEAD=%s\nWORLDENERGYDATA_HEAD=%s\n" "$(git rev-parse HEAD)" "$(git -C worldenergydata rev-parse HEAD)" > reports/compliance/wrk-188-worldenergydata-approved-heads.env
sha256sum reports/compliance/wrk-188-worldenergydata-approved-heads.env > reports/compliance/wrk-188-worldenergydata-approved-heads.env.sha256
```
Pass condition:
- Reviews confirm migration can proceed while preserving standard workflow:
  - WRK linkage
  - plan approval gate
  - cross-review gate
  - governance checks
- Outage handling:
  - Retry failed provider submissions up to 3 times (5-minute interval).
  - If still unavailable, log governance override in WRK-188 and attach latest available artifacts + rationale.
  - For executable degraded mode, create:
```bash
printf "REVIEW_OVERRIDE=APPROVED\nMISSING_PROVIDER=%s\nAPPROVER=%s\nREASON=%s\nDATE=%s\n" \
  "${MISSING_PROVIDER:?}" "${APPLY_APPROVER_ID:?}" "${REVIEW_OVERRIDE_REASON:?}" "$(date -u +%Y-%m-%dT%H:%M:%SZ)" \
  > reports/compliance/wrk-188-worldenergydata-review-override.env
```
- Freshness rule:
  - Re-run this step after any edit to `specs/wrk/WRK-188/worldenergydata-wave1-migration.md` before apply.
- Authoritative review gate artifact:
  - Only `reports/compliance/wrk-188-worldenergydata-review-bindings.env` is used by apply prechecks.

## Signoff Artifact Creation
Create governance signoff artifacts only when the corresponding guarded path is needed:
```bash
# protected branch apply (required only when hub branch is main/master)
printf "PROTECTED_BRANCH=APPROVED\nAPPROVER=%s\nREASON=%s\nDATE=%s\n" \
  "${APPLY_APPROVER_ID:?}" "${PROTECTED_BRANCH_REASON:?}" "$(date -u +%Y-%m-%dT%H:%M:%SZ)" \
  > reports/compliance/wrk-188-worldenergydata-protected-branch-signoff.env

# hard restore (required only for rollback step 3 destructive restore)
printf "HARD_RESTORE=APPROVED\nAPPROVER=%s\nREASON=%s\nDATE=%s\n" \
  "${APPLY_APPROVER_ID:?}" "${HARD_RESTORE_REASON:?}" "$(date -u +%Y-%m-%dT%H:%M:%SZ)" \
  > reports/compliance/wrk-188-worldenergydata-hard-restore-signoff.env

# semantic restore (required only when ROLLBACK_MODE=SEMANTIC_RESTORE)
printf "SEMANTIC_RESTORE=APPROVED\nAPPROVER=%s\nREASON=%s\nDATE=%s\n" \
  "${APPLY_APPROVER_ID:?}" "${SEMANTIC_RESTORE_REASON:?}" "$(date -u +%Y-%m-%dT%H:%M:%SZ)" \
  > reports/compliance/wrk-188-worldenergydata-semantic-restore-signoff.env
```

## Rollback
Rollback state machine (deterministic):
- `none-applied`: apply never started; no rollback actions.
- `applied-not-committed`: run step 3 only.
- `partial-applied`: mixed pointers/targets after failed apply; run step 3, then re-run dry-run preflight before retry.
- `submodule-committed-not-hub-committed`: revert submodule commit in submodule repo, restore hub index/worktree, rerun step 3.
- `submodule-pushed-hub-push-failed`: execute `Split Publish Recovery Runbook` only; do not run other rollback steps until runbook outcome is recorded.
- `both-pushed`: execute step 1.

Split Publish Recovery Runbook (authoritative):
1. Capture current SHAs and branch names in WRK-188 notes.
1a. Record selected rollback state:
```bash
printf "STATE=%s\nDATE=%s\n" "${ROLLBACK_STATE:?}" "$(date -u +%Y-%m-%dT%H:%M:%SZ)" > reports/compliance/wrk-188-worldenergydata-rollback-state.env
```
2. Attempt hub revert commit for pointer divergence.
3. Attempt hub push.
4. If hub push blocked, stop all migration writes and open containment work item.
5. After containment resolved, rerun preflight and only then resume apply.
Protected-branch fallback:
1. Create rollback branch: `git checkout -b wrk-188-rollback/<timestamp>`.
2. Apply revert commits on rollback branch.
3. Open PR with required approvers; merge after policy checks.
4. Record PR link + merge SHA in WRK-188 before closure.

1. Revert migration commits in order (submodule first, then hub pointer commit):
```bash
git log --oneline -n 10
# original submodule SHA captured in:
cat reports/compliance/wrk-188-worldenergydata-pre-apply-submodule-sha.txt
test -f reports/compliance/wrk-188-worldenergydata-execution-state.env
source reports/compliance/wrk-188-worldenergydata-execution-state.env
echo "$POST_HUB_HEAD" | rg -q '^[0-9a-f]{40}$'
echo "$POST_WORLDENERGYDATA_HEAD" | rg -q '^[0-9a-f]{40}$'
git -C worldenergydata revert "$POST_WORLDENERGYDATA_HEAD"
git revert "$POST_HUB_HEAD"
```
If revert conflicts or protected-branch rejects occur:
```bash
git status --porcelain
echo "WRK-188 rollback blocked: conflict/protection" >> reports/compliance/wrk-188-worldenergydata-rollback-blocked.log
```
Stop and escalate via containment work item before retry.
Split-publish convergence acceptance (must pass before closure):
```bash
source reports/compliance/wrk-188-worldenergydata-execution-state.env
test "$(git ls-remote origin "$(git rev-parse --abbrev-ref HEAD)" | awk '{print $1}')" = "$(git rev-parse HEAD)"
test "$(git -C worldenergydata ls-remote origin "$(git -C worldenergydata rev-parse --abbrev-ref HEAD)" | awk '{print $1}')" = "$(git -C worldenergydata rev-parse HEAD)"
```
Rollback PASS criteria (required before retry/closure):
```bash
source reports/compliance/wrk-188-worldenergydata-approved-heads.env
test -f reports/compliance/wrk-188-worldenergydata-source-checksums-rollback.txt
diff reports/compliance/wrk-188-worldenergydata-source-checksums.txt reports/compliance/wrk-188-worldenergydata-source-checksums-rollback.txt
test -z "$(find specs/repos/worldenergydata -type f -path '*/specs/*' | cat)"
# Closure mode A: STRICT_RESTORE (default; exact heads restored)
ROLLBACK_MODE="${ROLLBACK_MODE:-STRICT_RESTORE}"
if [ "$ROLLBACK_MODE" = "STRICT_RESTORE" ]; then
  source reports/compliance/wrk-188-worldenergydata-execution-state.env
  test "$(git -C worldenergydata rev-parse HEAD)" = "$(cat reports/compliance/wrk-188-worldenergydata-pre-apply-submodule-sha.txt)"
  test "$(git rev-parse HEAD)" = "$PRE_HUB_HEAD"
elif [ "$ROLLBACK_MODE" = "SEMANTIC_RESTORE" ]; then
  # Requires explicit signed governance artifact before use.
  test -f reports/compliance/wrk-188-worldenergydata-semantic-restore-signoff.env
  rg -q '^SEMANTIC_RESTORE=APPROVED$' reports/compliance/wrk-188-worldenergydata-semantic-restore-signoff.env
  rg -q '^APPROVER=[a-zA-Z0-9][a-zA-Z0-9_.@-]{2,}$' reports/compliance/wrk-188-worldenergydata-semantic-restore-signoff.env
  test -z "$(find worldenergydata -type f -path '*/specs/*' ! -name 'README.md' | cat)"
  test -z "$(git diff --name-only | rg -v '^(worldenergydata/|specs/repos/worldenergydata/|reports/compliance/)' | cat)"
else
  echo "invalid ROLLBACK_MODE=$ROLLBACK_MODE"; exit 1
fi
printf "ROLLBACK_STATUS=PASS\nDATE=%s\n" "$(date -u +%Y-%m-%dT%H:%M:%SZ)" > reports/compliance/wrk-188-worldenergydata-rollback-pass.env
```
2. Re-run file count and source checksum checks on restored state:
```bash
find worldenergydata -type f -path '*/specs/*' | wc -l
find worldenergydata -type f -path '*/specs/*' -print0 | sort -z | xargs -0 sha256sum > reports/compliance/wrk-188-worldenergydata-source-checksums-rollback.txt
```
3. If apply was not committed, restore deterministic scope and re-check:
```bash
git status --porcelain > reports/compliance/wrk-188-worldenergydata-rollback-pre-snapshot.txt
git diff --name-status > reports/compliance/wrk-188-worldenergydata-rollback-pre-diff.txt
python3 - <<'PY'
import subprocess
out = subprocess.check_output(["git", "status", "--porcelain=v1", "-z"]).decode("utf-8", "surrogateescape")
allowed = ("worldenergydata/", "specs/repos/worldenergydata/", "reports/compliance/")
for rec in out.split("\0"):
    if not rec:
        continue
    p = rec[3:]
    if " -> " in p:
        p = p.split(" -> ", 1)[1]
    if p and not p.startswith(allowed):
        raise SystemExit(1)
PY
# create artifact via `Signoff Artifact Creation` section before continuing
test -f reports/compliance/wrk-188-worldenergydata-hard-restore-signoff.env
rg -q '^HARD_RESTORE=APPROVED$' reports/compliance/wrk-188-worldenergydata-hard-restore-signoff.env
rg -q '^APPROVER=[a-zA-Z0-9][a-zA-Z0-9_.@-]{2,}$' reports/compliance/wrk-188-worldenergydata-hard-restore-signoff.env
git restore --staged --worktree worldenergydata specs/repos/worldenergydata
python3 - <<'PY'
import subprocess
out = subprocess.check_output(["git", "-C", "worldenergydata", "status", "--porcelain=v1", "-z"]).decode("utf-8", "surrogateescape")
for rec in out.split("\0"):
    if not rec:
        continue
    p = rec[3:]
    if " -> " in p:
        p = p.split(" -> ", 1)[1]
    if "/specs/" not in p and not p.startswith("specs/"):
        raise SystemExit(1)
PY
git -C worldenergydata restore --staged --worktree -- ':(glob)**/specs/**'
python3 - <<'PY'
from pathlib import Path
mf = Path("reports/compliance/wrk-188-worldenergydata-approved-target-files.txt")
if mf.exists():
    for line in mf.read_text().splitlines():
        p = Path(line.strip())
        if p.exists() and p.is_file():
            p.unlink()
for d in sorted(Path("specs/repos/worldenergydata").rglob("*"), reverse=True):
    if d.is_dir():
        try:
            d.rmdir()
        except OSError:
            pass
PY
find reports/compliance -maxdepth 1 -type f -name 'wrk-188-worldenergydata-*.tmp' -delete
test -z "$(find reports/compliance -maxdepth 1 -type f -name 'wrk-188-worldenergydata-*' -print | rg -v '(required-artifacts.txt|dryrun-approval.txt|contract-selftest.env|script-bindings.env|script-bindings.env.sha256|simulation-approval.txt|simulation-result.env|split-publish-drill.env|downstream-remediation.env|dryrun.log|dryrun.log.sha256|source-checksums.txt|source-checksums.txt.sha256|approved-source-files.txt|approved-source-files.txt.sha256|approved-target-files.txt|source-spec-roots.txt|approved-heads.env|approved-heads.env.sha256|pre-apply-submodule-sha.txt|approval.txt|approval.txt.sha256|review-bindings.env|review-bindings.env.sha256|pre-apply-publishability.env|pre-apply-gate-pass.env|closure-gate-pass.env|perf-override.env|review-override.env|protected-branch-signoff.env|semantic-restore-signoff.env|hard-restore-signoff.env|rollback-state.env|rollback-pass.env)$' | cat)"
test -f reports/compliance/wrk-188-worldenergydata-approved-heads.env.sha256
test -f reports/compliance/wrk-188-worldenergydata-review-bindings.env.sha256
test -f reports/compliance/wrk-188-worldenergydata-rollback-state.env || true
python3 - <<'PY'
import subprocess
out = subprocess.check_output(["git", "status", "--porcelain=v1", "-z"]).decode("utf-8", "surrogateescape")
for rec in out.split("\0"):
    if not rec:
        continue
    p = rec[3:]
    if " -> " in p:
        p = p.split(" -> ", 1)[1]
    if p.startswith("worldenergydata/") or p.startswith("specs/repos/worldenergydata/"):
        raise SystemExit(1)
PY
```
4. Record rollback reason and reverted SHA in WRK-188 progress notes.

## Residual Risks Accepted (Wave-1)
- Unicode normalization collisions (NFC/NFD) remain out-of-scope and require explicit signoff before multi-platform rollout.
- Case-insensitive reserved-name edge cases outside current collision checks require follow-up in next wave.
- Blocking downstream checks are intentionally limited to governance surfaces; full-repo scan is advisory and tracked in `downstream-hygiene.txt`.
