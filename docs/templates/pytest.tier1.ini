# ============================================================================
# pytest.tier1.ini - Tier 1 Repository Override Template
# ============================================================================
# Use this for PRODUCTION CRITICAL repositories:
#   - digitalmodel
#   - energy
#   - frontierdeepwater
#
# These repositories require the highest quality standards with strict
# coverage requirements and conservative test timeouts.
#
# Installation:
#   1. Copy to repository root as: pytest.ini
#   2. Customize repository-specific settings
#   3. Commit to version control
#
# Coverage Philosophy:
#   Tier 1 repos maintain 85% coverage minimum. This is non-negotiable.
#   Every production change must include corresponding tests.
#   Use --cov-report=html to visually identify untested code paths.
#
# ============================================================================

[pytest]

# Inherit from base configuration, override specific settings
testpaths = tests
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# Markers (inherited from base, can be extended)
markers =
    unit: Unit tests - Test single functions/methods in isolation
    integration: Integration tests - Test interaction between components
    e2e: End-to-end tests - Test complete workflows from user perspective
    slow: Tests that take significant time (>2 seconds)
    flaky: Tests that sometimes fail intermittently
    database: Tests requiring database access
    api: Tests requiring external API calls (mocked or real)
    scrapy: Tests for Scrapy spiders or web scraping functionality
    selenium: Tests using Selenium for browser automation
    llm: Tests involving LLM calls (Claude, GPT, Gemini)
    production_critical: Must pass before production deployment
    security: Security-related tests (OWASP, authentication, encryption)

# ============================================================================
# TIER 1 SPECIFIC SETTINGS
# ============================================================================

# Strict coverage requirement for production code
fail_under = 85

# Conservative timeout for reliability
timeout = 300

# Parallel execution limited to 4 workers (reduce system load)
# Enable with: -n 4
addopts =
    --verbose
    --showlocals
    --tb=short
    -W default
    --strict-markers
    --strict-config
    --cov=src
    --cov-report=term-missing:skip-covered
    --cov-report=html:htmlcov
    --cov-report=xml
    --durations=10
    -n 4

# Asyncio configuration
asyncio_mode = auto

# ============================================================================
# Coverage Settings - Tier 1 Requirements
# ============================================================================
# Tier 1 requires 85% coverage minimum with exception reporting

[coverage:run]
source = src
omit =
    */tests/*
    */venv/*
    */__pycache__/*
    */site-packages/*
    setup.py
    conftest.py

exclude_lines =
    pragma: no cover
    def __repr__
    if self\.debug
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.:
    @abstractmethod
    @abc.abstractmethod
    if TYPE_CHECKING:

[coverage:report]
precision = 2
show_missing = True
skip_covered = False
fail_under = 85

[coverage:html]
directory = htmlcov

# ============================================================================
# Logging Configuration
# ============================================================================
# Verbose logging for debugging production issues

log_level = INFO
log_cli_level = WARNING
log_capture = true
log_format = %(asctime)s [%(levelname)8s] %(name)s - %(message)s
log_date_format = %Y-%m-%d %H:%M:%S

# ============================================================================
# TIER 1 TESTING PHILOSOPHY
# ============================================================================
#
# Production Critical Principle:
#   All code must be tested before merging to main branch.
#   85% coverage is the MINIMUM, target 95%+.
#
# Test Categories:
#   1. Unit Tests (60% of test suite)
#      - Run on every commit
#      - Must complete in <30 seconds total
#      - No external dependencies
#
#   2. Integration Tests (30% of test suite)
#      - Run before merge
#      - Use test databases
#      - Test critical workflows
#
#   3. E2E Tests (10% of test suite)
#      - Run in staging environment
#      - Test complete user workflows
#      - Can be slow (but not >120s each)
#
# Quality Gates:
#   - Coverage <85%: BLOCK MERGE
#   - Test failure: BLOCK MERGE
#   - Flaky test: BLOCK MERGE (must be fixed immediately)
#
# Local Development:
#   pytest -m "unit"           # Fast feedback
#   pytest -m "not slow"       # Exclude slow tests
#   pytest --cov --cov-report=html  # Coverage report
#
# CI/CD Pipeline:
#   pytest -n 4                # Parallel with 4 workers
#   pytest --cov -cov-fail-under=85  # Enforce coverage
#   pytest -m "not selenium"   # Skip browser tests
#
# ============================================================================
# CUSTOMIZATION FOR YOUR TIER 1 REPOSITORY
# ============================================================================
#
# Add repository-specific markers:
#
# [pytest]
# markers =
#     # Your repo-specific marker
#     my_domain_feature: Repository-specific feature tests
#
# Override timeout for specific slow tests:
#   @pytest.mark.timeout(600)
#   def test_very_slow_operation(): ...
#
# Skip problematic test in local development:
#   @pytest.mark.skip(reason="Requires specific infrastructure")
#
# Mark security-critical test:
#   @pytest.mark.production_critical
#   @pytest.mark.security
#   def test_authentication_flow(): ...
#
# ============================================================================
