# ============================================================================
# pytest.tier2.ini - Tier 2 Repository Override Template
# ============================================================================
# Use this for DEVELOPMENT ACTIVE repositories:
#   - aceengineercode
#   - assetutilities
#   - worldenergydata
#   - rock-oil-field
#   - teamresumes
#
# These repositories are actively developed and need good coverage with
# balanced testing speed. 80% coverage threshold allows faster iteration
# while maintaining quality standards.
#
# Installation:
#   1. Copy to repository root as: pytest.ini
#   2. Customize repository-specific settings
#   3. Commit to version control
#
# Coverage Philosophy:
#   Tier 2 repos maintain 80% coverage minimum. This allows faster
#   development iteration while keeping code quality high.
#   Focus on testing critical paths and user-facing features.
#
# ============================================================================

[pytest]

# Inherit from base configuration, override specific settings
testpaths = tests
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# Markers (inherited from base, can be extended)
markers =
    unit: Unit tests - Test single functions/methods in isolation
    integration: Integration tests - Test interaction between components
    e2e: End-to-end tests - Test complete workflows from user perspective
    slow: Tests that take significant time (>2 seconds)
    flaky: Tests that sometimes fail intermittently
    database: Tests requiring database access
    api: Tests requiring external API calls (mocked or real)
    scrapy: Tests for Scrapy spiders or web scraping functionality
    selenium: Tests using Selenium for browser automation
    llm: Tests involving LLM calls (Claude, GPT, Gemini)

# ============================================================================
# TIER 2 SPECIFIC SETTINGS
# ============================================================================

# Balanced coverage requirement for active development
fail_under = 80

# Moderate timeout for good feedback
timeout = 300

# Parallel execution with 8 workers (good balance)
# Enable with: -n 8
addopts =
    --verbose
    --tb=short
    -W default
    --strict-markers
    --strict-config
    --cov=src
    --cov-report=term-missing:skip-covered
    --cov-report=html:htmlcov
    --cov-report=xml
    --durations=10
    -n 8

# Asyncio configuration
asyncio_mode = auto

# ============================================================================
# Coverage Settings - Tier 2 Requirements
# ============================================================================
# Tier 2 requires 80% coverage minimum

[coverage:run]
source = src
omit =
    */tests/*
    */venv/*
    */__pycache__/*
    */site-packages/*
    setup.py
    conftest.py

exclude_lines =
    pragma: no cover
    def __repr__
    if self\.debug
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.:
    @abstractmethod
    @abc.abstractmethod
    if TYPE_CHECKING:

[coverage:report]
precision = 2
show_missing = True
skip_covered = False
fail_under = 80

[coverage:html]
directory = htmlcov

# ============================================================================
# Logging Configuration
# ============================================================================
# Standard logging for development

log_level = INFO
log_cli_level = INFO
log_capture = true
log_format = %(asctime)s [%(levelname)8s] %(name)s - %(message)s
log_date_format = %Y-%m-%d %H:%M:%S

# ============================================================================
# TIER 2 TESTING PHILOSOPHY
# ============================================================================
#
# Development Active Principle:
#   Good coverage (80%+) with fast feedback loop for iteration.
#   Balance between quality and development velocity.
#
# Test Distribution:
#   1. Unit Tests (70% of test suite)
#      - Run frequently during development
#      - Must complete in <30 seconds total
#      - Catch regressions quickly
#
#   2. Integration Tests (20% of test suite)
#      - Run before merge
#      - Test feature workflows
#      - Database interactions
#
#   3. E2E Tests (10% of test suite)
#      - Run pre-merge
#      - Test user-facing features
#
# Quality Gates:
#   - Coverage <80%: BLOCK MERGE
#   - Critical test failure: BLOCK MERGE
#   - Flaky test: RERUN, monitor trends
#
# Local Development (Recommended):
#   # Quick unit test feedback during coding
#   pytest -m "unit"
#
#   # Before committing
#   pytest -m "unit or integration"
#
#   # Skip flaky/slow for faster iteration
#   pytest -m "not (slow or flaky or selenium)"
#
#   # Coverage check before merge
#   pytest --cov --cov-report=html
#
# CI/CD Pipeline:
#   # Parallel testing with 8 workers
#   pytest -n 8 --cov --cov-fail-under=80
#
#   # Skip expensive external tests
#   pytest -m "not (selenium or llm or scrapy)"
#
# ============================================================================
# CUSTOMIZATION FOR YOUR TIER 2 REPOSITORY
# ============================================================================
#
# Add repository-specific markers for your domain:
#
# [pytest]
# markers =
#     economic_modeling: Economic analysis tests
#     data_pipeline: Data processing tests
#     ml_feature: Machine learning feature tests
#
# Common Tier 2 configurations:
#
# If your repo has slow tests:
#   # Skip slow tests in CI/CD
#   pytest -m "not slow"
#
# If database is optional:
#   # Run without database
#   pytest -m "not database"
#
# If you use async extensively:
#   # Asyncio tests work automatically with asyncio_mode = auto
#
# ============================================================================
# EXAMPLE TEST STRUCTURE FOR TIER 2
# ============================================================================
#
# tests/
# ├── unit/
# │   ├── test_calculator.py
# │   ├── test_parser.py
# │   └── test_validators.py
# ├── integration/
# │   ├── test_data_pipeline.py
# │   └── test_api_workflows.py
# └── conftest.py
#
# Quick test run (during development):
#   pytest tests/unit -v
#
# Full test run (before commit):
#   pytest tests/ -m "not slow"
#
# Coverage check (pre-merge):
#   pytest tests/ --cov=src --cov-report=html
#
# ============================================================================
