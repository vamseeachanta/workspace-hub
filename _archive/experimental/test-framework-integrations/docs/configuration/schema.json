{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://test-framework-integrations.dev/schema",
  "title": "Test Framework Integrations Configuration",
  "description": "Configuration schema for the Test Framework Integrations system",
  "type": "object",
  "properties": {
    "framework": {
      "type": "object",
      "description": "Testing framework configuration",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["jest", "mocha", "pytest", "playwright", "vitest", "multi"],
          "description": "The testing framework to use"
        },
        "version": {
          "type": "string",
          "description": "Framework version constraint (semver)"
        },
        "autoDetect": {
          "type": "boolean",
          "default": true,
          "description": "Auto-detect framework from project files"
        },
        "fallback": {
          "type": "string",
          "enum": ["jest", "mocha", "pytest", "playwright", "vitest"],
          "description": "Fallback framework if detection fails"
        },
        "configFile": {
          "type": "string",
          "description": "Path to framework configuration file"
        },
        "testCommand": {
          "type": "string",
          "description": "Custom test command to execute"
        },
        "testDir": {
          "type": "string",
          "default": "tests",
          "description": "Directory containing test files"
        },
        "testPattern": {
          "type": "string",
          "default": "**/*.test.js",
          "description": "Glob pattern for test files"
        },
        "setupFiles": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Setup files to run before tests"
        },
        "teardownFiles": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Cleanup files to run after tests"
        },
        "configurations": {
          "type": "object",
          "description": "Multi-framework configurations",
          "additionalProperties": {
            "$ref": "#/properties/framework"
          }
        }
      },
      "required": ["type"],
      "additionalProperties": false
    },
    "execution": {
      "type": "object",
      "description": "Test execution settings",
      "properties": {
        "mode": {
          "type": "string",
          "enum": ["parallel", "sequential", "adaptive"],
          "default": "parallel",
          "description": "Test execution mode"
        },
        "maxWorkers": {
          "type": "integer",
          "minimum": 1,
          "maximum": 16,
          "description": "Maximum number of parallel workers"
        },
        "timeout": {
          "type": "integer",
          "minimum": 1000,
          "default": 30000,
          "description": "Default test timeout in milliseconds"
        },
        "retries": {
          "type": "integer",
          "minimum": 0,
          "maximum": 5,
          "default": 0,
          "description": "Number of retries for failed tests"
        },
        "bail": {
          "type": "boolean",
          "default": false,
          "description": "Stop execution on first failure"
        },
        "verbose": {
          "type": "boolean",
          "default": false,
          "description": "Enable verbose output"
        },
        "watch": {
          "type": "boolean",
          "default": false,
          "description": "Enable watch mode"
        },
        "coverage": {
          "type": "boolean",
          "default": false,
          "description": "Enable coverage collection"
        },
        "silent": {
          "type": "boolean",
          "default": false,
          "description": "Suppress console output during tests"
        },
        "forceExit": {
          "type": "boolean",
          "default": false,
          "description": "Force exit after tests complete"
        },
        "detectOpenHandles": {
          "type": "boolean",
          "default": false,
          "description": "Detect open handles preventing exit"
        },
        "passWithNoTests": {
          "type": "boolean",
          "default": false,
          "description": "Pass when no tests are found"
        },
        "skipUnchanged": {
          "type": "boolean",
          "default": false,
          "description": "Skip tests for unchanged files"
        },
        "updateSnapshots": {
          "type": "boolean",
          "default": false,
          "description": "Update test snapshots"
        },
        "clearCache": {
          "type": "boolean",
          "default": false,
          "description": "Clear cache before running tests"
        }
      },
      "additionalProperties": false
    },
    "baseline": {
      "type": "object",
      "description": "Baseline tracking configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": false,
          "description": "Enable baseline functionality"
        },
        "directory": {
          "type": "string",
          "default": "baselines",
          "description": "Directory to store baseline files"
        },
        "autoSave": {
          "type": "boolean",
          "default": false,
          "description": "Automatically save new baselines"
        },
        "autoLoad": {
          "type": "boolean",
          "default": true,
          "description": "Automatically load existing baselines"
        },
        "compareThreshold": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "default": 0.05,
          "description": "Threshold for detecting changes (0-1)"
        },
        "includePerformance": {
          "type": "boolean",
          "default": true,
          "description": "Include performance data in baselines"
        },
        "includeCoverage": {
          "type": "boolean",
          "default": true,
          "description": "Include coverage data in baselines"
        },
        "compression": {
          "type": "string",
          "enum": ["none", "gzip", "brotli"],
          "default": "gzip",
          "description": "Compression method for baseline files"
        },
        "retention": {
          "type": "object",
          "properties": {
            "maxAge": {
              "type": "string",
              "pattern": "^\\d+[dwmy]$",
              "description": "Maximum age of baselines (e.g., '30d', '1w')"
            },
            "maxCount": {
              "type": "integer",
              "minimum": 1,
              "description": "Maximum number of baselines to keep"
            },
            "cleanupInterval": {
              "type": "string",
              "pattern": "^\\d+[dwmy]$",
              "description": "Cleanup interval (e.g., '1d', '1w')"
            }
          },
          "additionalProperties": false
        },
        "comparison": {
          "type": "object",
          "properties": {
            "strict": {
              "type": "boolean",
              "default": false,
              "description": "Enable strict comparison mode"
            },
            "ignoreFields": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Fields to ignore during comparison"
            },
            "tolerance": {
              "type": "object",
              "properties": {
                "performance": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 1,
                  "description": "Performance tolerance (0-1)"
                },
                "coverage": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 1,
                  "description": "Coverage tolerance (0-1)"
                },
                "testCount": {
                  "type": "integer",
                  "minimum": 0,
                  "description": "Test count tolerance (absolute)"
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "storage": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["filesystem", "s3", "gcs", "azure"],
              "default": "filesystem",
              "description": "Storage backend type"
            },
            "path": {
              "type": "string",
              "description": "Storage path or identifier"
            },
            "options": {
              "type": "object",
              "description": "Storage-specific options"
            }
          },
          "required": ["type"],
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "performance": {
      "type": "object",
      "description": "Performance monitoring configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": false,
          "description": "Enable performance monitoring"
        },
        "collectMetrics": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["duration", "memory", "cpu", "network", "disk", "gc"]
          },
          "default": ["duration", "memory"],
          "description": "Metrics to collect during test execution"
        },
        "thresholds": {
          "type": "object",
          "properties": {
            "testDuration": {
              "type": "integer",
              "minimum": 100,
              "description": "Maximum test duration in milliseconds"
            },
            "suiteDuration": {
              "type": "integer",
              "minimum": 1000,
              "description": "Maximum suite duration in milliseconds"
            },
            "totalDuration": {
              "type": "integer",
              "minimum": 10000,
              "description": "Maximum total duration in milliseconds"
            },
            "memoryUsage": {
              "type": "integer",
              "minimum": 1048576,
              "description": "Maximum memory usage in bytes"
            },
            "cpuUsage": {
              "type": "number",
              "minimum": 0,
              "maximum": 100,
              "description": "Maximum CPU usage percentage"
            },
            "networkRequests": {
              "type": "integer",
              "minimum": 0,
              "description": "Maximum number of network requests"
            }
          },
          "additionalProperties": false
        },
        "profiling": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false,
              "description": "Enable detailed profiling"
            },
            "sampleRate": {
              "type": "integer",
              "minimum": 100,
              "maximum": 10000,
              "default": 1000,
              "description": "Profiling sample rate in Hz"
            },
            "includeNodeModules": {
              "type": "boolean",
              "default": false,
              "description": "Include node_modules in profiling"
            },
            "outputFormat": {
              "type": "string",
              "enum": ["json", "cpuprofile", "v8"],
              "default": "json",
              "description": "Profiling output format"
            }
          },
          "additionalProperties": false
        },
        "monitoring": {
          "type": "object",
          "properties": {
            "realTime": {
              "type": "boolean",
              "default": false,
              "description": "Enable real-time monitoring"
            },
            "interval": {
              "type": "integer",
              "minimum": 100,
              "maximum": 10000,
              "default": 1000,
              "description": "Monitoring interval in milliseconds"
            },
            "alerts": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": false,
                  "description": "Enable performance alerts"
                },
                "thresholdMultiplier": {
                  "type": "number",
                  "minimum": 1,
                  "maximum": 10,
                  "default": 1.5,
                  "description": "Threshold multiplier for alerts"
                },
                "channels": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "enum": ["console", "webhook", "email", "slack"]
                  },
                  "description": "Alert notification channels"
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "benchmarks": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false,
              "description": "Enable benchmark tests"
            },
            "iterations": {
              "type": "integer",
              "minimum": 1,
              "maximum": 10000,
              "default": 100,
              "description": "Number of benchmark iterations"
            },
            "warmupIterations": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100,
              "default": 10,
              "description": "Number of warmup iterations"
            },
            "compareWithBaseline": {
              "type": "boolean",
              "default": true,
              "description": "Compare benchmark results with baseline"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "reporting": {
      "type": "object",
      "description": "Output and reporting configuration",
      "properties": {
        "formats": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["json", "html", "junit", "console", "tap", "lcov", "cobertura"]
          },
          "default": ["console"],
          "description": "Output report formats"
        },
        "outputDir": {
          "type": "string",
          "default": "test-results",
          "description": "Output directory for reports"
        },
        "filename": {
          "type": "string",
          "default": "results",
          "description": "Base filename for reports"
        },
        "includeSkipped": {
          "type": "boolean",
          "default": true,
          "description": "Include skipped tests in reports"
        },
        "includePending": {
          "type": "boolean",
          "default": false,
          "description": "Include pending tests in reports"
        },
        "includePassedAssertions": {
          "type": "boolean",
          "default": false,
          "description": "Include passed assertions in reports"
        },
        "timestamp": {
          "type": "boolean",
          "default": true,
          "description": "Add timestamp to reports"
        },
        "detailed": {
          "type": "boolean",
          "default": false,
          "description": "Include detailed test information"
        },
        "summary": {
          "type": "boolean",
          "default": true,
          "description": "Include summary section in reports"
        },
        "coverage": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false,
              "description": "Include coverage in reports"
            },
            "formats": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["html", "json", "lcov", "cobertura", "text"]
              },
              "default": ["html"],
              "description": "Coverage report formats"
            },
            "directory": {
              "type": "string",
              "default": "coverage",
              "description": "Coverage output directory"
            },
            "watermarks": {
              "type": "object",
              "properties": {
                "statements": {
                  "type": "array",
                  "items": { "type": "number", "minimum": 0, "maximum": 100 },
                  "minItems": 2,
                  "maxItems": 2,
                  "description": "Statement coverage watermarks [low, high]"
                },
                "functions": {
                  "type": "array",
                  "items": { "type": "number", "minimum": 0, "maximum": 100 },
                  "minItems": 2,
                  "maxItems": 2,
                  "description": "Function coverage watermarks [low, high]"
                },
                "branches": {
                  "type": "array",
                  "items": { "type": "number", "minimum": 0, "maximum": 100 },
                  "minItems": 2,
                  "maxItems": 2,
                  "description": "Branch coverage watermarks [low, high]"
                },
                "lines": {
                  "type": "array",
                  "items": { "type": "number", "minimum": 0, "maximum": 100 },
                  "minItems": 2,
                  "maxItems": 2,
                  "description": "Line coverage watermarks [low, high]"
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "performance": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false,
              "description": "Include performance data in reports"
            },
            "charts": {
              "type": "boolean",
              "default": false,
              "description": "Generate performance charts"
            },
            "trends": {
              "type": "boolean",
              "default": false,
              "description": "Show performance trends over time"
            },
            "baseline": {
              "type": "boolean",
              "default": false,
              "description": "Compare performance with baseline"
            }
          },
          "additionalProperties": false
        },
        "notifications": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false,
              "description": "Enable report notifications"
            },
            "channels": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["email", "slack", "webhook", "teams"]
              },
              "description": "Notification channels"
            },
            "conditions": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["success", "failure", "regression", "improvement"]
              },
              "description": "Conditions that trigger notifications"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "environment": {
      "type": "object",
      "description": "Environment and runtime configuration",
      "properties": {
        "node": {
          "type": "object",
          "properties": {
            "version": {
              "type": "string",
              "pattern": "^[>=<~^]*\\d+\\.\\d+\\.\\d+",
              "description": "Required Node.js version (semver)"
            },
            "flags": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Node.js command line flags"
            }
          },
          "additionalProperties": false
        },
        "variables": {
          "type": "object",
          "patternProperties": {
            "^[A-Z_][A-Z0-9_]*$": {
              "type": "string"
            }
          },
          "description": "Environment variables to set"
        },
        "paths": {
          "type": "object",
          "properties": {
            "node_modules": {
              "type": "string",
              "description": "Path to node_modules directory"
            },
            "cache": {
              "type": "string",
              "description": "Path to cache directory"
            },
            "temp": {
              "type": "string",
              "description": "Path to temporary directory"
            }
          },
          "additionalProperties": false
        },
        "limits": {
          "type": "object",
          "properties": {
            "maxMemory": {
              "type": "string",
              "pattern": "^\\d+[KMGT]?B?$",
              "description": "Maximum memory usage (e.g., '2GB', '512MB')"
            },
            "maxDuration": {
              "type": "string",
              "pattern": "^\\d+[smhd]$",
              "description": "Maximum execution time (e.g., '30m', '2h')"
            },
            "maxFiles": {
              "type": "integer",
              "minimum": 1,
              "description": "Maximum number of files to process"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "plugins": {
      "type": "object",
      "description": "Plugin system configuration",
      "properties": {
        "enabled": {
          "type": "array",
          "items": { "type": "string" },
          "description": "List of enabled plugins"
        },
        "disabled": {
          "type": "array",
          "items": { "type": "string" },
          "description": "List of disabled plugins"
        },
        "autoLoad": {
          "type": "boolean",
          "default": true,
          "description": "Automatically load available plugins"
        },
        "searchPaths": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Directories to search for plugins"
        },
        "configuration": {
          "type": "object",
          "description": "Plugin-specific configuration",
          "additionalProperties": {
            "type": "object"
          }
        }
      },
      "additionalProperties": false
    },
    "rules": {
      "type": "object",
      "description": "Custom rules and validation thresholds",
      "properties": {
        "coverage": {
          "type": "object",
          "properties": {
            "global": {
              "type": "object",
              "properties": {
                "statements": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 100,
                  "description": "Minimum global statement coverage percentage"
                },
                "branches": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 100,
                  "description": "Minimum global branch coverage percentage"
                },
                "functions": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 100,
                  "description": "Minimum global function coverage percentage"
                },
                "lines": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 100,
                  "description": "Minimum global line coverage percentage"
                }
              },
              "additionalProperties": false
            },
            "perFile": {
              "type": "object",
              "properties": {
                "statements": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 100,
                  "description": "Minimum per-file statement coverage percentage"
                },
                "branches": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 100,
                  "description": "Minimum per-file branch coverage percentage"
                },
                "functions": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 100,
                  "description": "Minimum per-file function coverage percentage"
                },
                "lines": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 100,
                  "description": "Minimum per-file line coverage percentage"
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "performance": {
          "type": "object",
          "properties": {
            "regressionThreshold": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Performance regression threshold (0-1)"
            },
            "absoluteThresholds": {
              "type": "object",
              "properties": {
                "testDuration": {
                  "type": "integer",
                  "minimum": 1,
                  "description": "Maximum test duration in milliseconds"
                },
                "memoryUsage": {
                  "type": "integer",
                  "minimum": 1,
                  "description": "Maximum memory usage in bytes"
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "quality": {
          "type": "object",
          "properties": {
            "maxTestFileSize": {
              "type": "string",
              "pattern": "^\\d+[KMGT]?B$",
              "description": "Maximum test file size (e.g., '50KB')"
            },
            "maxTestsPerFile": {
              "type": "integer",
              "minimum": 1,
              "description": "Maximum number of tests per file"
            },
            "requireDescriptions": {
              "type": "boolean",
              "default": false,
              "description": "Require descriptions for all tests"
            },
            "forbiddenPatterns": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Forbidden code patterns in tests"
            }
          },
          "additionalProperties": false
        },
        "dependencies": {
          "type": "object",
          "properties": {
            "allowedPackages": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Whitelist of allowed npm packages"
            },
            "blockedPackages": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Blacklist of blocked npm packages"
            },
            "maxDependencies": {
              "type": "integer",
              "minimum": 1,
              "description": "Maximum number of dependencies allowed"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "integrations": {
      "type": "object",
      "description": "Third-party service integrations",
      "properties": {
        "ci": {
          "type": "object",
          "properties": {
            "provider": {
              "type": "string",
              "enum": ["github", "gitlab", "jenkins", "azure", "circleci", "travis"],
              "description": "CI/CD provider"
            },
            "uploadArtifacts": {
              "type": "boolean",
              "default": false,
              "description": "Upload test artifacts to CI"
            },
            "commentOnPR": {
              "type": "boolean",
              "default": false,
              "description": "Comment test results on pull requests"
            },
            "failOnRegression": {
              "type": "boolean",
              "default": false,
              "description": "Fail CI build on performance regression"
            }
          },
          "additionalProperties": false
        },
        "codecov": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false,
              "description": "Enable Codecov integration"
            },
            "token": {
              "type": "string",
              "description": "Codecov upload token"
            },
            "flags": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Coverage flags for Codecov"
            }
          },
          "additionalProperties": false
        },
        "sonarqube": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false,
              "description": "Enable SonarQube integration"
            },
            "serverUrl": {
              "type": "string",
              "format": "uri",
              "description": "SonarQube server URL"
            },
            "projectKey": {
              "type": "string",
              "description": "SonarQube project key"
            }
          },
          "additionalProperties": false
        },
        "slack": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false,
              "description": "Enable Slack notifications"
            },
            "webhook": {
              "type": "string",
              "format": "uri",
              "description": "Slack webhook URL"
            },
            "channels": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Slack channels to notify"
            },
            "mentions": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Users or groups to mention"
            }
          },
          "additionalProperties": false
        },
        "datadog": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false,
              "description": "Enable Datadog metrics"
            },
            "apiKey": {
              "type": "string",
              "description": "Datadog API key"
            },
            "tags": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Tags to add to Datadog metrics"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}